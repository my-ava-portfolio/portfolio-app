"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[28],{1028:(Mr,We,f)=>{f.r(We),f.d(We,{MapSandboxModule:()=>Lr});var w=f(6895),G=f(2216),Le=f(646),_=f(2687),e=f(4650),Ie=f(9947),kt=f(3686),Y=f(7579);let ne=(()=>{class o{constructor(){this.layerIdSelected=new Y.x,this.allLayers=new Y.x,this.removeLayers=new Y.x}sendAllLayers(t){this.allLayers.next(t)}removeAllLayers(){this.removeLayers.next(!0)}sendSelectedLayerId(t){this.layerIdSelected.next(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),Zt=(()=>{class o{constructor(t){this._elemRef=t,this.setHeight()}ngAfterViewChecked(){this.setHeight()}onResize(t){this.setHeight()}setHeight(){this._elemRef.nativeElement.style.height=window.innerHeight-this._elemRef.nativeElement.offsetTop+"px"}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","fluidHeight",""]],hostBindings:function(t,i){1&t&&e.NdJ("resize",function(s){return i.onResize(s)},!1,e.Jf7)}}),o})(),Me=(()=>{class o{constructor(t,i){this._elemRef=t,this.renderer=i,this.isRemoved=!1,this.renderer.appendChild(document.body,this._elemRef.nativeElement)}ngOnChanges(t){t.isRemoved.currentValue&&this.ngOnDestroy()}ngOnDestroy(){this.renderer.removeChild(document.body,this._elemRef.nativeElement)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq),e.Y36(e.Qsj))},o.\u0275dir=e.lG2({type:o,selectors:[["","moveDivToBody",""]],inputs:{isRemoved:"isRemoved"},features:[e.TTD]}),o})();var I=f(3171),K=f(9972),At=f(7660),x=f(760),M=f(1729);class ie extends At.Z{constructor(n){super(),this.geometries_=n||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(M.bN),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let n=0,t=this.geometries_.length;n<t;++n)this.changeEventsKeys_.push((0,M.oL)(this.geometries_[n],K.Z.CHANGE,this.changed,this))}clone(){const n=new ie(null);return n.setGeometries(this.geometries_),n.applyProperties(this),n}closestPointXY(n,t,i,r){if(r<(0,x.qf)(this.getExtent(),n,t))return r;const s=this.geometries_;for(let a=0,l=s.length;a<l;++a)r=s[a].closestPointXY(n,t,i,r);return r}containsXY(n,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)if(i[r].containsXY(n,t))return!0;return!1}computeExtent(n){(0,x.YN)(n);const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)(0,x.l7)(n,t[i].getExtent());return n}getGeometries(){return Xe(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let n=[];const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].getType()===this.getType()?n=n.concat(t[i].getGeometriesArrayRecursive()):n.push(t[i]);return n}getSimplifiedGeometry(n){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),n<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&n<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let r=!1;for(let s=0,a=i.length;s<a;++s){const l=i[s],c=l.getSimplifiedGeometry(n);t.push(c),c!==l&&(r=!0)}if(r){const s=new ie(null);return s.setGeometriesArray(t),s}return this.simplifiedGeometryMaxMinSquaredTolerance=n,this}getType(){return"GeometryCollection"}intersectsExtent(n){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)if(t[i].intersectsExtent(n))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(n,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].rotate(n,t);this.changed()}scale(n,t,i){i||(i=(0,x.qg)(this.getExtent()));const r=this.geometries_;for(let s=0,a=r.length;s<a;++s)r[s].scale(n,t,i);this.changed()}setGeometries(n){this.setGeometriesArray(Xe(n))}setGeometriesArray(n){this.unlistenGeometriesChange_(),this.geometries_=n,this.listenGeometriesChange_(),this.changed()}applyTransform(n){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].applyTransform(n);this.changed()}translate(n,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].translate(n,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Xe(o){const n=[];for(let t=0,i=o.length;t<i;++t)n.push(o[t].clone());return n}const W=ie;var T=f(119),y=f(6003);const ze=class Gt{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(n,t){if(t){let i=t.dataProjection?(0,y.U2)(t.dataProjection):this.readProjection(n);t.extent&&i&&"tile-pixels"===i.getUnits()&&(i=(0,y.U2)(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(n){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},n)}getType(){return(0,T.O3)()}readFeature(n,t){return(0,T.O3)()}readFeatures(n,t){return(0,T.O3)()}readGeometry(n,t){return(0,T.O3)()}readProjection(n){return(0,T.O3)()}writeFeature(n,t){return(0,T.O3)()}writeFeatures(n,t){return(0,T.O3)()}writeGeometry(n,t){return(0,T.O3)()}};function re(o,n,t){const i=t?(0,y.U2)(t.featureProjection):null,r=t?(0,y.U2)(t.dataProjection):null;let s;if(s=i&&r&&!(0,y.OP)(i,r)?(n?o.clone():o).transform(n?i:r,n?r:i):o,n&&t&&void 0!==t.decimals){const a=Math.pow(10,t.decimals),l=function(c){for(let d=0,u=c.length;d<u;++d)c[d]=Math.round(c[d]*a)/a;return c};s===o&&(s=o.clone()),s.applyTransform(l)}return s}function oe(o){return"string"==typeof o?JSON.parse(o)||null:null!==o?o:null}const Nt=class Ot extends ze{constructor(){super()}getType(){return"json"}readFeature(n,t){return this.readFeatureFromObject(oe(n),this.getReadOptions(n,t))}readFeatures(n,t){return this.readFeaturesFromObject(oe(n),this.getReadOptions(n,t))}readFeatureFromObject(n,t){return(0,T.O3)()}readFeaturesFromObject(n,t){return(0,T.O3)()}readGeometry(n,t){return this.readGeometryFromObject(oe(n),this.getReadOptions(n,t))}readGeometryFromObject(n,t){return(0,T.O3)()}readProjection(n){return this.readProjectionFromObject(oe(n))}readProjectionFromObject(n){return(0,T.O3)()}writeFeature(n,t){return JSON.stringify(this.writeFeatureObject(n,t))}writeFeatureObject(n,t){return(0,T.O3)()}writeFeatures(n,t){return JSON.stringify(this.writeFeaturesObject(n,t))}writeFeaturesObject(n,t){return(0,T.O3)()}writeGeometry(n,t){return JSON.stringify(this.writeGeometryObject(n,t))}writeGeometryObject(n,t){return(0,T.O3)()}};var O=f(6527),q=f(2774),se=f(5066),ae=f(8999),$e=f(9182),R=f(2456),ke=f(392),et=f(410),tt=f(9644);class le extends q.ZP{constructor(n,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(n[0]))this.setCoordinates(n,t);else if(void 0!==t&&i)this.setFlatCoordinates(t,n),this.ends_=i;else{let r=this.getLayout();const s=n,a=[],l=[];for(let c=0,d=s.length;c<d;++c){const u=s[c];0===c&&(r=u.getLayout()),(0,R.l7)(a,u.getFlatCoordinates()),l.push(a.length)}this.setFlatCoordinates(r,a),this.ends_=l}}appendLineString(n){this.flatCoordinates?(0,R.l7)(this.flatCoordinates,n.getFlatCoordinates().slice()):this.flatCoordinates=n.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const n=new le(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return n.applyProperties(this),n}closestPointXY(n,t,i,r){return r<(0,x.qf)(this.getExtent(),n,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,se.Af)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,se.Xl)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,n,t,i,r))}getCoordinateAtM(n,t,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(0,et.dG)(this.flatCoordinates,0,this.ends_,this.stride,n,t=void 0!==t&&t,i=void 0!==i&&i)}getCoordinates(){return(0,ke.o1)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(n){return n<0||this.ends_.length<=n?null:new O.Z(this.flatCoordinates.slice(0===n?0:this.ends_[n-1],this.ends_[n]),this.layout)}getLineStrings(){const n=this.flatCoordinates,t=this.ends_,i=this.layout,r=[];let s=0;for(let a=0,l=t.length;a<l;++a){const c=t[a],d=new O.Z(n.slice(s,c),i);r.push(d),s=c}return r}getFlatMidpoints(){const n=[],t=this.flatCoordinates;let i=0;const r=this.ends_,s=this.stride;for(let a=0,l=r.length;a<l;++a){const c=r[a],d=(0,et.WW)(t,i,c,s,.5);(0,R.l7)(n,d),i=c}return n}getSimplifiedGeometryInternal(n){const t=[],i=[];return t.length=(0,$e.UJ)(this.flatCoordinates,0,this.ends_,this.stride,n,t,0,i),new le(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(n){return(0,tt.AW)(this.flatCoordinates,0,this.ends_,this.stride,n)}setCoordinates(n,t){this.setLayout(t,n,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,ae._5)(this.flatCoordinates,0,n,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const ce=le;var D=f(187),X=f(2156);class Ze extends q.ZP{constructor(n,t){super(),t&&!Array.isArray(n[0])?this.setFlatCoordinates(t,n):this.setCoordinates(n,t)}appendPoint(n){this.flatCoordinates?(0,R.l7)(this.flatCoordinates,n.getFlatCoordinates()):this.flatCoordinates=n.getFlatCoordinates().slice(),this.changed()}clone(){const n=new Ze(this.flatCoordinates.slice(),this.layout);return n.applyProperties(this),n}closestPointXY(n,t,i,r){if(r<(0,x.qf)(this.getExtent(),n,t))return r;const s=this.flatCoordinates,a=this.stride;for(let l=0,c=s.length;l<c;l+=a){const d=(0,X.bI)(n,t,s[l],s[l+1]);if(d<r){r=d;for(let u=0;u<a;++u)i[u]=s[l+u];i.length=a}}return r}getCoordinates(){return(0,ke.Ml)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(n){return n<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=n?null:new D.Z(this.flatCoordinates.slice(n*this.stride,(n+1)*this.stride),this.layout)}getPoints(){const n=this.flatCoordinates,t=this.layout,i=this.stride,r=[];for(let s=0,a=n.length;s<a;s+=i){const l=new D.Z(n.slice(s,s+i),t);r.push(l)}return r}getType(){return"MultiPoint"}intersectsExtent(n){const t=this.flatCoordinates,i=this.stride;for(let r=0,s=t.length;r<s;r+=i)if((0,x.jE)(n,t[r],t[r+1]))return!0;return!1}setCoordinates(n,t){this.setLayout(t,n,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,ae.Sg)(this.flatCoordinates,0,n,this.stride),this.changed()}}const de=Ze;var A=f(2275),Dt=f(2474),Ae=f(1265),Jt=f(8818),Ut=f(4325);class ue extends q.ZP{constructor(n,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(n[0])){let r=this.getLayout();const s=n,a=[],l=[];for(let c=0,d=s.length;c<d;++c){const u=s[c];0===c&&(r=u.getLayout());const p=a.length,h=u.getEnds();for(let g=0,m=h.length;g<m;++g)h[g]+=p;(0,R.l7)(a,u.getFlatCoordinates()),l.push(h)}t=r,n=a,i=l}void 0!==t&&i?(this.setFlatCoordinates(t,n),this.endss_=i):this.setCoordinates(n,t)}appendPolygon(n){let t;if(this.flatCoordinates){const i=this.flatCoordinates.length;(0,R.l7)(this.flatCoordinates,n.getFlatCoordinates()),t=n.getEnds().slice();for(let r=0,s=t.length;r<s;++r)t[r]+=i}else this.flatCoordinates=n.getFlatCoordinates().slice(),t=n.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){const n=this.endss_.length,t=new Array(n);for(let r=0;r<n;++r)t[r]=this.endss_[r].slice();const i=new ue(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(n,t,i,r){return r<(0,x.qf)(this.getExtent(),n,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,se.sD)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,se.gI)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,n,t,i,r))}containsXY(n,t){return(0,Ut.Zl)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,n,t)}getArea(){return(0,Jt.Eu)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(n){let t;return void 0!==n?(t=this.getOrientedFlatCoordinates().slice(),(0,Ae.dL)(t,0,this.endss_,this.stride,n)):t=this.flatCoordinates,(0,ke.ug)(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const n=function Rt(o,n,t,i){const r=[];let s=(0,x.lJ)();for(let a=0,l=t.length;a<l;++a){const c=t[a];s=(0,x.GN)(o,n,c[0],i),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),n=c[c.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,Dt.U)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,n),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new de(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const n=this.flatCoordinates;(0,Ae.Oj)(n,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=n:(this.orientedFlatCoordinates_=n.slice(),this.orientedFlatCoordinates_.length=(0,Ae.dL)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(n){const t=[],i=[];return t.length=(0,$e.Pp)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(n),t,0,i),new ue(t,"XY",i)}getPolygon(n){if(n<0||this.endss_.length<=n)return null;let t;if(0===n)t=0;else{const s=this.endss_[n-1];t=s[s.length-1]}const i=this.endss_[n].slice(),r=i[i.length-1];if(0!==t)for(let s=0,a=i.length;s<a;++s)i[s]-=t;return new A.ZP(this.flatCoordinates.slice(t,r),this.layout,i)}getPolygons(){const n=this.layout,t=this.flatCoordinates,i=this.endss_,r=[];let s=0;for(let a=0,l=i.length;a<l;++a){const c=i[a].slice(),d=c[c.length-1];if(0!==s)for(let p=0,h=c.length;p<h;++p)c[p]-=s;const u=new A.ZP(t.slice(s,d),n,c);r.push(u),s=d}return r}getType(){return"MultiPolygon"}intersectsExtent(n){return(0,tt.oW)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,n)}setCoordinates(n,t){this.setLayout(t,n,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,ae.QT)(this.flatCoordinates,0,n,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()}}const he=ue;var jt=f(1911),qt=f(9466);function Ge(o,n){if(!o)return null;let t;switch(o.type){case"Point":t=function Bt(o){return new D.Z(o.coordinates)}(o);break;case"LineString":t=function Vt(o){return new O.Z(o.coordinates)}(o);break;case"Polygon":t=function Xt(o){return new A.ZP(o.coordinates)}(o);break;case"MultiPoint":t=function Kt(o){return new de(o.coordinates)}(o);break;case"MultiLineString":t=function Yt(o){return new ce(o.coordinates)}(o);break;case"MultiPolygon":t=function Wt(o){return new he(o.coordinates)}(o);break;case"GeometryCollection":t=function Ht(o,n){const t=o.geometries.map(function(i){return Ge(i,n)});return new W(t)}(o);break;default:throw new Error("Unsupported GeoJSON type: "+o.type)}return re(t,!1,n)}function Oe(o,n){const t=(o=re(o,!0,n)).getType();let i;switch(t){case"Point":i=function rn(o,n){return{type:"Point",coordinates:o.getCoordinates()}}(o);break;case"LineString":i=function $t(o,n){return{type:"LineString",coordinates:o.getCoordinates()}}(o);break;case"Polygon":i=function on(o,n){let t;return n&&(t=n.rightHanded),{type:"Polygon",coordinates:o.getCoordinates(t)}}(o,n);break;case"MultiPoint":i=function tn(o,n){return{type:"MultiPoint",coordinates:o.getCoordinates()}}(o);break;case"MultiLineString":i=function en(o,n){return{type:"MultiLineString",coordinates:o.getCoordinates()}}(o);break;case"MultiPolygon":i=function nn(o,n){let t;return n&&(t=n.rightHanded),{type:"MultiPolygon",coordinates:o.getCoordinates(t)}}(o,n);break;case"GeometryCollection":i=function zt(o,n){return delete(n=Object.assign({},n)).featureProjection,{type:"GeometryCollection",geometries:o.getGeometriesArray().map(function(i){return Oe(i,n)})}}(o,n);break;case"Circle":i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+t)}return i}const nt=class Qt extends Nt{constructor(n){n=n||{},super(),this.dataProjection=(0,y.U2)(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(this.defaultFeatureProjection=(0,y.U2)(n.featureProjection)),this.geometryName_=n.geometryName,this.extractGeometryName_=n.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(n,t){let i=null;i="Feature"===n.type?n:{type:"Feature",geometry:n,properties:null};const r=Ge(i.geometry,t),s=new I.Z;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&s.setGeometryName(i.geometry_name),s.setGeometry(r),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(n,t){let r=null;if("FeatureCollection"===n.type){r=[];const a=n.features;for(let l=0,c=a.length;l<c;++l)r.push(this.readFeatureFromObject(a[l],t))}else r=[this.readFeatureFromObject(n,t)];return r}readGeometryFromObject(n,t){return Ge(n,t)}readProjectionFromObject(n){const t=n.crs;let i;return t?"name"==t.type?i=(0,y.U2)(t.properties.name):"EPSG"===t.type?i=(0,y.U2)("EPSG:"+t.properties.code):(0,jt.h)(!1,36):i=this.dataProjection,i}writeFeatureObject(n,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},r=n.getId();if(void 0!==r&&(i.id=r),!n.hasProperties())return i;const s=n.getProperties(),a=n.getGeometry();return a&&(i.geometry=Oe(a,t),delete s[n.getGeometryName()]),(0,qt.x)(s)||(i.properties=s),i}writeFeaturesObject(n,t){t=this.adaptOptions(t);const i=[];for(let r=0,s=n.length;r<s;++r)i.push(this.writeFeatureObject(n[r],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(n,t){return Oe(n,this.adaptOptions(t))}};var Ne=f(7053),z=f(5947);const it={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let ge;const sn=new Uint8Array(16);function an(){if(!ge&&(ge=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ge))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ge(sn)}const S=[];for(let o=0;o<256;++o)S.push((o+256).toString(16).slice(1));const ot=function ln(o,n,t){if(it.randomUUID&&!n&&!o)return it.randomUUID();const i=(o=o||{}).random||(o.rng||an)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){t=t||0;for(let r=0;r<16;++r)n[t+r]=i[r];return n}return function rt(o,n=0){return(S[o[n+0]]+S[o[n+1]]+S[o[n+2]]+S[o[n+3]]+"-"+S[o[n+4]]+S[o[n+5]]+"-"+S[o[n+6]]+S[o[n+7]]+"-"+S[o[n+8]]+S[o[n+9]]+"-"+S[o[n+10]]+S[o[n+11]]+S[o[n+12]]+S[o[n+13]]+S[o[n+14]]+S[o[n+15]]).toLowerCase()}(i)},st=/^#([0-9a-f]{3}){1,2}$/i,un=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928","#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"];function at(){const o=un;return o[Math.floor(Math.random()*o.length)]}const hn=_.diR,gn=_.fQK,pn=_.ubJ;var k=f(6597),fn=f(154),mn=f(3324),pe=f(9889),fe=f(5002),lt=f(2909),me=f(4412),Q=f(1345),P=f(3481);function ct(o){return o.feature?o.feature:o.element?o.element:void 0}const De=[],yn=class _n extends fe.Z{constructor(n){const t=n=n||{};t.handleDownEvent||(t.handleDownEvent=Q.uX),t.stopDown||(t.stopDown=Q.Dv),super(t),this.source_=n.source?n.source:null,this.vertex_=void 0===n.vertex||n.vertex,this.edge_=void 0===n.edge||n.edge,this.features_=n.features?n.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,this.rBush_=new lt.Z,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(n,t){t=void 0===t||t;const i=(0,T.sq)(n),r=n.getGeometry();if(r){const s=this.GEOMETRY_SEGMENTERS_[r.getType()];if(s){this.indexedFeaturesExtents_[i]=r.getExtent((0,x.lJ)());const a=[];if(s(a,r),1===a.length)this.rBush_.insert((0,x.hI)(a[0]),{feature:n,segment:a[0]});else if(a.length>1){const l=a.map(d=>(0,x.hI)(d)),c=a.map(d=>({feature:n,segment:d}));this.rBush_.load(l,c)}}}t&&(this.featureChangeListenerKeys_[i]=(0,M.oL)(n,K.Z.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let n;return this.features_?n=this.features_:this.source_&&(n=this.source_.getFeatures()),n}handleEvent(n){const t=this.snapTo(n.pixel,n.coordinate,n.map);return t&&(n.coordinate=t.vertex.slice(0,2),n.pixel=t.vertexPixel),super.handleEvent(n)}handleFeatureAdd_(n){const t=ct(n);this.addFeature(t)}handleFeatureRemove_(n){const t=ct(n);this.removeFeature(t)}handleFeatureChange_(n){const t=n.target;if(this.handlingDownUpSequence){const i=(0,T.sq)(t);i in this.pendingFeatures_||(this.pendingFeatures_[i]=t)}else this.updateFeature_(t)}handleUpEvent(n){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(n,t){const i=void 0===t||t,r=(0,T.sq)(n),s=this.indexedFeaturesExtents_[r];if(s){const a=this.rBush_,l=[];a.forEachInExtent(s,function(c){n===c.feature&&l.push(c)});for(let c=l.length-1;c>=0;--c)a.remove(l[c])}i&&((0,M.bN)(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])}setMap(n){const t=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();t&&(i.forEach(M.bN),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(M.bN),this.featureChangeListenerKeys_={}),super.setMap(n),n&&(this.features_?i.push((0,M.oL)(this.features_,pe.Z.ADD,this.handleFeatureAdd_,this),(0,M.oL)(this.features_,pe.Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push((0,M.oL)(this.source_,me.Z.ADDFEATURE,this.handleFeatureAdd_,this),(0,M.oL)(this.source_,me.Z.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(s=>this.addFeature(s)))}snapTo(n,t,i){const r=i.getView().getProjection(),s=(0,y.Vs)(t,r),a=(0,y.Fj)((0,x.f3)((0,x.hI)([s]),i.getView().getResolution()*this.pixelTolerance_),r),l=this.rBush_.getInExtent(a),c=l.length;if(0===c)return null;let d,u=1/0;const p=this.pixelTolerance_*this.pixelTolerance_,h=()=>{if(d){const g=i.getPixelFromCoordinate(d);if((0,P.bI)(n,g)<=p)return{vertex:d,vertexPixel:[Math.round(g[0]),Math.round(g[1])]}}return null};if(this.vertex_){for(let m=0;m<c;++m){const C=l[m];"Circle"!==C.feature.getGeometry().getType()&&C.segment.forEach(b=>{const F=(0,y.Vs)(b,r),E=(0,P.bI)(s,F);E<u&&(d=b,u=E)})}const g=h();if(g)return g}if(this.edge_){for(let m=0;m<c;++m){let C=null;const b=l[m];if("Circle"===b.feature.getGeometry().getType()){let F=b.feature.getGeometry();const E=(0,y.Cs)();E&&(F=F.clone().transform(E,r)),C=(0,P.Ed)(s,F)}else{const[F,E]=b.segment;E&&(De[0]=(0,y.Vs)(F,r),De[1]=(0,y.Vs)(E,r),C=(0,P.oL)(s,De))}if(C){const F=(0,P.bI)(s,C);F<u&&(d=(0,y.lO)(C,r),u=F)}}const g=h();if(g)return g}return null}updateFeature_(n){this.removeFeature(n,!1),this.addFeature(n,!1)}segmentCircleGeometry_(n,t){const i=this.getMap().getView().getProjection();let r=t;const s=(0,y.Cs)();s&&(r=r.clone().transform(s,i));const a=(0,A.Bb)(r);s&&a.transform(i,s);const l=a.getCoordinates()[0];for(let c=0,d=l.length-1;c<d;++c)n.push(l.slice(c,c+2))}segmentGeometryCollectionGeometry_(n,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const s=this.GEOMETRY_SEGMENTERS_[i[r].getType()];s&&s(n,i[r])}}segmentLineStringGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length-1;r<s;++r)n.push(i.slice(r,r+2))}segmentMultiLineStringGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l)n.push(a.slice(l,l+2))}}segmentMultiPointGeometry_(n,t){t.getCoordinates().forEach(i=>{n.push([i])})}segmentMultiPolygonGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let u=0,p=d.length-1;u<p;++u)n.push(d.slice(u,u+2))}}}segmentPointGeometry_(n,t){n.push([t.getCoordinates()])}segmentPolygonGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l)n.push(a.slice(l,l+2))}}};var $=f(2815),Je=f(8214),dt=f(7366);class Ue extends Je.ZP{constructor(n,t,i,r,s){super(n),this.features=t,this.coordinate=i,this.startCoordinate=r,this.mapBrowserEvent=s}}const xn=class Cn extends fe.Z{constructor(n){let t;if(super(n=n||{}),this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=void 0!==n.features?n.features:null,n.layers&&!this.features_)if("function"==typeof n.layers)t=n.layers;else{const i=n.layers;t=function(r){return i.includes(r)}}else t=Q.uX;this.layerFilter_=t,this.filter_=n.filter&&!this.features_?n.filter:Q.uX,this.hitTolerance_=n.hitTolerance?n.hitTolerance:0,this.condition_=n.condition?n.condition:k.Bx,this.lastFeature_=null,this.addChangeListener(dt.Z.ACTIVE,this.handleActiveChanged_)}handleDownEvent(n){if(!n.originalEvent||!this.condition_(n))return!1;if(this.lastFeature_=this.featuresAtPixel_(n.pixel,n.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=n.coordinate,this.lastCoordinate_=n.coordinate,this.handleMoveEvent(n);const t=this.features_||new $.Z([this.lastFeature_]);return this.dispatchEvent(new Ue("translatestart",t,n.coordinate,this.startCoordinate_,n)),!0}return!1}handleUpEvent(n){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(n);const t=this.features_||new $.Z([this.lastFeature_]);return this.dispatchEvent(new Ue("translateend",t,n.coordinate,this.startCoordinate_,n)),this.startCoordinate_=null,!0}return!1}handleDragEvent(n){if(this.lastCoordinate_){const t=n.coordinate,i=t[0]-this.lastCoordinate_[0],r=t[1]-this.lastCoordinate_[1],s=this.features_||new $.Z([this.lastFeature_]);s.forEach(function(a){const l=a.getGeometry();l.translate(i,r),a.setGeometry(l)}),this.lastCoordinate_=t,this.dispatchEvent(new Ue("translating",s,t,this.startCoordinate_,n))}}handleMoveEvent(n){const t=n.map.getViewport();this.featuresAtPixel_(n.pixel,n.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(n,t){return t.forEachFeatureAtPixel(n,(i,r)=>{if(i instanceof I.Z&&this.filter_(i,r)&&(!this.features_||this.features_.getArray().includes(i)))return i},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(n){this.hitTolerance_=n}setMap(n){const t=this.getMap();super.setMap(n),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(n){let t=this.getMap();const i=this.getActive();(!t||!i)&&(t=t||n,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}};var Z=f(4624),U=f(109);const ee=1,ht=[0,0,0,0],H=[];class qe extends Je.ZP{constructor(n,t,i){super(n),this.features=t,this.mapBrowserEvent=i}}function vn(o,n){return o.index-n.index}function gt(o,n,t){const i=n.geometry;if("Circle"===i.getType()){let s=i;if(n.index===ee){const a=(0,y.Cs)();a&&(s=s.clone().transform(a,t));const l=(0,P.bI)(s.getCenter(),(0,y.Vs)(o,t)),c=Math.sqrt(l)-s.getRadius();return c*c}}const r=(0,y.Vs)(o,t);return H[0]=(0,y.Vs)(n.segment[0],t),H[1]=(0,y.Vs)(n.segment[1],t),(0,P.Bs)(r,H)}function pt(o,n,t){const i=n.geometry;if("Circle"===i.getType()&&n.index===ee){let s=i;const a=(0,y.Cs)();return a&&(s=s.clone().transform(a,t)),(0,y.lO)(s.getClosestPoint((0,y.Vs)(o,t)),t)}const r=(0,y.Vs)(o,t);return H[0]=(0,y.Vs)(n.segment[0],t),H[1]=(0,y.Vs)(n.segment[1],t),(0,y.lO)((0,P.oL)(r,H),t)}function bn(){const o=(0,U.Ly)();return function(n,t){return o.Point}}const wn=class Tn extends fe.Z{constructor(n){let t;if(super(n),this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=n.condition?n.condition:k.Xp,this.defaultDeleteCondition_=function(i){return(0,k.Ko)(i)&&(0,k.Kf)(i)},this.deleteCondition_=n.deleteCondition?n.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=n.insertVertexCondition?n.insertVertexCondition:k.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new lt.Z,this.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ne.Z({source:new z.Z({useSpatialIndex:!1,wrapX:!!n.wrapX}),style:n.style?n.style:bn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,n.features?t=n.features:n.source&&(this.source_=n.source,t=new $.Z(this.source_.getFeatures()),this.source_.addEventListener(me.Z.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(me.Z.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");n.hitDetection&&(this.hitDetection_=n.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(pe.Z.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(pe.Z.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===n.snapToPointer?!this.hitDetection_:n.snapToPointer}addFeature_(n){const t=n.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(n,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),n.addEventListener(K.Z.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(n,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new $.Z;const i=this.featuresBeingModified_.getArray();for(let r=0,s=t.length;r<s;++r){const a=t[r];for(let l=0,c=a.length;l<c;++l){const d=a[l].feature;d&&!i.includes(d)&&this.featuresBeingModified_.push(d)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new qe("modifystart",this.featuresBeingModified_,n))}}removeFeature_(n){this.removeFeatureSegmentData_(n),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),n.removeEventListener(K.Z.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(n){const t=this.rBush_,i=[];t.forEach(function(r){n===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const s=i[r];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===s&&this.dragSegments_.splice(a,1);t.remove(s)}}setActive(n){this.vertexFeature_&&!n&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(n)}setMap(n){this.overlay_.setMap(n),super.setMap(n)}getOverlay(){return this.overlay_}handleSourceAdd_(n){n.feature&&this.features_.push(n.feature)}handleSourceRemove_(n){n.feature&&this.features_.remove(n.feature)}handleFeatureAdd_(n){this.addFeature_(n.element)}handleFeatureChange_(n){if(!this.changingFeature_){const t=n.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(n){this.removeFeature_(n.element)}writePointGeometry_(n,t){const i=t.getCoordinates(),r={feature:n,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),r)}writeMultiPointGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r],l={feature:n,geometry:t,depth:[r],index:r,segment:[a,a]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length-1;r<s;++r){const a=i.slice(r,r+2),l={feature:n,geometry:t,index:r,segment:a};this.rBush_.insert((0,x.hI)(a),l)}}writeMultiLineStringGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),u={feature:n,geometry:t,depth:[r],index:l,segment:d};this.rBush_.insert((0,x.hI)(d),u)}}}writePolygonGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),u={feature:n,geometry:t,depth:[r],index:l,segment:d};this.rBush_.insert((0,x.hI)(d),u)}}}writeMultiPolygonGeometry_(n,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let u=0,p=d.length-1;u<p;++u){const h=d.slice(u,u+2),g={feature:n,geometry:t,depth:[l,r],index:u,segment:h};this.rBush_.insert((0,x.hI)(h),g)}}}}writeCircleGeometry_(n,t){const i=t.getCenter(),r={feature:n,geometry:t,index:0,segment:[i,i]},s={feature:n,geometry:t,index:ee,segment:[i,i]},a=[r,s];r.featureSegments=a,s.featureSegments=a,this.rBush_.insert((0,x.HK)(i),r);let l=t;const c=(0,y.Cs)();if(c&&this.getMap()){const d=this.getMap().getView().getProjection();l=l.clone().transform(c,d),l=(0,A.Bb)(l).transform(d,c)}this.rBush_.insert(l.getExtent(),s)}writeGeometryCollectionGeometry_(n,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const s=i[r];(0,this.SEGMENT_WRITERS_[s.getType()])(n,s)}}createOrUpdateVertexFeature_(n,t,i){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(n):(r=new I.Z(new D.Z(n)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",i),r}handleEvent(n){if(!n.originalEvent)return!0;let t;return this.lastPointerEvent_=n,!n.map.getView().getInteracting()&&n.type==Z.Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(n),this.vertexFeature_&&this.deleteCondition_(n)&&(t=!(n.type!=Z.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),n.type==Z.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(n)&&!t}handleDragEvent(n){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(n,this.dragSegments_);const t=[n.coordinate[0]+this.delta_[0],n.coordinate[1]+this.delta_[1]],i=[],r=[];for(let s=0,a=this.dragSegments_.length;s<a;++s){const l=this.dragSegments_[s],c=l[0],d=c.feature;i.includes(d)||i.push(d);const u=c.geometry;r.includes(u)||r.push(u);const p=c.depth;let h;const g=c.segment,m=l[1];for(;t.length<u.getStride();)t.push(g[m][t.length]);switch(u.getType()){case"Point":h=t,g[0]=t,g[1]=t;break;case"MultiPoint":h=u.getCoordinates(),h[c.index]=t,g[0]=t,g[1]=t;break;case"LineString":h=u.getCoordinates(),h[c.index+m]=t,g[m]=t;break;case"MultiLineString":case"Polygon":h=u.getCoordinates(),h[p[0]][c.index+m]=t,g[m]=t;break;case"MultiPolygon":h=u.getCoordinates(),h[p[1]][p[0]][c.index+m]=t,g[m]=t;break;case"Circle":if(g[0]=t,g[1]=t,0===c.index)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const C=n.map.getView().getProjection();let b=(0,P.TE)((0,y.Vs)(u.getCenter(),C),(0,y.Vs)(t,C));const F=(0,y.Cs)();if(F){const E=u.clone().transform(F,C);E.setRadius(b),b=E.transform(C,F).getRadius()}u.setRadius(b),this.changingFeature_=!1}}h&&this.setGeometryCoordinates_(u,h)}this.createOrUpdateVertexFeature_(t,i,r)}handleDownEvent(n){if(!this.condition_(n))return!1;const t=n.coordinate;this.handlePointerAtPixel_(n.pixel,n.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const r=n.map.getView().getProjection(),s=[],a=i.getGeometry().getCoordinates(),l=(0,x.hI)([a]),c=this.rBush_.getInExtent(l),d={};c.sort(vn);for(let u=0,p=c.length;u<p;++u){const h=c[u],g=h.segment;let m=(0,T.sq)(h.geometry);const C=h.depth;if(C&&(m+="-"+C.join("-")),d[m]||(d[m]=new Array(2)),"Circle"!==h.geometry.getType()||h.index!==ee)if(!(0,P.fS)(g[0],a)||d[m][0])if(!(0,P.fS)(g[1],a)||d[m][1])(0,T.sq)(g)in this.vertexSegments_&&!d[m][0]&&!d[m][1]&&this.insertVertexCondition_(n)&&s.push(h);else{if(d[m][0]&&0===d[m][0].index){let b=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":b=b[C[1]];case"Polygon":if(h.index!==b[C[0]].length-2)continue}}this.dragSegments_.push([h,1]),d[m][1]=h}else this.dragSegments_.push([h,0]),d[m][0]=h;else{const b=pt(t,h,r);(0,P.fS)(b,a)&&!d[m][0]&&(this.dragSegments_.push([h,0]),d[m][0]=h)}}s.length&&this.willModifyFeatures_(n,[s]);for(let u=s.length-1;u>=0;--u)this.insertVertex_(s[u],a)}return!!this.vertexFeature_}handleUpEvent(n){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],r=i.geometry;if("Circle"===r.getType()){const s=r.getCenter(),a=i.featureSegments[0],l=i.featureSegments[1];a.segment[0]=s,a.segment[1]=s,l.segment[0]=s,l.segment[1]=s,this.rBush_.update((0,x.HK)(s),a);let c=r;const d=(0,y.Cs)();if(d){const u=n.map.getView().getProjection();c=c.clone().transform(d,u),c=(0,A.Bb)(c).transform(u,d)}this.rBush_.update(c.getExtent(),l)}else this.rBush_.update((0,x.hI)(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new qe("modifyend",this.featuresBeingModified_,n)),this.featuresBeingModified_=null),!1}handlePointerMove_(n){this.lastPixel_=n.pixel,this.handlePointerAtPixel_(n.pixel,n.map,n.coordinate)}handlePointerAtPixel_(n,t,i){const r=i||t.getCoordinateFromPixel(n),s=t.getView().getProjection(),a=function(d,u){return gt(r,d,s)-gt(r,u,s)};let l,c;if(this.hitDetection_&&t.forEachFeatureAtPixel(n,(u,p,h)=>{const g=h||u.getGeometry();if("Point"===g.getType()&&u instanceof I.Z&&this.features_.getArray().includes(u)){c=g;const m=c.getFlatCoordinates().slice(0,2);l=[{feature:u,geometry:c,segment:[m,m]}]}return!0},{layerFilter:"object"==typeof this.hitDetection_?u=>u===this.hitDetection_:void 0}),!l){const d=(0,y.dY)((0,x.HK)(r,ht),s),u=t.getView().getResolution()*this.pixelTolerance_,p=(0,y.Fj)((0,x.f3)(d,u,ht),s);l=this.rBush_.getInExtent(p)}if(l&&l.length>0){const d=l.sort(a)[0],u=d.segment;let p=pt(r,d,s);const h=t.getPixelFromCoordinate(p);let g=(0,P.TE)(n,h);if(c||g<=this.pixelTolerance_){const m={};if(m[(0,T.sq)(u)]=!0,this.snapToPointer_||(this.delta_[0]=p[0]-r[0],this.delta_[1]=p[1]-r[1]),"Circle"===d.geometry.getType()&&d.index===ee)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(p,[d.feature],[d.geometry]);else{const C=t.getPixelFromCoordinate(u[0]),b=t.getPixelFromCoordinate(u[1]),F=(0,P.bI)(h,C),E=(0,P.bI)(h,b);g=Math.sqrt(Math.min(F,E)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(p=F>E?u[1]:u[0]),this.createOrUpdateVertexFeature_(p,[d.feature],[d.geometry]);const j={};j[(0,T.sq)(d.geometry)]=!0;for(let Ee=1,Ir=l.length;Ee<Ir;++Ee){const te=l[Ee].segment;if(!((0,P.fS)(u[0],te[0])&&(0,P.fS)(u[1],te[1])||(0,P.fS)(u[0],te[1])&&(0,P.fS)(u[1],te[0])))break;{const Mt=(0,T.sq)(l[Ee].geometry);Mt in j||(j[Mt]=!0,m[(0,T.sq)(te)]=!0)}}}return void(this.vertexSegments_=m)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(n,t){const i=n.segment,r=n.feature,s=n.geometry,a=n.depth,l=n.index;let c;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":case"Polygon":c=s.getCoordinates(),c[a[0]].splice(l+1,0,t);break;case"MultiPolygon":c=s.getCoordinates(),c[a[1]][a[0]].splice(l+1,0,t);break;case"LineString":c=s.getCoordinates(),c.splice(l+1,0,t);break;default:return}this.setGeometryCoordinates_(s,c);const d=this.rBush_;d.remove(n),this.updateSegmentIndices_(s,l,a,1);const u={segment:[i[0],t],feature:r,geometry:s,depth:a,index:l};d.insert((0,x.hI)(u.segment),u),this.dragSegments_.push([u,1]);const p={segment:[t,i[1]],feature:r,geometry:s,depth:a,index:l+1};d.insert((0,x.hI)(p.segment),p),this.dragSegments_.push([p,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Z.Z.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new qe("modifyend",this.featuresBeingModified_,n)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const n=this.dragSegments_,t={};let r,s,a,l,c,d,u,p,h,g,m,i=!1;for(c=n.length-1;c>=0;--c)a=n[c],g=a[0],m=(0,T.sq)(g.feature),g.depth&&(m+="-"+g.depth.join("-")),m in t||(t[m]={}),0===a[1]?(t[m].right=g,t[m].index=g.index):1==a[1]&&(t[m].left=g,t[m].index=g.index+1);for(m in t){switch(h=t[m].right,u=t[m].left,d=t[m].index,p=d-1,g=void 0!==u?u:h,p<0&&(p=0),l=g.geometry,s=l.getCoordinates(),r=s,i=!1,l.getType()){case"MultiLineString":s[g.depth[0]].length>2&&(s[g.depth[0]].splice(d,1),i=!0);break;case"LineString":s.length>2&&(s.splice(d,1),i=!0);break;case"MultiPolygon":r=r[g.depth[1]];case"Polygon":r=r[g.depth[0]],r.length>4&&(d==r.length-1&&(d=0),r.splice(d,1),i=!0,0===d&&(r.pop(),r.push(r[0]),p=r.length-1))}if(i){this.setGeometryCoordinates_(l,s);const C=[];if(void 0!==u&&(this.rBush_.remove(u),C.push(u.segment[0])),void 0!==h&&(this.rBush_.remove(h),C.push(h.segment[1])),void 0!==u&&void 0!==h){const b={depth:g.depth,feature:g.feature,geometry:g.geometry,index:p,segment:C};this.rBush_.insert((0,x.hI)(b.segment),b)}this.updateSegmentIndices_(l,d,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),n.length=0}}return i}setGeometryCoordinates_(n,t){this.changingFeature_=!0,n.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(n,t,i,r){this.rBush_.forEachInExtent(n.getExtent(),function(s){s.geometry===n&&(void 0===i||void 0===s.depth||(0,R.fS)(s.depth,i))&&s.index>t&&(s.index+=r)})}};var ft=f(874);class _e extends q.ZP{constructor(n,t,i){super(),void 0!==i&&void 0===t?this.setFlatCoordinates(i,n):this.setCenterAndRadius(n,t=t||0,i)}clone(){const n=new _e(this.flatCoordinates.slice(),void 0,this.layout);return n.applyProperties(this),n}closestPointXY(n,t,i,r){const s=this.flatCoordinates,a=n-s[0],l=t-s[1],c=a*a+l*l;if(c<r){if(0===c)for(let d=0;d<this.stride;++d)i[d]=s[d];else{const d=this.getRadius()/Math.sqrt(c);i[0]=s[0]+d*a,i[1]=s[1]+d*l;for(let u=2;u<this.stride;++u)i[u]=s[u]}return i.length=this.stride,c}return r}containsXY(n,t){const i=this.flatCoordinates,r=n-i[0],s=t-i[1];return r*r+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(n){const t=this.flatCoordinates,i=t[this.stride]-t[0];return(0,x.T9)(t[0]-i,t[1]-i,t[0]+i,t[1]+i,n)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const n=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return n*n+t*t}getType(){return"Circle"}intersectsExtent(n){const t=this.getExtent();if((0,x.kK)(n,t)){const i=this.getCenter();return n[0]<=i[0]&&n[2]>=i[0]||n[1]<=i[1]&&n[3]>=i[1]||(0,x.H6)(n,this.intersectsCoordinate.bind(this))}return!1}setCenter(n){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],r=n.slice();r[t]=r[0]+i;for(let s=1;s<t;++s)r[t+s]=n[s];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(n,t,i){this.setLayout(i,n,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let s=(0,ae.IG)(r,0,n,this.stride);r[s++]=r[0]+t;for(let a=1,l=this.stride;a<l;++a)r[s++]=r[a];r.length=s,this.changed()}getCoordinates(){return null}setCoordinates(n,t){}setRadius(n){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+n,this.changed()}rotate(n,t){const i=this.getCenter(),r=this.getStride();this.setCenter((0,ft.U1)(i,0,i.length,r,n,t,i)),this.changed()}translate(n,t){const i=this.getCenter(),r=this.getStride();this.setCenter((0,ft.Iu)(i,0,i.length,r,n,t,i)),this.changed()}}const Pn=_e;var Fn=f(1994);class Ce extends Je.ZP{constructor(n,t){super(n),this.feature=t}}function xe(o,n){return(0,X.bI)(o[0],o[1],n[0],n[1])}function B(o,n){const t=o.length;return n<0?o[n+t]:n>=t?o[n-t]:o[n]}function Te(o,n,t){let i,r;n<t?(i=n,r=t):(i=t,r=n);const s=Math.ceil(i),a=Math.floor(r);if(s>a)return xe(V(o,i),V(o,r));let l=0;i<s&&(l+=xe(V(o,i),B(o,s))),a<r&&(l+=xe(B(o,a),V(o,r)));for(let c=s;c<a-1;++c)l+=xe(B(o,c),B(o,c+1));return l}function mt(o,n,t){if(n instanceof O.Z)ve(o,n.getCoordinates(),!1,t);else if(n instanceof ce){const i=n.getCoordinates();for(let r=0,s=i.length;r<s;++r)ve(o,i[r],!1,t)}else if(n instanceof A.ZP){const i=n.getCoordinates();for(let r=0,s=i.length;r<s;++r)ve(o,i[r],!0,t)}else if(n instanceof he){const i=n.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length;l<c;++l)ve(o,a[l],!0,t)}}else if(n instanceof W){const i=n.getGeometries();for(let r=0;r<i.length;++r)mt(o,i[r],t)}}const Qe={index:-1,endIndex:NaN};function ve(o,n,t,i){const r=o[0],s=o[1];for(let a=0,l=n.length-1;a<l;++a){const u=_t(r,s,n[a],n[a+1]);if(0===u.squaredDistance){const p=a+u.along;return void i.push({coordinates:n,ring:t,startIndex:p,endIndex:p})}}}const He={along:0,squaredDistance:0};function _t(o,n,t,i){const r=t[0],s=t[1],c=i[0]-r,d=i[1]-s;let u=0,p=r,h=s;return(0!==c||0!==d)&&(u=(0,X.uZ)(((o-r)*c+(n-s)*d)/(c*c+d*d),0,1),p+=c*u,h+=d*u),He.along=u,He.squaredDistance=(0,X.FH)((0,X.bI)(o,n,p,h),10),He}function V(o,n){const t=o.length;let i=Math.floor(n);const r=n-i;i>=t?i-=t:i<0&&(i+=t);let s=i+1;s>=t&&(s-=t);const a=o[i],l=a[0],c=a[1],d=o[s];return[l+(d[0]-l)*r,c+(d[1]-c)*r]}function In(){const o=(0,U.Ly)();return function(n,t){return o[n.getGeometry().getType()]}}const kn=class Ln extends fe.Z{constructor(n){const t=n;t.stopDown||(t.stopDown=Q.Dv),super(t),this.shouldHandle_=!1,this.downPx_=null,this.freehand_=!1,this.source_=n.source?n.source:null,this.features_=n.features?n.features:null,this.snapTolerance_=n.snapTolerance?n.snapTolerance:12,this.type_=n.type,this.mode_=function Mn(o){switch(o){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+o)}}(this.type_),this.stopClick_=!!n.stopClick,this.minPoints_=n.minPoints?n.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:n.maxPoints?n.maxPoints:1/0,this.finishCondition_=n.finishCondition?n.finishCondition:Q.uX,this.geometryLayout_=n.geometryLayout?n.geometryLayout:"XY";let i=n.geometryFunction;if(!i){const r=this.mode_;if("Circle"===r)i=function(s,a,l){const c=a||new Pn([NaN,NaN]),d=(0,y.Vs)(s[0],l),u=(0,P.bI)(d,(0,y.Vs)(s[s.length-1],l));c.setCenterAndRadius(d,Math.sqrt(u),this.geometryLayout_);const p=(0,y.Cs)();return p&&c.transform(l,p),c};else{let s;"Point"===r?s=D.Z:"LineString"===r?s=O.Z:"Polygon"===r&&(s=A.ZP),i=function(a,l,c){return l?l.setCoordinates("Polygon"===r?a[0].length?[a[0].concat([a[0][0]])]:[]:a,this.geometryLayout_):l=new s(a,this.geometryLayout_),l}}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==n.dragVertexDelay?n.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=n.clickTolerance?n.clickTolerance*n.clickTolerance:36,this.overlay_=new Ne.Z({source:new z.Z({useSpatialIndex:!1,wrapX:!!n.wrapX&&n.wrapX}),style:n.style?n.style:In(),updateWhileInteracting:!0}),this.geometryName_=n.geometryName,this.condition_=n.condition?n.condition:k.rM,this.freehandCondition_=n.freehand?k.Bx:n.freehandCondition?n.freehandCondition:k.vY,this.setTrace(n.trace||!1),this.traceState_={active:!1},this.traceSource_=n.traceSource||n.source||null,this.addChangeListener(dt.Z.ACTIVE,this.updateState_)}setTrace(n){let t;t=n?!0===n?k.Bx:n:k.Fi,this.traceCondition_=t}setMap(n){super.setMap(n),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(n){n.originalEvent.type===K.Z.CONTEXTMENU&&n.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(n);let t=n.type===Z.Z.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&n.type===Z.Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=n.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&n.type===Z.Z.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(n.coordinate),i=!1):this.freehand_&&n.type===Z.Z.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=n.type===Z.Z.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(n),this.shouldHandle_&&n.originalEvent.preventDefault()):("mouse"===n.originalEvent.pointerType||n.type===Z.Z.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(n)):n.type===Z.Z.DBLCLICK&&(i=!1),super.handleEvent(n)&&i}handleDownEvent(n){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=n.pixel,this.finishCoordinate_||this.startDrawing_(n.coordinate),!0):this.condition_(n)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Fn.Z(Z.Z.POINTERMOVE,n.map,n.originalEvent,!1,n.frameState))},this.dragVertexDelay_),this.downPx_=n.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(n){if(!this.traceSource_||!this.traceCondition_(n))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),i=t.getCoordinateFromPixel([n.pixel[0]-this.snapTolerance_,n.pixel[1]+this.snapTolerance_]),r=t.getCoordinateFromPixel([n.pixel[0]+this.snapTolerance_,n.pixel[1]-this.snapTolerance_]),s=(0,x.hI)([i,r]),a=this.traceSource_.getFeaturesInExtent(s);if(0===a.length)return;const l=function Sn(o,n){const t=[];for(let i=0;i<n.length;++i)mt(o,n[i].getGeometry(),t);return t}(n.coordinate,a);l.length&&(this.traceState_={active:!0,startPx:n.pixel.slice(),targets:l,targetIndex:-1})}addOrRemoveTracedCoordinates_(n,t){const i=n.startIndex<=n.endIndex;i===n.startIndex<=t?i&&t>n.endIndex||!i&&t<n.endIndex?this.addTracedCoordinates_(n,n.endIndex,t):(i&&t<n.endIndex||!i&&t>n.endIndex)&&this.removeTracedCoordinates_(t,n.endIndex):(this.removeTracedCoordinates_(n.startIndex,n.endIndex),this.addTracedCoordinates_(n,n.startIndex,t))}removeTracedCoordinates_(n,t){if(n===t)return;let i=0;if(n<t){const r=Math.ceil(n);let s=Math.floor(t);s===t&&(s-=1),i=s-r+1}else{const r=Math.floor(n);let s=Math.ceil(t);s===t&&(s+=1),i=r-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(n,t,i){if(t===i)return;const r=[];if(t<i){const s=Math.ceil(t);let a=Math.floor(i);a===i&&(a-=1);for(let l=s;l<=a;++l)r.push(B(n.coordinates,l))}else{const s=Math.floor(t);let a=Math.ceil(i);a===i&&(a+=1);for(let l=s;l>=a;--l)r.push(B(n.coordinates,l))}r.length&&this.appendCoordinates(r)}updateTrace_(n){const t=this.traceState_;if(!t.active||-1===t.targetIndex&&(0,P.TE)(t.startPx,n.pixel)<this.snapTolerance_)return;const i=function En(o,n,t,i){const r=o[0],s=o[1];let a=1/0,l=-1,c=NaN;for(let p=0;p<n.targets.length;++p){const h=n.targets[p],g=h.coordinates;let C,m=1/0;for(let b=0;b<g.length-1;++b){const j=_t(r,s,g[b],g[b+1]);j.squaredDistance<m&&(m=j.squaredDistance,C=b+j.along)}m<a&&(a=m,h.ring&&n.targetIndex===p&&(h.endIndex>h.startIndex?C<h.startIndex&&(C+=g.length):h.endIndex<h.startIndex&&C>h.startIndex&&(C-=g.length)),c=C,l=p)}const d=n.targets[l];let u=d.ring;if(n.targetIndex===l&&u){const p=V(d.coordinates,c),h=t.getPixelFromCoordinate(p);(0,P.TE)(h,n.startPx)>i&&(u=!1)}if(u){const p=d.coordinates,h=p.length,g=d.startIndex,m=c;if(g<m){const C=Te(p,g,m);Te(p,g,m-h)<C&&(c-=h)}else{const C=Te(p,g,m);Te(p,g,m+h)<C&&(c+=h)}}return Qe.index=l,Qe.endIndex=c,Qe}(n.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(-1!==t.targetIndex){const c=t.targets[t.targetIndex];this.removeTracedCoordinates_(c.startIndex,c.endIndex)}const l=t.targets[i.index];this.addTracedCoordinates_(l,l.startIndex,i.endIndex)}else this.addOrRemoveTracedCoordinates_(t.targets[t.targetIndex],i.endIndex);t.targetIndex=i.index;const r=t.targets[t.targetIndex];r.endIndex=i.endIndex;const s=V(r.coordinates,r.endIndex),a=this.getMap().getPixelFromCoordinate(s);n.coordinate=s,n.pixel=[Math.round(a[0]),Math.round(a[1])]}handleUpEvent(n){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(n);const i=this.traceState_.active;if(this.toggleTraceState_(n),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(n.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||"Point"===this.mode_)&&(this.atFinish_(n.pixel,i)?this.finishCondition_(n)&&this.finishDrawing():this.addToDrawing_(n.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&n.preventDefault(),t}handlePointerMove_(n){if(this.pointerType_=n.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=n.pixel,r=t[0]-i[0],s=t[1]-i[1],a=r*r+s*s;if(this.shouldHandle_=this.freehand_?a>this.squaredClickTolerance_:a<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(n),this.modifyDrawing_(n.coordinate)):this.createOrUpdateSketchPoint_(n.coordinate.slice())}atFinish_(n,t){let i=!1;if(this.sketchFeature_){let r=!1,s=[this.finishCoordinate_];const a=this.mode_;if("Point"===a)i=!0;else if("Circle"===a)i=2===this.sketchCoords_.length;else if("LineString"===a)r=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===a){const l=this.sketchCoords_;r=l[0].length>this.minPoints_,s=[l[0][0],l[0][l[0].length-2]],s=t?[l[0][0]]:[l[0][0],l[0][l[0].length-2]]}if(r){const l=this.getMap();for(let c=0,d=s.length;c<d;c++){const u=s[c],p=l.getPixelFromCoordinate(u),h=n[0]-p[0],g=n[1]-p[1],m=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(h*h+g*g)<=m,i){this.finishCoordinate_=u;break}}}}return i}createOrUpdateSketchPoint_(n){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(n):(this.sketchPoint_=new I.Z(new D.Z(n)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(n){this.sketchLine_||(this.sketchLine_=new I.Z);const t=n.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new O.Z(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(n){const t=this.getMap().getView().getProjection(),i=(0,q.tP)(this.geometryLayout_);for(;n.length<i;)n.push(0);this.finishCoordinate_=n,"Point"===this.mode_?this.sketchCoords_=n.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[n.slice(),n.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[n.slice(),n.slice()],this.sketchLineCoords_&&(this.sketchLine_=new I.Z(new O.Z(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new I.Z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new Ce("drawstart",this.sketchFeature_))}modifyDrawing_(n){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),r=t.getView().getProjection(),s=(0,q.tP)(this.geometryLayout_);let a,l;for(;n.length<s;)n.push(0);"Point"===this.mode_?l=this.sketchCoords_:"Polygon"===this.mode_?(a=this.sketchCoords_[0],l=a[a.length-1],this.atFinish_(t.getPixelFromCoordinate(n))&&(n=this.finishCoordinate_.slice())):(a=this.sketchCoords_,l=a[a.length-1]),l[0]=n[0],l[1]=n[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(n),"Polygon"===i.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(n){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,s;const a=this.mode_;"LineString"===a||"Circle"===a?(this.finishCoordinate_=n.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(n.slice()),this.geometryFunction_(s,t,i)):"Polygon"===a&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(n.slice()),r&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(n.slice()),this.updateSketchFeatures_(),r&&this.finishDrawing()}removeLastPoints_(n){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let s=0;s<n;++s){let a;if("LineString"===r||"Circle"===r){if(a=this.sketchCoords_,a.splice(-2,1),a.length>=2){this.finishCoordinate_=a[a.length-2].slice();const l=this.finishCoordinate_.slice();a[a.length-1]=l,this.createOrUpdateSketchPoint_(l)}this.geometryFunction_(a,t,i),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===r){a=this.sketchCoords_[0],a.splice(-2,1);const l=this.sketchLine_.getGeometry();if(a.length>=2){const c=a[a.length-2].slice();a[a.length-1]=c,this.createOrUpdateSketchPoint_(c)}l.setCoordinates(a),this.geometryFunction_(this.sketchCoords_,t,i)}if(1===a.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const n=this.abortDrawing_();if(!n)return;let t=this.sketchCoords_;const i=n.getGeometry(),r=this.getMap().getView().getProjection();"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,i,r)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,i,r),t=i.getCoordinates()),"MultiPoint"===this.type_?n.setGeometry(new de([t])):"MultiLineString"===this.type_?n.setGeometry(new ce([t])):"MultiPolygon"===this.type_&&n.setGeometry(new he([t])),this.dispatchEvent(new Ce("drawend",n)),this.features_&&this.features_.push(n),this.source_&&this.source_.addFeature(n)}abortDrawing_(){this.finishCoordinate_=null;const n=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),n}abortDrawing(){const n=this.abortDrawing_();n&&this.dispatchEvent(new Ce("drawabort",n))}appendCoordinates(n){const t=this.mode_,i=!this.sketchFeature_;let r;if(i&&this.startDrawing_(n[0]),"LineString"===t||"Circle"===t)r=this.sketchCoords_;else{if("Polygon"!==t)return;r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&r.shift(),r.pop();for(let a=0;a<n.length;a++)this.addToDrawing_(n[a]);const s=n[n.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)}extend(n){const i=n.getGeometry();this.sketchFeature_=n,this.sketchCoords_=i.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new I.Z(new D.Z(r)),this.updateSketchFeatures_(),this.dispatchEvent(new Ce("drawstart",this.sketchFeature_))}updateSketchFeatures_(){const n=[];this.sketchFeature_&&n.push(this.sketchFeature_),this.sketchLine_&&n.push(this.sketchLine_),this.sketchPoint_&&n.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(n)}updateState_(){const n=this.getMap(),t=this.getActive();(!n||!t)&&this.abortDrawing(),this.overlay_.setMap(t?n:null)}};function be(o){return"string"==typeof o?o:""}const An=class Zn extends ze{constructor(){super()}getType(){return"text"}readFeature(n,t){return this.readFeatureFromText(be(n),this.adaptOptions(t))}readFeatureFromText(n,t){return(0,T.O3)()}readFeatures(n,t){return this.readFeaturesFromText(be(n),this.adaptOptions(t))}readFeaturesFromText(n,t){return(0,T.O3)()}readGeometry(n,t){return this.readGeometryFromText(be(n),this.adaptOptions(t))}readGeometryFromText(n,t){return(0,T.O3)()}readProjection(n){return this.readProjectionFromText(be(n))}readProjectionFromText(n){return this.dataProjection}writeFeature(n,t){return this.writeFeatureText(n,this.adaptOptions(t))}writeFeatureText(n,t){return(0,T.O3)()}writeFeatures(n,t){return this.writeFeaturesText(n,this.adaptOptions(t))}writeFeaturesText(n,t){return(0,T.O3)()}writeGeometry(n,t){return this.writeGeometryText(n,this.adaptOptions(t))}writeGeometryText(n,t){return(0,T.O3)()}},Gn={POINT:D.Z,LINESTRING:O.Z,POLYGON:A.ZP,MULTIPOINT:de,MULTILINESTRING:ce,MULTIPOLYGON:he},yt="EMPTY",Ct="Z",xt="M",Nn={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Dn{constructor(n){this.wkt=n,this.index_=-1}isAlpha_(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"}isNumeric_(n,t){return t=void 0!==t&&t,n>="0"&&n<="9"||"."==n&&!t}isWhiteSpace_(n){return" "==n||"\t"==n||"\r"==n||"\n"==n}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const n=this.nextChar_(),t=this.index_;let r,i=n;if("("==n)r=2;else if(","==n)r=5;else if(")"==n)r=3;else if(this.isNumeric_(n)||"-"==n)r=4,i=this.readNumber_();else if(this.isAlpha_(n))r=1,i=this.readText_();else{if(this.isWhiteSpace_(n))return this.nextToken();if(""!==n)throw new Error("Unexpected character: "+n);r=6}return{position:t,value:i,type:r}}readNumber_(){let n;const t=this.index_;let i=!1,r=!1;do{"."==n?i=!0:("e"==n||"E"==n)&&(r=!0),n=this.nextChar_()}while(this.isNumeric_(n,i)||!r&&("e"==n||"E"==n)||r&&("-"==n||"+"==n));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let n;const t=this.index_;do{n=this.nextChar_()}while(this.isAlpha_(n));return this.wkt.substring(t,this.index_--).toUpperCase()}}class Jn{constructor(n){this.lexer_=n,this.token_={position:0,type:0},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(n){return this.token_.type==n}match(n){const t=this.isTokenType(n);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let n="XY";const t=this.token_;if(this.isTokenType(1)){const i=t.value;i===Ct?n="XYZ":i===xt?n="XYM":"ZM"===i&&(n="XYZM"),"XY"!==n&&this.consume_()}return n}parseGeometryCollectionText_(){if(this.match(2)){const n=[];do{n.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(2)){const n=this.parsePoint_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(2)){const n=this.parsePointList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(2)){const n=this.parseLineStringTextList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(2)){let n;if(n=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(2)){const n=this.parseLineStringTextList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(2)){const n=this.parsePolygonTextList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parsePoint_(){const n=[],t=this.layout_.length;for(let i=0;i<t;++i){const r=this.token_;if(!this.match(4))break;n.push(r.value)}if(n.length==t)return n;throw new Error(this.formatErrorMessage_())}parsePointList_(){const n=[this.parsePoint_()];for(;this.match(5);)n.push(this.parsePoint_());return n}parsePointTextList_(){const n=[this.parsePointText_()];for(;this.match(5);)n.push(this.parsePointText_());return n}parseLineStringTextList_(){const n=[this.parseLineStringText_()];for(;this.match(5);)n.push(this.parseLineStringText_());return n}parsePolygonTextList_(){const n=[this.parsePolygonText_()];for(;this.match(5);)n.push(this.parsePolygonText_());return n}isEmptyGeometry_(){const n=this.isTokenType(1)&&this.token_.value==yt;return n&&this.consume_(),n}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const n=this.token_;if(this.match(1)){const t=n.value;this.layout_=this.parseGeometryLayout_();const i=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==t){if(i)return new W([]);const a=this.parseGeometryCollectionText_();return new W(a)}const r=Gn[t];if(!r)throw new Error("Invalid geometry type: "+t);let s;if(i)s="POINT"==t?[NaN,NaN]:[];else switch(t){case"POINT":s=this.parsePointText_();break;case"LINESTRING":s=this.parseLineStringText_();break;case"POLYGON":s=this.parsePolygonText_();break;case"MULTIPOINT":s=this.parseMultiPointText_();break;case"MULTILINESTRING":s=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":s=this.parseMultiPolygonText_()}return new r(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}function Tt(o){const n=o.getCoordinates();return 0===n.length?"":n.join(" ")}function Be(o){const n=o.getCoordinates(),t=[];for(let i=0,r=n.length;i<r;++i)t.push(n[i].join(" "));return t.join(",")}function vt(o){const n=[],t=o.getLinearRings();for(let i=0,r=t.length;i<r;++i)n.push("("+Be(t[i])+")");return n.join(",")}const Bn={Point:Tt,LineString:Be,Polygon:vt,MultiPoint:function Un(o){const n=[],t=o.getPoints();for(let i=0,r=t.length;i<r;++i)n.push("("+Tt(t[i])+")");return n.join(",")},MultiLineString:function qn(o){const n=[],t=o.getLineStrings();for(let i=0,r=t.length;i<r;++i)n.push("("+Be(t[i])+")");return n.join(",")},MultiPolygon:function Qn(o){const n=[],t=o.getPolygons();for(let i=0,r=t.length;i<r;++i)n.push("("+vt(t[i])+")");return n.join(",")},GeometryCollection:function jn(o){const n=[],t=o.getGeometries();for(let i=0,r=t.length;i<r;++i)n.push(bt(t[i]));return n.join(",")}};function bt(o){const n=o.getType(),i=(0,Bn[n])(o);let r=Nn[n];if("function"==typeof o.getFlatCoordinates){const s=function Hn(o){const n=o.getLayout();let t="";return("XYZ"===n||"XYZM"===n)&&(t+=Ct),("XYM"===n||"XYZM"===n)&&(t+=xt),t}(o);s.length>0&&(r+=" "+s)}return 0===i.length?r+" "+yt:r+"("+i+")"}const wt=class Rn extends An{constructor(n){super(),this.splitCollection_=void 0!==(n=n||{}).splitCollection&&n.splitCollection}parse_(n){const t=new Dn(n);return new Jn(t).parse()}readFeatureFromText(n,t){const i=this.readGeometryFromText(n,t),r=new I.Z;return r.setGeometry(i),r}readFeaturesFromText(n,t){let i=[];const r=this.readGeometryFromText(n,t);i=this.splitCollection_&&"GeometryCollection"==r.getType()?r.getGeometriesArray():[r];const s=[];for(let a=0,l=i.length;a<l;++a){const c=new I.Z;c.setGeometry(i[a]),s.push(c)}return s}readGeometryFromText(n,t){return re(this.parse_(n),!1,t)}writeFeatureText(n,t){const i=n.getGeometry();return i?this.writeGeometryText(i,t):""}writeFeaturesText(n,t){if(1==n.length)return this.writeFeatureText(n[0],t);const i=[];for(let s=0,a=n.length;s<a;++s)i.push(n[s].getGeometry());const r=new W(i);return this.writeGeometryText(r,t)}writeGeometryText(n,t){return bt(re(n,!0,t))}};var we=f(5044),Pe=f(6785),Vn=f(7392);class Yn{constructor(n,t,i,r=null){this._fillColor=at(),this._strokeColor="black",this._strokeWidth="2",this._locked=!1,this._featuresToggled=!1,this._featuresCounter=0,this._initLayer(n,t,i)}get layer(){return this._vectorLayer}get layerName(){return this._getLayerAttributes("name")}set layerName(n){this.layer.set("name",n)}get geomType(){return this._getLayerAttributes("geom_type")}get sourceFeatures(){return this._sourceFeatures}get zIndex(){return this.layer.getZIndex()}set zIndex(n){this.layer.setZIndex(n)}get uuid(){return this._getLayerAttributes("uuid")}set visible(n){this.layer.setVisible(n)}get visible(){return this.layer.getVisible()}set propertyStyled(n){this._propertyStyled=n}get propertyStyled(){return this._propertyStyled}set styleSettings(n){this._styleSettings=n}get styleSettings(){return this._styleSettings}set featuresToggled(n){this._featuresToggled=n}get featuresToggled(){return this._featuresToggled}set locked(n){this._locked=n}get locked(){return this._locked}set opacity(n){this.layer.setOpacity(n.target.valueAsNumber)}get opacity(){return this.layer.getOpacity()}get fillColor(){return this._fillColor}set fillColor(n){st.test(n)&&(this.features.forEach(t=>{t.set("fill_color",n,!1)}),this._fillColor=n)}get strokeColor(){return this._strokeColor}set strokeColor(n){st.test(n)&&(this.features.forEach(t=>{t.set("stroke_color",n,!1)}),this._strokeColor=n)}get strokeWidth(){return this._strokeWidth}set strokeWidth(n){this._strokeWidth=n,this.features.forEach(t=>{t.set("stroke_width",parseFloat(n),!1)})}_initLayer(n,t,i){this._sourceFeatures=new z.Z,this._vectorLayer=new Ne.Z({source:this._sourceFeatures,style:(r,s)=>Ft(r)}),this.layerName=n,this.layer.set("uuid",ot()),this.layer.set("geom_type",t),this.zIndex=i}_getLayerAttributes(n){return this.layer.get(n)}get features(){return this._sourceFeatures.getFeatures().sort((n,t)=>n.get("no")-t.get("no"))}featureById(n){const t=this.sourceFeatures.getFeatureById(n);return null!==t?[t]:[]}duplicateFeature(n){const t=this.featureById(n);if(1===t.length){const i=this.addProperties(t[0].clone());this.sourceFeatures.addFeature(i)}}removeFeature(n){const t=this.featureById(n);1===t.length&&this.sourceFeatures.removeFeature(t[0])}addProperties(n){++this._featuresCounter;const t=ot();let i;return n.setId(t),i=void 0!==n.get("name")?n.get("name")+" copy":"feature "+this._featuresCounter,n.setProperties({id:n.getId(),no:this._featuresCounter,name:i,geom_type:n.getGeometry()?.getType(),status:"added",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),fill_color:this.fillColor,stroke_width:this.strokeWidth,stroke_color:this.strokeColor},!0),n}_updateMetadataFeature(n){n.setProperties({updated_at:(new Date).toISOString(),status:"modified"},!0)}addFeaturesAndUpdateIds(n){n.length>0&&n.forEach(t=>{let i=t.clone(),r=this.addProperties(i);this.sourceFeatures.addFeature(r)})}}class Kn{constructor(n,t){this._headerHidden=["geometry","id","no","geom_type","created_at","updated_at","fill_color","stroke_width","stroke_color"],this.holePolygonDrawingStatus=!1,this._zoomPadding=[100,100,100,200],this._maxZoom=14,this.container=t,this._map=n,this._initSelect(),this._initTranslate(),this._initSnap(),this._initModifier(),this._map.addLayer(this.container.layer)}removeLayer(){this._map.removeLayer(this.container.layer)}enableTranslating(){this._map.addInteraction(this._translate)}disableTranslating(){this._map.removeInteraction(this._translate)}enableSelecting(){this._map.addInteraction(this.select)}disableSelecting(){this._map.removeInteraction(this.select)}enableSnapping(){this._map.addInteraction(this._snap)}disableSnapping(){this._map.removeInteraction(this._snap)}_initSelect(){this.select=new mn.Z({condition:k.V4,multi:!1,layers:[this.container.layer]})}_initSnap(){this._snap=new yn({source:this.container.layer.getSource()})}_initTranslate(){this._translate=new xn({features:this.select.getFeatures()})}_initModifier(){this._modifier=new wn({features:this.select.getFeatures(),deleteCondition:k.Ko,snapToPointer:!0}),this._modifier.on("modifyend",n=>{n.mapBrowserEvent.originalEvent.ctrlKey&&this._removeHoles(n),n.features.getArray().length>0&&n.features.getArray().forEach(t=>{this._updateMetadataFeature(t)})})}_removeHoles(n){const t=n.features.getArray()[0],i=n.mapBrowserEvent.coordinate;if("Polygon"==t.getGeometry().getType()){const r=t.getGeometry().getLinearRings();if(r.length>1){let s=new z.Z;r.forEach((c,d)=>{const u=new O.Z(c.getCoordinates());let p=new I.Z({geometry:u});p.setId(d),s.addFeature(p)});const a=s.getClosestFeatureToCoordinate(i);let l=[];r.forEach((c,d)=>{d!==a.getId()&&l.push(c.getCoordinates())}),t.getGeometry().setCoordinates(l)}}}enableEditing(){this.disableEditing(),this._map.addInteraction(this._modifier)}disableEditing(){this._map.removeInteraction(this._modifier)}cleanEvents(){this.disableDrawing(),this.disableEditing()}enableDrawing(n=!1){this.holePolygonDrawingStatus=n,this._draw=new kn({type:this.container.geomType,stopClick:!0,source:this.container.sourceFeatures,condition:t=>1===t.originalEvent.buttons}),this._map.addInteraction(this._draw),this._draw.on("drawstart",this._onDrawStart.bind(this)),this._draw.on("drawend",this._onDrawEnd.bind(this)),this._draw.on("drawabort",this._onDrawAborting.bind(this))}disableDrawing(){this._map.removeInteraction(this._draw)}_updateMetadataFeature(n){n.setProperties({updated_at:(new Date).toISOString(),status:"modified"},!0)}_onDrawStart(n){if(this.holePolygonDrawingStatus&&"Polygon"===n.feature.getGeometry()?.getType()){let t=this.checkIfCoordIntersectLayer(n.feature);if(this.polygonIntersected=t,void 0===this.polygonIntersected)return n.target.abortDrawing(),this._onDrawAborting(n),void alert("An hole is possible only on a polygon!");if(void 0!==this.polygonIntersected){this.previousPolygonGeometry=this.polygonIntersected.getGeometry();const i=this.polygonIntersected.getGeometry();this.coordsLength=i.getCoordinates().length,n.feature.getGeometry().on("change",this._onGeomChangeBuildHole.bind(this))}}}_onDrawEnd(n){if(this.holePolygonDrawingStatus)return setTimeout(()=>{this.container.sourceFeatures.removeFeature(n.feature)},5),void 0!==this.polygonIntersected&&(n.feature.setGeometry(this.polygonIntersected.getGeometry()),this.select.getFeatures().clear()),void(this.polygonIntersected=void 0);this.container.addProperties(n.feature)}_onDrawAborting(n){this.holePolygonDrawingStatus&&void 0!==this.polygonIntersected&&(this.polygonIntersected.setGeometry(this.previousPolygonGeometry),this.polygonIntersected=void 0)}checkIfCoordIntersectLayer(n){let t;return this.container.sourceFeatures.forEachFeatureIntersectingExtent(n.getGeometry().getExtent(),i=>{t=i}),t}_onGeomChangeBuildHole(n){if(void 0!==this.polygonIntersected){let i=this.polygonIntersected.getGeometry().getCoordinates(),r=new A.ZP(i.slice(0,this.coordsLength)),s=new fn.Z(n.target.getCoordinates()[0]);r.appendLinearRing(s),this.polygonIntersected.setGeometry(r)}}zoomToLayer(){this.container.features.length>0&&this._map.getView().fit(this.container.layer.getSource().getExtent(),{size:this._map.getSize(),padding:this._zoomPadding,maxZoom:20})}zoomToFeature(n){this.container.features.filter(t=>{t.getId()===n&&this._map.getView().fit(t.getGeometry(),{size:this._map.getSize(),padding:this._zoomPadding,maxZoom:20})})}getFeatureAttribute(n,t){const i=this.container.featureById(n);if(1===i.length)return i[0].get(t)}getAttributesHeader(){return this.container.features[0].getKeys().filter(i=>!this._headerHidden.includes(i))}setAttribute(n,t){this.getAttributesHeader().includes(n)||this.container.features.forEach(r=>{null===t&&(t=""),r.set(n,t,!1)})}removeAttribute(n){this.getAttributesHeader().includes(n)&&this.container.features.forEach(t=>{t.unset(n,!1)})}exportBounds(){return this.container.sourceFeatures.getExtent().join(",").split(",").map(Number)}exportBoundsPolygon(){const n=this.exportBounds(),i=new A.ZP([[[n[0],n[3]],[n[2],n[3]],[n[2],n[1]],[n[0],n[1]],[n[0],n[3]]]]);return{Polygon:[new I.Z({geometry:i})]}}exportToGeoJSON(){let n=new nt;return JSON.stringify(JSON.parse(n.writeFeatures(this.container.features)),null,2)}exportToWkt(){let n=[];return this.container.features.forEach(t=>{n.push(Fe(t.getGeometry()))}),n.join("\n")}exportToPytestFixture(){let t=[];return this.container.features.forEach(i=>{t.push("\n@pytest.fixture\ndef "+i.get("name").replace(" ","_")+"():\n\treturn '"+Fe(i.getGeometry())+"'")}),"import pytest\n"+t.join("\n")}}function Pt(o,n,t){const i=o.findIndex(a=>a.container.uuid===n),s=o[i].container.zIndex+t;return s>=0&&s<o.length&&(o[i].container.zIndex=s,(o=o.sort((a,l)=>a.container.zIndex<l.container.zIndex?-1:1)).forEach((a,l)=>{a.container.zIndex=l})),o}function Fe(o){return(new wt).writeGeometry(o)}function Ft(o){let n,t=o.getGeometry();if(void 0!==t){const i=o.get("fill_color"),r=o.get("stroke_width"),s=o.get("stroke_color");return"Point"===t.getType()?n=function Wn(o,n,t){return new U.ZP({image:new Vn.Z({radius:7,fill:new we.Z({color:o}),stroke:new Pe.Z({color:t,width:n})})})}(i,r,s):"LineString"===t.getType()?n=function Xn(o,n,t){return[new U.ZP({fill:new we.Z({color:o}),stroke:new Pe.Z({color:t,width:2*n})}),new U.ZP({fill:new we.Z({color:o}),stroke:new Pe.Z({color:o,width:n})})]}(i,r,s):"Polygon"===t.getType()&&(n=function zn(o,n,t){return new U.ZP({fill:new we.Z({color:o}),stroke:new Pe.Z({color:t,width:n})})}(i,r,s)),n}return new U.ZP}var J=f(3396);const ti=["POINT(539215.0048531858 5742515.939068312)","POINT(539296.087038823 5742385.422904979)","POINT(539356.2447894571 5742478.798196181)","POINT(539314.6574748883 5742559.095715506)"],ni=["LINESTRING(539218.6666293114 5742542.879278379,539338.720575142 5742544.971721878)","LINESTRING(539338.720575142 5742544.971721878,539360.6912318952 5742400.070009482)","LINESTRING(539360.6912318952 5742400.070009482,539237.7601762518 5742383.592016917)","LINESTRING(539218.6666293114 5742542.879278379,539237.7601762518 5742383.592016917)"],ii=["POLYGON((539226.5182729785 5742530.856872896,539232.6448189546 5742490.7562545985,539256.9808711325 5742494.193922905,539256.4417101032 5742499.585533198,539254.5546465009 5742504.7075629765,539250.5109387813 5742504.7075629765,539250.5109387813 5742509.020851211,539259.4070957643 5742507.942529152,539258.867934735 5742515.760364076,539260.3004442152 5742515.72208676,539260.1154706075 5742531.383185537,539226.5182729785 5742530.856872896))","POLYGON((539260.1154706075 5742531.383185537,539287.3729426434 5742531.99944534,539287.3112847741 5742498.704195973,539259.9351908506 5742495.12803956,539259.4070957643 5742507.942529152,539258.867934735 5742515.760364076,539260.3004442152 5742515.72208676,539260.1154706075 5742531.383185537),(539270.1545458606 5742508.569826204,539269.7288732142 5742508.536220469,539269.7387920542 5742506.9663504455,539267.7040823707 5742506.9663504455,539267.8273981091 5742504.3767199395,539275.904578974 5742504.191746332,539279.9739983409 5742504.191746332,539279.9123404718 5742506.843034708,539272.0955777467 5742506.707124501,539271.7118438686 5742508.692770784,539270.1545458606 5742508.569826204))","POLYGON((539287.3729426434 5742531.99944534,539318.0346724865 5742532.378169541,539319.9065139169 5742531.559238915,539321.4273850791 5742530.038367753,539324.9370877611 5742504.300548085,539294.9876248749 5742499.737934599,539287.3112847741 5742498.704195973,539287.3729426434 5742531.99944534),(539295.3754938005 5742507.421860116,539295.4466824754 5742503.221728295,539298.9348396178 5742503.597902105,539299.2196822468 5742506.211652642,539301.1417764699 5742507.63542614,539300.9282104451 5742509.984652413,539301.070587795 5742511.408425912,539298.934927547 5742511.266048562,539298.6501728473 5742508.916822289,539297.1300637128 5742508.069037543,539295.3754938005 5742507.421860116))","POLYGON((539294.9876248749 5742499.737934599,539299.5562570365 5742468.337040057,539329.0781557556 5742472.196111785,539324.9370877611 5742504.300548085,539294.9876248749 5742499.737934599))","POLYGON((539259.9351908506 5742495.12803956,539256.9808711325 5742494.193922905,539232.6448189546 5742490.7562545985,539235.2430055273 5742471.432241965,539263.2547045123 5742475.410715154,539261.062456945 5742495.2752950415,539259.9351908506 5742495.12803956))","POLYGON((539235.2430055273 5742471.432241965,539237.7456480276 5742451.885722645,539265.9128935036 5742455.147193177,539263.2547045123 5742475.410715154,539235.2430055273 5742471.432241965))","POLYGON((539237.7456480276 5742451.885722645,539240.2658752541 5742432.168650814,539268.1366234096 5742436.319613306,539265.9128935036 5742455.147193177,539237.7456480276 5742451.885722645))","POLYGON((539299.5562570365 5742468.337040057,539302.9750586041 5742442.1013110615,539268.1366234096 5742436.319613306,539265.9128935036 5742455.147193177,539263.2547045123 5742475.410715154,539261.062456945 5742495.2752950415,539287.3112847741 5742498.704195973,539294.9876248749 5742499.737934599,539299.5562570365 5742468.337040057))","POLYGON((539300.4403774067 5742461.5523402225,539306.3847777933 5742462.263128876,539305.2312471652 5742469.078868832,539299.5562570365 5742468.337040057,539300.4403774067 5742461.5523402225))","POLYGON((539329.0781557556 5742472.196111785,539333.6625313073 5742445.2145329295,539310.683988945 5742442.546057043,539306.1134484276 5742469.194189259,539329.0781557556 5742472.196111785))","POLYGON((539333.6625313073 5742445.2145329295,539337.225770125 5742416.486706159,539337.0295486205 5742412.562276067,539335.263555079 5742409.226510488,539333.1051185282 5742406.675630929,539330.3580174637 5742405.890744911,539253.242966151 5742396.0796696795,539248.3374285357 5742397.649441716,539245.5903274711 5742400.788985791,539243.8243339296 5742405.694523405,539240.2658752541 5742432.168650814,539268.1366234096 5742436.319613306,539302.9750586041 5742442.1013110615,539310.683988945 5742442.546057043,539333.6625313073 5742445.2145329295),(539258.4659895932 5742428.264073253,539259.96085796 5742413.215731693,539320.2538820857 5742421.188362983,539318.5596979368 5742438.72815182,539272.3084690453 5742432.624896874,539272.2187785674 5742430.257231075,539258.4659895932 5742428.264073253))","POLYGON((539302.325413111 5742447.086661268,539305.5990284064 5742447.378161909,539306.2690154614 5742442.291347034,539302.9750586041 5742442.1013110615,539302.325413111 5742447.086661268))"];var L=f(4945),N=f(4006);function ri(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",16),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.setImportDataType(s.label_text))}),e._UZ(2,"fa-icon",17),e._uU(3),e.qZA(),e.BQk()}if(2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngbPopover",t.label),e.xp6(1),e.Q6J("icon",t.icon),e.xp6(1),e.hij("",t.label_text," ")}}function oi(o,n){if(1&o&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function si(o,n){if(1&o&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.container.uuid),e.xp6(1),e.hij("Importer dans la couche : ",t.container.layerName,"")}}let ai=(()=>{class o{constructor(){this.featuresToNewLayerEvent=new e.vpe,this.featuresToAppendEvent=new e.vpe,this.loadIcon=_.cf$,this.importModes=[{mode:"GeoJSON",label:"Importer un GeoJSON",label_text:"GeoJSON",icon:this.loadIcon},{mode:"WKT",label:"Importer un/des WKT(s)",label_text:"WKT(s)",icon:this.loadIcon}],this.componentRemoved=!1,this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="newLayer"}ngOnInit(){}ngOnDestroy(){this.componentRemoved=!0}setImportDataType(t){this.importDataType=t}importFromFormat(){let i,t={};this.strInputEpsgInput!==this.currentEpsg&&(t={dataProjection:this.strInputEpsgInput,featureProjection:this.currentEpsg}),null!==this.strInputDataValues&&("GeoJSON"===this.importDataType?i=function li(o,n){let t={};return t=function ci(o){return o.reduce((n,t)=>{let i=t.getGeometry().getType();return n[i]||(n[i]=[]),n[i].push(t),n},{})}(new z.Z({features:(new nt).readFeatures(JSON.parse(o,n))}).getFeatures()),t}(this.strInputDataValues,t):"WKT(s)"===this.importDataType&&(i=Ve(this.strInputDataValues.split("\n"),t)),"newLayer"===this.modeImportInput?this.featuresToNewLayerEvent.emit(i):this.featuresToAppendEvent.emit({layerId:this.modeImportInput,features:i})),this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="newLayer"}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-import-tools"]],inputs:{epsgAvailable:"epsgAvailable",currentEpsg:"currentEpsg",existingLayers:"existingLayers"},outputs:{featuresToNewLayerEvent:"featuresToNewLayerEvent",featuresToAppendEvent:"featuresToAppendEvent"},decls:25,vars:9,consts:[[1,"text-center","fw-bold","bg-dark","bg-gradient","text-white","p-2"],["id","importTools",1,"text-center","m-3"],[4,"ngFor","ngForOf"],["moveDivToBody","","id","modalDataImport","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade",3,"isRemoved"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-control",3,"ngModel","ngModelChange"],[1,"form-select","form-select-sm",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","newLayer"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"ngClass","click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["data-bs-toggle","modal","data-bs-target","#modalDataImport","type","button","role","tab","placement","bottom","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-dark","border-0","m-1","text-warning",3,"ngbPopover","click"],[1,"mx-1",3,"icon"],[3,"value"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Importer "),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,ri,4,3,"ng-container",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"h5",7),e._uU(9),e.qZA()(),e.TgZ(10,"div",8)(11,"textarea",9),e.NdJ("ngModelChange",function(s){return i.strInputDataValues=s}),e.qZA(),e._uU(12," EPSG des donn\xe9es \xe0 importer "),e.TgZ(13,"select",10),e.NdJ("ngModelChange",function(s){return i.strInputEpsgInput=s}),e.YNc(14,oi,2,2,"option",11),e.qZA(),e._uU(15," Type d'importation "),e.TgZ(16,"select",10),e.NdJ("ngModelChange",function(s){return i.modeImportInput=s}),e.TgZ(17,"option",12),e._uU(18,"Cr\xe9er de nouvelles couches"),e.qZA(),e.YNc(19,si,2,2,"option",11),e.qZA()(),e.TgZ(20,"div",13)(21,"button",14),e.NdJ("click",function(){return i.importFromFormat()}),e._uU(22,"Ajouter"),e.qZA(),e.TgZ(23,"button",15),e._uU(24,"Fermer"),e.qZA()()()()()),2&t&&(e.xp6(3),e.Q6J("ngForOf",i.importModes),e.xp6(1),e.Q6J("isRemoved",i.componentRemoved),e.xp6(5),e.hij("Importer ",i.importDataType,""),e.xp6(2),e.Q6J("ngModel",i.strInputDataValues),e.xp6(2),e.Q6J("ngModel",i.strInputEpsgInput),e.xp6(1),e.Q6J("ngForOf",i.epsgAvailable),e.xp6(2),e.Q6J("ngModel",i.modeImportInput),e.xp6(3),e.Q6J("ngForOf",i.existingLayers),e.xp6(2),e.Q6J("ngClass",null!==i.strInputEpsgInput&&null!==i.strInputDataValues?"":"pe-none"))},dependencies:[w.mk,w.sg,G.BN,L.o8,N.YN,N.Kr,N.Fj,N.EJ,N.JJ,N.On,Me]}),o})();function Ve(o,n){let t={};return o.forEach(i=>{let r;try{r=(new wt).readFeature(i,n)}catch(s){alert(s.message)}if(void 0!==r&&!r.getGeometry().flatCoordinates.includes(NaN)){const s=r.getGeometry(),a=s.getType();a in t||(t[a]=[]),void 0!==s&&t[a].push(r)}}),t}let Se=(()=>{class o{constructor(){this.newFeatures=new Y.x,this.snappingLayerEnabled=new Y.x}addNewFeatures(t){this.newFeatures.next(t)}activateSnapping(t){this.snappingLayerEnabled.next(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var St=f(5861),di=f(2091);function ui(o,n){if(1&o&&(e.TgZ(0,"th",3),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.xp6(1),e.Oqu(t)}}function hi(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"td")(1,"input",8,9),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.MAs(2),l=e.oxw().$implicit,c=e.oxw();return l.set(s,a.value,!1),e.KtG(c.sendEditedEvent())}),e.qZA()()}if(2&o){const t=n.$implicit,i=e.oxw().$implicit;e.xp6(1),e.Q6J("placeholder",i.get(t))}}function gi(o,n){if(1&o&&(e.ynx(0),e.TgZ(1,"tr",6)(2,"th",7),e._uU(3),e.qZA(),e.YNc(4,hi,3,1,"td",5),e.qZA(),e.BQk()),2&o){const t=n.$implicit,i=e.oxw();e.xp6(3),e.Oqu(t.get("no")),e.xp6(1),e.Q6J("ngForOf",i.attributesHeaders)}}let Et=(()=>{class o{constructor(){this.edited=new e.vpe}sendEditedEvent(){this.edited.emit(!0)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-widget-table"]],inputs:{attributesHeaders:"attributesHeaders",features:"features"},outputs:{edited:"edited"},decls:9,vars:2,consts:[[1,"m-2","table-responsive"],[1,"table","table-striped","table-hover","table-sm"],[1,"table-dark"],["scope","col"],["scope","col",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"small"],["scope","row",1,"p-1"],["type","text",1,"p-1",3,"placeholder","change"],["rowInput",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"table",1)(2,"thead",2)(3,"tr")(4,"th",3),e._uU(5,"#"),e.qZA(),e.YNc(6,ui,2,1,"th",4),e.qZA()(),e.TgZ(7,"tbody"),e.YNc(8,gi,5,2,"ng-container",5),e.qZA()()()),2&t&&(e.xp6(6),e.Q6J("ngForOf",i.attributesHeaders),e.xp6(2),e.Q6J("ngForOf",i.features))},dependencies:[w.sg],styles:["table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{position:relative}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:none;position:absolute;display:block;top:0;left:0;margin:0;height:100%;width:100%;border:none;padding:10px;box-sizing:border-box}"]}),o})();function pi(o,n){if(1&o&&(e.O4$(),e.TgZ(0,"svg",11),e._UZ(1,"circle",12),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",t.feature.get("stroke_width"))("fill",t.feature.get("fill_color"))}}function fi(o,n){if(1&o&&(e.O4$(),e.TgZ(0,"svg",11),e._UZ(1,"line",13)(2,"line",13),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",t.feature.get("stroke_width")*t._strokeWidthCoeff),e.xp6(1),e.uIk("stroke",t.feature.get("fill_color"))("stroke-width",t.feature.get("stroke_width")*t._strokeWidthLineCoeff)}}function mi(o,n){if(1&o&&(e.O4$(),e.TgZ(0,"svg",14),e._UZ(1,"rect",15),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",t.feature.get("stroke_width")*t._strokeWidthCoeff)("fill",t.feature.get("fill_color"))}}function _i(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",17),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.removeFeature())}),e._UZ(2,"fa-icon",3),e.qZA(),e.TgZ(3,"div",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.showPopup())}),e._UZ(4,"fa-icon",19),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("icon",t.disabledIcon),e.xp6(2),e.Q6J("icon",t.paramIcon)}}const yi=function(o){return[o]};function Ci(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",20)(1,"div",21)(2,"div",22)(3,"strong"),e._uU(4),e.qZA(),e.TgZ(5,"em",23),e._uU(6),e.qZA(),e.TgZ(7,"em",24),e._uU(8),e.qZA(),e.TgZ(9,"button",25),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.showPopup())}),e.qZA()(),e.TgZ(10,"div",26)(11,"div",27)(12,"span",28),e._uU(13,"Actions :"),e.qZA(),e.TgZ(14,"span",29),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.copyToClipboard(r.getWktFromFeature()))}),e._uU(15," WKT "),e.qZA(),e.TgZ(16,"span",30),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.copyToClipboard(r.getBoundsFromFeature()))}),e._uU(17," Bbox "),e.qZA()(),e.TgZ(18,"div",31)(19,"span"),e._uU(20),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"span"),e._uU(23),e.ALo(24,"date"),e.qZA()(),e.TgZ(25,"app-widget-table",32),e.NdJ("edited",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.applyClassifiedStyle())}),e.qZA()()()()}if(2&o){const t=e.oxw();e.Q6J("id","featurePopup"+t.feature.getId()),e.xp6(4),e.Oqu(t.feature.get("name")),e.xp6(2),e.hij("(",t.feature.get("geom_type"),")"),e.xp6(2),e.hij("Couche: ",t.layer.container.layerName,""),e.xp6(12),e.hij("Cr\xe9\xe9 \xe0 ",e.xi3(21,8,t.feature.get("created_at"),"HH:mm:ss"),""),e.xp6(3),e.hij("Modifi\xe9 \xe0 ",e.xi3(24,11,t.feature.get("updated_at"),"HH:mm:ss"),""),e.xp6(2),e.Q6J("attributesHeaders",t.layer.getAttributesHeader())("features",e.VKq(14,yi,t.feature))}}let xi=(()=>{class o{constructor(t){this.elementRef=t,this._strokeWidthCoeff=1.8,this._strokeWidthLineCoeff=1.2,this.disabledIcon=_.g82,this.duplicateIcon=J.WM4,this.centerIcon=_.TL5,this.paramIcon=_.gr5,this.displayPopup=!1}ngOnInit(){}ngOnDestroy(){this.elementRef.nativeElement.remove()}set feature(t){this._feature=t,this._id=t.getId(),this._geometry=t.getGeometry()}get feature(){return this._feature}get id(){return this._id}get geometry(){return this._geometry}set selected(t){this.displayPopup=!1,this._selected=t}get selected(){return this._selected}removeFeature(){this.layer.container.removeFeature(this.id)}duplicateFeature(){this.layer.select.getFeatures().clear(),this.layer.container.duplicateFeature(this.id)}zoomToFeature(){this.layer.zoomToFeature(this.id)}showPopup(){this.displayPopup=!this.displayPopup}copyToClipboard(t){const i=document.createElement("textarea");i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.opacity="0",i.value=t,document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),document.body.removeChild(i)}getWktFromFeature(){return Fe(this.geometry)}getBoundsFromFeature(){return this.geometry.getExtent().join(", ")}applyClassifiedStyle(){const t=this.layer.container.propertyStyled;null!==t&&this.layer.container.styleSettings.forEach(i=>{this.feature.get(t)===i.class&&this.feature.set("fill_color",i.color)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-feature"]],inputs:{layer:"layer",feature:"feature",selected:"selected"},decls:14,vars:8,consts:[[1,"pointer","feature-item","mx-4","py-1","d-flex","flex-row","align-items-around","border-top"],[1,"me-2","d-flex","flex-row"],["ngbPopover","Center sur l'object","triggers","mouseenter:mouseleave",1,"px-1",3,"click"],[1,"",3,"icon"],["ngbPopover","Dupliquer l'object","triggers","mouseenter:mouseleave",1,"px-1",3,"click"],[1,"me-2","d-flex","flex-row","small"],["height","20","width","20",4,"ngIf"],["height","16","width","25",4,"ngIf"],[1,"title","small"],["class","ms-auto d-flex flex-row align-items-center",4,"ngIf"],["class","featureToast position-fixed bottom-0 end-0 p-3 d-flex flex-row overflow-auto fw-normal pointer-none","style","z-index: 11",3,"id",4,"ngIf"],["height","20","width","20"],["cx","10","cy","10","r","7"],["x1","0","y1","10","x2","20","y2","10"],["height","16","width","25"],["x","0","y","0","width","25","height","16"],[1,"ms-auto","d-flex","flex-row","align-items-center"],["ngbPopover","Supprimer l'object","triggers","mouseenter:mouseleave",1,"px-2","text-danger",3,"click"],["ngbPopover","Options de l'objet","triggers","mouseenter:mouseleave",1,"px-1","text-black",3,"click"],["size","1x",1,"",3,"icon"],[1,"featureToast","position-fixed","bottom-0","end-0","p-3","d-flex","flex-row","overflow-auto","fw-normal","pointer-none",2,"z-index","11",3,"id"],["role","alert","aria-live","assertive","aria-atomic","true",1,"toast","toastFeature","faded"],[1,"toast-header","justify-content-between"],[1,"ms-2","me-auto","me-auto"],[1,"ms-auto"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"toast-body","bg-white"],["id","toastActions",1,"d-flex","flex-row","justify-content-start","align-items-center"],[1,"fw-bold"],["data-bs-toggle","tooltip","data-bs-placement","bottom","title","Copier le WKT",1,"badge","bg-dark","rounded","m-1","small","pointer",3,"click"],["data-bs-toggle","tooltip","data-bs-placement","bottom","title","Copier la Bbox (xmin, ymin, xmax, ymax)",1,"badge","bg-primary","rounded","m-1","small","pointer",3,"click"],[1,"d-flex","flex-row","justify-content-between"],[3,"attributesHeaders","features","edited"]],template:function(t,i){1&t&&(e.TgZ(0,"li",0)(1,"div",1)(2,"div",2),e.NdJ("click",function(){return i.zoomToFeature()}),e._UZ(3,"fa-icon",3),e.qZA(),e.TgZ(4,"div",4),e.NdJ("click",function(){return i.duplicateFeature()}),e._UZ(5,"fa-icon",3),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,pi,2,3,"svg",6),e.YNc(8,fi,3,4,"svg",6),e.YNc(9,mi,2,3,"svg",7),e.qZA(),e.TgZ(10,"span",8),e._uU(11),e.qZA(),e.YNc(12,_i,5,2,"div",9),e.qZA(),e.YNc(13,Ci,26,16,"div",10)),2&t&&(e.xp6(3),e.Q6J("icon",i.centerIcon),e.xp6(2),e.Q6J("icon",i.duplicateIcon),e.xp6(2),e.Q6J("ngIf","Point"===i.feature.get("geom_type")),e.xp6(1),e.Q6J("ngIf","LineString"===i.feature.get("geom_type")),e.xp6(1),e.Q6J("ngIf","Polygon"===i.feature.get("geom_type")),e.xp6(2),e.Oqu(i.feature.get("name")),e.xp6(1),e.Q6J("ngIf",i.selected),e.xp6(1),e.Q6J("ngIf",i.displayPopup))},dependencies:[w.O5,G.BN,L.o8,Et,w.uU],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer-none[_ngcontent-%COMP%]{cursor:auto}.feature[_ngcontent-%COMP%]:hover{font-weight:700}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.feature-item[_ngcontent-%COMP%]:hover{background-color:#0000001a}@keyframes _ngcontent-%COMP%_featureColorTransition{0%{background-color:var(--bs-secondary)}to{background-color:var(--bs-light)}}"]}),o})();function Ti(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"input",8,22),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(2),s=e.oxw(2);return e.KtG(s.translateHandler(r.checked))}),e.qZA(),e.TgZ(3,"label",23)(4,"div",11),e._UZ(5,"fa-icon",12),e.qZA()(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("id","btnMove"+t.layer.container.uuid)("checked",t.isMoved),e.xp6(2),e.Q6J("for","btnMove"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngClass",t.isMoved?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.moveIcon)}}function vi(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"input",8,24),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(2),s=e.oxw(2);return e.KtG(s.drawHoleHandler(r.checked,!0))}),e.qZA(),e.TgZ(3,"label",25)(4,"div",11),e._UZ(5,"fa-icon",12),e.qZA()(),e.BQk()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("id","btnHole"+t.layer.container.uuid)("checked",t.isHole),e.xp6(2),e.Q6J("for","btnHole"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngClass",t.isHole?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.polygonIcon)}}const bi=function(){return["Polygon","LineString"]},wi=function(){return["Polygon"]};function Pi(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"span",7),e._uU(3,"Ajouter"),e.qZA(),e.TgZ(4,"input",8,9),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(5),s=e.oxw();return e.KtG(s.drawHandler(r.checked))}),e.qZA(),e.TgZ(6,"label",10)(7,"div",11),e._UZ(8,"fa-icon",12),e.qZA()()(),e.TgZ(9,"div",6)(10,"span",7),e._uU(11,"Editer"),e.qZA(),e.YNc(12,Ti,6,5,"ng-container",13),e.TgZ(13,"input",8,14),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(14),s=e.oxw();return e.KtG(s.editHandler(r.checked))}),e.qZA(),e.TgZ(15,"label",15)(16,"div",11),e._UZ(17,"fa-icon",12),e.qZA()(),e.YNc(18,vi,6,5,"ng-container",13),e.qZA(),e.TgZ(19,"div",6)(20,"span",7),e._uU(21,"Calculer"),e.qZA(),e.ynx(22),e.TgZ(23,"button",16),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.computeBoundingBox())}),e._UZ(24,"fa-icon",12),e.qZA(),e.BQk(),e.TgZ(25,"div",6)(26,"span",7),e._uU(27,"Misc"),e.qZA(),e.TgZ(28,"input",17,18),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(29),s=e.oxw();return e.KtG(s.snappingHandler(r.checked))}),e.qZA(),e.TgZ(30,"label",19)(31,"div",20),e._UZ(32,"fa-icon",21),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("id","btnDraw"+t.layer.container.uuid)("checked",t.isDrawn),e.xp6(2),e.Q6J("for","btnDraw"+t.layer.container.uuid)("ngbPopover","Ajouter un objet de type '"+t.layer.container.geomType+"'"),e.xp6(1),e.Q6J("ngClass",t.isDrawn?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.addIcon),e.xp6(4),e.Q6J("ngIf",e.DdM(20,bi).includes(t.layer.container.geomType)),e.xp6(1),e.Q6J("id","btnEdit"+t.layer.container.uuid)("checked",t.isEdited),e.xp6(2),e.Q6J("for","btnEdit"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngClass",t.isEdited?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.editIcon),e.xp6(1),e.Q6J("ngIf",e.DdM(21,wi).includes(t.layer.container.geomType)),e.xp6(6),e.Q6J("icon",t.centerIcon),e.xp6(4),e.Q6J("disabled",t.editing)("checked",t.isSnapped),e.xp6(3),e.ekj("disabled",t.editing),e.Q6J("ngClass",t.isSnapped?"btn-danger":"btn-outline-dark"),e.xp6(1),e.Q6J("icon",t.snapIcon)}}let Fi=(()=>{class o{constructor(t){this.editComputingService=t,this.addIcon=_.EQ8,this.editIcon=_.TzT,this.paramIcon=_.gr5,this.lockIcon=_.byT,this.unLockIcon=_._1N,this.polygonIcon=_.ubJ,this.moveIcon=_.$pG,this.pathIcon=_.KJ_,this.motorIcon=_.yn$,this.pedestrianIcon=_.EiI,this.centerIcon=_.TL5,this.snapIcon=_.mlU,this.isDrawn=!1,this.isEdited=!1,this.isHole=!1,this.isMoved=!1,this.isShortestPath=!1,this.editing=!1,this.isSnapped=!1,this.epsgAvailable=["EPSG:4326","EPSG:3857"],this.strInputDataValues=null,this.strInputEspgInput=null}ngOnInit(){}ngOnDestroy(){this.disableEditing()}set layer(t){this._layer=t}get layer(){return this._layer}set enabled(t){t||this.disableEditing(),this._enabled=t}get enabled(){return this._enabled}enableSnapModeOnAllOthersLayers(){this.isSnapped&&this.editComputingService.activateSnapping(!0)}disableSnapModeOnAllOthersLayers(){this.isSnapped&&this.editComputingService.activateSnapping(!1)}snappingHandler(t){this.isSnapped=t,t||this.disableSnapModeOnAllOthersLayers()}disableEditing(t=!0){this.drawHoleHandler(!1),this.drawHandler(!1),this.editHandler(!1),this.translateHandler(!1),this.disableSnapModeOnAllOthersLayers(),t&&this.unSelectFeature()}unSelectFeature(){this.layer.select.getFeatures().clear()}translateHandler(t){t?(this.disableEditing(!1),this.translateFeatureEnable()):this.translateFeatureDisable()}editHandler(t){t?(this.disableEditing(!1),this.editFeatureEnable(),this.enableSnapModeOnAllOthersLayers()):(this.editFeatureDisable(),this.disableSnapModeOnAllOthersLayers())}drawHandler(t,i=!1){t?(this.disableEditing(!1),this.addFeatureEnable(i),this.enableSnapModeOnAllOthersLayers()):(this.addFeatureDisable(),this.disableSnapModeOnAllOthersLayers())}drawHoleHandler(t,i=!0){t?(this.disableEditing(!1),this.addHoleFeatureEnable(i),this.enableSnapModeOnAllOthersLayers()):(this.addHoleFeatureDisable(),this.disableSnapModeOnAllOthersLayers())}translateFeatureEnable(){this.layer.enableTranslating(),this.isMoved=!0,this.editing=!0}translateFeatureDisable(){this.layer.disableTranslating(),this.isMoved=!1,this.editing=!1}addFeatureEnable(t=!1){this.layer.enableDrawing(t),this.isDrawn=!0,this.editing=!0}addFeatureDisable(){this.layer.disableDrawing(),this.isDrawn=!1,this.editing=!1}editFeatureEnable(){this.layer.enableEditing(),this.isEdited=!0,this.editing=!0}editFeatureDisable(){this.layer.disableEditing(),this.isEdited=!1,this.editing=!1}addHoleFeatureEnable(t=!0){this.layer.enableDrawing(t),this.isHole=!0,this.editing=!0}addHoleFeatureDisable(){this.layer.disableDrawing(),this.isHole=!1,this.editing=!1}computeBoundingBox(){this.layer.container.features.length>0&&this.editComputingService.addNewFeatures(this.layer.exportBoundsPolygon())}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Se))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-edit-bar"]],inputs:{currentEpsg:"currentEpsg",layer:"layer",enabled:"enabled"},decls:7,vars:3,consts:[[1,"d-flex","flex-column","editTools","bg-dark","bg-gradient","p-2","m-2","rounded-3","shadow"],[1,"d-flex","flex-row","align-items-center","justify-content-center","text-warning","m-1"],[1,"fw-bold","me-1"],[1,"fst-italic"],["class","d-flex flex-row m-1",4,"ngIf"],[1,"d-flex","flex-row","m-1"],[1,"d-flex","flex-row","m-1","align-items-center","shadow","border","rounded","bg-light"],[1,"text-dark","m-2","fw-bold","small"],["type","checkbox",1,"btn-check",3,"id","checked","click"],["btnDraw",""],["triggers","mouseenter:mouseleave",3,"for","ngbPopover"],[1,"btn","btn-outline-success","m-1",3,"ngClass"],[3,"icon"],[4,"ngIf"],["btnEdit",""],["ngbPopover","Editer","triggers","mouseenter:mouseleave",3,"for"],["ngbPopover","La bounding box","triggers","mouseenter:mouseleave",1,"btn","btn-outline-success","m-1",3,"click"],["type","checkbox","id","btnSnap",1,"btn-check",3,"disabled","checked","click"],["btnSnap",""],["for","btnSnap","container","body","ngbPopover","Activer le snapping","triggers","mouseenter:mouseleave"],[1,"btn","m-1",3,"ngClass"],["size","xs",3,"icon"],["btnMove",""],["ngbPopover","D\xe9placer","triggers","mouseenter:mouseleave",3,"for"],["btnHole",""],["ngbPopover","Ajouter un trou","triggers","mouseenter:mouseleave",3,"for"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"span",3),e._uU(5),e.qZA()(),e.YNc(6,Pi,33,22,"div",4),e.qZA()),2&t&&(e.xp6(3),e.Oqu(i.layer.container.layerName),e.xp6(2),e.hij("(",i.layer.container.geomType,")"),e.xp6(1),e.Q6J("ngIf",i.enabled))},dependencies:[w.mk,w.O5,G.BN,L.o8]}),o})();function Si(o,n){if(1&o&&(e.TgZ(0,"option"),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.xp6(1),e.Oqu(t)}}function Ei(o,n){if(1&o&&(e.TgZ(0,"option"),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.xp6(1),e.Oqu(t)}}function Li(o,n){1&o&&(e.TgZ(0,"span",27),e._uU(1,"Classes :"),e.qZA())}function Ii(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",28)(1,"span",29),e._uU(2),e.qZA(),e.TgZ(3,"div",30)(4,"input",31,32),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.MAs(5),l=e.oxw(),c=e.MAs(35);return e.KtG(l.changeCategoryClassStyle(c.value,s.class,a.value))}),e.qZA(),e._UZ(6,"label",33),e.TgZ(7,"input",34,35),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.MAs(5),l=e.oxw(),c=e.MAs(35);return e.KtG(l.changeCategoryClassStyle(c.value,s.class,a.value))}),e.qZA(),e._UZ(9,"label",36),e.qZA()()}if(2&o){const t=n.$implicit;e.xp6(2),e.Oqu(t.class),e.xp6(2),e.Q6J("value",t.color),e.xp6(3),e.Q6J("value",t.color)}}let Mi=(()=>{class o{constructor(){this.propertiesStylingClassified=[]}ngOnInit(){}set layer(t){this._layer=t}get layer(){return this._layer}getFeatures(){return this.layer.container.features}addField(t){this.layer.setAttribute(t,null)}updateField(t,i){"number"==typeof i&&(i=+i),this.layer.removeAttribute(t),this.layer.setAttribute(t,i)}removeField(t){this.layer.removeAttribute(t)}refreshTable(){this.getFeatures()}setCategoryClassesStyling(t){this.propertiesStylingClassified=[];let i=[];this.layer.container.features.forEach(r=>{const s=r.get(t);i.includes(s)||i.push(s)}),i.forEach(r=>{const s=at();this.propertiesStylingClassified.push({class:r,color:s})}),this.applyClassifiedStyle(t)}changeCategoryClassStyle(t,i,r){this.propertiesStylingClassified.forEach(s=>{s.class===i&&(s.color=r)}),this.applyClassifiedStyle(t)}applyClassifiedStyle(t){this.propertiesStylingClassified.forEach(i=>{this.layer.container.features.forEach(r=>{r.get(t)===i.class&&r.set("fill_color",i.color)})}),this.layer.container.propertyStyled=t,this.layer.container.styleSettings=this.propertiesStylingClassified}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-layer-table"]],inputs:{layer:"layer"},decls:43,vars:10,consts:[["role","tablist",1,"nav","nav-pills","align-items-center","justify-content-center","mt-2","mb-3"],["role","presentation",1,"nav-item","border","m-1"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold","active"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold"],["id","'StylingTabContent' + layer.container.id",1,"d-flex","flex-row","mx-2","tab-content"],["role","tabpanel",1,"tab-pane","fade","w-100","show","active",3,"id"],[1,"d-flex","flex-row"],[1,"input-group","m-2"],["type","text","placeholder","Ajouter un champs","aria-label","Ajouter un champs","aria-describedby","btn-add-field",1,"form-control"],["fieldToAdd",""],["type","button","id","btn-add-field",1,"btn","btn-success",3,"click"],["type","text","placeholder","Supprimer un champs","aria-label","Supprimer un champs","aria-describedby","btn-rm-field",1,"form-control"],["fieldToRm",""],["type","button","id","btn-rm-field",1,"btn","btn-danger",3,"click"],[1,"input-group-text"],["aria-label","Champs",1,"form-select"],["fieldSelected",""],[4,"ngFor","ngForOf"],["type","text","placeholder","D\xe9finir une valeur","aria-label","Valeur","aria-describedby","btn-field-value",1,"form-control"],["fieldValue",""],["type","button","id","btn-field-value",1,"btn","btn-warning",3,"click"],["role","tabpanel",1,"m-2","tab-pane","fade","w-100","show",3,"id"],[1,"input-group","mb-3"],["fieldClassifiedSelected",""],["class","fs-4",4,"ngIf"],["class","d-flex flex-row ms-2 my-1",4,"ngFor","ngForOf"],[3,"attributesHeaders","features","edited"],[1,"fs-4"],[1,"d-flex","flex-row","ms-2","my-1"],[1,"w-25"],[1,"d-flex","flex-row","align-items-center"],["type","color","id","strokeColor",1,"fillColor","pointer","border-0",3,"value","change"],["layerStrokeColor",""],["for","strokeColor"],["type","text","id","textStrokeColor",1,"fillColor","p-0","border-1",3,"value","change"],["textLayerStrokeColor",""],["for","textStrokeColor"]],template:function(t,i){if(1&t){const r=e.EpF();e.TgZ(0,"ul",0)(1,"li",1)(2,"a",2),e._uU(3," Modification des attributs "),e.qZA()(),e.TgZ(4,"li",1)(5,"a",3),e._uU(6," Application de style "),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7),e._UZ(11,"input",8,9),e.TgZ(13,"button",10),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(12);return e.KtG(i.addField(a.value))}),e._uU(14,"Ajouter"),e.qZA()(),e.TgZ(15,"div",7),e._UZ(16,"input",11,12),e.TgZ(18,"button",13),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(17);return e.KtG(i.removeField(a.value))}),e._uU(19,"Supprimer"),e.qZA()()(),e.TgZ(20,"div",7)(21,"span",14),e._uU(22,"S\xe9lection du champ"),e.qZA(),e.TgZ(23,"select",15,16),e.YNc(25,Si,2,1,"option",17),e.qZA(),e._UZ(26,"input",18,19),e.TgZ(28,"button",20),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(24),l=e.MAs(27);return e.KtG(i.updateField(a.value,l.value))}),e._uU(29,"Mettre \xe0 jour"),e.qZA()()(),e.TgZ(30,"div",21)(31,"div",22)(32,"span",14),e._uU(33,"Classification par cat\xe9gories"),e.qZA(),e.TgZ(34,"select",15,23),e.YNc(36,Ei,2,1,"option",17),e.qZA(),e.TgZ(37,"button",20),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(35);return e.KtG(i.setCategoryClassesStyling(a.value))}),e._uU(38,"Appliquer"),e.qZA()(),e.TgZ(39,"div"),e.YNc(40,Li,2,0,"span",24),e.YNc(41,Ii,10,3,"div",25),e.qZA()()(),e.TgZ(42,"app-widget-table",26),e.NdJ("edited",function(){e.CHM(r);const a=e.MAs(35);return e.KtG(i.applyClassifiedStyle(a.value))}),e.qZA()}2&t&&(e.xp6(2),e.uIk("data-bs-target","#attributesChanges"+i.layer.container.uuid),e.xp6(3),e.uIk("data-bs-target","#styleApplying"+i.layer.container.uuid),e.xp6(3),e.Q6J("id","attributesChanges"+i.layer.container.uuid),e.xp6(17),e.Q6J("ngForOf",i.layer.getAttributesHeader()),e.xp6(5),e.Q6J("id","styleApplying"+i.layer.container.uuid),e.xp6(6),e.Q6J("ngForOf",i.layer.getAttributesHeader()),e.xp6(4),e.Q6J("ngIf",i.propertiesStylingClassified.length>0),e.xp6(1),e.Q6J("ngForOf",i.propertiesStylingClassified),e.xp6(1),e.Q6J("attributesHeaders",i.layer.getAttributesHeader())("features",i.getFeatures()))},dependencies:[w.sg,w.O5,N.YN,N.Kr,Et],styles:["table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{position:relative}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:none;position:absolute;display:block;top:0;left:0;margin:0;height:100%;width:100%;border:none;padding:10px;box-sizing:border-box}"]}),o})(),ki=(()=>{class o{constructor(){this.fillColorEvent=new e.vpe,this.strokeColorEvent=new e.vpe,this.strokeWidthEvent=new e.vpe}setFillColor(t){this.fillColor=t,this.fillColorEvent.emit(t)}setStrokeColor(t){this.strokeColor=t,this.strokeColorEvent.emit(t)}setStrokeWidth(t){this.strokeWidth=t,this.strokeWidthEvent.emit(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-widget-color"]],inputs:{fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth"},outputs:{fillColorEvent:"fillColorEvent",strokeColorEvent:"strokeColorEvent",strokeWidthEvent:"strokeWidthEvent"},decls:30,vars:5,consts:[[1,"d-flex","flex-column","my-2"],[1,"fs-5"],[1,"d-flex","flex-row","ms-2","my-1"],[1,"fs-6","ms-2"],["type","color","id","fillColor",1,"fillColor","pointer","border-0",3,"value","change"],["layerFillColor",""],["for","fillColor"],["type","text","id","textFillColor",1,"fillColor","p-0","border-1",3,"value","change"],["textLayerFillColor",""],["for","textFillColor"],["type","color","id","strokeColor",1,"fillColor","pointer","border-0",3,"value","change"],["layerStrokeColor",""],["for","strokeColor"],["type","text","id","textStrokeColor",1,"fillColor","p-0","border-1",3,"value","change"],["textLayerStrokeColor",""],["for","textStrokeColor"],[1,"d-flex","flex-row","align-items-center","ms-2"],["type","number","min","0","max","12",1,"small","strokeWidth",3,"value","change"],["layerStrokeWidth",""]],template:function(t,i){if(1&t){const r=e.EpF();e.TgZ(0,"div",0)(1,"span",1),e._uU(2,"Fond"),e.qZA(),e.TgZ(3,"div",2)(4,"span",3),e._uU(5,"Couleur :"),e.qZA(),e.TgZ(6,"input",4,5),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(7);return e.KtG(i.setFillColor(a.value))}),e.qZA(),e._UZ(8,"label",6),e.TgZ(9,"input",7,8),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(10);return e.KtG(i.setFillColor(a.value))}),e.qZA(),e._UZ(11,"label",9),e.qZA()(),e.TgZ(12,"div",0)(13,"span",1),e._uU(14,"Contour"),e.qZA(),e.TgZ(15,"div",2)(16,"span",3),e._uU(17,"Couleur :"),e.qZA(),e.TgZ(18,"input",10,11),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(19);return e.KtG(i.setStrokeColor(a.value))}),e.qZA(),e._UZ(20,"label",12),e.TgZ(21,"input",13,14),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(22);return e.KtG(i.setStrokeColor(a.value))}),e.qZA(),e._UZ(23,"label",15),e.qZA(),e.TgZ(24,"div",2)(25,"span",3),e._uU(26,"Epaisseur du contour :"),e.qZA(),e.TgZ(27,"div",16)(28,"input",17,18),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(29);return e.KtG(i.setStrokeWidth(a.value))}),e.qZA()()()()}2&t&&(e.xp6(6),e.Q6J("value",i.fillColor),e.xp6(3),e.Q6J("value",i.fillColor),e.xp6(9),e.Q6J("value",i.strokeColor),e.xp6(3),e.Q6J("value",i.strokeColor),e.xp6(7),e.Q6J("value",i.strokeWidth))}}),o})();function Zi(o,n){1&o&&e.GkF(0)}const Ye=function(o){return{layerObject:o}};function Ai(o,n){if(1&o&&(e.TgZ(0,"div",9),e.YNc(1,Zi,1,0,"ng-container",10),e.qZA()),2&o){const t=e.oxw(),i=e.MAs(16);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,Ye,t.layer))}}function Gi(o,n){1&o&&e.GkF(0)}function Oi(o,n){if(1&o&&(e.TgZ(0,"div",9),e.YNc(1,Gi,1,0,"ng-container",10),e.qZA()),2&o){const t=e.oxw(),i=e.MAs(18);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,Ye,t.layer))}}function Ni(o,n){1&o&&e.GkF(0)}function Di(o,n){if(1&o&&(e.TgZ(0,"div",9),e.YNc(1,Ni,1,0,"ng-container",10),e.qZA()),2&o){const t=e.oxw(),i=e.MAs(20);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,Ye,t.layer))}}function Ji(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"span",11),e._uU(1,"Informations g\xe9n\xe9rales"),e.qZA(),e.TgZ(2,"div",12)(3,"div",13)(4,"span",14),e._uU(5,"Nom de la couche :"),e.qZA(),e.TgZ(6,"input",15,16),e.NdJ("change",function(){e.CHM(t);const r=e.MAs(7),s=e.oxw();return e.KtG(s.layer.container.layerName=r.value)}),e.qZA()(),e.TgZ(8,"div",13)(9,"span",14),e._uU(10,"Type de la g\xe9om\xe9trie :"),e.qZA(),e.TgZ(11,"span"),e._uU(12),e.qZA()(),e.TgZ(13,"div",17)(14,"span",18),e._uU(15,"Bounding box de la couche:"),e.qZA(),e.TgZ(16,"span",19),e._uU(17),e.qZA(),e.TgZ(18,"span",19),e._uU(19),e.qZA()()(),e.TgZ(20,"span",11),e._uU(21,"Style global de la couche"),e.qZA(),e.TgZ(22,"div",12)(23,"div",17)(24,"span",14),e._uU(25,"Opacit\xe9 :"),e.qZA(),e.TgZ(26,"div",20)(27,"input",21,22),e.NdJ("change",function(){e.CHM(t);const r=e.MAs(28),s=e.oxw();return e.KtG(s.layer.container.opacity=r.value)}),e.qZA()()(),e.TgZ(29,"app-widget-color",23),e.NdJ("fillColorEvent",function(r){e.CHM(t);const s=e.oxw();return s.layer.container.fillColor=r,e.KtG(s.updateStyle())})("strokeColorEvent",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.layer.container.strokeColor=r)})("strokeWidthEvent",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.layer.container.strokeWidth=r)}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(6),e.Q6J("placeholder",t.layer.container.layerName),e.xp6(6),e.Oqu(t.layer.container.geomType),e.xp6(5),e.AsE("x min, x max: ",t.layer.exportBounds()[0],", ",t.layer.exportBounds()[2],""),e.xp6(2),e.AsE("y min, y max: ",t.layer.exportBounds()[1],", ",t.layer.exportBounds()[3],""),e.xp6(8),e.Q6J("value",t.layer.container.opacity),e.xp6(2),e.Q6J("fillColor",t.layer.container.fillColor)("strokeColor",t.layer.container.strokeColor)("strokeWidth",t.layer.container.strokeWidth)}}function Ri(o,n){if(1&o&&e._UZ(0,"app-layer-table",24),2&o){const t=e.oxw();e.Q6J("layer",t.layer)}}function Ui(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"span",11),e._uU(1,"Exportation des donn\xe9es"),e.qZA(),e.TgZ(2,"ul",25)(3,"li",26)(4,"a",27),e._uU(5," GeoJSON "),e.qZA()(),e.TgZ(6,"li",26)(7,"a",28),e._uU(8," WKT "),e.qZA()(),e.TgZ(9,"li",26)(10,"a",28),e._uU(11," Pytest Fixtures "),e.qZA()()(),e.TgZ(12,"div",29)(13,"div",30)(14,"textarea",31,32),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(15);return e.KtG(r.select())}),e._uU(16),e.qZA()(),e.TgZ(17,"div",33)(18,"textarea",31,34),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(19);return e.KtG(r.select())}),e._uU(20),e.qZA()(),e.TgZ(21,"div",33)(22,"textarea",31,35),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(23);return e.KtG(r.select())}),e._uU(24),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(4),e.uIk("data-bs-target","#GeoJsonTab"+t.layer.container.uuid),e.xp6(3),e.uIk("data-bs-target","#wktTab"+t.layer.container.uuid),e.xp6(3),e.uIk("data-bs-target","#pytestFixture"+t.layer.container.uuid),e.xp6(3),e.Q6J("id","GeoJsonTab"+t.layer.container.uuid),e.xp6(3),e.Oqu(t.layer.exportToGeoJSON()),e.xp6(1),e.Q6J("id","wktTab"+t.layer.container.uuid),e.xp6(3),e.Oqu(t.layer.exportToWkt()),e.xp6(1),e.Q6J("id","pytestFixture"+t.layer.container.uuid),e.xp6(3),e.Oqu(t.layer.exportToPytestFixture())}}let ji=(()=>{class o{ngOnInit(){this.updateStyle()}set layer(t){this._layer=t}get layer(){return this._layer}updateStyle(){this.layer.container.propertyStyled=null,this.layer.container.styleSettings=[{class:"*",color:this.layer.container.fillColor}]}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-layer-settings"]],inputs:{layer:"layer"},decls:21,vars:1,consts:[["ngbNav","",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem",""],["ngbNavLink","",1,"fw-bold"],["ngbNavContent",""],[1,"nav-content","mx-2",3,"ngbNavOutlet"],["ngNavLayerGeneral",""],["ngNavLayerAttributes",""],["ngNavLayerExporting",""],[1,"d-flex","flex-column"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"fs-4","my-2"],[1,"d-flex","flex-column","ms-3"],[1,"d-flex","flex-row","align-items-center","my-2"],[1,"fs-5","me-2"],["type","text","aria-label","layerName",1,"form-control","w-50",3,"placeholder","change"],["layerName",""],[1,"d-flex","flex-column","my-2"],[1,"fs-5"],[1,"ms-3"],[1,"d-flex","flex-row","align-items-center","ms-2"],["id","","type","range","min","0","max","1","step","0.1",1,"small","opacity-setter",3,"value","change"],["opacityInput",""],[3,"fillColor","strokeColor","strokeWidth","fillColorEvent","strokeColorEvent","strokeWidthEvent"],[3,"layer"],["role","tablist",1,"nav","nav-pills","align-items-center","justify-content-center"],["role","presentation",1,"nav-item","border","m-1"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold","active"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold"],["id","'tabContent' + layer.container.id",1,"d-flex","flex-row","mx-2","tab-content"],["role","tabpanel",1,"tab-pane","fade","w-100","show","active",3,"id"],["aria-label","With textarea","readonly","",1,"form-control","vh-100",3,"click"],["exportGeoJsonStringGeomDiv",""],["role","tabpanel",1,"tab-pane","fade","w-100","show",3,"id"],["exportWktStringGeomDiv",""],["exportPytestFixturesGeomDiv",""]],template:function(t,i){if(1&t&&(e.TgZ(0,"ul",0,1)(2,"li",2)(3,"a",3),e._uU(4,"G\xe9n\xe9ral"),e.qZA(),e.YNc(5,Ai,2,4,"ng-template",4),e.qZA(),e.TgZ(6,"li",2)(7,"a",3),e._uU(8,"Attributs"),e.qZA(),e.YNc(9,Oi,2,4,"ng-template",4),e.qZA(),e.TgZ(10,"li",2)(11,"a",3),e._uU(12,"Exporter"),e.qZA(),e.YNc(13,Di,2,4,"ng-template",4),e.qZA()(),e._UZ(14,"div",5),e.YNc(15,Ji,30,10,"ng-template",null,6,e.W1O),e.YNc(17,Ri,1,1,"ng-template",null,7,e.W1O),e.YNc(19,Ui,25,9,"ng-template",null,8,e.W1O)),2&t){const r=e.MAs(1);e.xp6(14),e.Q6J("ngbNavOutlet",r)}},dependencies:[w.tP,L.uN,L.Pz,L.nv,L.Is,L.Vx,L.tO,L.Dy,Mi,ki]}),o})();const qi=["modalLayerSettings"],Qi=["modalLayerTable"];function Hi(o,n){if(1&o&&e._UZ(0,"fa-icon",23),2&o){const t=e.oxw();e.Q6J("icon",t.pointIcon)}}function Bi(o,n){if(1&o&&e._UZ(0,"fa-icon",23),2&o){const t=e.oxw();e.Q6J("icon",t.lineStringIcon)}}function Vi(o,n){if(1&o&&e._UZ(0,"fa-icon",23),2&o){const t=e.oxw();e.Q6J("icon",t.polygonIcon)}}function Yi(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-feature",34),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.selectFeatureById(s.get("id")))}),e.qZA(),e.BQk()}if(2&o){const t=n.$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngClass",i.featuresIdSelected.includes(t.get("id"))?"fw-bold bg-secondary bg-opacity-25":"")("selected",i.featuresIdSelected.includes(t.get("id")))("feature",t)("layer",i.layer)}}function Ki(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",24)(1,"div",25)(2,"div",26),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.zoomToLayer())}),e._UZ(3,"fa-icon",6),e.qZA(),e.TgZ(4,"div",27),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.duplicateLayer())}),e._UZ(5,"fa-icon",6),e.qZA(),e.TgZ(6,"div",28),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.toggleFeatures())}),e._UZ(7,"fa-icon",6),e.qZA(),e.TgZ(8,"div",29),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.unSelectFeatures())}),e._UZ(9,"fa-icon",30),e.TgZ(10,"span"),e._uU(11),e.qZA()(),e.TgZ(12,"div",31),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.removeLayer())}),e._UZ(13,"fa-icon",6),e.qZA()(),e.TgZ(14,"ul",32),e.YNc(15,Yi,2,4,"ng-container",33),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("icon",t.centerIcon),e.xp6(2),e.Q6J("icon",t.duplicateIcon),e.xp6(2),e.Q6J("icon",t.toggled?t.toggleIcon:t.unToggleIcon),e.xp6(2),e.Q6J("icon",t.clearIcon),e.xp6(2),e.AsE("",t.featuresIdSelected.length," / ",t.layer.container.features.length," s\xe9lectionn\xe9(s)"),e.xp6(1),e.Q6J("ngClass",t.locked?"pe-none":"pe-auto"),e.xp6(1),e.Q6J("icon",t.removeIcon),e.xp6(1),e.Q6J("hidden",t.toggled)("id","featuresLayer-"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngForOf",t.layer.container.features)}}function Wi(o,n){if(1&o&&e._UZ(0,"app-edit-bar",37),2&o){const t=e.oxw(2);e.Q6J("layer",t.layer)("enabled",!t.locked&&t.selected)("currentEpsg",t.epsg)}}function Xi(o,n){if(1&o&&(e.TgZ(0,"div",35),e.YNc(1,Wi,1,3,"app-edit-bar",36),e.qZA()),2&o){const t=e.oxw();e.Q6J("isRemoved",t.isLayerRemoved),e.xp6(1),e.Q6J("ngIf",t.selected)}}let zi=(()=>{class o{constructor(t,i,r){this.elementRef=t,this.interactionsService=i,this.editComputingService=r,this.layerIdCurrentlySelected=new e.vpe,this.layerMoveUp=new e.vpe,this.layerMoveDown=new e.vpe,this.layerCloned=new e.vpe,this.removeLayerId=new e.vpe,this.groupIcon=_.Krp,this.helpIcon=_.FDd,this.addIcon=_.EQ8,this.editIcon=_.TzT,this.paramIcon=_.gr5,this.clearIcon=_.Z$V,this.removeIcon=J.Vui,this.EditIcon=_.diR,this.pointIcon=_.diR,this.lineStringIcon=_.fQK,this.polygonIcon=_.ubJ,this.visibleIcon=_.Mdf,this.invisibleIcon=_.Aq,this.upIcon=_.l1h,this.downIcon=_.eW2,this.duplicateIcon=J.WM4,this.centerIcon=_.TL5,this.lockIcon=_.byT,this.unLockIcon=_._1N,this.unToggleIcon=J.El_,this.toggleIcon=J.CPW,this._selected=!1,this.displayTool=!1,this.isDrawn=!1,this.isEdited=!1,this.isShown=!1,this.isHole=!1,this.featuresIdSelected=[],this.isLayerRemoved=!1,this.exportData="",this.exportDataMode="geojson",this.removeLayerSubscription=this.interactionsService.removeLayers.subscribe(s=>{this.removeLayer()}),this.featureIdEditedSubscription=this.editComputingService.snappingLayerEnabled.subscribe(s=>{s?this.layer.enableSnapping():this.layer.disableSnapping()})}openSettings(){var t=this;return(0,St.Z)(function*(){return yield t.modalLayerSettingComponent.open()})()}openTable(){var t=this;return(0,St.Z)(function*(){return yield t.modalLayerTableComponent.open()})()}ngOnInit(){this.layer.enableSelecting(),this.layerSelectConfigured(),this.layer.container.sourceFeatures.on("changefeature",t=>{Ft(t.feature)}),this.zoomToLayer()}ngOnDestroy(){this.isLayerRemoved=!0;let t=document.getElementById("modalWktLayer-"+this.layer.container.uuid);null!==t&&t.remove(),this.removeLayerSubscription.unsubscribe(),this.featureIdEditedSubscription.unsubscribe(),this.layer.disableSelecting(),this.elementRef.nativeElement.remove()}toggleFeatures(){this.toggled=!this.toggled}set layer(t){this._layer=t}get layer(){return this._layer}set epsg(t){t!==this._epsg&&void 0!==this._epsg&&this.layer.container.features.forEach(i=>{i.setGeometry(i.getGeometry().transform(this._epsg,t))}),this._epsg=t}get epsg(){return this._epsg}set visible(t){this.layer.container.visible=t}get visible(){return this.layer.container.visible}set locked(t){this.layer.container.locked=t}get locked(){return this.layer.container.locked}set toggled(t){this.layer.container.featuresToggled=t}get toggled(){return this.layer.container.featuresToggled}set selected(t){t?this.selectLayer():this.unSelectFeatures(),this._selected=t}get selected(){return this._selected}layerSelectConfigured(){this.layer.select.on("select",t=>{let i=t.deselected,r=t.selected;t.mapBrowserEvent.originalEvent.shiftKey?r.forEach(s=>{this.featuresIdSelected.push(s.get("id")),this.layer.select.getFeatures().push(s),this.selectLayer()}):(i.length>0&&this.unSelectFeatures(),0==r.length&&(this.selected=!1),0==i.length&&(this.selected=!0),r.length>0&&r.forEach(s=>{this.featuresIdSelected.push(s.get("id")),this.layer.select.getFeatures().push(s)}))})}removeLayer(){this.layer.removeLayer(),this.removeLayerId.emit(this.layer.container.uuid),this.ngOnDestroy()}layerGoUp(){this.layerMoveUp.emit(this.layer.container.uuid)}layerGoDown(){this.layerMoveDown.emit(this.layer.container.uuid)}selectLayer(){this.interactionsService.sendSelectedLayerId(this.layer.container.uuid)}unSelectLayer(){this.interactionsService.sendSelectedLayerId(null)}zoomToLayer(){this.layer.zoomToLayer()}duplicateLayer(){this.unSelectFeatures();const t=Object.create(this.layer);this.layerCloned.emit(t)}unSelectFeatures(){this.featuresIdSelected=[],this.layer.select.getFeatures().clear()}selectFeatureById(t){this.unSelectFeatures(),this.featuresIdSelected.push(t);let i=this.getFeature(t);this.layer.select.getFeatures().push(i),this.selected=!0}getFeature(t){let i=this.layer.container.features.filter(r=>r.getId()===t);return 1===i.length?i[0]:null}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq),e.Y36(ne),e.Y36(Se))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-layer"]],viewQuery:function(t,i){if(1&t&&(e.Gf(qi,5),e.Gf(Qi,5)),2&t){let r;e.iGM(r=e.CRH())&&(i.modalLayerSettingComponent=r.first),e.iGM(r=e.CRH())&&(i.modalLayerTableComponent=r.first)}},inputs:{layersVisibleStatus:"layersVisibleStatus",layer:"layer",epsg:"epsg",visible:"visible",locked:"locked",toggled:"toggled",selected:"selected"},outputs:{layerIdCurrentlySelected:"layerIdCurrentlySelected",layerMoveUp:"layerMoveUp",layerMoveDown:"layerMoveDown",layerCloned:"layerCloned",removeLayerId:"removeLayerId"},decls:31,vars:24,consts:[[1,"layer","d-flex","flex-column","m-1","p-1","align-items-around"],[1,"header","d-flex","flex-row","align-items-center","rounded","border","p-2","pointer","shadow",3,"ngClass","click"],[1,"d-flex","flex-row","justify-content-start","align-items-center","me-1"],["type","checkbox",1,"btn-check",3,"id","checked","change"],["btnVisible",""],["container","body","triggers","mouseenter:mouseleave",1,"p-1","pointer",3,"for","ngClass","ngbPopover"],[1,"",3,"icon"],["btnLocked",""],["container","body","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","pointer",3,"for","ngbPopover"],[1,"d-flex","flex-column","justify-content-center","align-items-center","mx-1",3,"ngClass"],["container","body","ngbPopover","Remonter","triggers","mouseenter:mouseleave",1,"text-danger",3,"click"],["container","body","ngbPopover","Descendre","triggers","mouseenter:mouseleave",1,"text-danger",3,"click"],[1,"d-flex","flex-row","pointer","justify-content-center","align-items-center","w-50","flex-fill"],[1,"me-2"],[3,"icon",4,"ngIf"],[1,"layer-name","fw-bold"],["ngbPopover","Options de la couche","triggers","mouseenter:mouseleave",1,"px-1","text-black",3,"click"],["size","1x",1,"",3,"icon"],["class","feature-container d-flex flex-column small",4,"ngIf"],["moveDivToBody","","class","position-fixed bottom-0 start-50 translate-middle-x",3,"isRemoved",4,"ngIf"],[3,"title"],["modalLayerSettings",""],[3,"layer"],[3,"icon"],[1,"feature-container","d-flex","flex-column","small"],[1,"d-flex","flex-row","justify-content-around","align-items-center","flex-fill","pt-1","mx-2","px-3","pb-1","shadow","border","border-top-0","border-warning","border-opacity-50","rounded-bottom","bg-warning","bg-opacity-25"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],["ngbPopover","Dupliquer","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],["ngbPopover","Masquer les objets","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],["ngbPopover","D\xe9s\xe9lectionner","triggers","mouseenter:mouseleave",1,"pointer","ms-auto",3,"click"],[1,"me-1",3,"icon"],["ngbPopover","Supprimer","triggers","mouseenter:mouseleave",1,"pointer","ms-auto","px-1","text-danger",3,"ngClass","click"],["id","featuresList",1,"list-unstyled","my-1","h-25",3,"hidden","id"],[4,"ngFor","ngForOf"],[3,"ngClass","selected","feature","layer","click"],["moveDivToBody","",1,"position-fixed","bottom-0","start-50","translate-middle-x",3,"isRemoved"],["class","",3,"layer","enabled","currentEpsg",4,"ngIf"],[1,"",3,"layer","enabled","currentEpsg"]],template:function(t,i){if(1&t){const r=e.EpF();e.TgZ(0,"div",0)(1,"div",1),e.NdJ("click",function(){return i.selected=!0}),e.TgZ(2,"div",2)(3,"input",3,4),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(4);return e.KtG(i.visible=a.checked)}),e.qZA(),e.TgZ(5,"label",5),e._UZ(6,"fa-icon",6),e.qZA(),e.TgZ(7,"input",3,7),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(8);return e.KtG(i.locked=a.checked)}),e.qZA(),e.TgZ(9,"label",8),e._UZ(10,"fa-icon",6),e.qZA(),e.TgZ(11,"div",9)(12,"div",10),e.NdJ("click",function(){return i.layerGoUp()}),e._UZ(13,"fa-icon",6),e.qZA(),e.TgZ(14,"div",11),e.NdJ("click",function(){return i.layerGoDown()}),e._UZ(15,"fa-icon",6),e.qZA()()(),e.TgZ(16,"div",12)(17,"div",13),e.YNc(18,Hi,1,1,"fa-icon",14),e.YNc(19,Bi,1,1,"fa-icon",14),e.YNc(20,Vi,1,1,"fa-icon",14),e.qZA(),e.TgZ(21,"div",15)(22,"span"),e._uU(23),e.qZA()()(),e.TgZ(24,"div",16),e.NdJ("click",function(){return i.openSettings()}),e._UZ(25,"fa-icon",17),e.qZA()(),e.YNc(26,Ki,16,11,"div",18),e.qZA(),e.YNc(27,Xi,2,2,"div",19),e.TgZ(28,"set-modal",20,21),e._UZ(30,"app-layer-settings",22),e.qZA()}2&t&&(e.xp6(1),e.Q6J("ngClass",i.selected?"bg-warning border-1":"bg-warning bg-opacity-25"),e.xp6(2),e.Q6J("id","btnVisible"+i.layer.container.uuid)("checked",i.visible),e.xp6(2),e.Q6J("for","btnVisible"+i.layer.container.uuid)("ngClass",i.visible?"text-success":"text-danger")("ngbPopover",i.visible?"Masquer":"Afficher"),e.xp6(1),e.Q6J("icon",i.visible?i.visibleIcon:i.invisibleIcon),e.xp6(1),e.Q6J("id","btnLocked"+i.layer.container.uuid)("checked",i.locked),e.xp6(2),e.Q6J("for","btnLocked"+i.layer.container.uuid)("ngbPopover",i.locked?"D\xe9verrouiller":"Verrouiller"),e.xp6(1),e.Q6J("icon",i.locked?i.lockIcon:i.unLockIcon),e.xp6(1),e.Q6J("ngClass",i.selected?"pe-auto":"pe-none"),e.xp6(2),e.Q6J("icon",i.upIcon),e.xp6(2),e.Q6J("icon",i.downIcon),e.xp6(3),e.Q6J("ngIf","Point"===i.layer.container.geomType),e.xp6(1),e.Q6J("ngIf","LineString"===i.layer.container.geomType),e.xp6(1),e.Q6J("ngIf","Polygon"===i.layer.container.geomType),e.xp6(3),e.Oqu(i.layer.container.layerName),e.xp6(2),e.Q6J("icon",i.paramIcon),e.xp6(1),e.Q6J("ngIf",i.layer.container.features.length>0),e.xp6(1),e.Q6J("ngIf",!i.isLayerRemoved),e.xp6(1),e.Q6J("title","Param\xe8tres de la couche : "+i.layer.container.layerName),e.xp6(2),e.Q6J("layer",i.layer))},dependencies:[w.mk,w.sg,w.O5,G.BN,L.o8,Me,di.z,xi,Fi,ji],styles:[".layer[_ngcontent-%COMP%]{background-color:var(--bs-light)}.layer[_ngcontent-%COMP%]   .layer-name[_ngcontent-%COMP%]:hover{font-weight:700}.layer[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_layerColorTransition;animation-duration:2s}@keyframes _ngcontent-%COMP%_layerColorTransition{0%{background-color:var(--bs-warning)}to{background-color:var(--bs-light)}}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.pointer[_ngcontent-%COMP%]{cursor:pointer}.colorPicker[_ngcontent-%COMP%]{width:10px;height:25px;cursor:pointer}#editBar[_ngcontent-%COMP%]{position:fixed;bottom:0;-webkit-user-select:none;user-select:none}"]}),o})();var $i=f(6422),Lt=f(9851);const Ke="projection",It="coordinateFormat",tr=class er extends $i.Z{constructor(n){n=n||{};const t=document.createElement("div");t.className=void 0!==n.className?n.className:"ol-mouse-position",super({element:t,render:n.render,target:n.target}),this.addChangeListener(Ke,this.handleProjectionChanged_),n.coordinateFormat&&this.setCoordinateFormat(n.coordinateFormat),n.projection&&this.setProjection(n.projection),this.renderOnMouseOut_=void 0!==n.placeholder,this.placeholder_=this.renderOnMouseOut_?n.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=!1!==n.wrapX}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(It)}getProjection(){return this.get(Ke)}handleMouseMove(n){const t=this.getMap();this.updateHTML_(t.getEventPixel(n))}handleMouseOut(n){this.updateHTML_(null)}setMap(n){if(super.setMap(n),n){const t=n.getViewport();this.listenerKeys.push((0,M.oL)(t,Lt.Z.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push((0,M.oL)(t,Lt.Z.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(n){this.set(It,n)}setProjection(n){this.set(Ke,(0,y.U2)(n))}updateHTML_(n){let t=this.placeholder_;if(n&&this.mapProjection_){if(!this.transform_){const s=this.getProjection();this.transform_=s?(0,y.WO)(this.mapProjection_,s):y.gD}const r=this.getMap().getCoordinateFromPixelInternal(n);if(r){const s=(0,y.Cs)();if(s&&(this.transform_=(0,y.WO)(this.mapProjection_,s)),this.transform_(r,r),this.wrapX_){const l=s||this.getProjection()||this.mapProjection_;(0,P.Cf)(r,l)}const a=this.getCoordinateFormat();t=a?a(r):r.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(n){const t=n.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}};function nr(o,n){if(1&o){const t=e.EpF();e.ynx(0),e._UZ(1,"input",10),e.TgZ(2,"label",11),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.setProjection(s))}),e.TgZ(3,"div",12)(4,"span"),e._uU(5),e.qZA()()(),e.BQk()}if(2&o){const t=n.$implicit,i=n.index,r=e.oxw();e.xp6(1),e.Q6J("id","btnradio-selector-"+i)("checked",r.currentEpsg===t),e.xp6(1),e.Q6J("ngClass",r.currentEpsg===t?"bg-success text-white ":"")("for","btnradio-selector-"+i),e.xp6(3),e.Oqu(t)}}let ir=(()=>{class o{constructor(t){this.mapService=t,this.defaultCoordsPrecision=4}ngAfterViewInit(){this.initMousePosition()}updatePrecision(t){this.mousePositionControl.setCoordinateFormat(this.setPrecisionFunc(t.target.value))}setProjection(t){this.currentEpsg=t,this.mapService.setProjectionOnMap(t),this.setMapEpsg()}initMousePosition(){let t;t=document.getElementById("mouseCoordinates"),this.mousePositionControl=new tr({coordinateFormat:this.setPrecisionFunc(this.defaultCoordsPrecision),placeholder:"x :<br>y : ",className:"mouse-position",target:t}),this.map.addControl(this.mousePositionControl)}setPrecisionFunc(t){return function(r){return(0,P.WU)(r,"x : {x}<br>y : {y}",t)}}setMapEpsg(){this.currentEpsg=this.map.getView().getProjection().getCode()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Ie.S))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-geo-tools"]],inputs:{currentEpsg:"currentEpsg",map:"map",epsgAvailable:"epsgAvailable"},decls:12,vars:1,consts:[[1,"text-center","fw-bold","bg-success","bg-gradient","text-white","p-2"],["id","epsgList",1,"text-center","m-3"],[1,"btn-group","m-2","bg-white","rounded-3","border"],[4,"ngFor","ngForOf"],["id","ccordinates",1,"d-flex","flex-column","justify-content-center","align-items-center","m-3"],[1,"d-flex","flex-column"],["id","mouseCoordinates"],[1,"d-flex","flex-row","my-2"],[1,"fw-bold","me-3"],["id","precision","type","number","min","0","max","12","value","4",1,"small","text-center",3,"change"],["type","radio","name","btnRadio","autocomplete","off",1,"border","btn-check",3,"id","checked"],[1,"pointer","p-2",3,"ngClass","for","click"],[1,"dropdown-item","small","d-flex","flex-row"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Projection\n"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2),e.YNc(4,nr,6,5,"ng-container",3),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5),e._UZ(7,"span",6),e.qZA(),e.TgZ(8,"div",7)(9,"span",8),e._uU(10,"Pr\xe9cision"),e.qZA(),e.TgZ(11,"input",9),e.NdJ("change",function(s){return i.updatePrecision(s)}),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("ngForOf",i.epsgAvailable))},dependencies:[w.mk,w.sg],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),o})();function rr(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",3),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.addLayer(s.mode))}),e._UZ(2,"fa-icon",4),e.qZA(),e.BQk()}if(2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngbPopover",t.label),e.xp6(1),e.Q6J("icon",t.icon)}}let or=(()=>{class o{constructor(){this.newLayerEvent=new e.vpe,this._pointIcon=_.diR,this._lineStringIcon=_.fQK,this._polygonIcon=_.ubJ,this._layerTypes=[{mode:"Point",label:"Ajouter une couche de Points",icon:this._pointIcon},{mode:"LineString",label:"Ajouter une couche de LineString",icon:this._lineStringIcon},{mode:"Polygon",label:"Ajouter une couche de Polygones",icon:this._polygonIcon}]}ngOnInit(){this.layerTypesModes=this._layerTypes.filter(t=>this.layerTypeModes.includes(t.mode))}addLayer(t){this.newLayerEvent.emit(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-tools"]],inputs:{layerTypeModes:"layerTypeModes"},outputs:{newLayerEvent:"newLayerEvent"},decls:4,vars:1,consts:[[1,"text-center","fw-bold","bg-dark","bg-gradient","text-white","p-2"],["id","creationTools",1,"text-center","m-3"],[4,"ngFor","ngForOf"],["placement","bottom","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-dark","border-0","me-1","text-warning",3,"ngbPopover","click"],[1,"",3,"icon"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Cr\xe9er "),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,rr,3,2,"ng-container",2),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngForOf",i.layerTypesModes))},dependencies:[w.sg,G.BN,L.o8]}),o})();var sr=f(6488),ar=f(529);let lr=(()=>{class o{constructor(t){this.http=t,this.apiUrl=sr.n+"api/v1/network-api/",this.shortestPathRoute=this.apiUrl+"path/shortest"}getShortestPathFromApi(t,i="vehicle"){return this.http.get(this.shortestPathRoute,{params:{mode:i,step_point:t}})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(ar.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),cr=(()=>{class o{constructor(t,i){this.editComputingService=t,this.graphComputingService=i,this.pathIcon=_.KJ_,this.motorIcon=_.yn$,this.pedestrianIcon=_.EiI}ngOnInit(){}ngOnDestroy(){}set layersToDisplay(t){t.forEach(i=>{["Polygon","LineString"].includes(i.container.geomType)&&(i.container.featuresToggled=!0)})}set layerSelected(t){this.buttonEnabled=!1,null!==t&&"Point"===t.container.geomType&&(this.buttonEnabled=!0),this._layerSelected=t}get layerSelected(){return this._layerSelected}computeShortestPath(t){let i=[];if(null!==this.layerSelected){this.layerSelected.container.features.forEach(s=>{let l=s.clone().getGeometry();void 0!==l&&("EPSG:4326"!==this.currentEpsg&&(l=l.transform(this.currentEpsg,"EPSG:4326")),i.push(Fe(l)))});const r={dataProjection:"EPSG:4326",featureProjection:this.currentEpsg};this.graphComputingService.getShortestPathFromApi(i,t).subscribe(s=>{const a=Ve(s,r);this.editComputingService.addNewFeatures(a)})}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Se),e.Y36(lr))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-path-tools"]],inputs:{currentEpsg:"currentEpsg",layersToDisplay:"layersToDisplay",layerSelected:"layerSelected"},decls:7,vars:3,consts:[[1,"text-center","fw-bold","bg-success","bg-gradient","text-white","p-2"],[1,"d-flex","flex-row","justify-content-center","m-1",3,"ngClass"],["ngbPopover","Pi\xe9ton",1,"btn","btn-sm","btn-outline-secondary","border-0",3,"click"],[3,"icon"],["ngbPopover","Motoris\xe9",1,"btn","btn-sm","btn-outline-secondary","border-0",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Plus court chemin\n"),e.qZA(),e.TgZ(2,"div",1)(3,"button",2),e.NdJ("click",function(){return i.computeShortestPath("pedestrian")}),e._UZ(4,"fa-icon",3),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.computeShortestPath("vehicle")}),e._UZ(6,"fa-icon",3),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngClass",i.buttonEnabled?"pe-auto":"pe-none"),e.xp6(2),e.Q6J("icon",i.pedestrianIcon),e.xp6(2),e.Q6J("icon",i.motorIcon))},dependencies:[w.mk,G.BN,L.o8]}),o})();const dr=["exportStringGeomDiv"];function ur(o,n){if(1&o&&(e.ynx(0),e._UZ(1,"app-geo-tools",21),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("map",t.map)("currentEpsg",t.currentEpsg)("epsgAvailable",t.epsgAvailable)}}const hr=function(){return["Point","LineString","Polygon"]};function gr(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-create-tools",22),e.NdJ("newLayerEvent",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.addLayer(r))}),e.qZA(),e.TgZ(2,"app-import-tools",23),e.NdJ("featuresToNewLayerEvent",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.createNewLayersFromFeatures(r))})("featuresToAppendEvent",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.appendFeatureOnLayerFromFeatures(r))}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("layerTypeModes",e.DdM(4,hr)),e.xp6(1),e.Q6J("epsgAvailable",t.epsgAvailable)("currentEpsg",t.currentEpsg)("existingLayers",t.existingLayers)}}const pr=function(){return["Point","LineString"]};function fr(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-create-tools",24),e.NdJ("newLayerEvent",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.addLayer(r))}),e.qZA(),e._UZ(2,"app-path-tools",25),e.BQk()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("layerTypeModes",e.DdM(4,pr)),e.xp6(1),e.Q6J("currentEpsg",t.currentEpsg)("layerSelected",t.getLayerFromId(t.layerIdSelected))("layersToDisplay",t.layersToDisplay)}}function mr(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-layer",26),e.NdJ("layerMoveUp",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.layerGoUp(r))})("layerMoveDown",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.layerGoDown(r))})("layerCloned",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.duplicateLayer(r))})("removeLayerId",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.removeLayer(r))}),e.qZA(),e.BQk()}if(2&o){const t=n.$implicit,i=e.oxw();e.xp6(1),e.Q6J("layer",t)("selected",i.layerIdSelected==t.container.uuid)("visible",i.allVisible)("locked",i.allLocked)("toggled",i.allToggled)("epsg",i.currentEpsg)}}let _r=(()=>{class o{constructor(t,i,r){this.mapService=t,this.interactionsService=i,this.editComputingService=r,this.disabledIcon=_.g82,this.loadIcon=_.cf$,this.visibleIcon=J.Mdf,this.invisibleIcon=_.Aq,this.centerIcon=_.TL5,this.lockIcon=_.byT,this.unLockIcon=_._1N,this.unToggleIcon=J.El_,this.toggleIcon=J.CPW,this.allToggled=!1,this.allVisible=!0,this.allLocked=!1,this.existingLayers=[],this.layersToDisplay=[],this.layerIdSelected=null,this.layerNamedIncrement=-1,this.zoomPadding=[100,100,100,100],this.epsgChangesSubscription=this.mapService.setMapProjectionFromEpsg.subscribe(s=>{this.currentEpsg=s}),this.layerIdSelectedSubscription=this.interactionsService.layerIdSelected.subscribe(s=>{this.layerIdSelected=s}),this.newFeaturesSubscription=this.editComputingService.newFeatures.subscribe(s=>{this.createNewLayersFromFeatures(s)})}ngOnInit(){this._mapExamplesData(),this.zoomToLayers()}ngOnDestroy(){this.existingLayers.forEach(t=>{this.map.removeLayer(t.container.layer),t.cleanEvents()}),this.epsgChangesSubscription.unsubscribe(),this.layerIdSelectedSubscription.unsubscribe(),this.newFeaturesSubscription.unsubscribe()}_mapExamplesData(){const r=Ve([...ti,...ni,...ii],{dataProjection:this.currentEpsg,featureProjection:"EPSG:3857"});this.createNewLayersFromFeatures(r)}set toolsMode(t){this._toolsMode=t,this.refreshLayers()}get toolsMode(){return this._toolsMode}set currentEpsg(t){this._currentEpsg=t}get currentEpsg(){return this._currentEpsg}addLayer(t){let i=this.setNewLayer(t);this.existingLayers.push(i),this.refreshLayers()}setNewLayer(t,i=null,r=null){const s=++this.layerNamedIncrement;null===i&&(i="layer "+s);let a=new Yn(i,t,s);return new Kn(this.map,a)}duplicateLayer(t){let i=this.setNewLayer(t.container.geomType,t.container.layerName+" copy");i.container.addFeaturesAndUpdateIds(t.container.features),this.existingLayers.push(i),this.refreshLayers()}addLayerFromFeatures(t,i){let r=this.setNewLayer(t);r.container.addFeaturesAndUpdateIds(i),this.existingLayers.push(r),this.refreshLayers()}layerGoUp(t){this.existingLayers=Pt(this.existingLayers,t,1),this.refreshLayers()}layerGoDown(t){this.existingLayers=Pt(this.existingLayers,t,-1),this.refreshLayers()}removeLayer(t){this.existingLayers=this.existingLayers.filter(i=>i.container.uuid!==t),this.buildLayersIndexes(),this.refreshLayers()}getLayerFromId(t){return null!==t?this.existingLayers.filter(r=>r.container.uuid===t)[0]:null}refreshLayers(){this.layersToDisplay=this.existingLayers.sort((t,i)=>t.container.zIndex>i.container.zIndex?-1:1),this.interactionsService.sendAllLayers(this.layersToDisplay)}unSelectLayer(){this.layerIdSelected=null}buildLayersIndexes(){let t=this.existingLayers;this.existingLayers=[],t.forEach((i,r)=>{i.container.zIndex=r,this.existingLayers.push(i)})}createNewLayersFromFeatures(t){Object.keys(t).forEach(i=>{this.addLayerFromFeatures(i,t[i])})}appendFeatureOnLayerFromFeatures(t){const r=t.features;let s=this.getLayerFromId(t.layerId);if(null!==s){const a=s.container.geomType;let l=s.container;Object.keys(r).forEach(c=>{c===a&&(l.addFeaturesAndUpdateIds(r[c]),this.refreshLayers())})}}zoomToLayers(){let t=(0,x.lJ)();this.existingLayers.forEach(i=>{(0,x.l7)(t,i.container.sourceFeatures.getExtent())}),t[0]!==1/0&&t[1]!==1/0&&t[2]!==1/0&&t[3]!==1/0&&this.map.getView().fit(t,{size:this.map.getSize(),padding:this.zoomPadding})}removeLayers(){this.interactionsService.removeAllLayers()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Ie.S),e.Y36(ne),e.Y36(Se))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-layers-manager"]],viewQuery:function(t,i){if(1&t&&e.Gf(dr,5),2&t){let r;e.iGM(r=e.CRH())&&(i.exportStringGeomDiv=r.first)}},inputs:{map:"map",epsgAvailable:"epsgAvailable",toolsMode:"toolsMode",currentEpsg:"currentEpsg"},decls:29,vars:18,consts:[[4,"ngIf"],[1,"text-center","fw-bold","bg-warning","bg-gradient","p-2"],["id","layersTools",1,"d-flex","flex-row","justify-content-evenly","align-items-center","mx-2"],["type","checkbox","id","btnVisibleLayers",1,"btn-check",3,"checked","change"],["btnVisible",""],["for","btnVisibleLayers","container","body","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer",3,"ngClass","ngbPopover"],["size","1x",1,"",3,"icon"],["type","checkbox","id","btnLockLayers",1,"btn-check",3,"checked","change"],["btnLock",""],["for","btnLockLayers","container","body","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer",3,"ngbPopover"],["type","checkbox","id","btnToggleFeatures",1,"btn-check",3,"checked","change"],["btnToggle",""],["for","btnToggleFeatures","container","body","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer",3,"ngbPopover"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer",3,"click"],["ngbPopover","Supprimer toutes les couches","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer","text-danger",3,"click"],["id","layersList",1,"d-flex","flex-column","justify-content-start","mb-2"],["layersList",""],[1,"layer","pointer","d-flex","flex-column","small","mt-1","mx-1","px-1","align-items-around",3,"ngClass","click"],[1,"pointer","p-2","d-flex","flex-row","pointer","justify-content-center","align-items-center","border-bottom"],[1,"me-1",3,"icon"],[4,"ngFor","ngForOf"],["id","geoTools",1,"overflow-auto",3,"map","currentEpsg","epsgAvailable"],[3,"layerTypeModes","newLayerEvent"],[3,"epsgAvailable","currentEpsg","existingLayers","featuresToNewLayerEvent","featuresToAppendEvent"],["classColor","danger",3,"layerTypeModes","newLayerEvent"],[3,"currentEpsg","layerSelected","layersToDisplay"],[3,"layer","selected","visible","locked","toggled","epsg","layerMoveUp","layerMoveDown","layerCloned","removeLayerId"]],template:function(t,i){if(1&t){const r=e.EpF();e.YNc(0,ur,2,3,"ng-container",0),e.YNc(1,gr,3,5,"ng-container",0),e.YNc(2,fr,3,5,"ng-container",0),e.TgZ(3,"div",1),e._uU(4," Couches\n"),e.qZA(),e.TgZ(5,"div",2)(6,"input",3,4),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(7);return e.KtG(i.allVisible=a.checked)}),e.qZA(),e.TgZ(8,"label",5),e._UZ(9,"fa-icon",6),e.qZA(),e.TgZ(10,"input",7,8),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(11);return e.KtG(i.allLocked=a.checked)}),e.qZA(),e.TgZ(12,"label",9),e._UZ(13,"fa-icon",6),e.qZA(),e.TgZ(14,"input",10,11),e.NdJ("change",function(){e.CHM(r);const a=e.MAs(15);return e.KtG(i.allToggled=a.checked)}),e.qZA(),e.TgZ(16,"label",12),e._UZ(17,"fa-icon",6),e.qZA(),e.TgZ(18,"button",13),e.NdJ("click",function(){return i.zoomToLayers()}),e._UZ(19,"fa-icon",6),e.qZA(),e.TgZ(20,"button",14),e.NdJ("click",function(){return i.removeLayers()}),e._UZ(21,"fa-icon",6),e.qZA()(),e.TgZ(22,"div",15,16)(24,"div",17),e.NdJ("click",function(){return i.unSelectLayer()}),e.TgZ(25,"div",18),e._UZ(26,"fa-icon",19),e._uU(27,"D\xe9s\xe9lectionner "),e.qZA()(),e.YNc(28,mr,2,6,"ng-container",20),e.qZA()}2&t&&(e.Q6J("ngIf","geoTools"==i.toolsMode),e.xp6(1),e.Q6J("ngIf","createTools"==i.toolsMode),e.xp6(1),e.Q6J("ngIf","pathTools"==i.toolsMode),e.xp6(4),e.Q6J("checked",i.allVisible),e.xp6(2),e.Q6J("ngClass",i.allVisible?"text-success":"text-danger")("ngbPopover",i.allVisible?"Masquer":"Afficher"),e.xp6(1),e.Q6J("icon",i.allVisible?i.visibleIcon:i.invisibleIcon),e.xp6(1),e.Q6J("checked",!1),e.xp6(2),e.Q6J("ngbPopover",i.allLocked?"D\xe9v\xe9rouiller":"Verrouiller"),e.xp6(1),e.Q6J("icon",i.allLocked?i.lockIcon:i.unLockIcon),e.xp6(1),e.Q6J("checked",!i.allVisible),e.xp6(2),e.Q6J("ngbPopover",i.allToggled?"Masquer":"Afficher"),e.xp6(1),e.Q6J("icon",i.allToggled?i.toggleIcon:i.unToggleIcon),e.xp6(2),e.Q6J("icon",i.centerIcon),e.xp6(2),e.Q6J("icon",i.disabledIcon),e.xp6(3),e.Q6J("ngClass",null===i.layerIdSelected?"bg-secondary  bg-gradient bg-opacity-25 fw-bold text-black":"text-black"),e.xp6(2),e.Q6J("icon",i.disabledIcon),e.xp6(2),e.Q6J("ngForOf",i.layersToDisplay))},dependencies:[w.mk,w.sg,w.O5,G.BN,L.o8,zi,ir,or,ai,cr],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),o})();function yr(o,n){if(1&o&&(e.O4$(),e.TgZ(0,"svg",9),e._UZ(1,"circle",10),e.qZA()),2&o){const t=e.oxw().$implicit,i=e.oxw();e.xp6(1),e.uIk("stroke",i.layer.container.strokeColor)("stroke-width",1)("fill",t.color)}}function Cr(o,n){if(1&o&&(e.O4$(),e.TgZ(0,"svg",9),e._UZ(1,"line",11)(2,"line",11),e.qZA()),2&o){const t=e.oxw().$implicit,i=e.oxw();e.xp6(1),e.uIk("stroke",i.layer.container.strokeColor)("stroke-width",2),e.xp6(1),e.uIk("stroke",t.color)("stroke-width",1.5)}}function xr(o,n){if(1&o&&(e.O4$(),e.TgZ(0,"svg",12),e._UZ(1,"rect",13),e.qZA()),2&o){const t=e.oxw().$implicit,i=e.oxw();e.xp6(1),e.uIk("stroke",i.layer.container.strokeColor)("stroke-width",1.5)("fill",t.color)}}function Tr(o,n){if(1&o&&(e.TgZ(0,"li")(1,"div",4)(2,"div",5),e.YNc(3,yr,2,3,"svg",6),e.YNc(4,Cr,3,4,"svg",6),e.YNc(5,xr,2,3,"svg",7),e.qZA(),e.TgZ(6,"span",8),e._uU(7),e.qZA()()()),2&o){const t=n.$implicit,i=e.oxw();e.xp6(3),e.Q6J("ngIf","Point"===i.layer.container.geomType),e.xp6(1),e.Q6J("ngIf","LineString"===i.layer.container.geomType),e.xp6(1),e.Q6J("ngIf","Polygon"===i.layer.container.geomType),e.xp6(2),e.Oqu(t.class)}}let vr=(()=>{class o{constructor(t){this.interactionsService=t,this.pointIcon=hn,this.lineStringIcon=gn,this.polygonIcon=pn}ngOnInit(){this.layer.enableSelecting(),this.layerSelectConfigured()}ngOnDestroy(){this.unSelectFeature()}set layer(t){this._layer=t}get layer(){return this._layer}set selected(t){t?this.selectLayer():this.unSelectFeature(),this._selected=t}get selected(){return this._selected}layerSelectConfigured(){this.layer.select.on("select",t=>{let r=t.selected;t.deselected.length>0&&0===r.length&&this.unSelectFeature(),r.length>0&&r.forEach(s=>{this.selectFeatureById(s.getId())})})}unSelectFeature(){this.featureIdSelected="none",this.layer.select.getFeatures().clear()}selectFeatureById(t){this.featureIdSelected=t;let i=this.getFeature(this.featureIdSelected);this.layer.enableSelecting(),this.layer.select.getFeatures().clear(),this.layer.select.getFeatures().push(i),this.selectLayer()}getFeature(t){let i=this.layer.container.features.filter(r=>r.getId()===t);return 1===i.length?i[0]:null}selectLayer(){this.interactionsService.sendSelectedLayerId(this.layer.container.uuid)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(ne))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-legend"]],inputs:{layer:"layer",selected:"selected"},decls:5,vars:2,consts:[[1,"d-flex","flex-row","fs-6","title"],[1,"text-decoration-underline","mb-2","fw-bold"],[1,"list-unstyled","m-0"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-row","align-items-center","px-2","mx-2","pointer"],[1,"me-1"],["height","25","width","25",4,"ngIf"],["height","15","width","25",4,"ngIf"],[1,"small"],["height","25","width","25"],["cx","12","cy","12","r","8"],["x1","0","y1","12.5","x2","25","y2","12.5"],["height","15","width","25"],["x","0","y","0","width","25","height","15"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"span",1),e._uU(2),e.qZA()(),e.TgZ(3,"ul",2),e.YNc(4,Tr,8,4,"li",3),e.qZA()),2&t&&(e.xp6(2),e.Oqu(i.layer.container.layerName),e.xp6(2),e.Q6J("ngForOf",i.layer.container.styleSettings))},dependencies:[w.sg,w.O5]}),o})();function br(o,n){if(1&o&&(e.ynx(0),e.TgZ(1,"div",13),e._UZ(2,"app-legend",14),e.qZA(),e.BQk()),2&o){const t=n.$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("layer",t)("selected",i.layerIdSelected==t.container.uuid)}}function wr(o,n){if(1&o&&(e.TgZ(0,"div",10)(1,"div",11),e.YNc(2,br,3,2,"ng-container",12),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",t.currentLayers)}}const Pr=[{path:"",component:(()=>{class o{constructor(t,i,r,s){this.mapService=t,this.controlerService=i,this.activatedRoute=r,this.interactionsService=s,this.epsgAvailable=["EPSG:4326","EPSG:3857"],this.geoIcon=_.g4A,this.pathIcon=_.KJ_,this.leftSideIcon=_._Wx,this.rightSideIcon=_.ccb,this.layersIcon=_.Krp,this.isPanelsDisplayed=!0,this.toolsMode="createTools",this.layerIdSelected=null,this.mapSubscription=this.mapService.map.subscribe(a=>{this.map=a,this.currentEpsg=this.map.getView().getProjection().getCode(),this.defaultMapView=this.map.getView()}),this.allLayersSubscription=this.interactionsService.allLayers.subscribe(a=>{this.currentLayers=a}),this.layerIdSelectedSubscription=this.interactionsService.layerIdSelected.subscribe(a=>{this.layerIdSelected=a})}ngOnInit(){this.sendResumeSubMenus(),this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap()}ngOnDestroy(){this.map.setView(this.defaultMapView),this.mapSubscription.unsubscribe(),this.allLayersSubscription.unsubscribe(),this.layerIdSelectedSubscription.unsubscribe(),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isPanelsDisplayed=!this.isPanelsDisplayed,this.unSelectLayer()}unSelectLayer(){this.interactionsService.sendSelectedLayerId(null)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Ie.S),e.Y36(kt.L),e.Y36(Le.gz),e.Y36(ne))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-app-layout"]],decls:13,vars:14,consts:[["fluidHeight","","id","sandbox",1,"d-flex","flex-row","position-fixed"],["id","panelsContainer",1,"d-flex","flex-column","bg-light",3,"ngClass"],["id","createTools",1,"overflow-auto",3,"map","toolsMode","currentEpsg","epsgAvailable"],["id","legendLabels",1,"d-flex","flex-column"],[1,"tool","btn","btn-warning","text-black","my-3","shadow","rounded-end",3,"ngClass","click"],[3,"icon"],[1,"tool","btn","btn-success","text-white","mb-1","shadow","rounded-end",3,"ngClass","click"],["type","button",1,"tool","btn","btn-dark","text-white","mb-1","shadow","rounded-end",3,"ngClass","click"],["type","button",1,"tool","btn","btn-danger","text-white","mb-1","shadow","rounded-end",3,"ngClass","click"],["moveDivToBody","","class","position-fixed bottom-0 end-0 bg-white rounded shadow overflow-auto mb-3 me-3",4,"ngIf"],["moveDivToBody","",1,"position-fixed","bottom-0","end-0","bg-white","rounded","shadow","overflow-auto","mb-3","me-3"],[1,"d-flex","flex-row","justify-content-start"],[4,"ngFor","ngForOf"],[1,"m-3"],[3,"layer","selected"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"app-layers-manager",2),e.qZA(),e.TgZ(3,"div",3)(4,"span",4),e.NdJ("click",function(){return i.showHideLegend()}),e._UZ(5,"fa-icon",5),e.qZA(),e.TgZ(6,"span",6),e.NdJ("click",function(){return i.toolsMode="geoTools"}),e._UZ(7,"fa-icon",5),e.qZA(),e.TgZ(8,"span",7),e.NdJ("click",function(){return i.toolsMode="createTools"}),e._UZ(9,"fa-icon",5),e.qZA(),e.TgZ(10,"span",8),e.NdJ("click",function(){return i.toolsMode="pathTools"}),e._UZ(11,"fa-icon",5),e.qZA()()(),e.YNc(12,wr,3,1,"div",9)),2&t&&(e.xp6(1),e.Q6J("ngClass",i.isPanelsDisplayed?"displayed":"hidden"),e.xp6(1),e.Q6J("map",i.map)("toolsMode",i.toolsMode)("currentEpsg",i.currentEpsg)("epsgAvailable",i.epsgAvailable),e.xp6(2),e.Q6J("ngClass",i.isPanelsDisplayed?"selected":""),e.xp6(1),e.Q6J("icon",i.isPanelsDisplayed?i.leftSideIcon:i.rightSideIcon),e.xp6(1),e.Q6J("ngClass","geoTools"===i.toolsMode?"selected":""),e.xp6(1),e.Q6J("icon",i.geoIcon),e.xp6(1),e.Q6J("ngClass","createTools"===i.toolsMode?"selected":""),e.xp6(1),e.Q6J("icon",i.layersIcon),e.xp6(1),e.Q6J("ngClass","pathTools"===i.toolsMode?"selected":""),e.xp6(1),e.Q6J("icon",i.pathIcon),e.xp6(1),e.Q6J("ngIf",!i.isPanelsDisplayed))},dependencies:[w.mk,w.sg,w.O5,G.BN,Zt,Me,_r,vr],styles:["#panelsContainer[_ngcontent-%COMP%]{box-shadow:1em 0 1rem #00000026!important}#panelsContainer.displayed[_ngcontent-%COMP%]{transition:all .3s}#panelsContainer.displayed[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{opacity:1;transition:all .1s}#panelsContainer.hidden[_ngcontent-%COMP%]{transition:all .3s}#panelsContainer.hidden[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{opacity:0;transition:all .1s}@media (max-width: 960px){#panelsContainer.hidden[_ngcontent-%COMP%]{width:3vw}#panelsContainer.displayed[_ngcontent-%COMP%]{width:40vw}}@media (min-width: 960px){#panelsContainer.hidden[_ngcontent-%COMP%]{width:1vw}#panelsContainer.displayed[_ngcontent-%COMP%]{width:18vw}}.tool[_ngcontent-%COMP%]{border-radius:unset;transition:all .1s}.tool.btn[_ngcontent-%COMP%]{width:45px}.tool.btn[_ngcontent-%COMP%]:hover, .tool.btn.selected[_ngcontent-%COMP%]{width:60px}#editBar[_ngcontent-%COMP%]{position:fixed;bottom:0;-webkit-user-select:none;user-select:none}"]}),o})(),data:{title:"Bac \xe0 sable",page:"map-sandbox"},outlet:"map-sandbox"}];let Fr=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[Le.Bz.forChild(Pr),Le.Bz]}),o})();var Sr=f(5540),Er=f(7157);let Lr=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[w.ez,Fr,G.uH,L.IJ,N.u5,Sr.o,Er.p]}),o})()}}]);