

<div
  class="layer pointer d-flex flex-column small mt-1 mx-1 px-1 align-items-around"
  >

    <div class="header d-flex flex-row border rounded"
    [ngClass]="selected ? 'border-dark border-2' :  ''"
    >

      <div class="d-flex flex-row justify-content-start align-items-center me-1">
        <input #btnVisible type="checkbox" class="btn-check" [id]="'btnVisible' + layer.container.uuid" [checked]="visible" (change)="visible = btnVisible.checked">
        <label class="p-1 bg-transparent border-0 pointer" [for]="'btnVisible' + layer.container.uuid" [ngClass]="visible ? 'text-success' : 'text-danger'" container="body" [ngbPopover]="visible ? 'Masquer' : 'Afficher'" triggers="mouseenter:mouseleave">
          <fa-icon class="" [icon]="visible ? visibleIcon : invisibleIcon" size="xs"></fa-icon>
        </label>

        <input #btnLocked type="checkbox" class="btn-check" [id]="'btnLocked' + layer.container.uuid" [checked]="locked" (change)="locked = btnLocked.checked">
        <label class="ms-auto p-1 bg-transparent border-0 pointer" [for]="'btnLocked' + layer.container.uuid" container="body" [ngbPopover]="locked ? 'Déverrouiller' : 'Verrouiller'" triggers="mouseenter:mouseleave">
          <fa-icon class="" [icon]="locked ? lockIcon : unLockIcon" size="xs"></fa-icon>
        </label>

        <div class="d-flex flex-column" [ngClass]="selected ? 'pe-auto' :  'pe-none'">
          <button class="p-0 bg-transparent border-0 text-danger" (click)="layerGoUp()" container="body" ngbPopover="Remonter" triggers="mouseenter:mouseleave">
            <fa-icon class="" [icon]="upIcon" size="xs"></fa-icon>
          </button>

          <button class="p-0 bg-transparent border-0 text-danger" (click)="layerGoDown()" container="body" ngbPopover="Descendre" triggers="mouseenter:mouseleave">
            <fa-icon class="" [icon]="downIcon" size="xs"></fa-icon>
          </button>

        </div>

      </div>

      <div
        class="d-flex flex-row pointer justify-content-start align-items-center flex-fill p-1"
        [ngClass]="selected ? 'fw-bold' :  'text-black'"
        (click)="selected = true"
        >
        <div class="">
          <fa-icon *ngIf="layer.container.geomType === 'Point'" class="me-2" [icon]="pointIcon" size="xs"></fa-icon>
          <fa-icon *ngIf="layer.container.geomType === 'LineString'" class="me-2" [icon]="lineStringIcon" size="xs"></fa-icon>
          <fa-icon *ngIf="layer.container.geomType === 'Polygon'" class="me-2" [icon]="polygonIcon" size="xs"></fa-icon>
        </div>

        <div class="layer-name">
          <span>{{ layer.container.layerName }}</span>
        </div>
      </div>


      <button class="ms-auto p-1 bg-transparent border-0 text-danger" (click)="openTable()" ngbPopover="Table des attributs" triggers="mouseenter:mouseleave">
        <fa-icon class="" [icon]="tableIcon" size="xs"></fa-icon>
      </button>
      
      <button class="ms-auto p-1 bg-transparent border-0" (click)="toggleFeatures()" ngbPopover="Masquer les objets" triggers="mouseenter:mouseleave">
        <fa-icon class="" [icon]="toggled ? toggleIcon : unToggleIcon" size="xs"></fa-icon>
      </button>

      <div class="ms-auto d-flex flex-row" [ngClass]="selected ? 'd-block' : 'd-none'">



        <button class="ms-auto p-1 bg-transparent border-0" (click)="duplicateLayer()" ngbPopover="Dupliquer" triggers="mouseenter:mouseleave">
          <fa-icon class="" [icon]="duplicateIcon" size="xs"></fa-icon>
        </button>

        <button [ngClass]="this.locked ? 'pe-none' : 'pe-auto'" class="ms-auto p-1 bg-transparent border-0 text-danger" (click)="removeLayer()" ngbPopover="Supprimer" triggers="mouseenter:mouseleave">
          <fa-icon class="" [icon]="disabledIcon" size="xs"></fa-icon>
        </button>

      </div>

      <div class="ms-auto d-flex flex-row">

        <button class="ms-auto p-1 bg-transparent border-0" (click)="zoomToLayer()" ngbPopover="Centrer" triggers="mouseenter:mouseleave">
          <fa-icon class="" [icon]="centerIcon" size="xs"></fa-icon>
        </button>

        <button class="p-1 bg-transparent border-0 text-black" (click)="openSettings()" ngbPopover="Options de la couche" triggers="mouseenter:mouseleave">
          <fa-icon class="" [icon]="paramIcon" size="xs"></fa-icon>
        </button>

      </div>

    </div>

    <div class="feature-container d-flex flex-row small mb-1" *ngIf="layer.container.features.length > 0">
      <ul [hidden]="toggled" id="featuresList" class="w-100 list-group list-unstyled list-group-flush mx-3 rounded" [id]="'featuresLayer-' + layer.container.uuid">

        <li 
        class="feature border-bottom" 
        [ngClass]="featuresIdSelected.length > 0 && selected ? 'bg-opacity-25' : ''" 
        (click)="unSelectFeatures()"
        >
          <div class="feature d-flex flex-row pointer justify-content-center align-items-center flex-fill m-1">
            <fa-icon class="me-1" [icon]="disabledIcon" ></fa-icon>Désélectionner
          </div>

        </li>

        <ng-container *ngFor="let feature of layer.container.features">
          <app-feature
          class="feature"
          [ngClass]="featuresIdSelected.includes(feature.get('id')) ? 'fw-bold bg-secondary bg-opacity-25' : ''"
          (click)="selectFeatureById(feature.get('id'))"
          [selected]="featuresIdSelected.includes(feature.get('id'))"
          [feature]="feature"
          [layer]="layer"
          >
          </app-feature>
        </ng-container>

      </ul>
    </div>
</div>

<div moveDivToBody [isRemoved]="this.isLayerRemoved" *ngIf="!isLayerRemoved" class="position-fixed bottom-0 start-50 translate-middle-x">

  <app-edit-bar
    class=""
    [layer]="layer"
    *ngIf="selected"
    [enabled]="!locked && selected"
    [currentEpsg]="epsg"
  ></app-edit-bar>
</div>




<set-modal #modalLayerSettings title="Paramètres de la couche">
 
    <app-layer-settings
      [layer]="layer"
    ></app-layer-settings>

</set-modal>


<set-modal #modalLayerTable title="Attributs de la couche">
 
  <app-layer-table
    [layer]="layer"
  ></app-layer-table>

</set-modal>

