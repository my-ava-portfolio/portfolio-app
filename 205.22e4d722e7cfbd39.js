"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[205],{205:(tt,E,a)=>{a.r(E),a.d(E,{MapActivitiesModule:()=>qe});var ee=a(9387),m=a(4755),b=a(9129),M=a(7292),D=a(3171),U=a(7053),G=a(5947),L=a(187),te=a(3324),ie=a(6597),ne=a(3620),oe=a(483),re=a(8377),J=a(6003),ae=a(6527),u=a(7963),v=a(8227),S=a(109),y=a(7392),x=a(5044),g=a(6785);const h="activities",C="travel",k="legendActivity",w="white",de=new y.Z({radius:0,fill:new x.Z({color:v.Cm}),stroke:new g.Z({color:w,width:2})}),pe=new y.Z({radius:0,fill:new x.Z({color:v.bj}),stroke:new g.Z({color:w,width:2})}),ue=new y.Z({radius:0,fill:new x.Z({color:v.C1}),stroke:new g.Z({color:w,width:2})});function A(i){let o;o="job"===i.get("type")?de.clone():"education"===i.get("type")?pe.clone():ue.clone();let t=2*i.get("radius");return o.setRadius(t),new S.ZP({image:o})}function V(i){return new S.ZP({image:new y.Z({radius:2*i,fill:new x.Z({color:"rgba(255, 215, 0, 0.6)"}),stroke:new g.Z({color:"black",width:2})})})}const F="black",Y="yellow",we=new S.ZP({stroke:new g.Z({width:4,color:"black"})}),Te=new S.ZP({image:new y.Z({radius:2,fill:new x.Z({color:"black"}),stroke:new g.Z({color:F,width:1})})}),j=new S.ZP({image:new y.Z({radius:7,fill:new x.Z({color:Y}),stroke:new g.Z({color:F,width:3})})}),R=i=>"route"===i?we:"limit"===i?Te:j;function O(i,o,t,n){return i.getLayers().getArray().filter(d=>d.get("name")===o)[0].getSource().getFeatures().filter(d=>d.get(n)===t)[0]}var Q=a(230),$=a(6786),B=a(5625),e=a(2223),W=a(9947),f=a(7579),De=a(2340),Se=a(3144);let H=(()=>{class i{constructor(t){this.http=t,this.portfolioApiUrl=De.N.resumeApiUrl,this.apiUrlActivitiesGeoData=this.portfolioApiUrl+"geodata/activities",this.errorapiUrlApiFound=new f.x,this.activitiesGeoData=new f.x,this.apiUrlTripsGeoData=this.portfolioApiUrl+"/geodata/trips",this.tripsGeoData=new f.x,this.dateNotified=new f.x,this.timelineBuild=new f.x,this.activitiesGeoDataToMap=new f.x,this.tripsGeoDataToMap=new f.x}queryActivitiesGeoData(){this.http.get(this.apiUrlActivitiesGeoData).subscribe({complete:()=>{},error:t=>{this.errorapiUrlApiFound.next(t.error.message)},next:t=>{this.activitiesGeoData.next(t)}})}pullActivitiesGeoDataToMap(t){this.activitiesGeoDataToMap.next(t)}queryTripsGeoData(){this.http.get(this.apiUrlTripsGeoData).subscribe({complete:()=>{},error:t=>{this.errorapiUrlApiFound.next(t.error.message)},next:t=>{this.tripsGeoData.next(t)}})}pullTripsGeoDataToMap(t){this.tripsGeoDataToMap.next(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Se.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ze=a(6550),Le=a(3686),X=a(4519),I=a(6600);function Ce(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle")),2&i){const t=o.$implicit,n=e.oxw();e.Tol(t.class),e.uIk("r",n.activityTypesLegendData.circleR)("cx",n.activityTypesLegendData.circleCxPos)("cy",t.cy)("fill",t.color)("stroke",t.strokeColor)}}function be(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text"),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.Tol(t.class+" label"),e.uIk("x",n.activityTypesLegendData.textXPos)("y",t.cy)("font-size",n.fontSize),e.xp6(1),e.hij("",t.label," ")}}function Me(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle",7)),2&i){const t=o.$implicit,n=e.oxw();e.uIk("r",t)("cx",n.activityMonthLegendData.circleCxPos)("cy",t)}}function ke(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text",8),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",n.activityMonthLegendData.textXPos)("y",2*t)("font-size",n.fontSize),e.xp6(1),e.hij("",t," mois ")}}function _e(i,o){if(1&i&&(e.O4$(),e._UZ(0,"line",9)),2&i){const t=o.$implicit;e.uIk("y1",2*t+2)("y2",2*t+2)}}function Ae(i,o){if(1&i&&(e.O4$(),e._UZ(0,"line")),2&i){const t=o.$implicit;e.Tol(t.classLine),e.uIk("x1",t.x1)("x2",t.x2)("y1",t.y1)("y2",t.y2)("strokeColor",t.strokeColor)}}function Fe(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle")),2&i){const t=o.$implicit;e.Tol(t.classMarker),e.uIk("r",t.r)("cx",t.y2/2)("cy",t.y2/2)("color",t.circleColor)("strokeColor",t.strokeColor)}}function Oe(i,o){if(1&i&&(e.O4$(),e._UZ(0,"text")),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",t.y2/2)("y",t.y2/2)("font-size",n.movesLineLegendData.markerFontSize)}}function Ie(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text",8),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",n.movesLineLegendData.textXPos)("y",t.y2/2)("font-size",n.fontSize),e.xp6(1),e.hij("",t.label," ")}}let Pe=(()=>{class i{constructor(){this.sliderBarId="slider-bar",this.legendActivitiesId=k,this.widthLegendElement=200,this.heightLegendElement=140,this.heightMoveLegendElement=60,this.fontSize="19px",this.activityMonthLegendData={circleMonthR:[40,20,10],circleCxPos:50,textXPos:120},this.activityTypesLegendData={circleR:18,circleCxPos:20,textXPos:50,circleJobs:[{cy:25,class:"education",label:"Formations",color:v.bj,strokeColor:w},{cy:70,class:"job",label:"Entreprises",color:v.Cm,strokeColor:w},{cy:115,class:"volunteer",label:"B\xe9n\xe9volat",color:v.C1,strokeColor:w}]},this.movesLineLegendData={textXPos:50,markerFontSize:"12px",moves:[{x1:0,x2:45,y1:0,y2:45,r:12,classLine:"train-line",classMarker:"train-marker",classMarkerText:"train-marker-text",label:"Train",circleColor:Y,strokeColor:F}]}}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-theme-legend"]],decls:22,vars:13,consts:[["id","theme-legend",1,"d-flex","flex-row","justify-content-around"],[3,"id"],[3,"class",4,"ngFor","ngForOf"],["class","activity-months",4,"ngFor","ngForOf"],["class","label",4,"ngFor","ngForOf"],["x1","50","x2","115","class","line-dot",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"activity-months"],[1,"label"],["x1","50","x2","115",1,"line-dot"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"set-section-container")(2,"h6"),e._uU(3,"Activit\xe9s"),e.qZA(),e.O4$(),e.TgZ(4,"svg",1),e.YNc(5,Ce,1,7,"circle",2),e.YNc(6,be,2,6,"text",2),e.qZA()(),e.kcU(),e.TgZ(7,"set-section-container")(8,"h6"),e._uU(9,"Dur\xe9e"),e.qZA(),e.O4$(),e.TgZ(10,"svg"),e.YNc(11,Me,1,3,"circle",3),e.YNc(12,ke,2,4,"text",4),e.YNc(13,_e,1,2,"line",5),e.qZA()(),e.kcU(),e.TgZ(14,"set-section-container")(15,"h6"),e._uU(16,"D\xe9placements"),e.qZA(),e.O4$(),e.TgZ(17,"svg"),e.YNc(18,Ae,1,7,"line",2),e.YNc(19,Fe,1,7,"circle",2),e.YNc(20,Oe,1,3,"text",6),e.YNc(21,Ie,2,4,"text",4),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("id",n.legendActivitiesId),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),e.xp6(1),e.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),e.xp6(4),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(4),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightMoveLegendElement),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves))},dependencies:[m.sg,I.d],styles:['.label[_ngcontent-%COMP%]{text-anchor:start;dominant-baseline:middle}svg[_ngcontent-%COMP%]{width:9em}@media (max-width: 576px){svg[_ngcontent-%COMP%]{width:6em}}.activity-months[_ngcontent-%COMP%]{fill:#fff;opacity:.7;stroke:#000;stroke-width:2px;stroke-opacity:1}.line-dot[_ngcontent-%COMP%]{stroke:#000;stroke-width:1;stroke-dasharray:5,5}.train-line[_ngcontent-%COMP%]{stroke:#000;stroke-width:3px}.train-marker[_ngcontent-%COMP%]{fill:#ff0;stroke:#000;stroke-width:3px;color:#000}.train-marker-text[_ngcontent-%COMP%]{font-family:"Font Awesome 5 Free";font-weight:900;color:#000;text-anchor:middle;dominant-baseline:middle;pointer-events:none}']}),i})();var Ne=a(2921);function Ee(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"h6",11),e._uU(2,"Vitesse"),e.qZA(),e.TgZ(3,"div",12)(4,"div",13),e._uU(5,"-"),e.qZA(),e.TgZ(6,"div",14)(7,"input",15),e.NdJ("change",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.updateStepValue(r))}),e.qZA()(),e.TgZ(8,"div",13),e._uU(9,"+"),e.qZA()(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(7),e.Q6J("min",t.minStepValue)("max",t.maxStepValue)("step",t.minStepValue)("value",t.stepValue)}}let Ue=(()=>{class i extends Ne.g{constructor(t){super(),this.mapService=t,this.mapSubscription=this.mapService.map.subscribe(n=>{this.map=n})}ngOnInit(){super.ngOnInit(),this.mapService.getMap()}ngOnChanges(t){super.ngOnChanges(t),t.timelineDataViz&&u.Ys(".circle-events").selectAll("circle").data(this.timelineDataViz).enter().append("circle").attr("class",r=>new Date(r.start_date)<=this.currentDate?"pointer svg-color-"+r.type:"pointer trace").attr("id",r=>"location_"+r.id).attr("r","4").attr("cx",r=>{const s=new Date(r.start_date);return this.dateRange(s)}).on("mouseover",(r,s)=>{u.Ys("#popup-feature-"+s.id).style("display","block").style("right","1em").style("top","5em");const l=O(this.map,h,s.id,"id");void 0!==l&&(this.interactionWithEventNode(r.currentTarget,s),l.setStyle(V(l.get("radius"))))}).on("mouseout",(r,s)=>{u.Ys("#popup-feature-"+s.id).style("display","none").style("right","unset").style("top","unset");const l=O(this.map,h,s.id,"id");void 0!==l&&(this.interactionWithEventNode(r.currentTarget,s),l.setStyle(A(l)))}),t.currentDate&&u.td_(".circle-events circle").attr("class",n=>new Date(n.start_date)<=this.currentDate?"pointer svg-color-"+n.type:"trace")}interactionWithEventNode(t,n){const r=u.Ys(t);r.classed("selected",!r.classed("selected"));const s=u.Ys("#"+k+" circle."+n.type);s.classed("selected",!s.classed("selected"))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(W.S))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-time-legend"]],inputs:{timelineDataViz:"timelineDataViz"},features:[e.qOj,e.TTD],decls:18,vars:9,consts:[[1,"d-flex","flex-xl-row","flex-column"],[1,"badge","text-bg-secondary"],[1,"d-flex","flex-row","justify-content-center"],[3,"id"],[1,"d-flex","flex-column","justify-content-center","m-2"],[1,"d-flex","flex-row","justify-content-center","align-items-center"],["id","start-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"],[4,"ngIf"],[1,"mt-3"],[1,"d-flex","flex-row","align-self-center"],[1,"fw-bold"],[1,"px-1"],["id","speed-slider","type","range",1,"form-range",3,"min","max","step","value","change"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"set-section-container")(2,"h6"),e._uU(3,"Barre Temporelle"),e.qZA(),e.TgZ(4,"div",1),e._uU(5),e.ALo(6,"date"),e.qZA(),e.TgZ(7,"div",2),e.O4$(),e._UZ(8,"svg",3),e.qZA()(),e.kcU(),e.TgZ(9,"div",4)(10,"div",5)(11,"a",6),e.NdJ("click",function(){return n.resetTimeLine()}),e._UZ(12,"fa-icon",7),e.qZA(),e.TgZ(13,"a",8),e.NdJ("click",function(){return n.startTimeLine()}),e._uU(14,"Play"),e.qZA(),e.TgZ(15,"a",9),e.NdJ("click",function(){return n.forwardTimeLine()}),e._UZ(16,"fa-icon",7),e.qZA()(),e.YNc(17,Ee,10,4,"ng-container",10),e.qZA()()),2&t&&(e.xp6(5),e.Oqu(e.xi3(6,6,n.currentDate,n.currentDateFormat)),e.xp6(3),e.Q6J("id",n.timeLineId),e.uIk("viewBox","0 10 "+n.width+" "+n.height),e.xp6(4),e.Q6J("icon",n.backwardIcon),e.xp6(4),e.Q6J("icon",n.forwardIcon),e.xp6(1),e.Q6J("ngIf",n.timeLineSpeedSliderEnabled))},dependencies:[m.O5,b.BN,I.d,m.uU],styles:[".circle-events circle{opacity:1;stroke:#f8f8ff;stroke-width:1px}.circle-events circle.trace{fill:#686868;opacity:.7;stroke:#f8f8ff;stroke-width:1px;stroke-opacity:1}.circle-events circle.selected{stroke:#000;stroke-width:2px}\n",'.ticks{font-weight:700}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle-timeline{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected{stroke:#000!important;stroke-width:2px!important}#timeline-slider{width:33em}@media (max-width: 576px){#timeline-slider{width:20em}}#speed-slider{transform:rotate(180deg)}.marker-fontawesome{font-family:"Font Awesome 5 Free";text-anchor:middle;dominant-baseline:middle;pointer-events:none}\n'],encapsulation:2}),i})();function Ge(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.zoomOnData())}),e._UZ(1,"fa-icon",6),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("icon",t.centerIcon)}}function Je(i,o){if(1&i){const t=e.EpF();e._UZ(0,"app-theme-legend"),e.TgZ(1,"app-time-legend",7),e.NdJ("currentDateEvent",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.getCurrentDate(r))}),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("timeLineSpeedSliderEnabled",!1)("startDate",t.startDate)("endDate",t.endDate)("currentDate",t.currentDate)("stepValue",800)("timelineDataViz",t.geoFeaturesData)}}function ze(i,o){1&i&&e.GkF(0)}function Ve(i,o){if(1&i&&(e.TgZ(0,"div",21),e._UZ(1,"img",22),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("src",n.apiImgUrl+t.img_activity,e.LSH)("alt",t.id)}}function Ye(i,o){1&i&&e._UZ(0,"div")}function je(i,o){if(1&i&&(e.TgZ(0,"div",16),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.AsE("Du ",e.xi3(2,2,t.start_date,"MM-yyyy")," au ",e.xi3(3,5,t.end_date,"MM-yyyy"),"")}}function Re(i,o){if(1&i&&(e.TgZ(0,"div",16),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij("Du ",e.xi3(2,1,t.start_date,"MM-yyyy")," \xe0 aujourd'hui")}}function Qe(i,o){if(1&i&&(e.TgZ(0,"div",9)(1,"div",10)(2,"div",11)(3,"h5",12),e._uU(4),e.qZA()(),e.TgZ(5,"div",13),e.YNc(6,Ve,2,2,"div",14),e.TgZ(7,"div",15)(8,"h6",12),e._uU(9),e.qZA(),e.TgZ(10,"span",16),e._UZ(11,"fa-icon",17),e._uU(12),e.qZA(),e.YNc(13,Ye,1,0,"div",18),e.YNc(14,je,4,8,"ng-template",null,19,e.W1O),e.YNc(16,Re,3,4,"ng-template",null,20,e.W1O),e.qZA()()()()),2&i){const t=o.$implicit,n=e.MAs(15),r=e.MAs(17),s=e.oxw(2);e.Q6J("id","popup-feature-"+t.id),e.xp6(4),e.Oqu(t.title),e.xp6(2),e.Q6J("ngIf","null"!==t.img_activity),e.xp6(3),e.Oqu(t.name),e.xp6(2),e.Q6J("icon",s.locationIcon),e.xp6(1),e.hij(" ",t.location," "),e.xp6(1),e.Q6J("ngIf","InProgress"===t.status)("ngIfThen",r)("ngIfElse",n)}}function $e(i,o){if(1&i&&e.YNc(0,Qe,18,9,"div",8),2&i){const t=e.oxw();e.Q6J("ngForOf",t.geoFeaturesData)}}const Be=function(){return{}},We=[{path:"",component:(()=>{class i{constructor(t,n,r,s,l){this.mapService=t,this.dataService=n,this.activatedRoute=r,this.titleService=s,this.controlerService=l,this.imageProfile=Q.tz,this.fragment=null,this.experiencesRoute=$.I_.route,this.educationRoute=$.QD.route,this.geoTripsData=[],this.travelId=null,this.isLegendDisplayed=!0,this.defaultActivitieLayerZoom=9,this.apiImgUrl=Q.uV,this.locationIcon=B.p,this.centerIcon=B.H,this.helpPopup="Voici une cartographie spatio-temporelles de mes exp\xe9riences",this.popupWidth=330,this.popupHeight=190,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(c=>{this.mapService.zoomToLayerName(h,this.defaultActivitieLayerZoom)}),this.newCoordsSubscription=this.mapService.newCoords.subscribe(c=>{this.popupMoving(c[1])}),this.mapSubscription=this.mapService.map.subscribe(c=>{this.map=c}),this.getActivitiesGeoDataToMapSubscription=this.dataService.activitiesGeoData.subscribe(c=>{if(this.geoFeaturesData=c.geojson,this.startDate=new Date(c.date_range.start_date),this.endDate=new Date,this.getCurrentDate(this.endDate),null!==this.fragment){const p=O(this.map,h,this.fragment,"id").getGeometry();void 0!==p&&this.mapService.zoomToExtent(p.getExtent(),13)}else this.mapService.zoomToLayerName(h,this.defaultActivitieLayerZoom)}),this.getTripsGeoDataToMapSubscription=this.dataService.tripsGeoData.subscribe(c=>{this.geoTripsData=c}),this.tripsGeoDataToMapSubscription=this.dataService.tripsGeoDataToMap.subscribe(c=>{1===c.length&&this.travelId!==c[0].name&&(this.mapService.removeLayerByName(C),this.travelId=c[0].name,this.buildTravelLayer(c[0])),0===c.length&&(this.travelId=null,this.mapService.removeLayerByName(C))}),this.routeSubscription=this.activatedRoute.fragment.subscribe(c=>{this.fragment=null===c?null:c})}ngOnInit(){this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.sendResumeSubMenus(),this.initLayer(h,A),this.dataService.queryTripsGeoData(),this.dataService.queryActivitiesGeoData(),this.zoomInitDone=!1,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.getActivitiesGeoDataToMapSubscription.unsubscribe(),this.tripsGeoDataToMapSubscription.unsubscribe(),this.getTripsGeoDataToMapSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.routeSubscription.unsubscribe(),this.newCoordsSubscription.unsubscribe(),this.mapService.removeLayerByName(h),this.mapService.removeLayerByName(C),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}getCurrentDate(t){this.currentDate=t;const n=this.geoFeaturesData.filter(s=>new Date(s.start_date)<=this.currentDate);this.addLayerFeatures(n,A);let r=[];this.geoTripsData.forEach(s=>{const c=s.end_date,d=new Date(s.start_date),p=new Date(c);this.currentDate>=d&&this.currentDate<p&&r.push(s)}),this.dataService.pullTripsGeoDataToMap(r)}zoomOnData(){this.mapService.sendZoomAction()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}initLayer(t,n){this.sourceFeatures=new G.Z;const r=new U.Z({source:this.sourceFeatures,style:(l,c)=>n(l)});r.set("name",t),this.map.addLayer(r);let s=new te.Z({condition:ie.MJ,multi:!1,layers:[r],style:l=>V(l.get("radius"))});s.on("select",l=>{const c=l.selected,d=l.deselected;if(1===d.length){let p=d[0];this.currentFeatureSelectedId=null,this.mapService.unsetMapEvent("mapCoords"),u.Ys("#popup-feature-"+p.get("id")).style("display","none").style("right","unset").style("top","unset").style("left","unset"),this._handleActivityCircleOnLegend(p)}if(1===c.length){let p=c[0];this.currentFeatureSelectedId=p.get("id"),this.mapService.setMapEvent("mapCoords"),u.Ys("#popup-feature-"+p.get("id")).style("z-index","1"),this._handleActivityCircleOnLegend(p)}}),this.map.addInteraction(s)}addLayerFeatures(t,n){let r=[];t.forEach((s,l)=>{let c=new D.Z({geometry:new L.Z(s.geometry.coordinates).transform("EPSG:4326","EPSG:3857"),id:s.id,type:s.type,name:s.name,radius:12*s.years+s.months});r.push(c)}),this.sourceFeatures.clear(),this.sourceFeatures.addFeatures(r)}_handleActivityCircleOnLegend(t){const n=t.getProperties(),r=u.Ys("#"+k+" circle."+n.type);r.classed("selected",!r.classed("selected"));const s=u.Ys(".circle-events circle#location_"+n.id);s.classed("selected",!s.classed("selected"))}buildTravelLayer(t){const n=new ae.Z(t.geojson_data[0].coordinates),r=new D.Z({type:"route",geometry:n}),s=new D.Z({type:"limit",geometry:new L.Z(n.getFirstCoordinate())}),l=new D.Z({type:"limit",geometry:new L.Z(n.getLastCoordinate())}),c=new L.Z(n.getFirstCoordinate());new D.Z({type:"movingNode",geometry:c});let p=new G.Z({features:[]}),P=new U.Z({source:p});[r,s,l].forEach((T,N)=>{T.setStyle(R(T.get("type"))),p.addFeature(T)}),P.set("name",C),this.map.addLayer(P);let q=Date.now(),Z=0;P.on("postrender",T=>{const N=T.frameState.time;Z=(Z+100*(N-q)/1e6)%2,q=N;const et=n.getCoordinateAt(Z>1?2-Z:Z);c.setCoordinates(et);const K=function se(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const o=i.inversePixelTransform[0],t=i.inversePixelTransform[1],n=Math.sqrt(o*o+t*t),r=i.frameState,s=(0,oe.Jp)(i.inversePixelTransform.slice(),r.coordinateToPixelTransform),l=(0,re.se)(r.viewState.resolution,n);let c;const d=(0,J.Cs)();return d&&(c=(0,J.WO)(d,r.viewState.projection)),new ne.Z(i.context,n,r.extent,s,r.viewState.rotation,l,c)}(T);K.setStyle(R("movingNode")),K.drawGeometry(c),this.map.render()})}popupMoving(t){u.Ys("#popup-feature-"+this.currentFeatureSelectedId).style("left",()=>t[0]+this.popupWidth+20>this.innerWidth?t[0]-this.popupWidth-15+"px":t[0]+15+"px").style("top",()=>t[1]+this.popupHeight+20>this.innerHeight?t[1]-this.popupHeight-15+"px":t[1]+15+"px").style("display","block")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(W.S),e.Y36(H),e.Y36(M.gz),e.Y36(Ze.Dx),e.Y36(Le.L))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-map-view"]],decls:8,vars:3,consts:[["classes","position-fixed"],["buttonsTemplate",""],["controlersTemplate",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["activitiesPopups",""],["title","Centrer","type","button","checked","","autocomplete","off",1,"btn","btn-sm","btn-warning","mx-1",3,"click"],[1,"",3,"icon"],["currentDateFormat","MMMM y",3,"timeLineSpeedSliderEnabled","startDate","endDate","currentDate","stepValue","timelineDataViz","currentDateEvent"],["class","card shadow-lg map-popup border border-3 border-secondary",3,"id",4,"ngFor","ngForOf"],[1,"card","shadow-lg","map-popup","border","border-3","border-secondary",3,"id"],[1,"card-body"],[1,"d-flex","flex-row","justify-content-around","mb-1"],[1,"fw-bolder","small"],[1,"d-flex","flex-row","justify-content-around"],["class","w-25 justify-content-around text-center",4,"ngIf"],[1,"my-auto"],[1,"small"],[1,"me-2","text-danger",3,"icon"],[4,"ngIf","ngIfThen","ngIfElse"],["pastJob",""],["currentJob",""],[1,"w-25","justify-content-around","text-center"],[1,"img-fluid","rounded","mx-auto","shadow","mini-img-thumbnail",3,"src","alt"]],template:function(t,n){if(1&t&&(e.TgZ(0,"set-legend-container",0),e.YNc(1,Ge,2,1,"ng-template",null,1,e.W1O),e.YNc(3,Je,2,6,"ng-template",null,2,e.W1O),e.qZA(),e.YNc(5,ze,1,0,"ng-container",3),e.YNc(6,$e,1,1,"ng-template",null,4,e.W1O)),2&t){const r=e.MAs(7);e.xp6(5),e.Q6J("ngTemplateOutlet",r)("ngTemplateOutletContext",e.DdM(2,Be))}},dependencies:[m.sg,m.O5,m.tP,b.BN,X.b,Pe,Ue,m.uU],styles:[".map-popup{position:fixed;display:none;background-color:#f8f8ff;max-width:400px}#map-title{background-color:#f1f1f1c9!important;padding:10px;border-bottom-right-radius:25px;border-bottom-left-radius:25px}#map-title:after{left:-30px;border-top:30px solid salmon;border-left:30px solid transparent;z-index:-10}.mini-img-thumbnail{width:15vw}#legendActivity circle.selected{stroke:#000;stroke-width:4px}\n"],encapsulation:2}),i})(),data:{title:"Carte des activit\xe9s",page:"map-activities"},outlet:"map-activities"}];let He=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[M.Bz.forChild(We),M.Bz]}),i})();var Xe=a(7157);let qe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[H],imports:[m.ez,He,b.uH,Xe.p,ee.k,X.b,I.d]}),i})()}}]);