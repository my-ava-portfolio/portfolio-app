"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[527],{4527:(yr,ot,m)=>{m.r(ot),m.d(ot,{MapSandboxModule:()=>mr});var x=m(4755),A=m(9129),Me=m(7292);const rt="EPSG:3857";var st=m(3396),T=m(2687);const ke=st.diR,Ie=T.fQK,te=T.ubJ,on=T._Wx,rn=T.ccb,sn=T.Krp,an=T.g4A,at=T.EQ8,lt=T.TzT,ct=T.gr5,dt=T.byT,ut=T._1N,ln=T.$pG,cn=T.KJ_,dn=T.yn$,un=T.EiI,Ze=T.TL5,hn=T.mlU,gn=T.Krp,pn=st.FDd,fn=T.Z$V,mn=T.Vui,ht=T.Mdf,gt=T.Aq,_n=T.l1h,yn=T.eW2,pt=T.WM4,ft=T.El_,mt=T.CPW,_t=T.g82,yt=T.cf$,Cn=T.XVU,xn=T.dH7;var e=m(2223),Ge=m(9947),Tn=m(3686),V=m(7579);let Ae=(()=>{class r{constructor(){this.layerIdSelected=new V.x,this.allLayers=new V.x,this.removeLayers=new V.x}sendAllLayers(t){this.allLayers.next(t)}removeAllLayers(){this.removeLayers.next(!0)}sendSelectedLayerId(t){this.layerIdSelected.next(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var F=m(3835);let vn=(()=>{class r{constructor(t){this._elemRef=t,this.setHeight()}ngAfterViewChecked(){this.setHeight()}onResize(t){this.setHeight()}setHeight(){this._elemRef.nativeElement.style.height=window.innerHeight-this._elemRef.nativeElement.offsetTop+"px"}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(e.SBq))},r.\u0275dir=e.lG2({type:r,selectors:[["","fluidHeight",""]],hostBindings:function(t,i){1&t&&e.NdJ("resize",function(s){return i.onResize(s)},!1,e.Jf7)}}),r})(),Oe=(()=>{class r{constructor(t,i){this._elemRef=t,this.renderer=i,this.isRemoved=!1,this.renderer.appendChild(document.body,this._elemRef.nativeElement)}ngOnChanges(t){t.isRemoved.currentValue&&this.ngOnDestroy()}ngOnDestroy(){this.renderer.removeChild(document.body,this._elemRef.nativeElement)}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(e.SBq),e.Y36(e.Qsj))},r.\u0275dir=e.lG2({type:r,selectors:[["","moveDivToBody",""]],inputs:{isRemoved:"isRemoved"},features:[e.TTD]}),r})();var M=m(3171),Y=m(9972),bn=m(7660),C=m(760),k=m(1729);class ne extends bn.Z{constructor(n){super(),this.geometries_=n||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(k.bN),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let n=0,t=this.geometries_.length;n<t;++n)this.changeEventsKeys_.push((0,k.oL)(this.geometries_[n],Y.Z.CHANGE,this.changed,this))}clone(){const n=new ne(null);return n.setGeometries(this.geometries_),n.applyProperties(this),n}closestPointXY(n,t,i,o){if(o<(0,C.qf)(this.getExtent(),n,t))return o;const s=this.geometries_;for(let a=0,l=s.length;a<l;++a)o=s[a].closestPointXY(n,t,i,o);return o}containsXY(n,t){const i=this.geometries_;for(let o=0,s=i.length;o<s;++o)if(i[o].containsXY(n,t))return!0;return!1}computeExtent(n){(0,C.YN)(n);const t=this.geometries_;for(let i=0,o=t.length;i<o;++i)(0,C.l7)(n,t[i].getExtent());return n}getGeometries(){return Ct(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let n=[];const t=this.geometries_;for(let i=0,o=t.length;i<o;++i)t[i].getType()===this.getType()?n=n.concat(t[i].getGeometriesArrayRecursive()):n.push(t[i]);return n}getSimplifiedGeometry(n){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),n<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&n<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let o=!1;for(let s=0,a=i.length;s<a;++s){const l=i[s],c=l.getSimplifiedGeometry(n);t.push(c),c!==l&&(o=!0)}if(o){const s=new ne(null);return s.setGeometriesArray(t),s}return this.simplifiedGeometryMaxMinSquaredTolerance=n,this}getType(){return"GeometryCollection"}intersectsExtent(n){const t=this.geometries_;for(let i=0,o=t.length;i<o;++i)if(t[i].intersectsExtent(n))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(n,t){const i=this.geometries_;for(let o=0,s=i.length;o<s;++o)i[o].rotate(n,t);this.changed()}scale(n,t,i){i||(i=(0,C.qg)(this.getExtent()));const o=this.geometries_;for(let s=0,a=o.length;s<a;++s)o[s].scale(n,t,i);this.changed()}setGeometries(n){this.setGeometriesArray(Ct(n))}setGeometriesArray(n){this.unlistenGeometriesChange_(),this.geometries_=n,this.listenGeometriesChange_(),this.changed()}applyTransform(n){const t=this.geometries_;for(let i=0,o=t.length;i<o;++i)t[i].applyTransform(n);this.changed()}translate(n,t){const i=this.geometries_;for(let o=0,s=i.length;o<s;++o)i[o].translate(n,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Ct(r){const n=[];for(let t=0,i=r.length;t<i;++t)n.push(r[t].clone());return n}const W=ne;var v=m(119),_=m(6003);const xt=class wn{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(n,t){if(t){let i=t.dataProjection?(0,_.U2)(t.dataProjection):this.readProjection(n);t.extent&&i&&"tile-pixels"===i.getUnits()&&(i=(0,_.U2)(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(n){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},n)}getType(){return(0,v.O3)()}readFeature(n,t){return(0,v.O3)()}readFeatures(n,t){return(0,v.O3)()}readGeometry(n,t){return(0,v.O3)()}readProjection(n){return(0,v.O3)()}writeFeature(n,t){return(0,v.O3)()}writeFeatures(n,t){return(0,v.O3)()}writeGeometry(n,t){return(0,v.O3)()}};function ie(r,n,t){const i=t?(0,_.U2)(t.featureProjection):null,o=t?(0,_.U2)(t.dataProjection):null;let s;if(s=i&&o&&!(0,_.OP)(i,o)?(n?r.clone():r).transform(n?i:o,n?o:i):r,n&&t&&void 0!==t.decimals){const a=Math.pow(10,t.decimals),l=function(c){for(let d=0,u=c.length;d<u;++d)c[d]=Math.round(c[d]*a)/a;return c};s===r&&(s=r.clone()),s.applyTransform(l)}return s}function oe(r){return"string"==typeof r?JSON.parse(r)||null:null!==r?r:null}const En=class Pn extends xt{constructor(){super()}getType(){return"json"}readFeature(n,t){return this.readFeatureFromObject(oe(n),this.getReadOptions(n,t))}readFeatures(n,t){return this.readFeaturesFromObject(oe(n),this.getReadOptions(n,t))}readFeatureFromObject(n,t){return(0,v.O3)()}readFeaturesFromObject(n,t){return(0,v.O3)()}readGeometry(n,t){return this.readGeometryFromObject(oe(n),this.getReadOptions(n,t))}readGeometryFromObject(n,t){return(0,v.O3)()}readProjection(n){return this.readProjectionFromObject(oe(n))}readProjectionFromObject(n){return(0,v.O3)()}writeFeature(n,t){return JSON.stringify(this.writeFeatureObject(n,t))}writeFeatureObject(n,t){return(0,v.O3)()}writeFeatures(n,t){return JSON.stringify(this.writeFeaturesObject(n,t))}writeFeaturesObject(n,t){return(0,v.O3)()}writeGeometry(n,t){return JSON.stringify(this.writeGeometryObject(n,t))}writeGeometryObject(n,t){return(0,v.O3)()}};var O=m(6527),U=m(2774),re=m(5066),se=m(8999),Tt=m(9182),J=m(2456),Ne=m(392),vt=m(410),bt=m(9644);class ae extends U.ZP{constructor(n,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(n[0]))this.setCoordinates(n,t);else if(void 0!==t&&i)this.setFlatCoordinates(t,n),this.ends_=i;else{let o=this.getLayout();const s=n,a=[],l=[];for(let c=0,d=s.length;c<d;++c){const u=s[c];0===c&&(o=u.getLayout()),(0,J.l7)(a,u.getFlatCoordinates()),l.push(a.length)}this.setFlatCoordinates(o,a),this.ends_=l}}appendLineString(n){this.flatCoordinates?(0,J.l7)(this.flatCoordinates,n.getFlatCoordinates().slice()):this.flatCoordinates=n.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const n=new ae(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return n.applyProperties(this),n}closestPointXY(n,t,i,o){return o<(0,C.qf)(this.getExtent(),n,t)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,re.Af)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,re.Xl)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,n,t,i,o))}getCoordinateAtM(n,t,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(0,vt.dG)(this.flatCoordinates,0,this.ends_,this.stride,n,t=void 0!==t&&t,i=void 0!==i&&i)}getCoordinates(){return(0,Ne.o1)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(n){return n<0||this.ends_.length<=n?null:new O.Z(this.flatCoordinates.slice(0===n?0:this.ends_[n-1],this.ends_[n]),this.layout)}getLineStrings(){const n=this.flatCoordinates,t=this.ends_,i=this.layout,o=[];let s=0;for(let a=0,l=t.length;a<l;++a){const c=t[a],d=new O.Z(n.slice(s,c),i);o.push(d),s=c}return o}getFlatMidpoints(){const n=[],t=this.flatCoordinates;let i=0;const o=this.ends_,s=this.stride;for(let a=0,l=o.length;a<l;++a){const c=o[a],d=(0,vt.WW)(t,i,c,s,.5);(0,J.l7)(n,d),i=c}return n}getSimplifiedGeometryInternal(n){const t=[],i=[];return t.length=(0,Tt.UJ)(this.flatCoordinates,0,this.ends_,this.stride,n,t,0,i),new ae(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(n){return(0,bt.AW)(this.flatCoordinates,0,this.ends_,this.stride,n)}setCoordinates(n,t){this.setLayout(t,n,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,se._5)(this.flatCoordinates,0,n,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const le=ae;var N=m(187),K=m(2156);class De extends U.ZP{constructor(n,t){super(),t&&!Array.isArray(n[0])?this.setFlatCoordinates(t,n):this.setCoordinates(n,t)}appendPoint(n){this.flatCoordinates?(0,J.l7)(this.flatCoordinates,n.getFlatCoordinates()):this.flatCoordinates=n.getFlatCoordinates().slice(),this.changed()}clone(){const n=new De(this.flatCoordinates.slice(),this.layout);return n.applyProperties(this),n}closestPointXY(n,t,i,o){if(o<(0,C.qf)(this.getExtent(),n,t))return o;const s=this.flatCoordinates,a=this.stride;for(let l=0,c=s.length;l<c;l+=a){const d=(0,K.bI)(n,t,s[l],s[l+1]);if(d<o){o=d;for(let u=0;u<a;++u)i[u]=s[l+u];i.length=a}}return o}getCoordinates(){return(0,Ne.Ml)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(n){return n<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=n?null:new N.Z(this.flatCoordinates.slice(n*this.stride,(n+1)*this.stride),this.layout)}getPoints(){const n=this.flatCoordinates,t=this.layout,i=this.stride,o=[];for(let s=0,a=n.length;s<a;s+=i){const l=new N.Z(n.slice(s,s+i),t);o.push(l)}return o}getType(){return"MultiPoint"}intersectsExtent(n){const t=this.flatCoordinates,i=this.stride;for(let o=0,s=t.length;o<s;o+=i)if((0,C.jE)(n,t[o],t[o+1]))return!0;return!1}setCoordinates(n,t){this.setLayout(t,n,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,se.Sg)(this.flatCoordinates,0,n,this.stride),this.changed()}}const ce=De;var G=m(2275),Fn=m(2474),Je=m(1265),Sn=m(8818),Mn=m(4325);class de extends U.ZP{constructor(n,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(n[0])){let o=this.getLayout();const s=n,a=[],l=[];for(let c=0,d=s.length;c<d;++c){const u=s[c];0===c&&(o=u.getLayout());const g=a.length,h=u.getEnds();for(let p=0,f=h.length;p<f;++p)h[p]+=g;(0,J.l7)(a,u.getFlatCoordinates()),l.push(h)}t=o,n=a,i=l}void 0!==t&&i?(this.setFlatCoordinates(t,n),this.endss_=i):this.setCoordinates(n,t)}appendPolygon(n){let t;if(this.flatCoordinates){const i=this.flatCoordinates.length;(0,J.l7)(this.flatCoordinates,n.getFlatCoordinates()),t=n.getEnds().slice();for(let o=0,s=t.length;o<s;++o)t[o]+=i}else this.flatCoordinates=n.getFlatCoordinates().slice(),t=n.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){const n=this.endss_.length,t=new Array(n);for(let o=0;o<n;++o)t[o]=this.endss_[o].slice();const i=new de(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(n,t,i,o){return o<(0,C.qf)(this.getExtent(),n,t)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,re.sD)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,re.gI)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,n,t,i,o))}containsXY(n,t){return(0,Mn.Zl)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,n,t)}getArea(){return(0,Sn.Eu)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(n){let t;return void 0!==n?(t=this.getOrientedFlatCoordinates().slice(),(0,Je.dL)(t,0,this.endss_,this.stride,n)):t=this.flatCoordinates,(0,Ne.ug)(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const n=function Ln(r,n,t,i){const o=[];let s=(0,C.lJ)();for(let a=0,l=t.length;a<l;++a){const c=t[a];s=(0,C.GN)(r,n,c[0],i),o.push((s[0]+s[2])/2,(s[1]+s[3])/2),n=c[c.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,Fn.U)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,n),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new ce(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const n=this.flatCoordinates;(0,Je.Oj)(n,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=n:(this.orientedFlatCoordinates_=n.slice(),this.orientedFlatCoordinates_.length=(0,Je.dL)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(n){const t=[],i=[];return t.length=(0,Tt.Pp)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(n),t,0,i),new de(t,"XY",i)}getPolygon(n){if(n<0||this.endss_.length<=n)return null;let t;if(0===n)t=0;else{const s=this.endss_[n-1];t=s[s.length-1]}const i=this.endss_[n].slice(),o=i[i.length-1];if(0!==t)for(let s=0,a=i.length;s<a;++s)i[s]-=t;return new G.ZP(this.flatCoordinates.slice(t,o),this.layout,i)}getPolygons(){const n=this.layout,t=this.flatCoordinates,i=this.endss_,o=[];let s=0;for(let a=0,l=i.length;a<l;++a){const c=i[a].slice(),d=c[c.length-1];if(0!==s)for(let g=0,h=c.length;g<h;++g)c[g]-=s;const u=new G.ZP(t.slice(s,d),n,c);o.push(u),s=d}return o}getType(){return"MultiPolygon"}intersectsExtent(n){return(0,bt.oW)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,n)}setCoordinates(n,t){this.setLayout(t,n,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,se.QT)(this.flatCoordinates,0,n,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const o=i[i.length-1];this.flatCoordinates.length=0===o.length?0:o[o.length-1]}this.changed()}}const ue=de;var kn=m(1911),In=m(9466);function Re(r,n){if(!r)return null;let t;switch(r.type){case"Point":t=function An(r){return new N.Z(r.coordinates)}(r);break;case"LineString":t=function On(r){return new O.Z(r.coordinates)}(r);break;case"Polygon":t=function Rn(r){return new G.ZP(r.coordinates)}(r);break;case"MultiPoint":t=function Dn(r){return new ce(r.coordinates)}(r);break;case"MultiLineString":t=function Nn(r){return new le(r.coordinates)}(r);break;case"MultiPolygon":t=function Jn(r){return new ue(r.coordinates)}(r);break;case"GeometryCollection":t=function Gn(r,n){const t=r.geometries.map(function(i){return Re(i,n)});return new W(t)}(r);break;default:throw new Error("Unsupported GeoJSON type: "+r.type)}return ie(t,!1,n)}function je(r,n){const t=(r=ie(r,!0,n)).getType();let i;switch(t){case"Point":i=function Bn(r,n){return{type:"Point",coordinates:r.getCoordinates()}}(r);break;case"LineString":i=function Un(r,n){return{type:"LineString",coordinates:r.getCoordinates()}}(r);break;case"Polygon":i=function Vn(r,n){let t;return n&&(t=n.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(t)}}(r,n);break;case"MultiPoint":i=function qn(r,n){return{type:"MultiPoint",coordinates:r.getCoordinates()}}(r);break;case"MultiLineString":i=function Hn(r,n){return{type:"MultiLineString",coordinates:r.getCoordinates()}}(r);break;case"MultiPolygon":i=function Qn(r,n){let t;return n&&(t=n.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(t)}}(r,n);break;case"GeometryCollection":i=function jn(r,n){return delete(n=Object.assign({},n)).featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(i){return je(i,n)})}}(r,n);break;case"Circle":i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+t)}return i}const wt=class Zn extends En{constructor(n){n=n||{},super(),this.dataProjection=(0,_.U2)(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(this.defaultFeatureProjection=(0,_.U2)(n.featureProjection)),this.geometryName_=n.geometryName,this.extractGeometryName_=n.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(n,t){let i=null;i="Feature"===n.type?n:{type:"Feature",geometry:n,properties:null};const o=Re(i.geometry,t),s=new M.Z;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&s.setGeometryName(i.geometry_name),s.setGeometry(o),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(n,t){let o=null;if("FeatureCollection"===n.type){o=[];const a=n.features;for(let l=0,c=a.length;l<c;++l)o.push(this.readFeatureFromObject(a[l],t))}else o=[this.readFeatureFromObject(n,t)];return o}readGeometryFromObject(n,t){return Re(n,t)}readProjectionFromObject(n){const t=n.crs;let i;return t?"name"==t.type?i=(0,_.U2)(t.properties.name):"EPSG"===t.type?i=(0,_.U2)("EPSG:"+t.properties.code):(0,kn.h)(!1,36):i=this.dataProjection,i}writeFeatureObject(n,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},o=n.getId();if(void 0!==o&&(i.id=o),!n.hasProperties())return i;const s=n.getProperties(),a=n.getGeometry();return a&&(i.geometry=je(a,t),delete s[n.getGeometryName()]),(0,In.x)(s)||(i.properties=s),i}writeFeaturesObject(n,t){t=this.adaptOptions(t);const i=[];for(let o=0,s=n.length;o<s;++o)i.push(this.writeFeatureObject(n[o],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(n,t){return je(n,this.adaptOptions(t))}};var Ue=m(7053),z=m(5947);const Pt={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let he;const Yn=new Uint8Array(16);function Wn(){if(!he&&(he=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!he))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return he(Yn)}const S=[];for(let r=0;r<256;++r)S.push((r+256).toString(16).slice(1));const Ft=function Kn(r,n,t){if(Pt.randomUUID&&!n&&!r)return Pt.randomUUID();const i=(r=r||{}).random||(r.rng||Wn)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){t=t||0;for(let o=0;o<16;++o)n[t+o]=i[o];return n}return function Et(r,n=0){return(S[r[n+0]]+S[r[n+1]]+S[r[n+2]]+S[r[n+3]]+"-"+S[r[n+4]]+S[r[n+5]]+"-"+S[r[n+6]]+S[r[n+7]]+"-"+S[r[n+8]]+S[r[n+9]]+"-"+S[r[n+10]]+S[r[n+11]]+S[r[n+12]]+S[r[n+13]]+S[r[n+14]]+S[r[n+15]]).toLowerCase()}(i)},St=/^#([0-9a-f]{3}){1,2}$/i,$n=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928","#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"];function Lt(){const r=$n;return r[Math.floor(Math.random()*r.length)]}var I=m(6597),ei=m(154),ti=m(3324),ge=m(9889),pe=m(5002),Mt=m(2909),fe=m(4412),H=m(1345),P=m(3481);function kt(r){return r.feature?r.feature:r.element?r.element:null}const He=[],ii=class ni extends pe.Z{constructor(n){const t=n=n||{};t.handleDownEvent||(t.handleDownEvent=H.uX),t.stopDown||(t.stopDown=H.Dv),super(t),this.source_=n.source?n.source:null,this.vertex_=void 0===n.vertex||n.vertex,this.edge_=void 0===n.edge||n.edge,this.features_=n.features?n.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,this.rBush_=new Mt.Z,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(n,t){t=void 0===t||t;const i=(0,v.sq)(n),o=n.getGeometry();if(o){const s=this.GEOMETRY_SEGMENTERS_[o.getType()];if(s){this.indexedFeaturesExtents_[i]=o.getExtent((0,C.lJ)());const a=[];if(s(a,o),1===a.length)this.rBush_.insert((0,C.hI)(a[0]),{feature:n,segment:a[0]});else if(a.length>1){const l=a.map(d=>(0,C.hI)(d)),c=a.map(d=>({feature:n,segment:d}));this.rBush_.load(l,c)}}}t&&(this.featureChangeListenerKeys_[i]=(0,k.oL)(n,Y.Z.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let n;return this.features_?n=this.features_:this.source_&&(n=this.source_.getFeatures()),n}handleEvent(n){const t=this.snapTo(n.pixel,n.coordinate,n.map);return t&&(n.coordinate=t.vertex.slice(0,2),n.pixel=t.vertexPixel),super.handleEvent(n)}handleFeatureAdd_(n){const t=kt(n);t&&this.addFeature(t)}handleFeatureRemove_(n){const t=kt(n);t&&this.removeFeature(t)}handleFeatureChange_(n){const t=n.target;if(this.handlingDownUpSequence){const i=(0,v.sq)(t);i in this.pendingFeatures_||(this.pendingFeatures_[i]=t)}else this.updateFeature_(t)}handleUpEvent(n){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(n,t){const i=void 0===t||t,o=(0,v.sq)(n),s=this.indexedFeaturesExtents_[o];if(s){const a=this.rBush_,l=[];a.forEachInExtent(s,function(c){n===c.feature&&l.push(c)});for(let c=l.length-1;c>=0;--c)a.remove(l[c])}i&&((0,k.bN)(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])}setMap(n){const t=this.getMap(),i=this.featuresListenerKeys_,o=this.getFeatures_();t&&(i.forEach(k.bN),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(k.bN),this.featureChangeListenerKeys_={}),super.setMap(n),n&&(this.features_?i.push((0,k.oL)(this.features_,ge.Z.ADD,this.handleFeatureAdd_,this),(0,k.oL)(this.features_,ge.Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push((0,k.oL)(this.source_,fe.Z.ADDFEATURE,this.handleFeatureAdd_,this),(0,k.oL)(this.source_,fe.Z.REMOVEFEATURE,this.handleFeatureRemove_,this)),o.forEach(s=>this.addFeature(s)))}snapTo(n,t,i){const o=i.getView().getProjection(),s=(0,_.Vs)(t,o),a=(0,_.Fj)((0,C.f3)((0,C.hI)([s]),i.getView().getResolution()*this.pixelTolerance_),o),l=this.rBush_.getInExtent(a),c=l.length;if(0===c)return null;let d,u=1/0;const g=this.pixelTolerance_*this.pixelTolerance_,h=()=>{if(d){const p=i.getPixelFromCoordinate(d);if((0,P.bI)(n,p)<=g)return{vertex:d,vertexPixel:[Math.round(p[0]),Math.round(p[1])]}}return null};if(this.vertex_){for(let f=0;f<c;++f){const y=l[f];"Circle"!==y.feature.getGeometry().getType()&&y.segment.forEach(w=>{const E=(0,_.Vs)(w,o),L=(0,P.bI)(s,E);L<u&&(d=w,u=L)})}const p=h();if(p)return p}if(this.edge_){for(let f=0;f<c;++f){let y=null;const w=l[f];if("Circle"===w.feature.getGeometry().getType()){let E=w.feature.getGeometry();const L=(0,_.Cs)();L&&(E=E.clone().transform(L,o)),y=(0,P.Ed)(s,E)}else{const[E,L]=w.segment;L&&(He[0]=(0,_.Vs)(E,o),He[1]=(0,_.Vs)(L,o),y=(0,P.oL)(s,He))}if(y){const E=(0,P.bI)(s,y);E<u&&(d=(0,_.lO)(y,o),u=E)}}const p=h();if(p)return p}return null}updateFeature_(n){this.removeFeature(n,!1),this.addFeature(n,!1)}segmentCircleGeometry_(n,t){const i=this.getMap().getView().getProjection();let o=t;const s=(0,_.Cs)();s&&(o=o.clone().transform(s,i));const a=(0,G.Bb)(o);s&&a.transform(i,s);const l=a.getCoordinates()[0];for(let c=0,d=l.length-1;c<d;++c)n.push(l.slice(c,c+2))}segmentGeometryCollectionGeometry_(n,t){const i=t.getGeometriesArray();for(let o=0;o<i.length;++o){const s=this.GEOMETRY_SEGMENTERS_[i[o].getType()];s&&s(n,i[o])}}segmentLineStringGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length-1;o<s;++o)n.push(i.slice(o,o+2))}segmentMultiLineStringGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o];for(let l=0,c=a.length-1;l<c;++l)n.push(a.slice(l,l+2))}}segmentMultiPointGeometry_(n,t){t.getCoordinates().forEach(i=>{n.push([i])})}segmentMultiPolygonGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let u=0,g=d.length-1;u<g;++u)n.push(d.slice(u,u+2))}}}segmentPointGeometry_(n,t){n.push([t.getCoordinates()])}segmentPolygonGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o];for(let l=0,c=a.length-1;l<c;++l)n.push(a.slice(l,l+2))}}};var X=m(2815),qe=m(8214),It=m(7366);class Be extends qe.ZP{constructor(n,t,i,o,s){super(n),this.features=t,this.coordinate=i,this.startCoordinate=o,this.mapBrowserEvent=s}}const ri=class oi extends pe.Z{constructor(n){let t;if(super(n=n||{}),this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=void 0!==n.features?n.features:null,n.layers&&!this.features_)if("function"==typeof n.layers)t=n.layers;else{const i=n.layers;t=function(o){return i.includes(o)}}else t=H.uX;this.layerFilter_=t,this.filter_=n.filter&&!this.features_?n.filter:H.uX,this.hitTolerance_=n.hitTolerance?n.hitTolerance:0,this.condition_=n.condition?n.condition:I.Bx,this.lastFeature_=null,this.addChangeListener(It.Z.ACTIVE,this.handleActiveChanged_)}handleDownEvent(n){if(!n.originalEvent||!this.condition_(n))return!1;if(this.lastFeature_=this.featuresAtPixel_(n.pixel,n.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=n.coordinate,this.lastCoordinate_=n.coordinate,this.handleMoveEvent(n);const t=this.features_||new X.Z([this.lastFeature_]);return this.dispatchEvent(new Be("translatestart",t,n.coordinate,this.startCoordinate_,n)),!0}return!1}handleUpEvent(n){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(n);const t=this.features_||new X.Z([this.lastFeature_]);return this.dispatchEvent(new Be("translateend",t,n.coordinate,this.startCoordinate_,n)),this.startCoordinate_=null,!0}return!1}handleDragEvent(n){if(this.lastCoordinate_){const t=n.coordinate,i=n.map.getView().getProjection(),o=(0,_.Vs)(t,i),s=(0,_.Vs)(this.lastCoordinate_,i),a=o[0]-s[0],l=o[1]-s[1],c=this.features_||new X.Z([this.lastFeature_]),d=(0,_.Cs)();c.forEach(function(u){const g=u.getGeometry();d?(g.transform(d,i),g.translate(a,l),g.transform(i,d)):g.translate(a,l),u.setGeometry(g)}),this.lastCoordinate_=t,this.dispatchEvent(new Be("translating",c,t,this.startCoordinate_,n))}}handleMoveEvent(n){const t=n.map.getViewport();this.featuresAtPixel_(n.pixel,n.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(n,t){return t.forEachFeatureAtPixel(n,(i,o)=>{if(i instanceof M.Z&&this.filter_(i,o)&&(!this.features_||this.features_.getArray().includes(i)))return i},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(n){this.hitTolerance_=n}setMap(n){const t=this.getMap();super.setMap(n),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(n){let t=this.getMap();const i=this.getActive();(!t||!i)&&(t=t||n,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}};var Z=m(4624),R=m(109);const $=1,Gt=[0,0,0,0],q=[];class Ye extends qe.ZP{constructor(n,t,i){super(n),this.features=t,this.mapBrowserEvent=i}}function ai(r,n){return r.index-n.index}function At(r,n,t){const i=n.geometry;if("Circle"===i.getType()){let s=i;if(n.index===$){const a=(0,_.Cs)();a&&(s=s.clone().transform(a,t));const l=(0,P.bI)(s.getCenter(),(0,_.Vs)(r,t)),c=Math.sqrt(l)-s.getRadius();return c*c}}const o=(0,_.Vs)(r,t);return q[0]=(0,_.Vs)(n.segment[0],t),q[1]=(0,_.Vs)(n.segment[1],t),(0,P.Bs)(o,q)}function Ot(r,n,t){const i=n.geometry;if("Circle"===i.getType()&&n.index===$){let s=i;const a=(0,_.Cs)();return a&&(s=s.clone().transform(a,t)),(0,_.lO)(s.getClosestPoint((0,_.Vs)(r,t)),t)}const o=(0,_.Vs)(r,t);return q[0]=(0,_.Vs)(n.segment[0],t),q[1]=(0,_.Vs)(n.segment[1],t),(0,_.lO)((0,P.oL)(o,q),t)}function li(){const r=(0,R.Ly)();return function(n,t){return r.Point}}const ci=class si extends pe.Z{constructor(n){let t;if(super(n),this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=n.condition?n.condition:I.Xp,this.defaultDeleteCondition_=function(i){return(0,I.Ko)(i)&&(0,I.Kf)(i)},this.deleteCondition_=n.deleteCondition?n.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=n.insertVertexCondition?n.insertVertexCondition:I.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Mt.Z,this.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ue.Z({source:new z.Z({useSpatialIndex:!1,wrapX:!!n.wrapX}),style:n.style?n.style:li(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,n.features?t=n.features:n.source&&(this.source_=n.source,t=new X.Z(this.source_.getFeatures()),this.source_.addEventListener(fe.Z.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(fe.Z.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");n.hitDetection&&(this.hitDetection_=n.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ge.Z.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ge.Z.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===n.snapToPointer?!this.hitDetection_:n.snapToPointer}addFeature_(n){const t=n.getGeometry();if(t){const o=this.SEGMENT_WRITERS_[t.getType()];o&&o(n,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),n.addEventListener(Y.Z.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(n,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new X.Z;const i=this.featuresBeingModified_.getArray();for(let o=0,s=t.length;o<s;++o){const a=t[o];for(let l=0,c=a.length;l<c;++l){const d=a[l].feature;d&&!i.includes(d)&&this.featuresBeingModified_.push(d)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new Ye("modifystart",this.featuresBeingModified_,n))}}removeFeature_(n){this.removeFeatureSegmentData_(n),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),n.removeEventListener(Y.Z.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(n){const t=this.rBush_,i=[];t.forEach(function(o){n===o.feature&&i.push(o)});for(let o=i.length-1;o>=0;--o){const s=i[o];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===s&&this.dragSegments_.splice(a,1);t.remove(s)}}setActive(n){this.vertexFeature_&&!n&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(n)}setMap(n){this.overlay_.setMap(n),super.setMap(n)}getOverlay(){return this.overlay_}handleSourceAdd_(n){n.feature&&this.features_.push(n.feature)}handleSourceRemove_(n){n.feature&&this.features_.remove(n.feature)}handleFeatureAdd_(n){this.addFeature_(n.element)}handleFeatureChange_(n){if(!this.changingFeature_){const t=n.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(n){this.removeFeature_(n.element)}writePointGeometry_(n,t){const i=t.getCoordinates(),o={feature:n,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),o)}writeMultiPointGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o],l={feature:n,geometry:t,depth:[o],index:o,segment:[a,a]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length-1;o<s;++o){const a=i.slice(o,o+2),l={feature:n,geometry:t,index:o,segment:a};this.rBush_.insert((0,C.hI)(a),l)}}writeMultiLineStringGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),u={feature:n,geometry:t,depth:[o],index:l,segment:d};this.rBush_.insert((0,C.hI)(d),u)}}}writePolygonGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),u={feature:n,geometry:t,depth:[o],index:l,segment:d};this.rBush_.insert((0,C.hI)(d),u)}}}writeMultiPolygonGeometry_(n,t){const i=t.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let u=0,g=d.length-1;u<g;++u){const h=d.slice(u,u+2),p={feature:n,geometry:t,depth:[l,o],index:u,segment:h};this.rBush_.insert((0,C.hI)(h),p)}}}}writeCircleGeometry_(n,t){const i=t.getCenter(),o={feature:n,geometry:t,index:0,segment:[i,i]},s={feature:n,geometry:t,index:$,segment:[i,i]},a=[o,s];o.featureSegments=a,s.featureSegments=a,this.rBush_.insert((0,C.HK)(i),o);let l=t;const c=(0,_.Cs)();if(c&&this.getMap()){const d=this.getMap().getView().getProjection();l=l.clone().transform(c,d),l=(0,G.Bb)(l).transform(d,c)}this.rBush_.insert(l.getExtent(),s)}writeGeometryCollectionGeometry_(n,t){const i=t.getGeometriesArray();for(let o=0;o<i.length;++o){const s=i[o];(0,this.SEGMENT_WRITERS_[s.getType()])(n,s)}}createOrUpdateVertexFeature_(n,t,i){let o=this.vertexFeature_;return o?o.getGeometry().setCoordinates(n):(o=new M.Z(new N.Z(n)),this.vertexFeature_=o,this.overlay_.getSource().addFeature(o)),o.set("features",t),o.set("geometries",i),o}handleEvent(n){if(!n.originalEvent)return!0;let t;return this.lastPointerEvent_=n,!n.map.getView().getInteracting()&&n.type==Z.Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(n),this.vertexFeature_&&this.deleteCondition_(n)&&(t=!(n.type!=Z.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),n.type==Z.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(n)&&!t}handleDragEvent(n){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(n,this.dragSegments_);const t=[n.coordinate[0]+this.delta_[0],n.coordinate[1]+this.delta_[1]],i=[],o=[];for(let s=0,a=this.dragSegments_.length;s<a;++s){const l=this.dragSegments_[s],c=l[0],d=c.feature;i.includes(d)||i.push(d);const u=c.geometry;o.includes(u)||o.push(u);const g=c.depth;let h;const p=c.segment,f=l[1];for(;t.length<u.getStride();)t.push(p[f][t.length]);switch(u.getType()){case"Point":h=t,p[0]=t,p[1]=t;break;case"MultiPoint":h=u.getCoordinates(),h[c.index]=t,p[0]=t,p[1]=t;break;case"LineString":h=u.getCoordinates(),h[c.index+f]=t,p[f]=t;break;case"MultiLineString":case"Polygon":h=u.getCoordinates(),h[g[0]][c.index+f]=t,p[f]=t;break;case"MultiPolygon":h=u.getCoordinates(),h[g[1]][g[0]][c.index+f]=t,p[f]=t;break;case"Circle":if(p[0]=t,p[1]=t,0===c.index)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const y=n.map.getView().getProjection();let w=(0,P.TE)((0,_.Vs)(u.getCenter(),y),(0,_.Vs)(t,y));const E=(0,_.Cs)();if(E){const L=u.clone().transform(E,y);L.setRadius(w),w=L.transform(y,E).getRadius()}u.setRadius(w),this.changingFeature_=!1}}h&&this.setGeometryCoordinates_(u,h)}this.createOrUpdateVertexFeature_(t,i,o)}handleDownEvent(n){if(!this.condition_(n))return!1;const t=n.coordinate;this.handlePointerAtPixel_(n.pixel,n.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const o=n.map.getView().getProjection(),s=[],a=i.getGeometry().getCoordinates(),l=(0,C.hI)([a]),c=this.rBush_.getInExtent(l),d={};c.sort(ai);for(let u=0,g=c.length;u<g;++u){const h=c[u],p=h.segment;let f=(0,v.sq)(h.geometry);const y=h.depth;if(y&&(f+="-"+y.join("-")),d[f]||(d[f]=new Array(2)),"Circle"!==h.geometry.getType()||h.index!==$)if(!(0,P.fS)(p[0],a)||d[f][0])if(!(0,P.fS)(p[1],a)||d[f][1])(0,v.sq)(p)in this.vertexSegments_&&!d[f][0]&&!d[f][1]&&this.insertVertexCondition_(n)&&s.push(h);else{if(d[f][0]&&0===d[f][0].index){let w=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":w=w[y[1]];case"Polygon":if(h.index!==w[y[0]].length-2)continue}}this.dragSegments_.push([h,1]),d[f][1]=h}else this.dragSegments_.push([h,0]),d[f][0]=h;else{const w=Ot(t,h,o);(0,P.fS)(w,a)&&!d[f][0]&&(this.dragSegments_.push([h,0]),d[f][0]=h)}}s.length&&this.willModifyFeatures_(n,[s]);for(let u=s.length-1;u>=0;--u)this.insertVertex_(s[u],a)}return!!this.vertexFeature_}handleUpEvent(n){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],o=i.geometry;if("Circle"===o.getType()){const s=o.getCenter(),a=i.featureSegments[0],l=i.featureSegments[1];a.segment[0]=s,a.segment[1]=s,l.segment[0]=s,l.segment[1]=s,this.rBush_.update((0,C.HK)(s),a);let c=o;const d=(0,_.Cs)();if(d){const u=n.map.getView().getProjection();c=c.clone().transform(d,u),c=(0,G.Bb)(c).transform(u,d)}this.rBush_.update(c.getExtent(),l)}else this.rBush_.update((0,C.hI)(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ye("modifyend",this.featuresBeingModified_,n)),this.featuresBeingModified_=null),!1}handlePointerMove_(n){this.lastPixel_=n.pixel,this.handlePointerAtPixel_(n.pixel,n.map,n.coordinate)}handlePointerAtPixel_(n,t,i){const o=i||t.getCoordinateFromPixel(n),s=t.getView().getProjection(),a=function(d,u){return At(o,d,s)-At(o,u,s)};let l,c;if(this.hitDetection_&&t.forEachFeatureAtPixel(n,(u,g,h)=>{h&&(h=new N.Z((0,_.lO)(h.getCoordinates(),s)));const p=h||u.getGeometry();if("Point"===p.getType()&&u instanceof M.Z&&this.features_.getArray().includes(u)){c=p;const f=u.getGeometry().getFlatCoordinates().slice(0,2);l=[{feature:u,geometry:c,segment:[f,f]}]}return!0},{layerFilter:"object"==typeof this.hitDetection_?u=>u===this.hitDetection_:void 0}),!l){const d=(0,_.dY)((0,C.HK)(o,Gt),s),u=t.getView().getResolution()*this.pixelTolerance_,g=(0,_.Fj)((0,C.f3)(d,u,Gt),s);l=this.rBush_.getInExtent(g)}if(l&&l.length>0){const d=l.sort(a)[0],u=d.segment;let g=Ot(o,d,s);const h=t.getPixelFromCoordinate(g);let p=(0,P.TE)(n,h);if(c||p<=this.pixelTolerance_){const f={};if(f[(0,v.sq)(u)]=!0,this.snapToPointer_||(this.delta_[0]=g[0]-o[0],this.delta_[1]=g[1]-o[1]),"Circle"===d.geometry.getType()&&d.index===$)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(g,[d.feature],[d.geometry]);else{const y=t.getPixelFromCoordinate(u[0]),w=t.getPixelFromCoordinate(u[1]),E=(0,P.bI)(h,y),L=(0,P.bI)(h,w);p=Math.sqrt(Math.min(E,L)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(g=E>L?u[1]:u[0]),this.createOrUpdateVertexFeature_(g,[d.feature],[d.geometry]);const j={};j[(0,v.sq)(d.geometry)]=!0;for(let Le=1,_r=l.length;Le<_r;++Le){const ee=l[Le].segment;if(!((0,P.fS)(u[0],ee[0])&&(0,P.fS)(u[1],ee[1])||(0,P.fS)(u[0],ee[1])&&(0,P.fS)(u[1],ee[0])))break;{const tn=(0,v.sq)(l[Le].geometry);tn in j||(j[tn]=!0,f[(0,v.sq)(ee)]=!0)}}}return void(this.vertexSegments_=f)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(n,t){const i=n.segment,o=n.feature,s=n.geometry,a=n.depth,l=n.index;let c;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":case"Polygon":c=s.getCoordinates(),c[a[0]].splice(l+1,0,t);break;case"MultiPolygon":c=s.getCoordinates(),c[a[1]][a[0]].splice(l+1,0,t);break;case"LineString":c=s.getCoordinates(),c.splice(l+1,0,t);break;default:return}this.setGeometryCoordinates_(s,c);const d=this.rBush_;d.remove(n),this.updateSegmentIndices_(s,l,a,1);const u={segment:[i[0],t],feature:o,geometry:s,depth:a,index:l};d.insert((0,C.hI)(u.segment),u),this.dragSegments_.push([u,1]);const g={segment:[t,i[1]],feature:o,geometry:s,depth:a,index:l+1};d.insert((0,C.hI)(g.segment),g),this.dragSegments_.push([g,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Z.Z.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ye("modifyend",this.featuresBeingModified_,n)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const n=this.dragSegments_,t={};let o,s,a,l,c,d,u,g,h,p,f,i=!1;for(c=n.length-1;c>=0;--c)a=n[c],p=a[0],f=(0,v.sq)(p.feature),p.depth&&(f+="-"+p.depth.join("-")),f in t||(t[f]={}),0===a[1]?(t[f].right=p,t[f].index=p.index):1==a[1]&&(t[f].left=p,t[f].index=p.index+1);for(f in t){switch(h=t[f].right,u=t[f].left,d=t[f].index,g=d-1,p=void 0!==u?u:h,g<0&&(g=0),l=p.geometry,s=l.getCoordinates(),o=s,i=!1,l.getType()){case"MultiLineString":s[p.depth[0]].length>2&&(s[p.depth[0]].splice(d,1),i=!0);break;case"LineString":s.length>2&&(s.splice(d,1),i=!0);break;case"MultiPolygon":o=o[p.depth[1]];case"Polygon":o=o[p.depth[0]],o.length>4&&(d==o.length-1&&(d=0),o.splice(d,1),i=!0,0===d&&(o.pop(),o.push(o[0]),g=o.length-1))}if(i){this.setGeometryCoordinates_(l,s);const y=[];if(void 0!==u&&(this.rBush_.remove(u),y.push(u.segment[0])),void 0!==h&&(this.rBush_.remove(h),y.push(h.segment[1])),void 0!==u&&void 0!==h){const w={depth:p.depth,feature:p.feature,geometry:p.geometry,index:g,segment:y};this.rBush_.insert((0,C.hI)(w.segment),w)}this.updateSegmentIndices_(l,d,p.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),n.length=0}}return i}setGeometryCoordinates_(n,t){this.changingFeature_=!0,n.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(n,t,i,o){this.rBush_.forEachInExtent(n.getExtent(),function(s){s.geometry===n&&(void 0===i||void 0===s.depth||(0,J.fS)(s.depth,i))&&s.index>t&&(s.index+=o)})}};var di=m(874);class me extends U.ZP{constructor(n,t,i){super(),void 0!==i&&void 0===t?this.setFlatCoordinates(i,n):this.setCenterAndRadius(n,t=t||0,i)}clone(){const n=new me(this.flatCoordinates.slice(),void 0,this.layout);return n.applyProperties(this),n}closestPointXY(n,t,i,o){const s=this.flatCoordinates,a=n-s[0],l=t-s[1],c=a*a+l*l;if(c<o){if(0===c)for(let d=0;d<this.stride;++d)i[d]=s[d];else{const d=this.getRadius()/Math.sqrt(c);i[0]=s[0]+d*a,i[1]=s[1]+d*l;for(let u=2;u<this.stride;++u)i[u]=s[u]}return i.length=this.stride,c}return o}containsXY(n,t){const i=this.flatCoordinates,o=n-i[0],s=t-i[1];return o*o+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(n){const t=this.flatCoordinates,i=t[this.stride]-t[0];return(0,C.T9)(t[0]-i,t[1]-i,t[0]+i,t[1]+i,n)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const n=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return n*n+t*t}getType(){return"Circle"}intersectsExtent(n){const t=this.getExtent();if((0,C.kK)(n,t)){const i=this.getCenter();return n[0]<=i[0]&&n[2]>=i[0]||n[1]<=i[1]&&n[3]>=i[1]||(0,C.H6)(n,this.intersectsCoordinate.bind(this))}return!1}setCenter(n){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],o=n.slice();o[t]=o[0]+i;for(let s=1;s<t;++s)o[t+s]=n[s];this.setFlatCoordinates(this.layout,o),this.changed()}setCenterAndRadius(n,t,i){this.setLayout(i,n,0),this.flatCoordinates||(this.flatCoordinates=[]);const o=this.flatCoordinates;let s=(0,se.IG)(o,0,n,this.stride);o[s++]=o[0]+t;for(let a=1,l=this.stride;a<l;++a)o[s++]=o[a];o.length=s,this.changed()}getCoordinates(){return null}setCoordinates(n,t){}setRadius(n){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+n,this.changed()}rotate(n,t){const i=this.getCenter(),o=this.getStride();this.setCenter((0,di.U1)(i,0,i.length,o,n,t,i)),this.changed()}}const ui=me;var hi=m(1994);class ye extends qe.ZP{constructor(n,t){super(n),this.feature=t}}function Ce(r,n){return(0,K.bI)(r[0],r[1],n[0],n[1])}function Q(r,n){const t=r.length;return n<0?r[n+t]:n>=t?r[n-t]:r[n]}function xe(r,n,t){let i,o;n<t?(i=n,o=t):(i=t,o=n);const s=Math.ceil(i),a=Math.floor(o);if(s>a)return Ce(B(r,i),B(r,o));let l=0;i<s&&(l+=Ce(B(r,i),Q(r,s))),a<o&&(l+=Ce(Q(r,a),B(r,o)));for(let c=s;c<a-1;++c)l+=Ce(Q(r,c),Q(r,c+1));return l}function Nt(r,n,t){if(n instanceof O.Z)Te(r,n.getCoordinates(),!1,t);else if(n instanceof le){const i=n.getCoordinates();for(let o=0,s=i.length;o<s;++o)Te(r,i[o],!1,t)}else if(n instanceof G.ZP){const i=n.getCoordinates();for(let o=0,s=i.length;o<s;++o)Te(r,i[o],!0,t)}else if(n instanceof ue){const i=n.getCoordinates();for(let o=0,s=i.length;o<s;++o){const a=i[o];for(let l=0,c=a.length;l<c;++l)Te(r,a[l],!0,t)}}else if(n instanceof W){const i=n.getGeometries();for(let o=0;o<i.length;++o)Nt(r,i[o],t)}}const We={index:-1,endIndex:NaN};function Te(r,n,t,i){const o=r[0],s=r[1];for(let a=0,l=n.length-1;a<l;++a){const u=Dt(o,s,n[a],n[a+1]);if(0===u.squaredDistance){const g=a+u.along;return void i.push({coordinates:n,ring:t,startIndex:g,endIndex:g})}}}const Ke={along:0,squaredDistance:0};function Dt(r,n,t,i){const o=t[0],s=t[1],c=i[0]-o,d=i[1]-s;let u=0,g=o,h=s;return(0!==c||0!==d)&&(u=(0,K.uZ)(((r-o)*c+(n-s)*d)/(c*c+d*d),0,1),g+=c*u,h+=d*u),Ke.along=u,Ke.squaredDistance=(0,K.FH)((0,K.bI)(r,n,g,h),10),Ke}function B(r,n){const t=r.length;let i=Math.floor(n);const o=n-i;i>=t?i-=t:i<0&&(i+=t);let s=i+1;s>=t&&(s-=t);const a=r[i],l=a[0],c=a[1],d=r[s];return[l+(d[0]-l)*o,c+(d[1]-c)*o]}function mi(){const r=(0,R.Ly)();return function(n,t){return r[n.getGeometry().getType()]}}const yi=class fi extends pe.Z{constructor(n){const t=n;t.stopDown||(t.stopDown=H.Dv),super(t),this.shouldHandle_=!1,this.downPx_=null,this.freehand_=!1,this.source_=n.source?n.source:null,this.features_=n.features?n.features:null,this.snapTolerance_=n.snapTolerance?n.snapTolerance:12,this.type_=n.type,this.mode_=function _i(r){switch(r){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+r)}}(this.type_),this.stopClick_=!!n.stopClick,this.minPoints_=n.minPoints?n.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:n.maxPoints?n.maxPoints:1/0,this.finishCondition_=n.finishCondition?n.finishCondition:H.uX,this.geometryLayout_=n.geometryLayout?n.geometryLayout:"XY";let i=n.geometryFunction;if(!i){const o=this.mode_;if("Circle"===o)i=function(s,a,l){const c=a||new ui([NaN,NaN]),d=(0,_.Vs)(s[0],l),u=(0,P.bI)(d,(0,_.Vs)(s[s.length-1],l));c.setCenterAndRadius(d,Math.sqrt(u),this.geometryLayout_);const g=(0,_.Cs)();return g&&c.transform(l,g),c};else{let s;"Point"===o?s=N.Z:"LineString"===o?s=O.Z:"Polygon"===o&&(s=G.ZP),i=function(a,l,c){return l?l.setCoordinates("Polygon"===o?a[0].length?[a[0].concat([a[0][0]])]:[]:a,this.geometryLayout_):l=new s(a,this.geometryLayout_),l}}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==n.dragVertexDelay?n.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=n.clickTolerance?n.clickTolerance*n.clickTolerance:36,this.overlay_=new Ue.Z({source:new z.Z({useSpatialIndex:!1,wrapX:!!n.wrapX&&n.wrapX}),style:n.style?n.style:mi(),updateWhileInteracting:!0}),this.geometryName_=n.geometryName,this.condition_=n.condition?n.condition:I.rM,this.freehandCondition_=n.freehand?I.Bx:n.freehandCondition?n.freehandCondition:I.vY,this.setTrace(n.trace||!1),this.traceState_={active:!1},this.traceSource_=n.traceSource||n.source||null,this.addChangeListener(It.Z.ACTIVE,this.updateState_)}setTrace(n){let t;t=n?!0===n?I.Bx:n:I.Fi,this.traceCondition_=t}setMap(n){super.setMap(n),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(n){n.originalEvent.type===Y.Z.CONTEXTMENU&&n.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(n);let t=n.type===Z.Z.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&n.type===Z.Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=n.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&n.type===Z.Z.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(n.coordinate),i=!1):this.freehand_&&n.type===Z.Z.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=n.type===Z.Z.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(n),this.shouldHandle_&&n.originalEvent.preventDefault()):("mouse"===n.originalEvent.pointerType||n.type===Z.Z.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(n)):n.type===Z.Z.DBLCLICK&&(i=!1),super.handleEvent(n)&&i}handleDownEvent(n){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=n.pixel,this.finishCoordinate_||this.startDrawing_(n.coordinate),!0):this.condition_(n)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new hi.Z(Z.Z.POINTERMOVE,n.map,n.originalEvent,!1,n.frameState))},this.dragVertexDelay_),this.downPx_=n.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(n){if(!this.traceSource_||!this.traceCondition_(n))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),i=t.getCoordinateFromPixel([n.pixel[0]-this.snapTolerance_,n.pixel[1]+this.snapTolerance_]),o=t.getCoordinateFromPixel([n.pixel[0]+this.snapTolerance_,n.pixel[1]-this.snapTolerance_]),s=(0,C.hI)([i,o]),a=this.traceSource_.getFeaturesInExtent(s);if(0===a.length)return;const l=function gi(r,n){const t=[];for(let i=0;i<n.length;++i)Nt(r,n[i].getGeometry(),t);return t}(n.coordinate,a);l.length&&(this.traceState_={active:!0,startPx:n.pixel.slice(),targets:l,targetIndex:-1})}addOrRemoveTracedCoordinates_(n,t){const i=n.startIndex<=n.endIndex;i===n.startIndex<=t?i&&t>n.endIndex||!i&&t<n.endIndex?this.addTracedCoordinates_(n,n.endIndex,t):(i&&t<n.endIndex||!i&&t>n.endIndex)&&this.removeTracedCoordinates_(t,n.endIndex):(this.removeTracedCoordinates_(n.startIndex,n.endIndex),this.addTracedCoordinates_(n,n.startIndex,t))}removeTracedCoordinates_(n,t){if(n===t)return;let i=0;if(n<t){const o=Math.ceil(n);let s=Math.floor(t);s===t&&(s-=1),i=s-o+1}else{const o=Math.floor(n);let s=Math.ceil(t);s===t&&(s+=1),i=o-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(n,t,i){if(t===i)return;const o=[];if(t<i){const s=Math.ceil(t);let a=Math.floor(i);a===i&&(a-=1);for(let l=s;l<=a;++l)o.push(Q(n.coordinates,l))}else{const s=Math.floor(t);let a=Math.ceil(i);a===i&&(a+=1);for(let l=s;l>=a;--l)o.push(Q(n.coordinates,l))}o.length&&this.appendCoordinates(o)}updateTrace_(n){const t=this.traceState_;if(!t.active||-1===t.targetIndex&&(0,P.TE)(t.startPx,n.pixel)<this.snapTolerance_)return;const i=function pi(r,n,t,i){const o=r[0],s=r[1];let a=1/0,l=-1,c=NaN;for(let g=0;g<n.targets.length;++g){const h=n.targets[g],p=h.coordinates;let y,f=1/0;for(let w=0;w<p.length-1;++w){const j=Dt(o,s,p[w],p[w+1]);j.squaredDistance<f&&(f=j.squaredDistance,y=w+j.along)}f<a&&(a=f,h.ring&&n.targetIndex===g&&(h.endIndex>h.startIndex?y<h.startIndex&&(y+=p.length):h.endIndex<h.startIndex&&y>h.startIndex&&(y-=p.length)),c=y,l=g)}const d=n.targets[l];let u=d.ring;if(n.targetIndex===l&&u){const g=B(d.coordinates,c),h=t.getPixelFromCoordinate(g);(0,P.TE)(h,n.startPx)>i&&(u=!1)}if(u){const g=d.coordinates,h=g.length,p=d.startIndex,f=c;if(p<f){const y=xe(g,p,f);xe(g,p,f-h)<y&&(c-=h)}else{const y=xe(g,p,f);xe(g,p,f+h)<y&&(c+=h)}}return We.index=l,We.endIndex=c,We}(n.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(-1!==t.targetIndex){const c=t.targets[t.targetIndex];this.removeTracedCoordinates_(c.startIndex,c.endIndex)}const l=t.targets[i.index];this.addTracedCoordinates_(l,l.startIndex,i.endIndex)}else this.addOrRemoveTracedCoordinates_(t.targets[t.targetIndex],i.endIndex);t.targetIndex=i.index;const o=t.targets[t.targetIndex];o.endIndex=i.endIndex;const s=B(o.coordinates,o.endIndex),a=this.getMap().getPixelFromCoordinate(s);n.coordinate=s,n.pixel=[Math.round(a[0]),Math.round(a[1])]}handleUpEvent(n){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(n);const i=this.traceState_.active;if(this.toggleTraceState_(n),this.shouldHandle_){const o=!this.finishCoordinate_;o&&this.startDrawing_(n.coordinate),!o&&this.freehand_?this.finishDrawing():!this.freehand_&&(!o||"Point"===this.mode_)&&(this.atFinish_(n.pixel,i)?this.finishCondition_(n)&&this.finishDrawing():this.addToDrawing_(n.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&n.preventDefault(),t}handlePointerMove_(n){if(this.pointerType_=n.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=n.pixel,o=t[0]-i[0],s=t[1]-i[1],a=o*o+s*s;if(this.shouldHandle_=this.freehand_?a>this.squaredClickTolerance_:a<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(n),this.modifyDrawing_(n.coordinate)):this.createOrUpdateSketchPoint_(n.coordinate.slice())}atFinish_(n,t){let i=!1;if(this.sketchFeature_){let o=!1,s=[this.finishCoordinate_];const a=this.mode_;if("Point"===a)i=!0;else if("Circle"===a)i=2===this.sketchCoords_.length;else if("LineString"===a)o=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===a){const l=this.sketchCoords_;o=l[0].length>this.minPoints_,s=[l[0][0],l[0][l[0].length-2]],s=t?[l[0][0]]:[l[0][0],l[0][l[0].length-2]]}if(o){const l=this.getMap();for(let c=0,d=s.length;c<d;c++){const u=s[c],g=l.getPixelFromCoordinate(u),h=n[0]-g[0],p=n[1]-g[1],f=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(h*h+p*p)<=f,i){this.finishCoordinate_=u;break}}}}return i}createOrUpdateSketchPoint_(n){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(n):(this.sketchPoint_=new M.Z(new N.Z(n)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(n){this.sketchLine_||(this.sketchLine_=new M.Z);const t=n.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new O.Z(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(n){const t=this.getMap().getView().getProjection(),i=(0,U.tP)(this.geometryLayout_);for(;n.length<i;)n.push(0);this.finishCoordinate_=n,"Point"===this.mode_?this.sketchCoords_=n.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[n.slice(),n.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[n.slice(),n.slice()],this.sketchLineCoords_&&(this.sketchLine_=new M.Z(new O.Z(this.sketchLineCoords_)));const o=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new M.Z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new ye("drawstart",this.sketchFeature_))}modifyDrawing_(n){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),o=t.getView().getProjection(),s=(0,U.tP)(this.geometryLayout_);let a,l;for(;n.length<s;)n.push(0);"Point"===this.mode_?l=this.sketchCoords_:"Polygon"===this.mode_?(a=this.sketchCoords_[0],l=a[a.length-1],this.atFinish_(t.getPixelFromCoordinate(n))&&(n=this.finishCoordinate_.slice())):(a=this.sketchCoords_,l=a[a.length-1]),l[0]=n[0],l[1]=n[1],this.geometryFunction_(this.sketchCoords_,i,o),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(n),"Polygon"===i.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(n){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let o,s;const a=this.mode_;"LineString"===a||"Circle"===a?(this.finishCoordinate_=n.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():o=!0),s.push(n.slice()),this.geometryFunction_(s,t,i)):"Polygon"===a&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():o=!0),s.push(n.slice()),o&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(n.slice()),this.updateSketchFeatures_(),o&&this.finishDrawing()}removeLastPoints_(n){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),o=this.mode_;for(let s=0;s<n;++s){let a;if("LineString"===o||"Circle"===o){if(a=this.sketchCoords_,a.splice(-2,1),a.length>=2){this.finishCoordinate_=a[a.length-2].slice();const l=this.finishCoordinate_.slice();a[a.length-1]=l,this.createOrUpdateSketchPoint_(l)}this.geometryFunction_(a,t,i),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===o){a=this.sketchCoords_[0],a.splice(-2,1);const l=this.sketchLine_.getGeometry();if(a.length>=2){const c=a[a.length-2].slice();a[a.length-1]=c,this.createOrUpdateSketchPoint_(c)}l.setCoordinates(a),this.geometryFunction_(this.sketchCoords_,t,i)}if(1===a.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const n=this.abortDrawing_();if(!n)return;let t=this.sketchCoords_;const i=n.getGeometry(),o=this.getMap().getView().getProjection();"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,i,o)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,i,o),t=i.getCoordinates()),"MultiPoint"===this.type_?n.setGeometry(new ce([t])):"MultiLineString"===this.type_?n.setGeometry(new le([t])):"MultiPolygon"===this.type_&&n.setGeometry(new ue([t])),this.dispatchEvent(new ye("drawend",n)),this.features_&&this.features_.push(n),this.source_&&this.source_.addFeature(n)}abortDrawing_(){this.finishCoordinate_=null;const n=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),n}abortDrawing(){const n=this.abortDrawing_();n&&this.dispatchEvent(new ye("drawabort",n))}appendCoordinates(n){const t=this.mode_,i=!this.sketchFeature_;let o;if(i&&this.startDrawing_(n[0]),"LineString"===t||"Circle"===t)o=this.sketchCoords_;else{if("Polygon"!==t)return;o=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&o.shift(),o.pop();for(let a=0;a<n.length;a++)this.addToDrawing_(n[a]);const s=n[n.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)}extend(n){const i=n.getGeometry();this.sketchFeature_=n,this.sketchCoords_=i.getCoordinates();const o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.sketchPoint_=new M.Z(new N.Z(o)),this.updateSketchFeatures_(),this.dispatchEvent(new ye("drawstart",this.sketchFeature_))}updateSketchFeatures_(){const n=[];this.sketchFeature_&&n.push(this.sketchFeature_),this.sketchLine_&&n.push(this.sketchLine_),this.sketchPoint_&&n.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(n)}updateState_(){const n=this.getMap(),t=this.getActive();(!n||!t)&&this.abortDrawing(),this.overlay_.setMap(t?n:null)}};function ve(r){return"string"==typeof r?r:""}const xi=class Ci extends xt{constructor(){super()}getType(){return"text"}readFeature(n,t){return this.readFeatureFromText(ve(n),this.adaptOptions(t))}readFeatureFromText(n,t){return(0,v.O3)()}readFeatures(n,t){return this.readFeaturesFromText(ve(n),this.adaptOptions(t))}readFeaturesFromText(n,t){return(0,v.O3)()}readGeometry(n,t){return this.readGeometryFromText(ve(n),this.adaptOptions(t))}readGeometryFromText(n,t){return(0,v.O3)()}readProjection(n){return this.readProjectionFromText(ve(n))}readProjectionFromText(n){return this.dataProjection}writeFeature(n,t){return this.writeFeatureText(n,this.adaptOptions(t))}writeFeatureText(n,t){return(0,v.O3)()}writeFeatures(n,t){return this.writeFeaturesText(n,this.adaptOptions(t))}writeFeaturesText(n,t){return(0,v.O3)()}writeGeometry(n,t){return this.writeGeometryText(n,this.adaptOptions(t))}writeGeometryText(n,t){return(0,v.O3)()}},Ti={POINT:N.Z,LINESTRING:O.Z,POLYGON:G.ZP,MULTIPOINT:ce,MULTILINESTRING:le,MULTIPOLYGON:ue},bi={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class wi{constructor(n){this.wkt=n,this.index_=-1}isAlpha_(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"}isNumeric_(n,t){return t=void 0!==t&&t,n>="0"&&n<="9"||"."==n&&!t}isWhiteSpace_(n){return" "==n||"\t"==n||"\r"==n||"\n"==n}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const n=this.nextChar_(),t=this.index_;let o,i=n;if("("==n)o=2;else if(","==n)o=5;else if(")"==n)o=3;else if(this.isNumeric_(n)||"-"==n)o=4,i=this.readNumber_();else if(this.isAlpha_(n))o=1,i=this.readText_();else{if(this.isWhiteSpace_(n))return this.nextToken();if(""!==n)throw new Error("Unexpected character: "+n);o=6}return{position:t,value:i,type:o}}readNumber_(){let n;const t=this.index_;let i=!1,o=!1;do{"."==n?i=!0:("e"==n||"E"==n)&&(o=!0),n=this.nextChar_()}while(this.isNumeric_(n,i)||!o&&("e"==n||"E"==n)||o&&("-"==n||"+"==n));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let n;const t=this.index_;do{n=this.nextChar_()}while(this.isAlpha_(n));return this.wkt.substring(t,this.index_--).toUpperCase()}}class Pi{constructor(n){this.lexer_=n,this.token_={position:0,type:0},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(n){return this.token_.type==n}match(n){const t=this.isTokenType(n);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let n="XY";const t=this.token_;if(this.isTokenType(1)){const i=t.value;"Z"===i?n="XYZ":"M"===i?n="XYM":"ZM"===i&&(n="XYZM"),"XY"!==n&&this.consume_()}return n}parseGeometryCollectionText_(){if(this.match(2)){const n=[];do{n.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(2)){const n=this.parsePoint_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(2)){const n=this.parsePointList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(2)){const n=this.parseLineStringTextList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(2)){let n;if(n=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(2)){const n=this.parseLineStringTextList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(2)){const n=this.parsePolygonTextList_();if(this.match(3))return n}throw new Error(this.formatErrorMessage_())}parsePoint_(){const n=[],t=this.layout_.length;for(let i=0;i<t;++i){const o=this.token_;if(!this.match(4))break;n.push(o.value)}if(n.length==t)return n;throw new Error(this.formatErrorMessage_())}parsePointList_(){const n=[this.parsePoint_()];for(;this.match(5);)n.push(this.parsePoint_());return n}parsePointTextList_(){const n=[this.parsePointText_()];for(;this.match(5);)n.push(this.parsePointText_());return n}parseLineStringTextList_(){const n=[this.parseLineStringText_()];for(;this.match(5);)n.push(this.parseLineStringText_());return n}parsePolygonTextList_(){const n=[this.parsePolygonText_()];for(;this.match(5);)n.push(this.parsePolygonText_());return n}isEmptyGeometry_(){const n=this.isTokenType(1)&&"EMPTY"==this.token_.value;return n&&this.consume_(),n}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const n=this.token_;if(this.match(1)){const t=n.value;this.layout_=this.parseGeometryLayout_();const i=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==t){if(i)return new W([]);const a=this.parseGeometryCollectionText_();return new W(a)}const o=Ti[t];if(!o)throw new Error("Invalid geometry type: "+t);let s;if(i)s="POINT"==t?[NaN,NaN]:[];else switch(t){case"POINT":s=this.parsePointText_();break;case"LINESTRING":s=this.parseLineStringText_();break;case"POLYGON":s=this.parsePolygonText_();break;case"MULTIPOINT":s=this.parseMultiPointText_();break;case"MULTILINESTRING":s=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":s=this.parseMultiPolygonText_()}return new o(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}function Ut(r){const n=r.getCoordinates();return 0===n.length?"":n.join(" ")}function ze(r){const n=r.getCoordinates(),t=[];for(let i=0,o=n.length;i<o;++i)t.push(n[i].join(" "));return t.join(",")}function Ht(r){const n=[],t=r.getLinearRings();for(let i=0,o=t.length;i<o;++i)n.push("("+ze(t[i])+")");return n.join(",")}const Ii={Point:Ut,LineString:ze,Polygon:Ht,MultiPoint:function Fi(r){const n=[],t=r.getPoints();for(let i=0,o=t.length;i<o;++i)n.push("("+Ut(t[i])+")");return n.join(",")},MultiLineString:function Li(r){const n=[],t=r.getLineStrings();for(let i=0,o=t.length;i<o;++i)n.push("("+ze(t[i])+")");return n.join(",")},MultiPolygon:function Mi(r){const n=[],t=r.getPolygons();for(let i=0,o=t.length;i<o;++i)n.push("("+Ht(t[i])+")");return n.join(",")},GeometryCollection:function Si(r){const n=[],t=r.getGeometries();for(let i=0,o=t.length;i<o;++i)n.push(qt(t[i]));return n.join(",")}};function qt(r){const n=r.getType(),i=(0,Ii[n])(r);let o=bi[n];if("function"==typeof r.getFlatCoordinates){const s=function ki(r){const n=r.getLayout();let t="";return("XYZ"===n||"XYZM"===n)&&(t+="Z"),("XYM"===n||"XYZM"===n)&&(t+="M"),t}(r);s.length>0&&(o+=" "+s)}return 0===i.length?o+" EMPTY":o+"("+i+")"}const Qt=class Ei extends xi{constructor(n){super(),this.splitCollection_=void 0!==(n=n||{}).splitCollection&&n.splitCollection}parse_(n){const t=new wi(n);return new Pi(t).parse()}readFeatureFromText(n,t){const i=this.readGeometryFromText(n,t),o=new M.Z;return o.setGeometry(i),o}readFeaturesFromText(n,t){let i=[];const o=this.readGeometryFromText(n,t);i=this.splitCollection_&&"GeometryCollection"==o.getType()?o.getGeometriesArray():[o];const s=[];for(let a=0,l=i.length;a<l;++a){const c=new M.Z;c.setGeometry(i[a]),s.push(c)}return s}readGeometryFromText(n,t){return ie(this.parse_(n),!1,t)}writeFeatureText(n,t){const i=n.getGeometry();return i?this.writeGeometryText(i,t):""}writeFeaturesText(n,t){if(1==n.length)return this.writeFeatureText(n[0],t);const i=[];for(let s=0,a=n.length;s<a;++s)i.push(n[s].getGeometry());const o=new W(i);return this.writeGeometryText(o,t)}writeGeometryText(n,t){return qt(ie(n,!0,t))}};var be=m(5044),we=m(6785),Zi=m(7392);const Bt=[100,100,100,200];class Ai{constructor(n,t,i,o=null){this._fillColor=Lt(),this._strokeColor="black",this._strokeWidth=2,this._locked=!1,this._featuresToggled=!1,this._featuresCounter=0,this._initLayer(n,t,i)}get layer(){return this._vectorLayer}get layerName(){return this._getLayerAttributes("name")}set layerName(n){this.layer.set("name",n)}get geomType(){return this._getLayerAttributes("geom_type")}get sourceFeatures(){return this._sourceFeatures}get zIndex(){return this.layer.getZIndex()}set zIndex(n){this.layer.setZIndex(n)}get uuid(){return this._getLayerAttributes("uuid")}set visible(n){this.layer.setVisible(n)}get visible(){return this.layer.getVisible()}set propertyStyled(n){this._propertyStyled=n}get propertyStyled(){return this._propertyStyled}set styleSettings(n){this._styleSettings=n}get styleSettings(){return this._styleSettings}set featuresToggled(n){this._featuresToggled=n}get featuresToggled(){return this._featuresToggled}set locked(n){this._locked=n}get locked(){return this._locked}set opacity(n){this.layer.setOpacity(n.target.valueAsNumber)}get opacity(){return this.layer.getOpacity()}get fillColor(){return this._fillColor}set fillColor(n){St.test(n)&&(this.features.forEach(t=>{t.set("fill_color",n,!1)}),this._fillColor=n)}get strokeColor(){return this._strokeColor}set strokeColor(n){St.test(n)&&(this.features.forEach(t=>{t.set("stroke_color",n,!1)}),this._strokeColor=n)}get strokeWidth(){return this._strokeWidth}set strokeWidth(n){this._strokeWidth=n,this.features.forEach(t=>{t.set("stroke_width",this._strokeWidth,!1)})}_initLayer(n,t,i){this._sourceFeatures=new z.Z,this._vectorLayer=new Ue.Z({source:this._sourceFeatures,style:(o,s)=>Wt(o)}),this.layerName=n,this.layer.set("uuid",Ft()),this.layer.set("geom_type",t),this.zIndex=i}_getLayerAttributes(n){return this.layer.get(n)}get features(){return this._sourceFeatures.getFeatures().sort((n,t)=>n.get("no")-t.get("no"))}featureById(n){const t=this.sourceFeatures.getFeatureById(n);return null!==t?[t]:[]}duplicateFeature(n){const t=this.featureById(n);if(1===t.length){const i=this.addProperties(t[0].clone());this.sourceFeatures.addFeature(i)}}removeFeature(n){const t=this.featureById(n);1===t.length&&this.sourceFeatures.removeFeature(t[0])}addProperties(n){++this._featuresCounter;const t=Ft();let i;return n.setId(t),i=void 0!==n.get("name")?n.get("name")+" copy":"feature "+this._featuresCounter,n.setProperties({id:n.getId(),no:this._featuresCounter,name:i,geom_type:n.getGeometry()?.getType(),status:"added",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),fill_color:this.fillColor,stroke_width:this.strokeWidth,stroke_color:this.strokeColor},!0),n}_updateMetadataFeature(n){n.setProperties({updated_at:(new Date).toISOString(),status:"modified"},!0)}addFeaturesAndUpdateIds(n){n.length>0&&n.forEach(t=>{let i=t.clone(),o=this.addProperties(i);this.sourceFeatures.addFeature(o)})}}class Oi{constructor(n,t){this._headerHidden=["geometry","id","no","geom_type","created_at","updated_at","fill_color","stroke_width","stroke_color"],this.holePolygonDrawingStatus=!1,this._zoomMax=20,this._zoomPadding=Bt,this.container=t,this._map=n,this._initSelect(),this._initTranslate(),this._initSnap(),this._initModifier(),this._map.addLayer(this.container.layer)}removeLayer(){this._map.removeLayer(this.container.layer)}enableTranslating(){this._map.addInteraction(this._translate)}disableTranslating(){this._map.removeInteraction(this._translate)}enableSelecting(){this._map.addInteraction(this.select)}disableSelecting(){this._map.removeInteraction(this.select)}enableSnapping(){this._map.addInteraction(this._snap)}disableSnapping(){this._map.removeInteraction(this._snap)}_initSelect(){this.select=new ti.Z({condition:I.V4,multi:!1,layers:[this.container.layer]})}_initSnap(){this._snap=new ii({source:this.container.layer.getSource()})}_initTranslate(){this._translate=new ri({features:this.select.getFeatures()})}_initModifier(){this._modifier=new ci({features:this.select.getFeatures(),deleteCondition:I.Ko,snapToPointer:!0}),this._modifier.on("modifyend",n=>{n.mapBrowserEvent.originalEvent.ctrlKey&&this._removeHoles(n),n.features.getArray().length>0&&n.features.getArray().forEach(t=>{this._updateMetadataFeature(t)})})}_removeHoles(n){const t=n.features.getArray()[0],i=n.mapBrowserEvent.coordinate;if("Polygon"==t.getGeometry().getType()){const o=t.getGeometry().getLinearRings();if(o.length>1){let s=new z.Z;o.forEach((c,d)=>{const u=new O.Z(c.getCoordinates());let g=new M.Z({geometry:u});g.setId(d),s.addFeature(g)});const a=s.getClosestFeatureToCoordinate(i);let l=[];o.forEach((c,d)=>{d!==a.getId()&&l.push(c.getCoordinates())}),t.getGeometry().setCoordinates(l)}}}enableEditing(){this.disableEditing(),this._map.addInteraction(this._modifier)}disableEditing(){this._map.removeInteraction(this._modifier)}cleanEvents(){this.disableDrawing(),this.disableEditing()}enableDrawing(n=!1){this.holePolygonDrawingStatus=n,this._draw=new yi({type:this.container.geomType,stopClick:!0,source:this.container.sourceFeatures,condition:t=>1===t.originalEvent.buttons}),this._map.addInteraction(this._draw),this._draw.on("drawstart",this._onDrawStart.bind(this)),this._draw.on("drawend",this._onDrawEnd.bind(this)),this._draw.on("drawabort",this._onDrawAborting.bind(this))}disableDrawing(){this._map.removeInteraction(this._draw)}_updateMetadataFeature(n){n.setProperties({updated_at:(new Date).toISOString(),status:"modified"},!0)}_onDrawStart(n){if(this.holePolygonDrawingStatus&&"Polygon"===n.feature.getGeometry()?.getType()){let t=this.checkIfCoordIntersectLayer(n.feature);if(this.polygonIntersected=t,void 0===this.polygonIntersected)return n.target.abortDrawing(),this._onDrawAborting(n),void alert("An hole is possible only on a polygon!");if(void 0!==this.polygonIntersected){this.previousPolygonGeometry=this.polygonIntersected.getGeometry();const i=this.polygonIntersected.getGeometry();this.coordsLength=i.getCoordinates().length,n.feature.getGeometry().on("change",this._onGeomChangeBuildHole.bind(this))}}}_onDrawEnd(n){if(this.holePolygonDrawingStatus)return setTimeout(()=>{this.container.sourceFeatures.removeFeature(n.feature)},5),void 0!==this.polygonIntersected&&(n.feature.setGeometry(this.polygonIntersected.getGeometry()),this.select.getFeatures().clear()),void(this.polygonIntersected=void 0);this.container.addProperties(n.feature)}_onDrawAborting(n){this.holePolygonDrawingStatus&&void 0!==this.polygonIntersected&&(this.polygonIntersected.setGeometry(this.previousPolygonGeometry),this.polygonIntersected=void 0)}checkIfCoordIntersectLayer(n){let t;return this.container.sourceFeatures.forEachFeatureIntersectingExtent(n.getGeometry().getExtent(),i=>{t=i}),t}_onGeomChangeBuildHole(n){if(void 0!==this.polygonIntersected){let i=this.polygonIntersected.getGeometry().getCoordinates(),o=new G.ZP(i.slice(0,this.coordsLength)),s=new ei.Z(n.target.getCoordinates()[0]);o.appendLinearRing(s),this.polygonIntersected.setGeometry(o)}}zoomToLayer(){this.container.features.length>0&&this._map.getView().fit(this.container.layer.getSource().getExtent(),{size:this._map.getSize(),padding:this._zoomPadding,maxZoom:this._zoomMax})}zoomToFeature(n){this.container.features.filter(t=>{t.getId()===n&&this._map.getView().fit(t.getGeometry(),{size:this._map.getSize(),padding:this._zoomPadding,maxZoom:this._zoomMax})})}getFeatureAttribute(n,t){const i=this.container.featureById(n);if(1===i.length)return i[0].get(t)}getAttributesHeader(){return this.container.features[0].getKeys().filter(i=>!this._headerHidden.includes(i))}setAttribute(n,t){this.getAttributesHeader().includes(n)&&this.container.features.forEach(o=>{null===t&&(t=""),o.set(n,t,!1)})}removeAttribute(n){this.getAttributesHeader().includes(n)&&this.container.features.forEach(t=>{t.unset(n,!1)})}exportBounds(){return this.container.sourceFeatures.getExtent().join(",").split(",").map(Number)}exportBoundsPolygon(){const n=this.exportBounds(),i=new G.ZP([[[n[0],n[3]],[n[2],n[3]],[n[2],n[1]],[n[0],n[1]],[n[0],n[3]]]]);return{Polygon:[new M.Z({geometry:i})]}}exportToGeoJSON(){let n=new wt;return JSON.stringify(JSON.parse(n.writeFeatures(this.container.features)),null,2)}exportToWkt(){let n=[];return this.container.features.forEach(t=>{n.push(Ee(t.getGeometry()))}),n.join("\n")}exportToPytestFixture(){let t=[];return this.container.features.forEach(i=>{t.push("\n@pytest.fixture\ndef "+i.get("name").replace(" ","_")+"():\n\treturn '"+Ee(i.getGeometry())+"'")}),"import pytest\n"+t.join("\n")}}function Yt(r,n,t){const i=r.findIndex(a=>a.container.uuid===n),s=r[i].container.zIndex+t;return s>=0&&s<r.length&&(r[i].container.zIndex=s,(r=r.sort((a,l)=>a.container.zIndex<l.container.zIndex?-1:1)).forEach((a,l)=>{a.container.zIndex=l})),r}function Ee(r){return(new Qt).writeGeometry(r)}function Wt(r){let n,t=r.getGeometry();if(void 0!==t){const i=r.get("fill_color"),o=r.get("stroke_width"),s=r.get("stroke_color");return"Point"===t.getType()?n=function Ni(r,n,t){return new R.ZP({image:new Zi.Z({radius:7,fill:new be.Z({color:r}),stroke:new we.Z({color:t,width:n})})})}(i,o,s):"LineString"===t.getType()?n=function Di(r,n,t){return[new R.ZP({fill:new be.Z({color:r}),stroke:new we.Z({color:t,width:2*n})}),new R.ZP({fill:new be.Z({color:r}),stroke:new we.Z({color:r,width:n})})]}(i,o,s):"Polygon"===t.getType()&&(n=function Ji(r,n,t){return new R.ZP({fill:new be.Z({color:r}),stroke:new we.Z({color:t,width:n})})}(i,o,s)),n}return new R.ZP}const Ui=["POINT(539215.004853 5742515.939068)","POINT(539296.087038 5742385.422904)","POINT(539356.244789 5742478.798196)","POINT(539314.657474 5742559.095715)"],Hi=["LINESTRING(539218.666629 5742542.879278,539338.720575 5742544.971721)","LINESTRING(539338.720575 5742544.971721,539360.691231 5742400.070009)","LINESTRING(539360.691231 5742400.070009,539237.760176 5742383.592016)","LINESTRING(539218.666629 5742542.879278,539237.760176 5742383.592016)"],qi=["POLYGON((539226.518272 5742530.856872,539232.644818 5742490.756254,539256.980871 5742494.193922,539256.4417101032 5742499.585533,539254.554646 5742504.707562,539250.510938 5742504.707562,539250.510938 5742509.020851,539259.407095 5742507.942529,539258.867934 5742515.760364,539260.300444 5742515.722086,539260.115470 5742531.383185,539226.518272 5742530.856872))","POLYGON((539260.115470 5742531.383185,539287.372942 5742531.999445,539287.311284 5742498.704195,539259.9351908506 5742495.128039,539259.407095 5742507.942529,539258.867934 5742515.760364,539260.300444 5742515.722086,539260.115470 5742531.383185),(539270.154545 5742508.569826,539269.728873 5742508.536220,539269.738792 5742506.966350,539267.704082 5742506.966350,539267.827398 5742504.376719,539275.904578 5742504.191746,539279.973998 5742504.191746,539279.912340 5742506.843034,539272.095577 5742506.707124,539271.711843 5742508.692770,539270.154545 5742508.569826))","POLYGON((539287.372942 5742531.999445,539318.034672 5742532.378169,539319.906513 5742531.559238,539321.4273850791 5742530.038367,539324.937087 5742504.300548,539294.987624 5742499.737934,539287.311284 5742498.704195,539287.372942 5742531.999445),(539295.375493 5742507.421860,539295.446682 5742503.221728,539298.934839 5742503.597902,539299.219682 5742506.211652,539301.141776 5742507.635426,539300.928210 5742509.984652,539301.070587 5742511.408425,539298.934927 5742511.266048,539298.650172 5742508.916822,539297.130063 5742508.069037,539295.375493 5742507.421860))","POLYGON((539294.987624 5742499.737934,539299.556257 5742468.337040,539329.078155 5742472.196111,539324.9370877611 5742504.300548,539294.987624 5742499.737934))","POLYGON((539259.935190 5742495.128039,539256.980871 5742494.193922,539232.644818 5742490.756254,539235.2430055273 5742471.432241,539263.254704 5742475.410715,539261.062456 5742495.275295,539259.935190 5742495.128039))","POLYGON((539235.243005 5742471.432241,539237.745648 5742451.885722,539265.912893 5742455.147193,539263.2547045123 5742475.410715,539235.243005 5742471.432241))","POLYGON((539237.745648 5742451.885722,539240.265875 5742432.168650,539268.136623 5742436.319613,539265.9128935036 5742455.147193,539237.745648 5742451.885722))","POLYGON((539299.556257 5742468.337040,539302.975058 5742442.101311,539268.136623 5742436.319613,539265.9128935036 5742455.147193,539263.254704 5742475.410715,539261.062456 5742495.275295,539287.311284 5742498.704195,539294.987624 5742499.737934,539299.556257 5742468.337040))","POLYGON((539300.440377 5742461.552340,539306.384777 5742462.263128,539305.231247 5742469.078868,539299.5562570365 5742468.337040,539300.440377 5742461.552340))","POLYGON((539329.078155 5742472.196111,539333.662531 5742445.214532,539310.683988 5742442.546057,539306.1134484276 5742469.194189,539329.078155 5742472.196111))","POLYGON((539333.662531 5742445.214532,539337.225770 5742416.486706,539337.029548 5742412.562276,539335.263555079 5742409.2265104,539333.105118 5742406.675630,539330.358017 5742405.890744,539253.242966 5742396.079669,539248.337428 5742397.649441,539245.590327 5742400.788985,539243.824333 5742405.694523,539240.265875 5742432.168650,539268.136623 5742436.319613,539302.975058 5742442.101311,539310.683988 5742442.546057,539333.662531 5742445.214532),(539258.465989 5742428.264073,539259.960857 5742413.215731,539320.253882 5742421.188362,539318.559697 5742438.728151,539272.308469 5742432.624896,539272.218778 5742430.257231,539258.465989 5742428.264073))","POLYGON((539302.325413 5742447.086661,539305.599028 5742447.378161,539306.269015 5742442.291347,539302.9750586041 5742442.101311,539302.325413 5742447.086661))"];var D=m(9401);function Qi(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",16),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.setImportDataType(s.label_text))}),e._UZ(2,"fa-icon",17),e._uU(3),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit;e.xp6(1),e.Q6J("ngbPopover",t.label),e.xp6(1),e.Q6J("icon",t.icon),e.xp6(1),e.hij("",t.label_text," ")}}function Bi(r,n){if(1&r&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function Vi(r,n){if(1&r&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.Q6J("value",t.container.uuid),e.xp6(1),e.hij("Importer dans la couche : ",t.container.layerName,"")}}let Yi=(()=>{class r{constructor(){this.featuresToNewLayerEvent=new e.vpe,this.featuresToAppendEvent=new e.vpe,this.loadIcon=yt,this.importModes=[{mode:"GeoJSON",label:"Importer un GeoJSON",label_text:"GeoJSON",icon:this.loadIcon},{mode:"WKT",label:"Importer un/des WKT(s)",label_text:"WKT(s)",icon:this.loadIcon}],this.componentRemoved=!1,this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="newLayer"}ngOnInit(){}ngOnDestroy(){this.componentRemoved=!0}setImportDataType(t){this.importDataType=t}importFromFormat(){let i,t={};this.strInputEpsgInput!==this.currentEpsg&&(t={dataProjection:this.strInputEpsgInput,featureProjection:this.currentEpsg}),null!==this.strInputDataValues&&("GeoJSON"===this.importDataType?i=function Wi(r,n){let t={};return t=function Ki(r){return r.reduce((n,t)=>{let i=t.getGeometry().getType();return n[i]||(n[i]=[]),n[i].push(t),n},{})}(new z.Z({features:(new wt).readFeatures(JSON.parse(r,n))}).getFeatures()),t}(this.strInputDataValues,t):"WKT(s)"===this.importDataType&&(i=Xe(this.strInputDataValues.split("\n"),t)),"newLayer"===this.modeImportInput?this.featuresToNewLayerEvent.emit(i):this.featuresToAppendEvent.emit({layerId:this.modeImportInput,features:i})),this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="newLayer"}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-import-tools"]],inputs:{epsgAvailable:"epsgAvailable",currentEpsg:"currentEpsg",existingLayers:"existingLayers"},outputs:{featuresToNewLayerEvent:"featuresToNewLayerEvent",featuresToAppendEvent:"featuresToAppendEvent"},decls:25,vars:9,consts:[[1,"text-center","fw-bold","bg-secondary","bg-gradient","text-white","p-2"],["id","importTools",1,"text-center","m-3"],[4,"ngFor","ngForOf"],["moveDivToBody","","id","modalDataImport","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade",3,"isRemoved"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-control",3,"ngModel","ngModelChange"],[1,"form-select","form-select-sm",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","newLayer"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"ngClass","click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["data-bs-toggle","modal","data-bs-target","#modalDataImport","type","button","role","tab","placement","bottom","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-secondary","border-0","m-1","text-white",3,"ngbPopover","click"],[1,"mx-1",3,"icon"],[3,"value"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Importer\n"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,Qi,4,3,"ng-container",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"h5",7),e._uU(9),e.qZA()(),e.TgZ(10,"div",8)(11,"textarea",9),e.NdJ("ngModelChange",function(s){return i.strInputDataValues=s}),e.qZA(),e._uU(12," EPSG des donn\xe9es \xe0 importer "),e.TgZ(13,"select",10),e.NdJ("ngModelChange",function(s){return i.strInputEpsgInput=s}),e.YNc(14,Bi,2,2,"option",11),e.qZA(),e._uU(15," Type d'importation "),e.TgZ(16,"select",10),e.NdJ("ngModelChange",function(s){return i.modeImportInput=s}),e.TgZ(17,"option",12),e._uU(18,"Cr\xe9er de nouvelles couches"),e.qZA(),e.YNc(19,Vi,2,2,"option",11),e.qZA()(),e.TgZ(20,"div",13)(21,"button",14),e.NdJ("click",function(){return i.importFromFormat()}),e._uU(22,"Ajouter"),e.qZA(),e.TgZ(23,"button",15),e._uU(24,"Fermer"),e.qZA()()()()()),2&t&&(e.xp6(3),e.Q6J("ngForOf",i.importModes),e.xp6(1),e.Q6J("isRemoved",i.componentRemoved),e.xp6(5),e.hij("Importer ",i.importDataType,""),e.xp6(2),e.Q6J("ngModel",i.strInputDataValues),e.xp6(2),e.Q6J("ngModel",i.strInputEpsgInput),e.xp6(1),e.Q6J("ngForOf",i.epsgAvailable),e.xp6(2),e.Q6J("ngModel",i.modeImportInput),e.xp6(3),e.Q6J("ngForOf",i.existingLayers),e.xp6(2),e.Q6J("ngClass",null!==i.strInputEpsgInput&&null!==i.strInputDataValues?"":"pe-none"))},dependencies:[x.mk,x.sg,A.BN,F.o8,D.YN,D.Kr,D.Fj,D.EJ,D.JJ,D.On,Oe]}),r})();function Xe(r,n){let t={};return r.forEach(i=>{let o;try{o=(new Qt).readFeature(i,n)}catch(s){alert(s.message)}if(void 0!==o&&!o.getGeometry().flatCoordinates.includes(NaN)){const s=o.getGeometry(),a=s.getType();a in t||(t[a]=[]),void 0!==s&&t[a].push(o)}}),t}let Fe=(()=>{class r{constructor(){this.newFeatures=new V.x,this.snappingLayerEnabled=new V.x}addNewFeatures(t){this.newFeatures.next(t)}activateSnapping(t){this.snappingLayerEnabled.next(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Kt(r,n,t,i,o,s,a){try{var l=r[s](a),c=l.value}catch(d){return void t(d)}l.done?n(c):Promise.resolve(c).then(i,o)}function Se(r){return function(){var n=this,t=arguments;return new Promise(function(i,o){var s=r.apply(n,t);function a(c){Kt(s,i,o,a,l,"next",c)}function l(c){Kt(s,i,o,a,l,"throw",c)}a(void 0)})}}const zi=["modal"];function Xi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",1)(1,"h5",2),e._uU(2),e.qZA(),e.TgZ(3,"button",3),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.close())}),e.qZA()(),e.TgZ(4,"div",4),e.Hsn(5),e.qZA(),e.TgZ(6,"div",5)(7,"button",6),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.close())}),e._uU(8," Fermer "),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(2),e.Oqu(t.title)}}const $i=["*"];let zt=(()=>{class r{constructor(t){this.modalService=t,this.size="lg"}ngOnInit(){}open(){const t={backdrop:"static",scrollable:!0,size:this.size};return new Promise(i=>{this._modalRef=this.modalService.open(this.modalContent,t),this._modalRef.result.then(i,i)})}close(){var t=this;return Se(function*(){t._modalRef.close(!0)})()}dismiss(){var t=this;return Se(function*(){t._modalRef.dismiss(!0)})()}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(F.FF))},r.\u0275cmp=e.Xpm({type:r,selectors:[["set-modal"]],viewQuery:function(t,i){if(1&t&&e.Gf(zi,5),2&t){let o;e.iGM(o=e.CRH())&&(i.modalContent=o.first)}},inputs:{title:"title",size:"size"},standalone:!0,features:[e.jDz],ngContentSelectors:$i,decls:2,vars:0,consts:[["modal",""],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"click"]],template:function(t,i){1&t&&(e.F$t(),e.YNc(0,Xi,9,1,"ng-template",null,0,e.W1O))},dependencies:[x.ez]}),r})();var eo=m(5625);function to(r,n){if(1&r&&(e.O4$(),e.TgZ(0,"svg",4),e._UZ(1,"circle",5),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.uIk("stroke",t.strokeColor)("stroke-width",t.strokeWidth)("fill",t.fillColor)}}function no(r,n){if(1&r&&(e.O4$(),e.TgZ(0,"svg",4),e._UZ(1,"line",6)(2,"line",6),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.uIk("stroke",t.strokeColor)("stroke-width",t.strokeWidth*t._strokeWidthCoeff),e.xp6(1),e.uIk("stroke",t.fillColor)("stroke-width",t.strokeWidth*t._strokeWidthLineCoeff)}}function io(r,n){if(1&r&&(e.O4$(),e.TgZ(0,"svg",7),e._UZ(1,"rect",8),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.uIk("stroke",t.strokeColor)("stroke-width",t.strokeWidth*t._strokeWidthCoeff)("fill",t.fillColor)}}function oo(r,n){if(1&r&&(e.TgZ(0,"span",9),e._uU(1),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Oqu(t.title)}}let $e=(()=>{class r{constructor(){this._strokeWidthCoeff=1.8,this._strokeWidthLineCoeff=1.8}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-geom-icons"]],inputs:{geomType:"geomType",strokeColor:"strokeColor",fillColor:"fillColor",strokeWidth:"strokeWidth",title:"title"},standalone:!0,features:[e.jDz],decls:5,vars:4,consts:[[1,"mx-1"],["height","20","width","20",4,"ngIf"],["height","16","width","25",4,"ngIf"],["class","m-1 small",4,"ngIf"],["height","20","width","20"],["cx","10","cy","10","r","7"],["x1","0","y1","10","x2","20","y2","10"],["height","16","width","25"],["x","0","y","0","width","25","height","16"],[1,"m-1","small"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.YNc(1,to,2,3,"svg",1),e.YNc(2,no,3,4,"svg",1),e.YNc(3,io,2,3,"svg",2),e.YNc(4,oo,2,1,"span",3),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf","Point"===i.geomType),e.xp6(1),e.Q6J("ngIf","LineString"===i.geomType),e.xp6(1),e.Q6J("ngIf","Polygon"===i.geomType),e.xp6(1),e.Q6J("ngIf",i.title))},dependencies:[x.ez,x.O5]}),r})(),et=(()=>{class r{constructor(){this.fillColorEvent=new e.vpe,this.strokeColorEvent=new e.vpe,this.strokeWidthEvent=new e.vpe}setFillColor(t){this.fillColor=t,this.fillColorEvent.emit(t)}setStrokeColor(t){this.strokeColor=t,this.strokeColorEvent.emit(t)}setStrokeWidth(t){this.strokeWidth=parseFloat(t),this.strokeWidthEvent.emit(this.strokeWidth)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-widget-color"]],inputs:{fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth"},outputs:{fillColorEvent:"fillColorEvent",strokeColorEvent:"strokeColorEvent",strokeWidthEvent:"strokeWidthEvent"},standalone:!0,features:[e.jDz],decls:30,vars:5,consts:[[1,"d-flex","flex-column","my-2"],[1,"fs-5"],[1,"d-flex","flex-row","ms-2","my-1"],[1,"fs-6","ms-2"],["type","color","id","fillColor",1,"fillColor","pointer","border-0",3,"value","change"],["layerFillColor",""],["for","fillColor"],["type","text","id","textFillColor",1,"fillColor","p-0","border-1",3,"value","change"],["textLayerFillColor",""],["for","textFillColor"],["type","color","id","strokeColor",1,"fillColor","pointer","border-0",3,"value","change"],["layerStrokeColor",""],["for","strokeColor"],["type","text","id","textStrokeColor",1,"fillColor","p-0","border-1",3,"value","change"],["textLayerStrokeColor",""],["for","textStrokeColor"],[1,"d-flex","flex-row","align-items-center","ms-2"],["type","number","min","0","max","12",1,"small","strokeWidth",3,"value","change"],["layerStrokeWidth",""]],template:function(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"div",0)(1,"span",1),e._uU(2,"Fond"),e.qZA(),e.TgZ(3,"div",2)(4,"span",3),e._uU(5,"Couleur :"),e.qZA(),e.TgZ(6,"input",4,5),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(7);return e.KtG(i.setFillColor(a.value))}),e.qZA(),e._UZ(8,"label",6),e.TgZ(9,"input",7,8),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(10);return e.KtG(i.setFillColor(a.value))}),e.qZA(),e._UZ(11,"label",9),e.qZA()(),e.TgZ(12,"div",0)(13,"span",1),e._uU(14,"Contour"),e.qZA(),e.TgZ(15,"div",2)(16,"span",3),e._uU(17,"Couleur :"),e.qZA(),e.TgZ(18,"input",10,11),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(19);return e.KtG(i.setStrokeColor(a.value))}),e.qZA(),e._UZ(20,"label",12),e.TgZ(21,"input",13,14),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(22);return e.KtG(i.setStrokeColor(a.value))}),e.qZA(),e._UZ(23,"label",15),e.qZA(),e.TgZ(24,"div",2)(25,"span",3),e._uU(26,"Epaisseur du contour :"),e.qZA(),e.TgZ(27,"div",16)(28,"input",17,18),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(29);return e.KtG(i.setStrokeWidth(a.value))}),e.qZA()()()()}2&t&&(e.xp6(6),e.Q6J("value",i.fillColor),e.xp6(3),e.Q6J("value",i.fillColor),e.xp6(9),e.Q6J("value",i.strokeColor),e.xp6(3),e.Q6J("value",i.strokeColor),e.xp6(7),e.Q6J("value",i.strokeWidth))},dependencies:[x.ez]}),r})();function ro(r,n){if(1&r&&(e.TgZ(0,"th",3),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.Oqu(t)}}function so(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"td")(1,"input",8,9),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.MAs(2),l=e.oxw().$implicit,c=e.oxw();return l.set(s,a.value,!1),e.KtG(c.sendEditedEvent())}),e.qZA()()}if(2&r){const t=n.$implicit,i=e.oxw().$implicit;e.xp6(1),e.Q6J("value",i.get(t))}}function ao(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"tr",6)(2,"th",7),e._uU(3),e.qZA(),e.YNc(4,so,3,1,"td",5),e.qZA(),e.BQk()),2&r){const t=n.$implicit,i=e.oxw();e.xp6(3),e.Oqu(t.get("no")),e.xp6(1),e.Q6J("ngForOf",i.attributesHeaders)}}let tt=(()=>{class r{constructor(){this.edited=new e.vpe}sendEditedEvent(){this.edited.emit(!0)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-widget-table"]],inputs:{attributesHeaders:"attributesHeaders",features:"features"},outputs:{edited:"edited"},standalone:!0,features:[e.jDz],decls:9,vars:2,consts:[[1,"m-2","table-responsive"],[1,"table","table-striped","table-hover","table-sm"],[1,"table-dark"],["scope","col"],["scope","col",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"small"],["scope","row",1,"p-1"],["type","text",1,"p-1",3,"value","change"],["rowInput",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"table",1)(2,"thead",2)(3,"tr")(4,"th",3),e._uU(5,"#"),e.qZA(),e.YNc(6,ro,2,1,"th",4),e.qZA()(),e.TgZ(7,"tbody"),e.YNc(8,ao,5,2,"ng-container",5),e.qZA()()()),2&t&&(e.xp6(6),e.Q6J("ngForOf",i.attributesHeaders),e.xp6(2),e.Q6J("ngForOf",i.features))},dependencies:[x.ez,x.sg],styles:["table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{position:relative}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:none;position:absolute;display:block;top:0;left:0;margin:0;height:100%;width:100%;border:none;padding:10px;box-sizing:border-box}"]}),r})();function lo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",9)(1,"div",10),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.removeFeature())}),e._UZ(2,"fa-icon",3),e.qZA(),e.TgZ(3,"div",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.showPopup())}),e._UZ(4,"fa-icon",12),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(2),e.Q6J("icon",t.disabledIcon),e.xp6(2),e.Q6J("icon",t.paramIcon)}}const co=function(r){return[r]};function uo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",14)(2,"div",15)(3,"strong"),e._uU(4),e.qZA(),e.TgZ(5,"em",16),e._uU(6),e.qZA(),e.TgZ(7,"em",17),e._uU(8),e.qZA(),e.TgZ(9,"button",18),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.showPopup())}),e.qZA()(),e.TgZ(10,"div",19)(11,"div",20)(12,"span",21),e._uU(13,"Actions :"),e.qZA(),e.TgZ(14,"span",22),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.copyToClipboard(o.getWktFromFeature()))}),e._uU(15," WKT "),e.qZA(),e.TgZ(16,"span",23),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.copyToClipboard(o.getBoundsFromFeature()))}),e._uU(17," Bbox "),e.qZA()(),e.TgZ(18,"div",24)(19,"span"),e._uU(20),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"span"),e._uU(23),e.ALo(24,"date"),e.qZA()(),e.TgZ(25,"app-widget-table",25),e.NdJ("edited",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.applyClassifiedStyle())}),e.qZA(),e.TgZ(26,"app-widget-color",26),e.NdJ("fillColorEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.feature.set("fill_color",o))})("strokeColorEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.feature.set("stroke_color",o))})("strokeWidthEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.feature.set("stroke_width",o))}),e.qZA()()()()}if(2&r){const t=e.oxw();e.Q6J("id","featurePopup"+t.feature.getId()),e.xp6(4),e.Oqu(t.feature.get("name")),e.xp6(2),e.hij("(",t.feature.get("geom_type"),")"),e.xp6(2),e.hij("Couche: ",t.layer.container.layerName,""),e.xp6(12),e.hij("Cr\xe9\xe9 \xe0 ",e.xi3(21,11,t.feature.get("created_at"),"HH:mm:ss"),""),e.xp6(3),e.hij("Modifi\xe9 \xe0 ",e.xi3(24,14,t.feature.get("updated_at"),"HH:mm:ss"),""),e.xp6(2),e.Q6J("attributesHeaders",t.layer.getAttributesHeader())("features",e.VKq(17,co,t.feature)),e.xp6(1),e.Q6J("fillColor",t.feature.get("fill_color"))("strokeColor",t.feature.get("stroke_color"))("strokeWidth",t.feature.get("stroke_width"))}}let ho=(()=>{class r{constructor(t){this.elementRef=t,this._strokeWidthCoeff=1.8,this._strokeWidthLineCoeff=1.2,this.disabledIcon=_t,this.duplicateIcon=pt,this.centerIcon=eo.H,this.paramIcon=ct,this.displayPopup=!1}ngOnInit(){}ngOnDestroy(){this.elementRef.nativeElement.remove()}set feature(t){this._feature=t,this._id=t.getId(),this._geometry=t.getGeometry()}get feature(){return this._feature}get id(){return this._id}get geometry(){return this._geometry}set selected(t){this.displayPopup=!1,this._selected=t}get selected(){return this._selected}removeFeature(){this.layer.container.removeFeature(this.id)}duplicateFeature(){this.layer.select.getFeatures().clear(),this.layer.container.duplicateFeature(this.id)}zoomToFeature(){this.layer.zoomToFeature(this.id)}showPopup(){this.displayPopup=!this.displayPopup}copyToClipboard(t){const i=document.createElement("textarea");i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.opacity="0",i.value=t,document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),document.body.removeChild(i)}getWktFromFeature(){return Ee(this.geometry)}getBoundsFromFeature(){return this.geometry.getExtent().join(", ")}applyClassifiedStyle(){const t=this.layer.container.propertyStyled;null!==t&&this.layer.container.styleSettings.forEach(i=>{this.feature.get(t)===i.class&&this.feature.set("fill_color",i.color)})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(e.SBq))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-feature"]],inputs:{layer:"layer",feature:"feature",selected:"selected"},decls:10,vars:10,consts:[[1,"feature-item","mx-4","py-1","d-flex","flex-row","align-items-center","align-items-around",3,"ngClass"],[1,"me-2","d-flex","flex-row"],["ngbPopover","Center sur l'object","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],[1,"",3,"icon"],["ngbPopover","Dupliquer l'object","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],[1,"pointer","w-100"],[3,"geomType","strokeColor","strokeWidth","fillColor","title"],["class","ms-auto d-flex flex-row align-items-center",4,"ngIf"],["class","featureToast position-fixed bottom-0 end-0 p-3 d-flex flex-row overflow-auto fw-normal pointer-none",3,"id",4,"ngIf"],[1,"ms-auto","d-flex","flex-row","align-items-center"],["ngbPopover","Supprimer l'object","triggers","mouseenter:mouseleave",1,"px-2","text-danger","pointer",3,"click"],["ngbPopover","Options de l'objet","triggers","mouseenter:mouseleave",1,"px-1","text-black","pointer",3,"click"],["size","1x",1,"",3,"icon"],[1,"featureToast","position-fixed","bottom-0","end-0","p-3","d-flex","flex-row","overflow-auto","fw-normal","pointer-none",3,"id"],["role","alert","aria-live","assertive","aria-atomic","true",1,"toast","toastFeature","faded"],[1,"toast-header","justify-content-between"],[1,"ms-1"],[1,"ms-auto"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"toast-body","bg-white"],["id","toastActions",1,"d-flex","flex-row","justify-content-start","align-items-center"],[1,"fw-bold"],["data-bs-toggle","tooltip","data-bs-placement","bottom","title","Copier le WKT",1,"badge","bg-dark","rounded","m-1","small","pointer",3,"click"],["data-bs-toggle","tooltip","data-bs-placement","bottom","title","Copier la Bbox (xmin, ymin, xmax, ymax)",1,"badge","bg-primary","rounded","m-1","small","pointer",3,"click"],[1,"d-flex","flex-row","justify-content-between"],[3,"attributesHeaders","features","edited"],[3,"fillColor","strokeColor","strokeWidth","fillColorEvent","strokeColorEvent","strokeWidthEvent"]],template:function(t,i){1&t&&(e.TgZ(0,"li",0)(1,"div",1)(2,"div",2),e.NdJ("click",function(){return i.zoomToFeature()}),e._UZ(3,"fa-icon",3),e.qZA(),e.TgZ(4,"div",4),e.NdJ("click",function(){return i.duplicateFeature()}),e._UZ(5,"fa-icon",3),e.qZA()(),e.TgZ(6,"div",5),e._UZ(7,"app-geom-icons",6),e.qZA(),e.YNc(8,lo,5,2,"div",7),e.qZA(),e.YNc(9,uo,27,19,"div",8)),2&t&&(e.Q6J("ngClass",i.selected?"fw-bold bg-secondary bg-opacity-25":""),e.xp6(3),e.Q6J("icon",i.centerIcon),e.xp6(2),e.Q6J("icon",i.duplicateIcon),e.xp6(2),e.Q6J("geomType",i.feature.get("geom_type"))("strokeColor",i.feature.get("stroke_color"))("strokeWidth",i.feature.get("stroke_width"))("fillColor",i.feature.get("fill_color"))("title",i.feature.get("name")),e.xp6(1),e.Q6J("ngIf",i.selected),e.xp6(1),e.Q6J("ngIf",i.displayPopup))},dependencies:[x.mk,x.O5,A.BN,F.o8,$e,et,tt,x.uU],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer-none[_ngcontent-%COMP%]{cursor:auto}.feature[_ngcontent-%COMP%]:hover{font-weight:700}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.feature-item[_ngcontent-%COMP%]:hover{background-color:#0000001a}@keyframes _ngcontent-%COMP%_featureColorTransition{0%{background-color:var(--bs-secondary)}to{background-color:var(--bs-light)}}"]}),r})();function go(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"input",7,21),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(2),s=e.oxw(2);return e.KtG(s.translateHandler(o.checked))}),e.qZA(),e.TgZ(3,"label",22)(4,"div",10),e._UZ(5,"fa-icon",11),e.qZA()(),e.BQk()}if(2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("id","btnMove"+t.layer.container.uuid)("checked",t.isMoved),e.xp6(2),e.Q6J("for","btnMove"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngClass",t.isMoved?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.moveIcon)}}function po(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"input",7,23),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(2),s=e.oxw(2);return e.KtG(s.drawHoleHandler(o.checked,!0))}),e.qZA(),e.TgZ(3,"label",24)(4,"div",10),e._UZ(5,"fa-icon",11),e.qZA()(),e.BQk()}if(2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("id","btnHole"+t.layer.container.uuid)("checked",t.isHole),e.xp6(2),e.Q6J("for","btnHole"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngClass",t.isHole?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.polygonIcon)}}const fo=function(){return["Polygon","LineString"]},mo=function(){return["Polygon"]};function _o(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"input",7,8),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(3),s=e.oxw();return e.KtG(s.drawHandler(o.checked))}),e.qZA(),e.TgZ(4,"label",9)(5,"div",10),e._UZ(6,"fa-icon",11),e.qZA()()(),e.TgZ(7,"div",6),e.YNc(8,go,6,5,"ng-container",12),e.TgZ(9,"input",7,13),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(10),s=e.oxw();return e.KtG(s.editHandler(o.checked))}),e.qZA(),e.TgZ(11,"label",14)(12,"div",10),e._UZ(13,"fa-icon",11),e.qZA()(),e.YNc(14,po,6,5,"ng-container",12),e.TgZ(15,"input",15,16),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(16),s=e.oxw();return e.KtG(s.snappingHandler(o.checked))}),e.qZA(),e.TgZ(17,"label",17)(18,"div",18),e._UZ(19,"fa-icon",19),e.qZA()()(),e.TgZ(20,"div",6),e.ynx(21),e.TgZ(22,"button",20),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.computeBoundingBox())}),e._UZ(23,"fa-icon",11),e.qZA(),e.BQk(),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(2),e.Q6J("id","btnDraw"+t.layer.container.uuid)("checked",t.isDrawn),e.xp6(2),e.Q6J("for","btnDraw"+t.layer.container.uuid)("ngbPopover","Ajouter un objet de type '"+t.layer.container.geomType+"'"),e.xp6(1),e.Q6J("ngClass",t.isDrawn?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.addIcon),e.xp6(2),e.Q6J("ngIf",e.DdM(20,fo).includes(t.layer.container.geomType)),e.xp6(1),e.Q6J("id","btnEdit"+t.layer.container.uuid)("checked",t.isEdited),e.xp6(2),e.Q6J("for","btnEdit"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngClass",t.isEdited?"btn-outline-danger":""),e.xp6(1),e.Q6J("icon",t.editIcon),e.xp6(1),e.Q6J("ngIf",e.DdM(21,mo).includes(t.layer.container.geomType)),e.xp6(1),e.Q6J("disabled",t.editing)("checked",t.isSnapped),e.xp6(3),e.ekj("disabled",t.editing),e.Q6J("ngClass",t.isSnapped?"btn-outline-danger":"btn-outline-dark"),e.xp6(1),e.Q6J("icon",t.snapIcon),e.xp6(4),e.Q6J("icon",t.centerIcon)}}let yo=(()=>{class r{constructor(t){this.editComputingService=t,this.addIcon=at,this.editIcon=lt,this.polygonIcon=te,this.moveIcon=ln,this.centerIcon=Ze,this.snapIcon=hn,this.isDrawn=!1,this.isEdited=!1,this.isHole=!1,this.isMoved=!1,this.isShortestPath=!1,this.editing=!1,this.isSnapped=!1,this.epsgAvailable=["EPSG:4326","EPSG:3857"],this.strInputDataValues=null,this.strInputEspgInput=null}ngOnInit(){}ngOnDestroy(){this.disableEditing()}set layer(t){this._layer=t}get layer(){return this._layer}set edited(t){t||this.disableEditing(),this._edited=t}get edited(){return this._edited}enableSnapModeOnAllOthersLayers(){this.isSnapped&&this.editComputingService.activateSnapping(!0)}disableSnapModeOnAllOthersLayers(){this.isSnapped&&this.editComputingService.activateSnapping(!1)}snappingHandler(t){this.isSnapped=t,t||this.disableSnapModeOnAllOthersLayers()}disableEditing(t=!0){this.drawHoleHandler(!1),this.drawHandler(!1),this.editHandler(!1),this.translateHandler(!1),this.disableSnapModeOnAllOthersLayers(),t&&this.unSelectFeature()}unSelectFeature(){this.layer.select.getFeatures().clear()}translateHandler(t){t?(this.disableEditing(!1),this.translateFeatureEnable()):this.translateFeatureDisable()}editHandler(t){t?(this.disableEditing(!1),this.editFeatureEnable(),this.enableSnapModeOnAllOthersLayers()):(this.editFeatureDisable(),this.disableSnapModeOnAllOthersLayers())}drawHandler(t,i=!1){t?(this.disableEditing(!1),this.addFeatureEnable(i),this.enableSnapModeOnAllOthersLayers()):(this.addFeatureDisable(),this.disableSnapModeOnAllOthersLayers())}drawHoleHandler(t,i=!0){t?(this.disableEditing(!1),this.addHoleFeatureEnable(i),this.enableSnapModeOnAllOthersLayers()):(this.addHoleFeatureDisable(),this.disableSnapModeOnAllOthersLayers())}translateFeatureEnable(){this.layer.enableTranslating(),this.isMoved=!0,this.editing=!0}translateFeatureDisable(){this.layer.disableTranslating(),this.isMoved=!1,this.editing=!1}addFeatureEnable(t=!1){this.layer.enableDrawing(t),this.isDrawn=!0,this.editing=!0}addFeatureDisable(){this.layer.disableDrawing(),this.isDrawn=!1,this.editing=!1}editFeatureEnable(){this.layer.enableEditing(),this.isEdited=!0,this.editing=!0}editFeatureDisable(){this.layer.disableEditing(),this.isEdited=!1,this.editing=!1}addHoleFeatureEnable(t=!0){this.layer.enableDrawing(t),this.isHole=!0,this.editing=!0}addHoleFeatureDisable(){this.layer.disableDrawing(),this.isHole=!1,this.editing=!1}computeBoundingBox(){this.layer.container.features.length>0&&this.editComputingService.addNewFeatures(this.layer.exportBoundsPolygon())}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(Fe))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-edit-bar"]],inputs:{currentEpsg:"currentEpsg",layer:"layer",edited:"edited"},decls:7,vars:3,consts:[[1,"d-flex","flex-column","editTools","bg-dark","bg-gradient","p-2","m-2","rounded-3","shadow"],[1,"d-flex","flex-row","align-items-center","justify-content-center","text-warning","m-1"],[1,"fw-bold","me-1"],[1,"fst-italic"],["class","d-flex flex-row align-items-center",4,"ngIf"],[1,"d-flex","flex-row","align-items-center"],[1,"d-flex","flex-row","m-1","shadow","border","rounded","bg-light"],["type","checkbox",1,"btn-check",3,"id","checked","click"],["btnDraw",""],["triggers","mouseenter:mouseleave",3,"for","ngbPopover"],[1,"btn","btn-outline-success","m-1",3,"ngClass"],[3,"icon"],[4,"ngIf"],["btnEdit",""],["ngbPopover","Editer","triggers","mouseenter:mouseleave",3,"for"],["type","checkbox","id","btnSnap",1,"btn-check",3,"disabled","checked","click"],["btnSnap",""],["for","btnSnap","container","body","ngbPopover","Activer le snapping","triggers","mouseenter:mouseleave"],[1,"btn","m-1",3,"ngClass"],["size","xs",3,"icon"],["ngbPopover","La bounding box","triggers","mouseenter:mouseleave",1,"btn","btn-outline-success","m-1",3,"click"],["btnMove",""],["ngbPopover","D\xe9placer","triggers","mouseenter:mouseleave",3,"for"],["btnHole",""],["ngbPopover","Ajouter un trou","triggers","mouseenter:mouseleave",3,"for"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3),e.qZA(),e.TgZ(4,"span",3),e._uU(5),e.qZA()(),e.YNc(6,_o,24,22,"div",4),e.qZA()),2&t&&(e.xp6(3),e.Oqu(i.layer.container.layerName),e.xp6(2),e.hij("(",i.layer.container.geomType,")"),e.xp6(1),e.Q6J("ngIf",i.edited))},dependencies:[x.mk,x.O5,A.BN,F.o8]}),r})();function Co(r,n){if(1&r&&(e.TgZ(0,"option"),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.Oqu(t)}}function xo(r,n){if(1&r&&(e.TgZ(0,"option"),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.Oqu(t)}}function To(r,n){1&r&&(e.TgZ(0,"span",27),e._uU(1,"Classes :"),e.qZA())}function vo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",28)(1,"span",29),e._uU(2),e.qZA(),e.TgZ(3,"div",30)(4,"input",31,32),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.MAs(5),l=e.oxw(),c=e.MAs(35);return e.KtG(l.changeCategoryClassStyle(c.value,s.class,a.value))}),e.qZA(),e._UZ(6,"label",33),e.TgZ(7,"input",34,35),e.NdJ("change",function(){const s=e.CHM(t).$implicit,a=e.MAs(5),l=e.oxw(),c=e.MAs(35);return e.KtG(l.changeCategoryClassStyle(c.value,s.class,a.value))}),e.qZA(),e._UZ(9,"label",36),e.qZA()()}if(2&r){const t=n.$implicit;e.xp6(2),e.Oqu(t.class),e.xp6(2),e.Q6J("value",t.color),e.xp6(3),e.Q6J("value",t.color)}}let bo=(()=>{class r{constructor(){this.propertiesStylingClassified=[]}ngOnInit(){}set layer(t){this._layer=t}get layer(){return this._layer}getFeatures(){return this.layer.container.features}addField(t){this.layer.setAttribute(t,null)}updateField(t,i){"number"==typeof i&&(i=+i),this.layer.setAttribute(t,i)}removeField(t){this.layer.removeAttribute(t)}refreshTable(){this.getFeatures()}setCategoryClassesStyling(t){this.propertiesStylingClassified=[];let i=[];this.layer.container.features.forEach(o=>{const s=o.get(t);i.includes(s)||i.push(s)}),i.forEach(o=>{const s=Lt();this.propertiesStylingClassified.push({class:o,color:s})}),this.applyClassifiedStyle(t)}changeCategoryClassStyle(t,i,o){this.propertiesStylingClassified.forEach(s=>{s.class===i&&(s.color=o)}),this.applyClassifiedStyle(t)}applyClassifiedStyle(t){this.propertiesStylingClassified.forEach(i=>{this.layer.container.features.forEach(o=>{o.get(t)===i.class&&o.set("fill_color",i.color)})}),this.layer.container.propertyStyled=t,this.layer.container.styleSettings=this.propertiesStylingClassified}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-layer-table"]],inputs:{layer:"layer"},decls:43,vars:10,consts:[["role","tablist",1,"nav","nav-pills","align-items-center","justify-content-center","mt-2","mb-3"],["role","presentation",1,"nav-item","border","m-1"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold","active"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold"],["id","'StylingTabContent' + layer.container.id",1,"d-flex","flex-row","mx-2","tab-content"],["role","tabpanel",1,"tab-pane","fade","w-100","show","active",3,"id"],[1,"d-flex","flex-row"],[1,"input-group","m-2"],["type","text","placeholder","Ajouter un champs","aria-label","Ajouter un champs","aria-describedby","btn-add-field",1,"form-control"],["fieldToAdd",""],["type","button","id","btn-add-field",1,"btn","btn-success",3,"click"],["type","text","placeholder","Supprimer un champs","aria-label","Supprimer un champs","aria-describedby","btn-rm-field",1,"form-control"],["fieldToRm",""],["type","button","id","btn-rm-field",1,"btn","btn-danger",3,"click"],[1,"input-group-text"],["aria-label","Champs",1,"form-select"],["fieldSelected",""],[4,"ngFor","ngForOf"],["type","text","placeholder","D\xe9finir une valeur","aria-label","Valeur","aria-describedby","btn-field-value",1,"form-control"],["fieldValue",""],["type","button","id","btn-field-value",1,"btn","btn-warning",3,"click"],["role","tabpanel",1,"m-2","tab-pane","fade","w-100","show",3,"id"],[1,"input-group","mb-3"],["fieldClassifiedSelected",""],["class","fs-4",4,"ngIf"],["class","d-flex flex-row ms-2",4,"ngFor","ngForOf"],[3,"attributesHeaders","features","edited"],[1,"fs-4"],[1,"d-flex","flex-row","ms-2"],[1,"w-25"],[1,"d-flex","flex-row","align-items-center"],["type","color","id","strokeColor",1,"fillColor","pointer","border-0",3,"value","change"],["layerStrokeColor",""],["for","strokeColor"],["type","text","id","textStrokeColor",1,"fillColor","p-0","border-1",3,"value","change"],["textLayerStrokeColor",""],["for","textStrokeColor"]],template:function(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"ul",0)(1,"li",1)(2,"a",2),e._uU(3," Modification des attributs "),e.qZA()(),e.TgZ(4,"li",1)(5,"a",3),e._uU(6," Application de style "),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7),e._UZ(11,"input",8,9),e.TgZ(13,"button",10),e.NdJ("click",function(){e.CHM(o);const a=e.MAs(12);return e.KtG(i.addField(a.value))}),e._uU(14,"Ajouter"),e.qZA()(),e.TgZ(15,"div",7),e._UZ(16,"input",11,12),e.TgZ(18,"button",13),e.NdJ("click",function(){e.CHM(o);const a=e.MAs(17);return e.KtG(i.removeField(a.value))}),e._uU(19,"Supprimer"),e.qZA()()(),e.TgZ(20,"div",7)(21,"span",14),e._uU(22,"S\xe9lection du champ"),e.qZA(),e.TgZ(23,"select",15,16),e.YNc(25,Co,2,1,"option",17),e.qZA(),e._UZ(26,"input",18,19),e.TgZ(28,"button",20),e.NdJ("click",function(){e.CHM(o);const a=e.MAs(24),l=e.MAs(27);return e.KtG(i.updateField(a.value,l.value))}),e._uU(29,"Mettre \xe0 jour"),e.qZA()()(),e.TgZ(30,"div",21)(31,"div",22)(32,"span",14),e._uU(33,"Classification par cat\xe9gories"),e.qZA(),e.TgZ(34,"select",15,23),e.YNc(36,xo,2,1,"option",17),e.qZA(),e.TgZ(37,"button",20),e.NdJ("click",function(){e.CHM(o);const a=e.MAs(35);return e.KtG(i.setCategoryClassesStyling(a.value))}),e._uU(38,"Appliquer"),e.qZA()(),e.TgZ(39,"div"),e.YNc(40,To,2,0,"span",24),e.YNc(41,vo,10,3,"div",25),e.qZA()()(),e.TgZ(42,"app-widget-table",26),e.NdJ("edited",function(){e.CHM(o);const a=e.MAs(35);return e.KtG(i.applyClassifiedStyle(a.value))}),e.qZA()}2&t&&(e.xp6(2),e.uIk("data-bs-target","#attributesChanges"+i.layer.container.uuid),e.xp6(3),e.uIk("data-bs-target","#styleApplying"+i.layer.container.uuid),e.xp6(3),e.Q6J("id","attributesChanges"+i.layer.container.uuid),e.xp6(17),e.Q6J("ngForOf",i.layer.getAttributesHeader()),e.xp6(5),e.Q6J("id","styleApplying"+i.layer.container.uuid),e.xp6(6),e.Q6J("ngForOf",i.layer.getAttributesHeader()),e.xp6(4),e.Q6J("ngIf",i.propertiesStylingClassified.length>0),e.xp6(1),e.Q6J("ngForOf",i.propertiesStylingClassified),e.xp6(1),e.Q6J("attributesHeaders",i.layer.getAttributesHeader())("features",i.getFeatures()))},dependencies:[x.sg,x.O5,D.YN,D.Kr,tt],styles:["table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{position:relative}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:none;position:absolute;display:block;top:0;left:0;margin:0;height:100%;width:100%;border:none;padding:10px;box-sizing:border-box}"]}),r})();function wo(r,n){1&r&&e.GkF(0)}const nt=function(r){return{layerObject:r}};function Po(r,n){if(1&r&&(e.TgZ(0,"div",9),e.YNc(1,wo,1,0,"ng-container",10),e.qZA()),2&r){const t=e.oxw(),i=e.MAs(16);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,nt,t.layer))}}function Eo(r,n){1&r&&e.GkF(0)}function Fo(r,n){if(1&r&&(e.TgZ(0,"div",9),e.YNc(1,Eo,1,0,"ng-container",10),e.qZA()),2&r){const t=e.oxw(),i=e.MAs(18);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,nt,t.layer))}}function So(r,n){1&r&&e.GkF(0)}function Lo(r,n){if(1&r&&(e.TgZ(0,"div",9),e.YNc(1,So,1,0,"ng-container",10),e.qZA()),2&r){const t=e.oxw(),i=e.MAs(20);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,nt,t.layer))}}function Mo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"span",11),e._uU(1,"Informations g\xe9n\xe9rales"),e.qZA(),e.TgZ(2,"div",12)(3,"div",13)(4,"span",14),e._uU(5,"Nom de la couche :"),e.qZA(),e.TgZ(6,"input",15,16),e.NdJ("change",function(){e.CHM(t);const o=e.MAs(7),s=e.oxw();return e.KtG(s.layer.container.layerName=o.value)}),e.qZA()(),e.TgZ(8,"div",13)(9,"span",14),e._uU(10,"Type de la g\xe9om\xe9trie :"),e.qZA(),e.TgZ(11,"span"),e._uU(12),e.qZA()(),e.TgZ(13,"div",17)(14,"span",18),e._uU(15,"Bounding box de la couche:"),e.qZA(),e.TgZ(16,"span",19),e._uU(17),e.qZA(),e.TgZ(18,"span",19),e._uU(19),e.qZA()()(),e.TgZ(20,"span",11),e._uU(21,"Style global de la couche"),e.qZA(),e.TgZ(22,"div",12)(23,"div",17)(24,"span",14),e._uU(25,"Opacit\xe9 :"),e.qZA(),e.TgZ(26,"div",20)(27,"input",21,22),e.NdJ("change",function(){e.CHM(t);const o=e.MAs(28),s=e.oxw();return e.KtG(s.layer.container.opacity=o.value)}),e.qZA()()(),e.TgZ(29,"app-widget-color",23),e.NdJ("fillColorEvent",function(o){e.CHM(t);const s=e.oxw();return s.layer.container.fillColor=o,e.KtG(s.setDefaultStyle())})("strokeColorEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.layer.container.strokeColor=o)})("strokeWidthEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.layer.container.strokeWidth=o)}),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(6),e.Q6J("placeholder",t.layer.container.layerName),e.xp6(6),e.Oqu(t.layer.container.geomType),e.xp6(5),e.AsE("x min, x max: ",t.layer.exportBounds()[0],", ",t.layer.exportBounds()[2],""),e.xp6(2),e.AsE("y min, y max: ",t.layer.exportBounds()[1],", ",t.layer.exportBounds()[3],""),e.xp6(8),e.Q6J("value",t.layer.container.opacity),e.xp6(2),e.Q6J("fillColor",t.layer.container.fillColor)("strokeColor",t.layer.container.strokeColor)("strokeWidth",t.layer.container.strokeWidth)}}function ko(r,n){if(1&r&&e._UZ(0,"app-layer-table",24),2&r){const t=e.oxw();e.Q6J("layer",t.layer)}}function Io(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"span",11),e._uU(1,"Exportation des donn\xe9es"),e.qZA(),e.TgZ(2,"ul",25)(3,"li",26)(4,"a",27),e._uU(5," GeoJSON "),e.qZA()(),e.TgZ(6,"li",26)(7,"a",28),e._uU(8," WKT "),e.qZA()(),e.TgZ(9,"li",26)(10,"a",28),e._uU(11," Pytest Fixtures "),e.qZA()()(),e.TgZ(12,"div",29)(13,"div",30)(14,"textarea",31,32),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(15);return e.KtG(o.select())}),e._uU(16),e.qZA()(),e.TgZ(17,"div",33)(18,"textarea",31,34),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(19);return e.KtG(o.select())}),e._uU(20),e.qZA()(),e.TgZ(21,"div",33)(22,"textarea",31,35),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(23);return e.KtG(o.select())}),e._uU(24),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(4),e.uIk("data-bs-target","#GeoJsonTab"+t.layer.container.uuid),e.xp6(3),e.uIk("data-bs-target","#wktTab"+t.layer.container.uuid),e.xp6(3),e.uIk("data-bs-target","#pytestFixture"+t.layer.container.uuid),e.xp6(3),e.Q6J("id","GeoJsonTab"+t.layer.container.uuid),e.xp6(3),e.Oqu(t.layer.exportToGeoJSON()),e.xp6(1),e.Q6J("id","wktTab"+t.layer.container.uuid),e.xp6(3),e.Oqu(t.layer.exportToWkt()),e.xp6(1),e.Q6J("id","pytestFixture"+t.layer.container.uuid),e.xp6(3),e.Oqu(t.layer.exportToPytestFixture())}}let Zo=(()=>{class r{ngOnInit(){this.setDefaultStyle()}set layer(t){this._layer=t}get layer(){return this._layer}setDefaultStyle(){this.layer.container.propertyStyled=null,this.layer.container.styleSettings=[{class:"default",color:this.layer.container.fillColor}]}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-layer-settings"]],inputs:{layer:"layer"},decls:21,vars:1,consts:[["ngbNav","",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem",""],["ngbNavLink","",1,"fw-bold"],["ngbNavContent",""],[1,"nav-content","mx-2",3,"ngbNavOutlet"],["ngNavLayerGeneral",""],["ngNavLayerAttributes",""],["ngNavLayerExporting",""],[1,"d-flex","flex-column"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"fs-4","my-2"],[1,"d-flex","flex-column","ms-3"],[1,"d-flex","flex-row","align-items-center","my-2"],[1,"fs-5","me-2"],["type","text","aria-label","layerName",1,"form-control","w-50",3,"placeholder","change"],["layerName",""],[1,"d-flex","flex-column","my-2"],[1,"fs-5"],[1,"ms-3"],[1,"d-flex","flex-row","align-items-center","ms-2"],["id","","type","range","min","0","max","1","step","0.1",1,"small","opacity-setter",3,"value","change"],["opacityInput",""],[3,"fillColor","strokeColor","strokeWidth","fillColorEvent","strokeColorEvent","strokeWidthEvent"],[3,"layer"],["role","tablist",1,"nav","nav-pills","align-items-center","justify-content-center"],["role","presentation",1,"nav-item","border","m-1"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold","active"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold"],["id","'tabContent' + layer.container.id",1,"d-flex","flex-row","mx-2","tab-content"],["role","tabpanel",1,"tab-pane","fade","w-100","show","active",3,"id"],["aria-label","With textarea","readonly","",1,"form-control","vh-100",3,"click"],["exportGeoJsonStringGeomDiv",""],["role","tabpanel",1,"tab-pane","fade","w-100","show",3,"id"],["exportWktStringGeomDiv",""],["exportPytestFixturesGeomDiv",""]],template:function(t,i){if(1&t&&(e.TgZ(0,"ul",0,1)(2,"li",2)(3,"a",3),e._uU(4,"G\xe9n\xe9ral"),e.qZA(),e.YNc(5,Po,2,4,"ng-template",4),e.qZA(),e.TgZ(6,"li",2)(7,"a",3),e._uU(8,"Attributs"),e.qZA(),e.YNc(9,Fo,2,4,"ng-template",4),e.qZA(),e.TgZ(10,"li",2)(11,"a",3),e._uU(12,"Exporter"),e.qZA(),e.YNc(13,Lo,2,4,"ng-template",4),e.qZA()(),e._UZ(14,"div",5),e.YNc(15,Mo,30,10,"ng-template",null,6,e.W1O),e.YNc(17,ko,1,1,"ng-template",null,7,e.W1O),e.YNc(19,Io,25,9,"ng-template",null,8,e.W1O)),2&t){const o=e.MAs(1);e.xp6(14),e.Q6J("ngbNavOutlet",o)}},dependencies:[x.tP,F.uN,F.Pz,F.nv,F.Is,F.Vx,F.tO,F.Dy,et,bo]}),r})();const Go=["modalLayerSettings"],Ao=["modalLayerTable"];function Oo(r,n){if(1&r&&e._UZ(0,"fa-icon",23),2&r){const t=e.oxw();e.Q6J("icon",t.pointIcon)}}function No(r,n){if(1&r&&e._UZ(0,"fa-icon",23),2&r){const t=e.oxw();e.Q6J("icon",t.lineStringIcon)}}function Do(r,n){if(1&r&&e._UZ(0,"fa-icon",23),2&r){const t=e.oxw();e.Q6J("icon",t.polygonIcon)}}function Jo(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-feature",34),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.selectFeatureById(s.get("id")))}),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("selected",i.featuresIdSelected.includes(t.get("id")))("feature",t)("layer",i.layer)}}function Ro(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",24)(1,"div",25)(2,"div",26),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.zoomToLayer())}),e._UZ(3,"fa-icon",6),e.qZA(),e.TgZ(4,"div",27),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.duplicateLayer())}),e._UZ(5,"fa-icon",6),e.qZA(),e.TgZ(6,"div",28),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.toggleFeatures())}),e._UZ(7,"fa-icon",6),e.qZA(),e.TgZ(8,"div",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.unSelectFeatures())}),e._UZ(9,"fa-icon",30),e.TgZ(10,"span"),e._uU(11),e.qZA()(),e.TgZ(12,"div",31),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.removeLayer())}),e._UZ(13,"fa-icon",6),e.qZA()(),e.TgZ(14,"ul",32),e.YNc(15,Jo,2,3,"ng-container",33),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(3),e.Q6J("icon",t.centerIcon),e.xp6(2),e.Q6J("icon",t.duplicateIcon),e.xp6(2),e.Q6J("icon",t.toggled?t.toggleIcon:t.unToggleIcon),e.xp6(2),e.Q6J("icon",t.clearIcon),e.xp6(2),e.AsE("",t.featuresIdSelected.length," / ",t.layer.container.features.length," s\xe9lectionn\xe9(s)"),e.xp6(1),e.Q6J("ngClass",t.locked?"pe-none":"pe-auto"),e.xp6(1),e.Q6J("icon",t.removeIcon),e.xp6(1),e.Q6J("hidden",t.toggled)("id","featuresLayer-"+t.layer.container.uuid),e.xp6(1),e.Q6J("ngForOf",t.layer.container.features)}}function jo(r,n){if(1&r&&e._UZ(0,"app-edit-bar",37),2&r){const t=e.oxw(2);e.Q6J("layer",t.layer)("edited",!t.locked&&t.selected)("currentEpsg",t.epsg)}}function Uo(r,n){if(1&r&&(e.TgZ(0,"div",35),e.YNc(1,jo,1,3,"app-edit-bar",36),e.qZA()),2&r){const t=e.oxw();e.Q6J("isRemoved",t.isLayerRemoved),e.xp6(1),e.Q6J("ngIf",t.selected)}}let Ho=(()=>{class r{constructor(t,i,o){this.elementRef=t,this.interactionsService=i,this.editComputingService=o,this.layerMoveUp=new e.vpe,this.layerMoveDown=new e.vpe,this.layerCloned=new e.vpe,this.removeLayerId=new e.vpe,this.groupIcon=gn,this.helpIcon=pn,this.addIcon=at,this.editIcon=lt,this.paramIcon=ct,this.clearIcon=fn,this.removeIcon=mn,this.pointIcon=ke,this.lineStringIcon=Ie,this.polygonIcon=te,this.visibleIcon=ht,this.invisibleIcon=gt,this.upIcon=_n,this.downIcon=yn,this.duplicateIcon=pt,this.centerIcon=Ze,this.lockIcon=dt,this.unLockIcon=ut,this.unToggleIcon=ft,this.toggleIcon=mt,this._selected=!1,this.featuresIdSelected=[],this.isLayerRemoved=!1,this.exportData="",this.exportDataMode="geojson",this.removeLayerSubscription=this.interactionsService.removeLayers.subscribe(s=>{this.removeLayer()}),this.featureIdEditedSubscription=this.editComputingService.snappingLayerEnabled.subscribe(s=>{s?this.layer.enableSnapping():this.layer.disableSnapping()})}openSettings(){var t=this;return Se(function*(){return yield t.modalLayerSettingComponent.open()})()}openTable(){var t=this;return Se(function*(){return yield t.modalLayerTableComponent.open()})()}ngOnInit(){this.layer.enableSelecting(),this.layerSelectConfigured(),this.layer.container.sourceFeatures.on("changefeature",t=>{Wt(t.feature)}),this.zoomToLayer()}ngOnDestroy(){this.isLayerRemoved=!0;let t=document.getElementById("modalWktLayer-"+this.layer.container.uuid);null!==t&&t.remove(),this.removeLayerSubscription.unsubscribe(),this.featureIdEditedSubscription.unsubscribe(),this.layer.disableSelecting(),this.elementRef.nativeElement.remove()}toggleFeatures(){this.toggled=!this.toggled}set layer(t){this._layer=t}get layer(){return this._layer}set epsg(t){t!==this._epsg&&void 0!==this._epsg&&this.layer.container.features.forEach(i=>{i.setGeometry(i.getGeometry().transform(this._epsg,t))}),this._epsg=t}get epsg(){return this._epsg}set visible(t){this.layer.container.visible=t}get visible(){return this.layer.container.visible}set locked(t){this.layer.container.locked=t}get locked(){return this.layer.container.locked}set toggled(t){this.layer.container.featuresToggled=t}get toggled(){return this.layer.container.featuresToggled}set selected(t){t?this.selectLayer():this.unSelectFeatures(),this._selected=t}get selected(){return this._selected}layerSelectConfigured(){this.layer.select.on("select",t=>{let i=t.deselected,o=t.selected;t.mapBrowserEvent.originalEvent.shiftKey?o.forEach(s=>{this.featuresIdSelected.push(s.get("id")),this.layer.select.getFeatures().push(s),this.selectLayer()}):(i.length>0&&this.unSelectFeatures(),0==o.length&&(this.selected=!1),0==i.length&&(this.selected=!0),o.length>0&&o.forEach(s=>{this.featuresIdSelected.push(s.get("id")),this.layer.select.getFeatures().push(s)}))})}removeLayer(){this.layer.removeLayer(),this.removeLayerId.emit(this.layer.container.uuid),this.ngOnDestroy()}layerGoUp(){this.layerMoveUp.emit(this.layer.container.uuid)}layerGoDown(){this.layerMoveDown.emit(this.layer.container.uuid)}selectLayer(){this.interactionsService.sendSelectedLayerId(this.layer.container.uuid)}unSelectLayer(){this.interactionsService.sendSelectedLayerId(null)}zoomToLayer(){this.layer.zoomToLayer()}duplicateLayer(){this.unSelectFeatures();const t=Object.create(this.layer);this.layerCloned.emit(t)}unSelectFeatures(){this.featuresIdSelected=[],this.layer.select.getFeatures().clear()}selectFeatureById(t){this.unSelectFeatures(),this.featuresIdSelected.push(t);let i=this.getFeature(t);this.layer.select.getFeatures().push(i),this.selected=!0}getFeature(t){let i=this.layer.container.features.filter(o=>o.getId()===t);return 1===i.length?i[0]:null}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(e.SBq),e.Y36(Ae),e.Y36(Fe))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-layer"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Go,5),e.Gf(Ao,5)),2&t){let o;e.iGM(o=e.CRH())&&(i.modalLayerSettingComponent=o.first),e.iGM(o=e.CRH())&&(i.modalLayerTableComponent=o.first)}},inputs:{layer:"layer",epsg:"epsg",visible:"visible",locked:"locked",toggled:"toggled",selected:"selected"},outputs:{layerMoveUp:"layerMoveUp",layerMoveDown:"layerMoveDown",layerCloned:"layerCloned",removeLayerId:"removeLayerId"},decls:31,vars:24,consts:[[1,"layer","d-flex","flex-column","m-1","p-1","align-items-around"],[1,"header","d-flex","flex-row","align-items-center","rounded","border","p-1","pointer","shadow",3,"ngClass","click"],[1,"d-flex","flex-row","justify-content-start","align-items-center","me-1"],["type","checkbox",1,"btn-check",3,"id","checked","change"],["btnVisible",""],["container","body","triggers","mouseenter:mouseleave",1,"p-1","pointer",3,"for","ngClass","ngbPopover"],[1,"",3,"icon"],["btnLocked",""],["container","body","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","pointer",3,"for","ngbPopover"],[1,"d-flex","flex-row","justify-content-center","align-items-center",3,"ngClass"],["container","body","ngbPopover","Remonter","triggers","mouseenter:mouseleave",1,"text-danger","m-1",3,"click"],["container","body","ngbPopover","Descendre","triggers","mouseenter:mouseleave",1,"text-danger","m-1",3,"click"],[1,"d-flex","flex-row","pointer","justify-content-center","align-items-center","w-50","flex-fill"],[1,"me-2"],[3,"icon",4,"ngIf"],[1,"layer-name","fw-bold"],["ngbPopover","Options de la couche","triggers","mouseenter:mouseleave",1,"px-1","text-black",3,"click"],["size","1x",1,"",3,"icon"],["class","feature-container d-flex flex-column small",4,"ngIf"],["moveDivToBody","","class","position-fixed bottom-0 start-50 translate-middle-x",3,"isRemoved",4,"ngIf"],[3,"title"],["modalLayerSettings",""],[3,"layer"],[3,"icon"],[1,"feature-container","d-flex","flex-column","small"],[1,"d-flex","flex-row","justify-content-around","align-items-center","flex-fill","pt-1","mx-2","px-3","pb-1","border-secondary","border-opacity-10","rounded-bottom","bg-secondary","bg-opacity-10"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],["ngbPopover","Dupliquer","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],["ngbPopover","Masquer les objets","triggers","mouseenter:mouseleave",1,"pointer","px-1",3,"click"],["ngbPopover","D\xe9s\xe9lectionner","triggers","mouseenter:mouseleave",1,"pointer","ms-auto",3,"click"],[1,"me-1",3,"icon"],["ngbPopover","Supprimer","triggers","mouseenter:mouseleave",1,"pointer","ms-auto","px-1","text-danger",3,"ngClass","click"],["id","featuresList",1,"list-unstyled","my-1","h-25",3,"hidden","id"],[4,"ngFor","ngForOf"],[3,"selected","feature","layer","click"],["moveDivToBody","",1,"position-fixed","bottom-0","start-50","translate-middle-x",3,"isRemoved"],["class","",3,"layer","edited","currentEpsg",4,"ngIf"],[1,"",3,"layer","edited","currentEpsg"]],template:function(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"div",0)(1,"div",1),e.NdJ("click",function(){return i.selected=!0}),e.TgZ(2,"div",2)(3,"input",3,4),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(4);return e.KtG(i.visible=a.checked)}),e.qZA(),e.TgZ(5,"label",5),e._UZ(6,"fa-icon",6),e.qZA(),e.TgZ(7,"input",3,7),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(8);return e.KtG(i.locked=a.checked)}),e.qZA(),e.TgZ(9,"label",8),e._UZ(10,"fa-icon",6),e.qZA(),e.TgZ(11,"div",9)(12,"div",10),e.NdJ("click",function(){return i.layerGoUp()}),e._UZ(13,"fa-icon",6),e.qZA(),e.TgZ(14,"div",11),e.NdJ("click",function(){return i.layerGoDown()}),e._UZ(15,"fa-icon",6),e.qZA()()(),e.TgZ(16,"div",12)(17,"div",13),e.YNc(18,Oo,1,1,"fa-icon",14),e.YNc(19,No,1,1,"fa-icon",14),e.YNc(20,Do,1,1,"fa-icon",14),e.qZA(),e.TgZ(21,"div",15)(22,"span"),e._uU(23),e.qZA()()(),e.TgZ(24,"div",16),e.NdJ("click",function(){return i.openSettings()}),e._UZ(25,"fa-icon",17),e.qZA()(),e.YNc(26,Ro,16,11,"div",18),e.qZA(),e.YNc(27,Uo,2,2,"div",19),e.TgZ(28,"set-modal",20,21),e._UZ(30,"app-layer-settings",22),e.qZA()}2&t&&(e.xp6(1),e.Q6J("ngClass",i.selected?"bg-secondary bg-opacity-50 border-1":"bg-secondary bg-opacity-10"),e.xp6(2),e.Q6J("id","btnVisible"+i.layer.container.uuid)("checked",i.visible),e.xp6(2),e.Q6J("for","btnVisible"+i.layer.container.uuid)("ngClass",i.visible?"text-success":"text-danger")("ngbPopover",i.visible?"Masquer":"Afficher"),e.xp6(1),e.Q6J("icon",i.visible?i.visibleIcon:i.invisibleIcon),e.xp6(1),e.Q6J("id","btnLocked"+i.layer.container.uuid)("checked",i.locked),e.xp6(2),e.Q6J("for","btnLocked"+i.layer.container.uuid)("ngbPopover",i.locked?"D\xe9verrouiller":"Verrouiller"),e.xp6(1),e.Q6J("icon",i.locked?i.lockIcon:i.unLockIcon),e.xp6(1),e.Q6J("ngClass",i.selected?"pe-auto":"pe-none"),e.xp6(2),e.Q6J("icon",i.upIcon),e.xp6(2),e.Q6J("icon",i.downIcon),e.xp6(3),e.Q6J("ngIf","Point"===i.layer.container.geomType),e.xp6(1),e.Q6J("ngIf","LineString"===i.layer.container.geomType),e.xp6(1),e.Q6J("ngIf","Polygon"===i.layer.container.geomType),e.xp6(3),e.Oqu(i.layer.container.layerName),e.xp6(2),e.Q6J("icon",i.paramIcon),e.xp6(1),e.Q6J("ngIf",i.layer.container.features.length>0),e.xp6(1),e.Q6J("ngIf",!i.isLayerRemoved),e.xp6(1),e.Q6J("title","Param\xe8tres de la couche : "+i.layer.container.layerName),e.xp6(2),e.Q6J("layer",i.layer))},dependencies:[x.mk,x.sg,x.O5,A.BN,F.o8,Oe,zt,ho,yo,Zo],styles:[".layer[_ngcontent-%COMP%]{background-color:var(--bs-light)}.layer[_ngcontent-%COMP%]   .layer-name[_ngcontent-%COMP%]:hover{font-weight:700}.layer[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_layerColorTransition;animation-duration:2s}@keyframes _ngcontent-%COMP%_layerColorTransition{0%{background-color:var(--bs-warning)}to{background-color:var(--bs-light)}}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.pointer[_ngcontent-%COMP%]{cursor:pointer}.colorPicker[_ngcontent-%COMP%]{width:10px;height:25px;cursor:pointer}#editBar[_ngcontent-%COMP%]{position:fixed;bottom:0;-webkit-user-select:none;user-select:none}"]}),r})();var qo=m(6422),Xt=m(9851);const it="projection",$t="coordinateFormat",Bo=class Qo extends qo.Z{constructor(n){n=n||{};const t=document.createElement("div");t.className=void 0!==n.className?n.className:"ol-mouse-position",super({element:t,render:n.render,target:n.target}),this.addChangeListener(it,this.handleProjectionChanged_),n.coordinateFormat&&this.setCoordinateFormat(n.coordinateFormat),n.projection&&this.setProjection(n.projection),this.renderOnMouseOut_=void 0!==n.placeholder,this.placeholder_=this.renderOnMouseOut_?n.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=!1!==n.wrapX}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get($t)}getProjection(){return this.get(it)}handleMouseMove(n){const t=this.getMap();this.updateHTML_(t.getEventPixel(n))}handleMouseOut(n){this.updateHTML_(null)}setMap(n){if(super.setMap(n),n){const t=n.getViewport();this.listenerKeys.push((0,k.oL)(t,Xt.Z.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push((0,k.oL)(t,Xt.Z.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(n){this.set($t,n)}setProjection(n){this.set(it,(0,_.U2)(n))}updateHTML_(n){let t=this.placeholder_;if(n&&this.mapProjection_){if(!this.transform_){const s=this.getProjection();this.transform_=s?(0,_.WO)(this.mapProjection_,s):_.gD}const o=this.getMap().getCoordinateFromPixelInternal(n);if(o){const s=(0,_.Cs)();if(s&&(this.transform_=(0,_.WO)(this.mapProjection_,s)),this.transform_(o,o),this.wrapX_){const l=s||this.getProjection()||this.mapProjection_;(0,P.Cf)(o,l)}const a=this.getCoordinateFormat();t=a?a(o):o.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(n){const t=n.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}};function Vo(r,n){if(1&r){const t=e.EpF();e.ynx(0),e._UZ(1,"input",9),e.TgZ(2,"label",10),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.setProjection(s))}),e.TgZ(3,"div",11)(4,"span"),e._uU(5),e.qZA()()(),e.BQk()}if(2&r){const t=n.$implicit,i=n.index,o=e.oxw();e.xp6(1),e.Q6J("id","btnradio-selector-"+i)("checked",o.currentEpsg===t),e.xp6(1),e.Q6J("ngClass",o.currentEpsg===t?"bg-success text-white ":"")("for","btnradio-selector-"+i),e.xp6(3),e.Oqu(t)}}let Yo=(()=>{class r{constructor(t){this.mapService=t,this.defaultCoordsPrecision=4}ngAfterViewInit(){this.initMousePosition()}updatePrecision(t){this.mousePositionControl.setCoordinateFormat(this.setPrecisionFunc(t.target.value))}setProjection(t){this.currentEpsg=t,this.mapService.setProjectionOnMap(t),this.setMapEpsg()}initMousePosition(){let t;t=document.getElementById("mouseCoordinates"),this.mousePositionControl=new Bo({coordinateFormat:this.setPrecisionFunc(this.defaultCoordsPrecision),placeholder:"x :<br>y : ",className:"mouse-position",target:t}),this.map.addControl(this.mousePositionControl)}setPrecisionFunc(t){return function(o){return(0,P.WU)(o,"x : {x}<br>y : {y}",t)}}setMapEpsg(){this.currentEpsg=this.map.getView().getProjection().getCode()}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(Ge.S))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-geo-tools"]],inputs:{currentEpsg:"currentEpsg",map:"map",epsgAvailable:"epsgAvailable"},decls:11,vars:1,consts:[[1,"text-center","fw-bold","bg-success","bg-gradient","text-white","p-2"],["id","epsgList",1,"text-center","m-2"],[1,"btn-group","m-2","bg-white","rounded-3","border"],[4,"ngFor","ngForOf"],["id","ccordinates",1,"d-flex","flex-column","justify-content-center","align-items-center","m-2"],["id","mouseCoordinates"],[1,"d-flex","flex-row","my-1"],[1,"fw-bold","me-3"],["id","precision","type","number","min","0","max","12","value","4",1,"small","text-center",3,"change"],["type","radio","name","btnRadio","autocomplete","off",1,"border","btn-check",3,"id","checked"],[1,"pointer","p-1",3,"ngClass","for","click"],[1,"dropdown-item","small","d-flex","flex-row"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Projection\n"),e.qZA(),e.TgZ(2,"div",1)(3,"div",2),e.YNc(4,Vo,6,5,"ng-container",3),e.qZA()(),e.TgZ(5,"div",4),e._UZ(6,"span",5),e.TgZ(7,"div",6)(8,"span",7),e._uU(9,"Pr\xe9cision"),e.qZA(),e.TgZ(10,"input",8),e.NdJ("change",function(s){return i.updatePrecision(s)}),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("ngForOf",i.epsgAvailable))},dependencies:[x.mk,x.sg],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),r})();function Wo(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",3),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.addLayer(s.mode))}),e._UZ(2,"fa-icon",4),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit;e.xp6(1),e.Q6J("ngbPopover",t.label),e.xp6(1),e.Q6J("icon",t.icon)}}let Ko=(()=>{class r{constructor(){this.newLayerEvent=new e.vpe,this._pointIcon=ke,this._lineStringIcon=Ie,this._polygonIcon=te,this._layerTypes=[{mode:"Point",label:"Ajouter une couche de Points",icon:this._pointIcon},{mode:"LineString",label:"Ajouter une couche de LineString",icon:this._lineStringIcon},{mode:"Polygon",label:"Ajouter une couche de Polygones",icon:this._polygonIcon}]}ngOnInit(){this.layerTypesModes=this._layerTypes.filter(t=>this.layerTypeModes.includes(t.mode))}addLayer(t){this.newLayerEvent.emit(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-create-tools"]],inputs:{layerTypeModes:"layerTypeModes"},outputs:{newLayerEvent:"newLayerEvent"},decls:4,vars:1,consts:[[1,"text-center","fw-bold","bg-primary","bg-gradient","text-white","p-2"],[1,"text-center","m-3"],[4,"ngFor","ngForOf"],["placement","bottom","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-primary","border-0","me-1","text-white",3,"ngbPopover","click"],[3,"icon"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Cr\xe9er\n"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,Wo,3,2,"ng-container",2),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngForOf",i.layerTypesModes))},dependencies:[x.sg,A.BN,F.o8]}),r})();var zo=m(2340),Xo=m(3144);let $o=(()=>{class r{constructor(t){this.http=t,this.networkApiUrl=zo.N.networkApiUrl,this.shortestPathRoute=this.networkApiUrl+"path/shortest"}getShortestPathFromApi(t,i="vehicle"){return this.http.get(this.shortestPathRoute,{params:{mode:i,step_point:t}})}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(Xo.eN))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),er=(()=>{class r{constructor(t,i){this.editComputingService=t,this.graphComputingService=i,this.motorIcon=dn,this.pedestrianIcon=un}ngOnInit(){}ngOnDestroy(){}set layersToDisplay(t){t.forEach(i=>{["Polygon","LineString"].includes(i.container.geomType)&&(i.container.featuresToggled=!0)})}set layerSelected(t){this.buttonEnabled=!1,t&&"Point"===t.container.geomType&&(this.buttonEnabled=!0),this._layerSelected=t}get layerSelected(){return this._layerSelected}computeShortestPath(t){let i=[];if(null!==this.layerSelected){this.layerSelected.container.features.forEach(s=>{let l=s.clone().getGeometry();void 0!==l&&("EPSG:4326"!==this.currentEpsg&&(l=l.transform(this.currentEpsg,"EPSG:4326")),i.push(Ee(l)))});const o={dataProjection:"EPSG:4326",featureProjection:this.currentEpsg};this.graphComputingService.getShortestPathFromApi(i,t).subscribe(s=>{const a=Xe(s,o);this.editComputingService.addNewFeatures(a)})}}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(Fe),e.Y36($o))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-path-tools"]],inputs:{currentEpsg:"currentEpsg",layersToDisplay:"layersToDisplay",layerSelected:"layerSelected"},decls:7,vars:3,consts:[[1,"text-center","fw-bold","bg-danger","bg-gradient","text-white","p-2"],[1,"d-flex","flex-row","justify-content-around","m-1",3,"ngClass"],["ngbPopover","Pi\xe9ton",1,"btn","btn-sm","btn-outline-danger",3,"click"],[3,"icon"],["ngbPopover","Motoris\xe9",1,"btn","btn-sm","btn-outline-danger",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._uU(1," Plus court chemin\n"),e.qZA(),e.TgZ(2,"div",1)(3,"button",2),e.NdJ("click",function(){return i.computeShortestPath("pedestrian")}),e._UZ(4,"fa-icon",3),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.computeShortestPath("vehicle")}),e._UZ(6,"fa-icon",3),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngClass",i.buttonEnabled?"pe-auto":"pe-none"),e.xp6(2),e.Q6J("icon",i.pedestrianIcon),e.xp6(2),e.Q6J("icon",i.motorIcon))},dependencies:[x.mk,A.BN,F.o8]}),r})();const tr=["exportStringGeomDiv"],en=function(){return["Point","LineString","Polygon"]};function nr(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-create-tools",19),e.NdJ("newLayerEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.addLayer(o))}),e.qZA(),e._UZ(2,"app-geo-tools",20),e.BQk()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("layerTypeModes",e.DdM(4,en)),e.xp6(1),e.Q6J("map",t.map)("currentEpsg",t.currentEpsg)("epsgAvailable",t.epsgAvailable)}}function ir(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-create-tools",19),e.NdJ("newLayerEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.addLayer(o))}),e.qZA(),e.TgZ(2,"app-import-tools",21),e.NdJ("featuresToNewLayerEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.createNewLayersFromFeatures(o))})("featuresToAppendEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.appendFeatureOnLayerFromFeatures(o))}),e.qZA(),e.BQk()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("layerTypeModes",e.DdM(4,en)),e.xp6(1),e.Q6J("epsgAvailable",t.epsgAvailable)("currentEpsg",t.currentEpsg)("existingLayers",t.existingLayers)}}const or=function(){return["Point","LineString"]};function rr(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-create-tools",22),e.NdJ("newLayerEvent",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.addLayer(o))}),e.qZA(),e._UZ(2,"app-path-tools",23),e.BQk()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("layerTypeModes",e.DdM(4,or)),e.xp6(1),e.Q6J("currentEpsg",t.currentEpsg)("layerSelected",t.getLayerFromId(t.layerIdSelected))("layersToDisplay",t.layersToDisplay)}}function sr(r,n){if(1&r){const t=e.EpF();e.ynx(0,null,24),e.TgZ(2,"app-layer",25),e.NdJ("layerMoveUp",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.layerGoUp(o))})("layerMoveDown",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.layerGoDown(o))})("layerCloned",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.duplicateLayer(o))})("removeLayerId",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.removeLayer(o))}),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,i=e.oxw();e.xp6(2),e.Q6J("layer",t)("selected",i.layerIdSelected==t.container.uuid)("visible",i.allVisible)("locked",i.allLocked)("toggled",i.allToggled)("epsg",i.currentEpsg)}}let ar=(()=>{class r{constructor(t,i,o){this.mapService=t,this.interactionsService=i,this.editComputingService=o,this.disabledIcon=_t,this.loadIcon=yt,this.visibleIcon=ht,this.invisibleIcon=gt,this.centerIcon=Ze,this.lockIcon=dt,this.unLockIcon=ut,this.unToggleIcon=ft,this.toggleIcon=mt,this.allToggled=!1,this.allVisible=!0,this.allLocked=!1,this.existingLayers=[],this.layersToDisplay=[],this.layerIdSelected=null,this.layerNamedIncrement=-1,this.zoomPadding=Bt,this.mapSubscription=this.mapService.map.subscribe(s=>{this.map=s}),this.epsgChangesSubscription=this.mapService.setMapProjectionFromEpsg.subscribe(s=>{this.currentEpsg=s}),this.layerIdSelectedSubscription=this.interactionsService.layerIdSelected.subscribe(s=>{this.layerIdSelected=s}),this.newFeaturesSubscription=this.editComputingService.newFeatures.subscribe(s=>{this.createNewLayersFromFeatures(s)})}ngOnInit(){this.mapService.getMap(),this._mapExamplesData(),this.zoomToLayers()}ngOnDestroy(){this.existingLayers.forEach(t=>{this.map.removeLayer(t.container.layer),t.cleanEvents()}),this.mapSubscription.unsubscribe(),this.epsgChangesSubscription.unsubscribe(),this.layerIdSelectedSubscription.unsubscribe(),this.newFeaturesSubscription.unsubscribe()}_mapExamplesData(){const o=Xe([...Ui,...Hi,...qi],{dataProjection:this.currentEpsg,featureProjection:rt});this.createNewLayersFromFeatures(o)}set toolsMode(t){this._toolsMode=t,this.refreshLayers()}get toolsMode(){return this._toolsMode}set currentEpsg(t){this._currentEpsg=t}get currentEpsg(){return this._currentEpsg}addLayer(t){let i=this.setNewLayer(t);this.existingLayers.push(i),this.refreshLayers()}setNewLayer(t,i=null,o=null){const s=++this.layerNamedIncrement;null===i&&(i="layer "+s);let a=new Ai(i,t,s);return new Oi(this.map,a)}duplicateLayer(t){let i=this.setNewLayer(t.container.geomType,t.container.layerName+" copy");i.container.addFeaturesAndUpdateIds(t.container.features),this.existingLayers.push(i),this.refreshLayers()}addLayerFromFeatures(t,i){let o=this.setNewLayer(t);o.container.addFeaturesAndUpdateIds(i),this.existingLayers.push(o),this.refreshLayers()}layerGoUp(t){this.existingLayers=Yt(this.existingLayers,t,1),this.refreshLayers()}layerGoDown(t){this.existingLayers=Yt(this.existingLayers,t,-1),this.refreshLayers()}removeLayer(t){this.existingLayers=this.existingLayers.filter(i=>i.container.uuid!==t),this.buildLayersIndexes(),this.refreshLayers()}getLayerFromId(t){return t?this.existingLayers.filter(o=>o.container.uuid===t)[0]:null}refreshLayers(){this.layersToDisplay=this.existingLayers.sort((t,i)=>t.container.zIndex>i.container.zIndex?-1:1),this.interactionsService.sendAllLayers(this.layersToDisplay)}unSelectLayer(){this.layerIdSelected=null}buildLayersIndexes(){let t=this.existingLayers;this.existingLayers=[],t.forEach((i,o)=>{i.container.zIndex=o,this.existingLayers.push(i)})}createNewLayersFromFeatures(t){Object.keys(t).forEach(i=>{this.addLayerFromFeatures(i,t[i])})}appendFeatureOnLayerFromFeatures(t){const o=t.features;let s=this.getLayerFromId(t.layerId);if(null!==s){const a=s.container.geomType;let l=s.container;Object.keys(o).forEach(c=>{c===a&&(l.addFeaturesAndUpdateIds(o[c]),this.refreshLayers())})}}zoomToLayers(){let t=(0,C.lJ)();this.existingLayers.length>0&&(this.existingLayers.forEach(i=>{(0,C.l7)(t,i.container.sourceFeatures.getExtent())}),this.map.getView().fit(t,{size:this.map.getSize(),padding:this.zoomPadding}))}removeLayers(){this.interactionsService.removeAllLayers()}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(Ge.S),e.Y36(Ae),e.Y36(Fe))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-toolbar"]],viewQuery:function(t,i){if(1&t&&e.Gf(tr,5),2&t){let o;e.iGM(o=e.CRH())&&(i.exportStringGeomDiv=o.first)}},inputs:{epsgAvailable:"epsgAvailable",toolsMode:"toolsMode",currentEpsg:"currentEpsg"},decls:27,vars:18,consts:[[4,"ngIf"],[1,"text-center","fw-bold","bg-dark","text-white","bg-gradient","p-2"],["id","layersTools",1,"d-flex","flex-row","justify-content-evenly","align-items-center","mx-2"],["type","checkbox","id","btnVisibleLayers",1,"btn-check",3,"checked","change"],["btnVisible",""],["for","btnVisibleLayers","container","body","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-transparent","border-0",3,"ngClass","ngbPopover"],["size","1x",3,"icon"],["type","checkbox","id","btnLockLayers",1,"btn-check",3,"checked","change"],["btnLock",""],["for","btnLockLayers","container","body","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-transparent","border-0",3,"ngbPopover"],["type","checkbox","id","btnToggleFeatures",1,"btn-check",3,"checked","change"],["btnToggle",""],["for","btnToggleFeatures","container","body","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-transparent","border-0",3,"ngbPopover"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-transparent","border-0",3,"click"],["ngbPopover","Supprimer toutes les couches","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-transparent","border-0","text-danger",3,"click"],["id","layersList",1,"d-flex","flex-column","justify-content-start","mb-2"],[1,"d-flex","flex-row","small","m-1","p-2","justify-content-center","pointer",3,"ngClass","click"],[1,"me-1",3,"icon"],[4,"ngFor","ngForOf"],[3,"layerTypeModes","newLayerEvent"],["id","geoTools",1,"overflow-auto",3,"map","currentEpsg","epsgAvailable"],[3,"epsgAvailable","currentEpsg","existingLayers","featuresToNewLayerEvent","featuresToAppendEvent"],["classColor","danger",3,"layerTypeModes","newLayerEvent"],[3,"currentEpsg","layerSelected","layersToDisplay"],["layersList",""],[3,"layer","selected","visible","locked","toggled","epsg","layerMoveUp","layerMoveDown","layerCloned","removeLayerId"]],template:function(t,i){if(1&t){const o=e.EpF();e.YNc(0,nr,3,5,"ng-container",0),e.YNc(1,ir,3,5,"ng-container",0),e.YNc(2,rr,3,5,"ng-container",0),e.TgZ(3,"div",1),e._uU(4," Couches\n"),e.qZA(),e.TgZ(5,"div",2)(6,"input",3,4),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(7);return e.KtG(i.allVisible=a.checked)}),e.qZA(),e.TgZ(8,"label",5),e._UZ(9,"fa-icon",6),e.qZA(),e.TgZ(10,"input",7,8),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(11);return e.KtG(i.allLocked=a.checked)}),e.qZA(),e.TgZ(12,"label",9),e._UZ(13,"fa-icon",6),e.qZA(),e.TgZ(14,"input",10,11),e.NdJ("change",function(){e.CHM(o);const a=e.MAs(15);return e.KtG(i.allToggled=a.checked)}),e.qZA(),e.TgZ(16,"label",12),e._UZ(17,"fa-icon",6),e.qZA(),e.TgZ(18,"button",13),e.NdJ("click",function(){return i.zoomToLayers()}),e._UZ(19,"fa-icon",6),e.qZA(),e.TgZ(20,"button",14),e.NdJ("click",function(){return i.removeLayers()}),e._UZ(21,"fa-icon",6),e.qZA()(),e.TgZ(22,"div",15)(23,"div",16),e.NdJ("click",function(){return i.unSelectLayer()}),e._UZ(24,"fa-icon",17),e._uU(25,"D\xe9s\xe9lectionner "),e.qZA(),e.YNc(26,sr,3,6,"ng-container",18),e.qZA()}2&t&&(e.Q6J("ngIf","geoTools"==i.toolsMode),e.xp6(1),e.Q6J("ngIf","importTools"==i.toolsMode),e.xp6(1),e.Q6J("ngIf","pathTools"==i.toolsMode),e.xp6(4),e.Q6J("checked",i.allVisible),e.xp6(2),e.Q6J("ngClass",i.allVisible?"text-success":"text-danger")("ngbPopover",i.allVisible?"Masquer":"Afficher"),e.xp6(1),e.Q6J("icon",i.allVisible?i.visibleIcon:i.invisibleIcon),e.xp6(1),e.Q6J("checked",!1),e.xp6(2),e.Q6J("ngbPopover",i.allLocked?"D\xe9v\xe9rouiller":"Verrouiller"),e.xp6(1),e.Q6J("icon",i.allLocked?i.lockIcon:i.unLockIcon),e.xp6(1),e.Q6J("checked",!i.allVisible),e.xp6(2),e.Q6J("ngbPopover",i.allToggled?"Masquer":"Afficher"),e.xp6(1),e.Q6J("icon",i.allToggled?i.toggleIcon:i.unToggleIcon),e.xp6(2),e.Q6J("icon",i.centerIcon),e.xp6(2),e.Q6J("icon",i.disabledIcon),e.xp6(2),e.Q6J("ngClass",null===i.layerIdSelected?"bg-secondary  bg-gradient bg-opacity-10 fw-bold":""),e.xp6(1),e.Q6J("icon",i.disabledIcon),e.xp6(2),e.Q6J("ngForOf",i.layersToDisplay))},dependencies:[x.mk,x.sg,x.O5,A.BN,F.o8,Ho,Yo,Ko,Yi,er]}),r})();function lr(r,n){if(1&r&&(e.TgZ(0,"li")(1,"div",5),e._UZ(2,"app-geom-icons",6),e.qZA()()),2&r){const t=n.$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("geomType",i.layer.container.geomType)("strokeColor",i.layer.container.strokeColor)("fillColor",t.color)("strokeWidth",i.layer.container.strokeWidth)("title",t.class)}}function cr(r,n){if(1&r&&(e.TgZ(0,"div",1)(1,"span",2),e._uU(2),e.qZA(),e.TgZ(3,"ul",3),e.YNc(4,lr,3,5,"li",4),e.qZA()()),2&r){const t=e.oxw();e.xp6(2),e.Oqu(t.layer.container.layerName),e.xp6(2),e.Q6J("ngForOf",t.layer.container.styleSettings)}}let dr=(()=>{class r{constructor(){this.pointIcon=ke,this.lineStringIcon=Ie,this.polygonIcon=te,this._strokeWidthCoeff=1.8,this._strokeWidthLineCoeff=1.2}ngOnInit(){}ngOnDestroy(){}set layer(t){this._layer=t}get layer(){return this._layer}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-layer-legend"]],inputs:{layer:"layer"},decls:1,vars:1,consts:[["class","d-flex flex-column justify-content-start m-2",4,"ngIf"],[1,"d-flex","flex-column","justify-content-start","m-2"],[1,"mb-2","fs-6","fw-bold"],[1,"list-unstyled","m-0"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-row","align-items-cente","x-2"],[3,"geomType","strokeColor","fillColor","strokeWidth","title"]],template:function(t,i){1&t&&e.YNc(0,cr,5,2,"div",0),2&t&&e.Q6J("ngIf",i.layer.container.visible)},dependencies:[x.sg,x.O5,$e]}),r})();function ur(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"app-layer-legend",16),e.BQk()),2&r){const t=n.$implicit;e.xp6(1),e.Q6J("layer",t)}}function hr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"span",12),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.changeLegendShape())}),e._UZ(3,"fa-icon",5),e.qZA()(),e.TgZ(4,"div",13)(5,"div",14),e.YNc(6,ur,2,1,"ng-container",15),e.qZA()()()}if(2&r){const t=e.oxw();e.Q6J("ngClass",t.isLegendRow?"legend-row ":"legend-column "),e.xp6(3),e.Q6J("icon",t.isLegendRow?t.verticalOrientation:t.horizontalOrientation),e.xp6(2),e.Q6J("ngClass",t.isLegendRow?"flex-row":"flex-column"),e.xp6(1),e.Q6J("ngForOf",t.currentLayers)}}const gr=[{path:"",component:(()=>{class r{constructor(t,i,o,s){this.mapService=t,this.controlerService=i,this.activatedRoute=o,this.interactionsService=s,this.epsgAvailable=["EPSG:4326",rt],this.geoIcon=an,this.pathIcon=cn,this.leftSideIcon=on,this.rightSideIcon=rn,this.layersIcon=sn,this.horizontalOrientation=xn,this.verticalOrientation=Cn,this.isLegendRow=!0,this.toolsMode="importTools",this.layerIdSelected=null,this.mapSubscription=this.mapService.map.subscribe(a=>{this.currentEpsg=a.getView().getProjection().getCode()}),this.allLayersSubscription=this.interactionsService.allLayers.subscribe(a=>{this.currentLayers=a}),this.layerIdSelectedSubscription=this.interactionsService.layerIdSelected.subscribe(a=>{this.layerIdSelected=a})}ngOnInit(){this.sendResumeSubMenus(),this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.editMode=!0}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.allLayersSubscription.unsubscribe(),this.layerIdSelectedSubscription.unsubscribe(),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView(),this.mapService.changeBackgroundLayer("stamen"),this.hideBackgroundMapSwitcher()}set editMode(t){this._isEditMode=t,this._isEditMode?(this._sandBoxMode="Mode \xe9dition",this.displayBackgroundMapSwitcher()):(this._sandBoxMode="Mode carte",this.hideBackgroundMapSwitcher())}get editMode(){return this._isEditMode}get mode(){return this._sandBoxMode}changeLegendShape(){this.isLegendRow=!this.isLegendRow}displayBackgroundMapSwitcher(){this.mapService.enableBackgroundLayer(!0)}hideBackgroundMapSwitcher(){this.mapService.enableBackgroundLayer(!1)}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title)}showHideEditMode(){this.editMode=!this.editMode}unSelectLayer(){this.interactionsService.sendSelectedLayerId(null)}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(Ge.S),e.Y36(Tn.L),e.Y36(Me.gz),e.Y36(Ae))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-app-layout"]],decls:13,vars:14,consts:[["fluidHeight","","id","sandbox",1,"d-flex","flex-row","position-fixed"],["id","panelsContainer",1,"bg-light",3,"ngClass"],[1,"d-flex","flex-column","overflow-auto",3,"toolsMode","currentEpsg","epsgAvailable"],["id","legendLabels",1,"d-flex","flex-column"],["triggers","mouseenter:mouseleave","placement","right",1,"tool","btn","btn-warning","text-black","my-3","rounded-end",3,"ngClass","ngbPopover","click"],[3,"icon"],["ngbPopover","Projections","triggers","mouseenter:mouseleave","placement","right",1,"tool","btn","btn-success","text-white","mb-1","rounded-end",3,"ngClass","click"],["type","button","ngbPopover","Importations","triggers","mouseenter:mouseleave","placement","right",1,"tool","btn","btn-secondary","text-white","mb-1","rounded-end",3,"ngClass","click"],["type","button","ngbPopover","R\xe9seaux","triggers","mouseenter:mouseleave","placement","right",1,"tool","btn","btn-danger","text-white","mb-1","rounded-end",3,"ngClass","click"],["moveDivToBody","","id","legend","class","d-flex flex-column position-fixed bottom-0 end-0 bg-white shadow rounded m-2",3,"ngClass",4,"ngIf"],["moveDivToBody","","id","legend",1,"d-flex","flex-column","position-fixed","bottom-0","end-0","bg-white","shadow","rounded","m-2",3,"ngClass"],[1,"d-flex","flex-row","justify-content-end"],["type","button",1,"badge","bg-secondary","m-2",3,"click"],[1,"container","overflow-auto"],[1,"d-flex",3,"ngClass"],[4,"ngFor","ngForOf"],[3,"layer"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"app-toolbar",2),e.qZA(),e.TgZ(3,"div",3)(4,"span",4),e.NdJ("click",function(){return i.showHideEditMode()}),e._UZ(5,"fa-icon",5),e.qZA(),e.TgZ(6,"span",6),e.NdJ("click",function(){return i.toolsMode="geoTools"}),e._UZ(7,"fa-icon",5),e.qZA(),e.TgZ(8,"span",7),e.NdJ("click",function(){return i.toolsMode="importTools"}),e._UZ(9,"fa-icon",5),e.qZA(),e.TgZ(10,"span",8),e.NdJ("click",function(){return i.toolsMode="pathTools"}),e._UZ(11,"fa-icon",5),e.qZA()()(),e.YNc(12,hr,7,4,"div",9)),2&t&&(e.xp6(1),e.Q6J("ngClass",i.editMode?"displayed overflow-auto":"hidden"),e.xp6(1),e.Q6J("toolsMode",i.toolsMode)("currentEpsg",i.currentEpsg)("epsgAvailable",i.epsgAvailable),e.xp6(2),e.Q6J("ngClass",i.editMode?"selected":"")("ngbPopover",i.mode),e.xp6(1),e.Q6J("icon",i.editMode?i.leftSideIcon:i.rightSideIcon),e.xp6(1),e.Q6J("ngClass","geoTools"===i.toolsMode?"selected":""),e.xp6(1),e.Q6J("icon",i.geoIcon),e.xp6(1),e.Q6J("ngClass","importTools"===i.toolsMode?"selected":""),e.xp6(1),e.Q6J("icon",i.layersIcon),e.xp6(1),e.Q6J("ngClass","pathTools"===i.toolsMode?"selected":""),e.xp6(1),e.Q6J("icon",i.pathIcon),e.xp6(1),e.Q6J("ngIf",!i.editMode))},dependencies:[x.mk,x.sg,x.O5,A.BN,F.o8,vn,Oe,ar,dr],styles:["#panelsContainer[_ngcontent-%COMP%]{box-shadow:1em 0 1rem #00000026!important}#panelsContainer.displayed[_ngcontent-%COMP%]{transition:all .3s}#panelsContainer.displayed[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{opacity:1;transition:all .1s}#panelsContainer.hidden[_ngcontent-%COMP%]{transition:all .3s}#panelsContainer.hidden[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{opacity:0;transition:all .1s}@media (max-width: 960px){#panelsContainer.hidden[_ngcontent-%COMP%]{width:3vw}#panelsContainer.displayed[_ngcontent-%COMP%]{width:90%}}@media (min-width: 960px){#panelsContainer.hidden[_ngcontent-%COMP%]{width:1vw}#panelsContainer.displayed[_ngcontent-%COMP%]{width:20vw}}.tool[_ngcontent-%COMP%]{border-radius:unset;transition:all .1s}.tool.btn[_ngcontent-%COMP%]{width:45px}.tool.btn[_ngcontent-%COMP%]:hover, .tool.btn.selected[_ngcontent-%COMP%]{width:60px}.legend-row[_ngcontent-%COMP%]{max-width:70%}.legend-column[_ngcontent-%COMP%]{max-height:55%}"]}),r})(),data:{title:"Bac \xe0 sable",page:"map-sandbox"},outlet:"map-sandbox"}];let pr=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[Me.Bz.forChild(gr),Me.Bz]}),r})();var fr=m(5540);let mr=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[x.ez,pr,A.uH,F.IJ,D.u5,fr.o,$e,et,tt,zt]}),r})()}}]);