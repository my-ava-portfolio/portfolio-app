"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[880],{1880:(Ai,Ve,m)=>{m.r(Ve),m.d(Ve,{MapSandboxModule:()=>Zi});var P=m(6895),D=m(4006),A=m(2216),Le=m(646),y=m(2687),n=m(4650),Ee=m(9947),Et=m(3686),O=m(7579);let te=(()=>{class o{constructor(){this.layerIdSelected=new O.x,this.layerObjectSelected=new O.x,this.selectableLayerId=new O.x,this.selectableAllLayers=new O.x,this.editBarActivation=new O.x,this.removeLayers=new O.x,this.selectingLayerStatus=new O.x}activateEditBar(t){this.editBarActivation.next(t)}removeAllLayers(){this.removeLayers.next(!0)}setSelectingLayers(t){this.selectingLayerStatus.next(t)}setSelectableLayer(t){this.selectableLayerId.next(t)}setSelectableAllLayers(){this.selectableAllLayers.next(!0)}sendSelectedLayerId(t){this.layerIdSelected.next(t)}sendSelectedLayer(t){this.layerObjectSelected.next(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),St=(()=>{class o{constructor(t){this._elemRef=t,this.setHeight()}ngAfterViewChecked(){this.setHeight()}onResize(t){this.setHeight()}setHeight(){this._elemRef.nativeElement.style.height=window.innerHeight-this._elemRef.nativeElement.offsetTop+"px"}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(n.SBq))},o.\u0275dir=n.lG2({type:o,selectors:[["","fluidHeight",""]],hostBindings:function(t,i){1&t&&n.NdJ("resize",function(s){return i.onResize(s)},!1,n.Jf7)}}),o})();var It=m(6422),qe=m(9851),_=m(6003),I=m(1729),w=m(3481);const Se="projection",Ye="coordinateFormat",Mt=class kt extends It.Z{constructor(e){e=e||{};const t=document.createElement("div");t.className=void 0!==e.className?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.addChangeListener(Se,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=void 0!==e.placeholder,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=!1!==e.wrapX}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Ye)}getProjection(){return this.get(Se)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push((0,I.oL)(t,qe.Z.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push((0,I.oL)(t,qe.Z.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Ye,e)}setProjection(e){this.set(Se,(0,_.U2)(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const s=this.getProjection();this.transform_=s?(0,_.WO)(this.mapProjection_,s):_.gD}const r=this.getMap().getCoordinateFromPixelInternal(e);if(r){const s=(0,_.Cs)();if(s&&(this.transform_=(0,_.WO)(this.mapProjection_,s)),this.transform_(r,r),this.wrapX_){const l=s||this.getProjection()||this.mapProjection_;(0,w.Cf)(r,l)}const a=this.getCoordinateFormat();t=a?a(r):r.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}};function Zt(o,e){if(1&o){const t=n.EpF();n.ynx(0),n._UZ(1,"input",10),n.TgZ(2,"label",11),n.NdJ("click",function(){const s=n.CHM(t).$implicit,a=n.oxw();return n.KtG(a.setProjection(s))}),n.TgZ(3,"div",12)(4,"span"),n._uU(5),n.qZA()()(),n.BQk()}if(2&o){const t=e.$implicit,i=e.index,r=n.oxw();n.xp6(1),n.Q6J("id","btnradio-selector-"+i)("checked",r.currentEpsg===t),n.xp6(1),n.Q6J("ngClass",r.currentEpsg===t?"bg-info text-white ":"")("for","btnradio-selector-"+i),n.xp6(3),n.Oqu(t)}}let Gt=(()=>{class o{constructor(t){this.mapService=t,this.defaultCoordsPrecision=4}ngAfterViewInit(){this.initMousePosition()}updatePrecision(t){this.mousePositionControl.setCoordinateFormat(this.setPrecisionFunc(t.target.value))}setProjection(t){this.currentEpsg=t,this.mapService.setProjectionOnMap(t),this.setMapEpsg()}initMousePosition(){let t;t=document.getElementById("mouseCoordinates"),this.mousePositionControl=new Mt({coordinateFormat:this.setPrecisionFunc(this.defaultCoordsPrecision),placeholder:"x :<br>y : ",className:"mouse-position",target:t}),this.map.addControl(this.mousePositionControl)}setPrecisionFunc(t){return function(r){return(0,w.WU)(r,"x : {x}<br>y : {y}",t)}}setMapEpsg(){this.currentEpsg=this.map.getView().getProjection().getCode()}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(Ee.S))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-geoinfo"]],inputs:{currentEpsg:"currentEpsg",map:"map",epsgAvailable:"epsgAvailable"},decls:14,vars:1,consts:[[1,"text-center","fw-bold","bg-info","bg-gradient","text-white","p-3"],["id","epsgList",1,"text-center","m-3"],[1,"btn-group","m-2","bg-white","rounded-3","border"],[4,"ngFor","ngForOf"],["id","ccordinates",1,"d-flex","flex-column","justify-content-center","align-items-center","m-3"],[1,"d-flex","flex-column"],["id","mouseCoordinates"],[1,"d-flex","flex-row","my-2"],[1,"fw-bold","me-3"],["id","precision","type","number","min","0","max","12","value","4",1,"small","text-center",3,"change"],["type","radio","name","btnRadio","autocomplete","off",1,"border","btn-check",3,"id","checked"],[1,"pointer","p-2",3,"ngClass","for","click"],[1,"dropdown-item","small","d-flex","flex-row"]],template:function(t,i){1&t&&(n.TgZ(0,"div",0),n._uU(1," Projection\n"),n.qZA(),n.TgZ(2,"div",1)(3,"div",2),n.YNc(4,Zt,6,5,"ng-container",3),n.qZA()(),n.TgZ(5,"div",0),n._uU(6," Coordonn\xe9es\n"),n.qZA(),n.TgZ(7,"div",4)(8,"div",5),n._UZ(9,"span",6),n.qZA(),n.TgZ(10,"div",7)(11,"span",8),n._uU(12,"Pr\xe9cision"),n.qZA(),n.TgZ(13,"input",9),n.NdJ("change",function(s){return i.updatePrecision(s)}),n.qZA()()()),2&t&&(n.xp6(4),n.Q6J("ngForOf",i.epsgAvailable))},dependencies:[P.mk,P.sg],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),o})();var S=m(3171),Y=m(9972),At=m(7660),x=m(760);class ne extends At.Z{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(I.bN),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push((0,I.oL)(this.geometries_[e],Y.Z.CHANGE,this.changed,this))}clone(){const e=new ne(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<(0,x.qf)(this.getExtent(),e,t))return r;const s=this.geometries_;for(let a=0,l=s.length;a<l;++a)r=s[a].closestPointXY(e,t,i,r);return r}containsXY(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)if(i[r].containsXY(e,t))return!0;return!1}computeExtent(e){(0,x.YN)(e);const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)(0,x.l7)(e,t[i].getExtent());return e}getGeometries(){return Ke(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let r=!1;for(let s=0,a=i.length;s<a;++s){const l=i[s],c=l.getSimplifiedGeometry(e);t.push(c),c!==l&&(r=!0)}if(r){const s=new ne(null);return s.setGeometriesArray(t),s}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].rotate(e,t);this.changed()}scale(e,t,i){i||(i=(0,x.qg)(this.getExtent()));const r=this.geometries_;for(let s=0,a=r.length;s<a;++s)r[s].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(Ke(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Ke(o){const e=[];for(let t=0,i=o.length;t<i;++t)e.push(o[t].clone());return e}const K=ne;var v=m(119);const We=class Ot{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?(0,_.U2)(t.dataProjection):this.readProjection(e);t.extent&&i&&"tile-pixels"===i.getUnits()&&(i=(0,_.U2)(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return(0,v.O3)()}readFeature(e,t){return(0,v.O3)()}readFeatures(e,t){return(0,v.O3)()}readGeometry(e,t){return(0,v.O3)()}readProjection(e){return(0,v.O3)()}writeFeature(e,t){return(0,v.O3)()}writeFeatures(e,t){return(0,v.O3)()}writeGeometry(e,t){return(0,v.O3)()}};function ie(o,e,t){const i=t?(0,_.U2)(t.featureProjection):null,r=t?(0,_.U2)(t.dataProjection):null;let s;if(s=i&&r&&!(0,_.OP)(i,r)?(e?o.clone():o).transform(e?i:r,e?r:i):o,e&&t&&void 0!==t.decimals){const a=Math.pow(10,t.decimals),l=function(c){for(let d=0,u=c.length;d<u;++d)c[d]=Math.round(c[d]*a)/a;return c};s===o&&(s=o.clone()),s.applyTransform(l)}return s}function re(o){return"string"==typeof o?JSON.parse(o)||null:null!==o?o:null}const Dt=class Nt extends We{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(re(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(re(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return(0,v.O3)()}readFeaturesFromObject(e,t){return(0,v.O3)()}readGeometry(e,t){return this.readGeometryFromObject(re(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return(0,v.O3)()}readProjection(e){return this.readProjectionFromObject(re(e))}readProjectionFromObject(e){return(0,v.O3)()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return(0,v.O3)()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return(0,v.O3)()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return(0,v.O3)()}};var G=m(6527),B=m(2774),se=m(5066),oe=m(8999),Xe=m(9182),R=m(2456),Ie=m(392),ze=m(410),$e=m(9644);class ae extends B.ZP{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(void 0!==t&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{let r=this.getLayout();const s=e,a=[],l=[];for(let c=0,d=s.length;c<d;++c){const u=s[c];0===c&&(r=u.getLayout()),(0,R.l7)(a,u.getFlatCoordinates()),l.push(a.length)}this.setFlatCoordinates(r,a),this.ends_=l}}appendLineString(e){this.flatCoordinates?(0,R.l7)(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new ae(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<(0,x.qf)(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,se.Af)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,se.Xl)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,r))}getCoordinateAtM(e,t,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(0,ze.dG)(this.flatCoordinates,0,this.ends_,this.stride,e,t=void 0!==t&&t,i=void 0!==i&&i)}getCoordinates(){return(0,Ie.o1)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new G.Z(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,r=[];let s=0;for(let a=0,l=t.length;a<l;++a){const c=t[a],d=new G.Z(e.slice(s,c),i);r.push(d),s=c}return r}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const r=this.ends_,s=this.stride;for(let a=0,l=r.length;a<l;++a){const c=r[a],d=(0,ze.WW)(t,i,c,s,.5);(0,R.l7)(e,d),i=c}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=(0,Xe.UJ)(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new ae(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return(0,$e.AW)(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,oe._5)(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const le=ae;var N=m(187),W=m(2156);class ke extends B.ZP{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?(0,R.l7)(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new ke(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<(0,x.qf)(this.getExtent(),e,t))return r;const s=this.flatCoordinates,a=this.stride;for(let l=0,c=s.length;l<c;l+=a){const d=(0,W.bI)(e,t,s[l],s[l+1]);if(d<r){r=d;for(let u=0;u<a;++u)i[u]=s[l+u];i.length=a}}return r}getCoordinates(){return(0,Ie.Ml)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){return e<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=e?null:new N.Z(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,r=[];for(let s=0,a=e.length;s<a;s+=i){const l=new N.Z(e.slice(s,s+i),t);r.push(l)}return r}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let r=0,s=t.length;r<s;r+=i)if((0,x.jE)(e,t[r],t[r+1]))return!0;return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,oe.Sg)(this.flatCoordinates,0,e,this.stride),this.changed()}}const ce=ke;var M=m(2275),Rt=m(2474),Me=m(1265),jt=m(8818),Ut=m(4325);class de extends B.ZP{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){let r=this.getLayout();const s=e,a=[],l=[];for(let c=0,d=s.length;c<d;++c){const u=s[c];0===c&&(r=u.getLayout());const f=a.length,h=u.getEnds();for(let g=0,p=h.length;g<p;++g)h[g]+=f;(0,R.l7)(a,u.getFlatCoordinates()),l.push(h)}t=r,e=a,i=l}void 0!==t&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(this.flatCoordinates){const i=this.flatCoordinates.length;(0,R.l7)(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let r=0,s=t.length;r<s;++r)t[r]+=i}else this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=this.endss_[r].slice();const i=new de(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,r){return r<(0,x.qf)(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,se.sD)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,se.gI)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return(0,Ut.Zl)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return(0,jt.Eu)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),(0,Me.dL)(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,(0,Ie.ug)(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=function Jt(o,e,t,i){const r=[];let s=(0,x.lJ)();for(let a=0,l=t.length;a<l;++a){const c=t[a];s=(0,x.GN)(o,e,c[0],i),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=c[c.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,Rt.U)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new ce(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;(0,Me.Oj)(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=(0,Me.dL)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=(0,Xe.Pp)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new de(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(0===e)t=0;else{const s=this.endss_[e-1];t=s[s.length-1]}const i=this.endss_[e].slice(),r=i[i.length-1];if(0!==t)for(let s=0,a=i.length;s<a;++s)i[s]-=t;return new M.ZP(this.flatCoordinates.slice(t,r),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,r=[];let s=0;for(let a=0,l=i.length;a<l;++a){const c=i[a].slice(),d=c[c.length-1];if(0!==s)for(let f=0,h=c.length;f<h;++f)c[f]-=s;const u=new M.ZP(t.slice(s,d),e,c);r.push(u),s=d}return r}getType(){return"MultiPolygon"}intersectsExtent(e){return(0,$e.oW)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=(0,oe.QT)(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()}}const ue=de;var Bt=m(1911),Ht=m(9466);function Ze(o,e){if(!o)return null;let t;switch(o.type){case"Point":t=function qt(o){return new N.Z(o.coordinates)}(o);break;case"LineString":t=function Yt(o){return new G.Z(o.coordinates)}(o);break;case"Polygon":t=function zt(o){return new M.ZP(o.coordinates)}(o);break;case"MultiPoint":t=function Wt(o){return new ce(o.coordinates)}(o);break;case"MultiLineString":t=function Kt(o){return new le(o.coordinates)}(o);break;case"MultiPolygon":t=function Xt(o){return new ue(o.coordinates)}(o);break;case"GeometryCollection":t=function Vt(o,e){const t=o.geometries.map(function(i){return Ze(i,e)});return new K(t)}(o);break;default:throw new Error("Unsupported GeoJSON type: "+o.type)}return ie(t,!1,e)}function Ge(o,e){const t=(o=ie(o,!0,e)).getType();let i;switch(t){case"Point":i=function sn(o,e){return{type:"Point",coordinates:o.getCoordinates()}}(o);break;case"LineString":i=function en(o,e){return{type:"LineString",coordinates:o.getCoordinates()}}(o);break;case"Polygon":i=function on(o,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:o.getCoordinates(t)}}(o,e);break;case"MultiPoint":i=function nn(o,e){return{type:"MultiPoint",coordinates:o.getCoordinates()}}(o);break;case"MultiLineString":i=function tn(o,e){return{type:"MultiLineString",coordinates:o.getCoordinates()}}(o);break;case"MultiPolygon":i=function rn(o,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:o.getCoordinates(t)}}(o,e);break;case"GeometryCollection":i=function $t(o,e){return delete(e=Object.assign({},e)).featureProjection,{type:"GeometryCollection",geometries:o.getGeometriesArray().map(function(i){return Ge(i,e)})}}(o,e);break;case"Circle":i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+t)}return i}const et=class Qt extends Dt{constructor(e){e=e||{},super(),this.dataProjection=(0,_.U2)(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=(0,_.U2)(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;i="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null};const r=Ze(i.geometry,t),s=new S.Z;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&s.setGeometryName(i.geometry_name),s.setGeometry(r),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(e,t){let r=null;if("FeatureCollection"===e.type){r=[];const a=e.features;for(let l=0,c=a.length;l<c;++l)r.push(this.readFeatureFromObject(a[l],t))}else r=[this.readFeatureFromObject(e,t)];return r}readGeometryFromObject(e,t){return Ze(e,t)}readProjectionFromObject(e){const t=e.crs;let i;return t?"name"==t.type?i=(0,_.U2)(t.properties.name):"EPSG"===t.type?i=(0,_.U2)("EPSG:"+t.properties.code):(0,Bt.h)(!1,36):i=this.dataProjection,i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},r=e.getId();if(void 0!==r&&(i.id=r),!e.hasProperties())return i;const s=e.getProperties(),a=e.getGeometry();return a&&(i.geometry=Ge(a,t),delete s[e.getGeometryName()]),(0,Ht.x)(s)||(i.properties=s),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let r=0,s=e.length;r<s;++r)i.push(this.writeFeatureObject(e[r],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Ge(e,this.adaptOptions(t))}},tt={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let he;const an=new Uint8Array(16);function ln(){if(!he&&(he=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!he))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return he(an)}const L=[];for(let o=0;o<256;++o)L.push((o+256).toString(16).slice(1));const it=function cn(o,e,t){if(tt.randomUUID&&!e&&!o)return tt.randomUUID();const i=(o=o||{}).random||(o.rng||ln)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){t=t||0;for(let r=0;r<16;++r)e[t+r]=i[r];return e}return function nt(o,e=0){return(L[o[e+0]]+L[o[e+1]]+L[o[e+2]]+L[o[e+3]]+"-"+L[o[e+4]]+L[o[e+5]]+"-"+L[o[e+6]]+L[o[e+7]]+"-"+L[o[e+8]]+L[o[e+9]]+"-"+L[o[e+10]]+L[o[e+11]]+L[o[e+12]]+L[o[e+13]]+L[o[e+14]]+L[o[e+15]]).toLowerCase()}(i)};var ge=m(9889),fe=m(5002),rt=m(2909),pe=m(4412),H=m(1345);function st(o){return o.feature?o.feature:o.element?o.element:void 0}const Ae=[],un=class dn extends fe.Z{constructor(e){const t=e=e||{};t.handleDownEvent||(t.handleDownEvent=H.uX),t.stopDown||(t.stopDown=H.Dv),super(t),this.source_=e.source?e.source:null,this.vertex_=void 0===e.vertex||e.vertex,this.edge_=void 0===e.edge||e.edge,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.rBush_=new rt.Z,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=void 0===t||t;const i=(0,v.sq)(e),r=e.getGeometry();if(r){const s=this.GEOMETRY_SEGMENTERS_[r.getType()];if(s){this.indexedFeaturesExtents_[i]=r.getExtent((0,x.lJ)());const a=[];if(s(a,r),1===a.length)this.rBush_.insert((0,x.hI)(a[0]),{feature:e,segment:a[0]});else if(a.length>1){const l=a.map(d=>(0,x.hI)(d)),c=a.map(d=>({feature:e,segment:d}));this.rBush_.load(l,c)}}}t&&(this.featureChangeListenerKeys_[i]=(0,I.oL)(e,Y.Z.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel),super.handleEvent(e)}handleFeatureAdd_(e){const t=st(e);this.addFeature(t)}handleFeatureRemove_(e){const t=st(e);this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const i=(0,v.sq)(t);i in this.pendingFeatures_||(this.pendingFeatures_[i]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const i=void 0===t||t,r=(0,v.sq)(e),s=this.indexedFeaturesExtents_[r];if(s){const a=this.rBush_,l=[];a.forEachInExtent(s,function(c){e===c.feature&&l.push(c)});for(let c=l.length-1;c>=0;--c)a.remove(l[c])}i&&((0,I.bN)(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])}setMap(e){const t=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();t&&(i.forEach(I.bN),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(I.bN),this.featureChangeListenerKeys_={}),super.setMap(e),e&&(this.features_?i.push((0,I.oL)(this.features_,ge.Z.ADD,this.handleFeatureAdd_,this),(0,I.oL)(this.features_,ge.Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push((0,I.oL)(this.source_,pe.Z.ADDFEATURE,this.handleFeatureAdd_,this),(0,I.oL)(this.source_,pe.Z.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(s=>this.addFeature(s)))}snapTo(e,t,i){const r=i.getView().getProjection(),s=(0,_.Vs)(t,r),a=(0,_.Fj)((0,x.f3)((0,x.hI)([s]),i.getView().getResolution()*this.pixelTolerance_),r),l=this.rBush_.getInExtent(a),c=l.length;if(0===c)return null;let d,u=1/0;const f=this.pixelTolerance_*this.pixelTolerance_,h=()=>{if(d){const g=i.getPixelFromCoordinate(d);if((0,w.bI)(e,g)<=f)return{vertex:d,vertexPixel:[Math.round(g[0]),Math.round(g[1])]}}return null};if(this.vertex_){for(let p=0;p<c;++p){const C=l[p];"Circle"!==C.feature.getGeometry().getType()&&C.segment.forEach(b=>{const F=(0,_.Vs)(b,r),E=(0,w.bI)(s,F);E<u&&(d=b,u=E)})}const g=h();if(g)return g}if(this.edge_){for(let p=0;p<c;++p){let C=null;const b=l[p];if("Circle"===b.feature.getGeometry().getType()){let F=b.feature.getGeometry();const E=(0,_.Cs)();E&&(F=F.clone().transform(E,r)),C=(0,w.Ed)(s,F)}else{const[F,E]=b.segment;E&&(Ae[0]=(0,_.Vs)(F,r),Ae[1]=(0,_.Vs)(E,r),C=(0,w.oL)(s,Ae))}if(C){const F=(0,w.bI)(s,C);F<u&&(d=(0,_.lO)(C,r),u=F)}}const g=h();if(g)return g}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){const i=this.getMap().getView().getProjection();let r=t;const s=(0,_.Cs)();s&&(r=r.clone().transform(s,i));const a=(0,M.Bb)(r);s&&a.transform(i,s);const l=a.getCoordinates()[0];for(let c=0,d=l.length-1;c<d;++c)e.push(l.slice(c,c+2))}segmentGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const s=this.GEOMETRY_SEGMENTERS_[i[r].getType()];s&&s(e,i[r])}}segmentLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length-1;r<s;++r)e.push(i.slice(r,r+2))}segmentMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l)e.push(a.slice(l,l+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(i=>{e.push([i])})}segmentMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let u=0,f=d.length-1;u<f;++u)e.push(d.slice(u,u+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l)e.push(a.slice(l,l+2))}}};var X=m(2815),Oe=m(8214),ot=m(7366),Z=m(6597);class De extends Oe.ZP{constructor(e,t,i,r,s){super(e),this.features=t,this.coordinate=i,this.startCoordinate=r,this.mapBrowserEvent=s}}const gn=class hn extends fe.Z{constructor(e){let t;if(super(e=e||{}),this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=void 0!==e.features?e.features:null,e.layers&&!this.features_)if("function"==typeof e.layers)t=e.layers;else{const i=e.layers;t=function(r){return i.includes(r)}}else t=H.uX;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:H.uX,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Z.Bx,this.lastFeature_=null,this.addChangeListener(ot.Z.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new X.Z([this.lastFeature_]);return this.dispatchEvent(new De("translatestart",t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new X.Z([this.lastFeature_]);return this.dispatchEvent(new De("translateend",t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate,i=t[0]-this.lastCoordinate_[0],r=t[1]-this.lastCoordinate_[1],s=this.features_||new X.Z([this.lastFeature_]);s.forEach(function(a){const l=a.getGeometry();l.translate(i,r),a.setGeometry(l)}),this.lastCoordinate_=t,this.dispatchEvent(new De("translating",s,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(i,r)=>{if(i instanceof S.Z&&this.filter_(i,r)&&(!this.features_||this.features_.getArray().includes(i)))return i},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const i=this.getActive();(!t||!i)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}};var k=m(4624),Re=m(7053),z=m(5947),j=m(109);const $=1,lt=[0,0,0,0],Q=[];class Je extends Oe.ZP{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}function pn(o,e){return o.index-e.index}function ct(o,e,t){const i=e.geometry;if("Circle"===i.getType()){let s=i;if(e.index===$){const a=(0,_.Cs)();a&&(s=s.clone().transform(a,t));const l=(0,w.bI)(s.getCenter(),(0,_.Vs)(o,t)),c=Math.sqrt(l)-s.getRadius();return c*c}}const r=(0,_.Vs)(o,t);return Q[0]=(0,_.Vs)(e.segment[0],t),Q[1]=(0,_.Vs)(e.segment[1],t),(0,w.Bs)(r,Q)}function dt(o,e,t){const i=e.geometry;if("Circle"===i.getType()&&e.index===$){let s=i;const a=(0,_.Cs)();return a&&(s=s.clone().transform(a,t)),(0,_.lO)(s.getClosestPoint((0,_.Vs)(o,t)),t)}const r=(0,_.Vs)(o,t);return Q[0]=(0,_.Vs)(e.segment[0],t),Q[1]=(0,_.Vs)(e.segment[1],t),(0,_.lO)((0,w.oL)(r,Q),t)}function mn(){const o=(0,j.Ly)();return function(e,t){return o.Point}}const yn=class fn extends fe.Z{constructor(e){let t;if(super(e),this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Z.Xp,this.defaultDeleteCondition_=function(i){return(0,Z.Ko)(i)&&(0,Z.Kf)(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Z.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new rt.Z,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Re.Z({source:new z.Z({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:mn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new X.Z(this.source_.getFeatures()),this.source_.addEventListener(pe.Z.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(pe.Z.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ge.Z.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ge.Z.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(Y.Z.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new X.Z;const i=this.featuresBeingModified_.getArray();for(let r=0,s=t.length;r<s;++r){const a=t[r];for(let l=0,c=a.length;l<c;++l){const d=a[l].feature;d&&!i.includes(d)&&this.featuresBeingModified_.push(d)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new Je("modifystart",this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Y.Z.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(r){e===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const s=i[r];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===s&&this.dragSegments_.splice(a,1);t.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),r={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),r)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r],l={feature:e,geometry:t,depth:[r],index:r,segment:[a,a]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length-1;r<s;++r){const a=i.slice(r,r+2),l={feature:e,geometry:t,index:r,segment:a};this.rBush_.insert((0,x.hI)(a),l)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),u={feature:e,geometry:t,depth:[r],index:l,segment:d};this.rBush_.insert((0,x.hI)(d),u)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),u={feature:e,geometry:t,depth:[r],index:l,segment:d};this.rBush_.insert((0,x.hI)(d),u)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let u=0,f=d.length-1;u<f;++u){const h=d.slice(u,u+2),g={feature:e,geometry:t,depth:[l,r],index:u,segment:h};this.rBush_.insert((0,x.hI)(h),g)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),r={feature:e,geometry:t,index:0,segment:[i,i]},s={feature:e,geometry:t,index:$,segment:[i,i]},a=[r,s];r.featureSegments=a,s.featureSegments=a,this.rBush_.insert((0,x.HK)(i),r);let l=t;const c=(0,_.Cs)();if(c&&this.getMap()){const d=this.getMap().getView().getProjection();l=l.clone().transform(c,d),l=(0,M.Bb)(l).transform(d,c)}this.rBush_.insert(l.getExtent(),s)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const s=i[r];(0,this.SEGMENT_WRITERS_[s.getType()])(e,s)}}createOrUpdateVertexFeature_(e,t,i){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new S.Z(new N.Z(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",i),r}handleEvent(e){if(!e.originalEvent)return!0;let t;return this.lastPointerEvent_=e,!e.map.getView().getInteracting()&&e.type==k.Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=k.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==k.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],r=[];for(let s=0,a=this.dragSegments_.length;s<a;++s){const l=this.dragSegments_[s],c=l[0],d=c.feature;i.includes(d)||i.push(d);const u=c.geometry;r.includes(u)||r.push(u);const f=c.depth;let h;const g=c.segment,p=l[1];for(;t.length<u.getStride();)t.push(g[p][t.length]);switch(u.getType()){case"Point":h=t,g[0]=t,g[1]=t;break;case"MultiPoint":h=u.getCoordinates(),h[c.index]=t,g[0]=t,g[1]=t;break;case"LineString":h=u.getCoordinates(),h[c.index+p]=t,g[p]=t;break;case"MultiLineString":case"Polygon":h=u.getCoordinates(),h[f[0]][c.index+p]=t,g[p]=t;break;case"MultiPolygon":h=u.getCoordinates(),h[f[1]][f[0]][c.index+p]=t,g[p]=t;break;case"Circle":if(g[0]=t,g[1]=t,0===c.index)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const C=e.map.getView().getProjection();let b=(0,w.TE)((0,_.Vs)(u.getCenter(),C),(0,_.Vs)(t,C));const F=(0,_.Cs)();if(F){const E=u.clone().transform(F,C);E.setRadius(b),b=E.transform(C,F).getRadius()}u.setRadius(b),this.changingFeature_=!1}}h&&this.setGeometryCoordinates_(u,h)}this.createOrUpdateVertexFeature_(t,i,r)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const r=e.map.getView().getProjection(),s=[],a=i.getGeometry().getCoordinates(),l=(0,x.hI)([a]),c=this.rBush_.getInExtent(l),d={};c.sort(pn);for(let u=0,f=c.length;u<f;++u){const h=c[u],g=h.segment;let p=(0,v.sq)(h.geometry);const C=h.depth;if(C&&(p+="-"+C.join("-")),d[p]||(d[p]=new Array(2)),"Circle"!==h.geometry.getType()||h.index!==$)if(!(0,w.fS)(g[0],a)||d[p][0])if(!(0,w.fS)(g[1],a)||d[p][1])(0,v.sq)(g)in this.vertexSegments_&&!d[p][0]&&!d[p][1]&&this.insertVertexCondition_(e)&&s.push(h);else{if(d[p][0]&&0===d[p][0].index){let b=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":b=b[C[1]];case"Polygon":if(h.index!==b[C[0]].length-2)continue}}this.dragSegments_.push([h,1]),d[p][1]=h}else this.dragSegments_.push([h,0]),d[p][0]=h;else{const b=dt(t,h,r);(0,w.fS)(b,a)&&!d[p][0]&&(this.dragSegments_.push([h,0]),d[p][0]=h)}}s.length&&this.willModifyFeatures_(e,[s]);for(let u=s.length-1;u>=0;--u)this.insertVertex_(s[u],a)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],r=i.geometry;if("Circle"===r.getType()){const s=r.getCenter(),a=i.featureSegments[0],l=i.featureSegments[1];a.segment[0]=s,a.segment[1]=s,l.segment[0]=s,l.segment[1]=s,this.rBush_.update((0,x.HK)(s),a);let c=r;const d=(0,_.Cs)();if(d){const u=e.map.getView().getProjection();c=c.clone().transform(d,u),c=(0,M.Bb)(c).transform(u,d)}this.rBush_.update(c.getExtent(),l)}else this.rBush_.update((0,x.hI)(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Je("modifyend",this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const r=i||t.getCoordinateFromPixel(e),s=t.getView().getProjection(),a=function(d,u){return ct(r,d,s)-ct(r,u,s)};let l,c;if(this.hitDetection_&&t.forEachFeatureAtPixel(e,(u,f,h)=>{const g=h||u.getGeometry();if("Point"===g.getType()&&u instanceof S.Z&&this.features_.getArray().includes(u)){c=g;const p=c.getFlatCoordinates().slice(0,2);l=[{feature:u,geometry:c,segment:[p,p]}]}return!0},{layerFilter:"object"==typeof this.hitDetection_?u=>u===this.hitDetection_:void 0}),!l){const d=(0,_.dY)((0,x.HK)(r,lt),s),u=t.getView().getResolution()*this.pixelTolerance_,f=(0,_.Fj)((0,x.f3)(d,u,lt),s);l=this.rBush_.getInExtent(f)}if(l&&l.length>0){const d=l.sort(a)[0],u=d.segment;let f=dt(r,d,s);const h=t.getPixelFromCoordinate(f);let g=(0,w.TE)(e,h);if(c||g<=this.pixelTolerance_){const p={};if(p[(0,v.sq)(u)]=!0,this.snapToPointer_||(this.delta_[0]=f[0]-r[0],this.delta_[1]=f[1]-r[1]),"Circle"===d.geometry.getType()&&d.index===$)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(f,[d.feature],[d.geometry]);else{const C=t.getPixelFromCoordinate(u[0]),b=t.getPixelFromCoordinate(u[1]),F=(0,w.bI)(h,C),E=(0,w.bI)(h,b);g=Math.sqrt(Math.min(F,E)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(f=F>E?u[1]:u[0]),this.createOrUpdateVertexFeature_(f,[d.feature],[d.geometry]);const U={};U[(0,v.sq)(d.geometry)]=!0;for(let Pe=1,Gi=l.length;Pe<Gi;++Pe){const ee=l[Pe].segment;if(!((0,w.fS)(u[0],ee[0])&&(0,w.fS)(u[1],ee[1])||(0,w.fS)(u[0],ee[1])&&(0,w.fS)(u[1],ee[0])))break;{const Lt=(0,v.sq)(l[Pe].geometry);Lt in U||(U[Lt]=!0,p[(0,v.sq)(ee)]=!0)}}}return void(this.vertexSegments_=p)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,r=e.feature,s=e.geometry,a=e.depth,l=e.index;let c;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":case"Polygon":c=s.getCoordinates(),c[a[0]].splice(l+1,0,t);break;case"MultiPolygon":c=s.getCoordinates(),c[a[1]][a[0]].splice(l+1,0,t);break;case"LineString":c=s.getCoordinates(),c.splice(l+1,0,t);break;default:return}this.setGeometryCoordinates_(s,c);const d=this.rBush_;d.remove(e),this.updateSegmentIndices_(s,l,a,1);const u={segment:[i[0],t],feature:r,geometry:s,depth:a,index:l};d.insert((0,x.hI)(u.segment),u),this.dragSegments_.push([u,1]);const f={segment:[t,i[1]],feature:r,geometry:s,depth:a,index:l+1};d.insert((0,x.hI)(f.segment),f),this.dragSegments_.push([f,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=k.Z.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Je("modifyend",this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let r,s,a,l,c,d,u,f,h,g,p,i=!1;for(c=e.length-1;c>=0;--c)a=e[c],g=a[0],p=(0,v.sq)(g.feature),g.depth&&(p+="-"+g.depth.join("-")),p in t||(t[p]={}),0===a[1]?(t[p].right=g,t[p].index=g.index):1==a[1]&&(t[p].left=g,t[p].index=g.index+1);for(p in t){switch(h=t[p].right,u=t[p].left,d=t[p].index,f=d-1,g=void 0!==u?u:h,f<0&&(f=0),l=g.geometry,s=l.getCoordinates(),r=s,i=!1,l.getType()){case"MultiLineString":s[g.depth[0]].length>2&&(s[g.depth[0]].splice(d,1),i=!0);break;case"LineString":s.length>2&&(s.splice(d,1),i=!0);break;case"MultiPolygon":r=r[g.depth[1]];case"Polygon":r=r[g.depth[0]],r.length>4&&(d==r.length-1&&(d=0),r.splice(d,1),i=!0,0===d&&(r.pop(),r.push(r[0]),f=r.length-1))}if(i){this.setGeometryCoordinates_(l,s);const C=[];if(void 0!==u&&(this.rBush_.remove(u),C.push(u.segment[0])),void 0!==h&&(this.rBush_.remove(h),C.push(h.segment[1])),void 0!==u&&void 0!==h){const b={depth:g.depth,feature:g.feature,geometry:g.geometry,index:f,segment:C};this.rBush_.insert((0,x.hI)(b.segment),b)}this.updateSegmentIndices_(l,d,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,r){this.rBush_.forEachInExtent(e.getExtent(),function(s){s.geometry===e&&(void 0===i||void 0===s.depth||(0,R.fS)(s.depth,i))&&s.index>t&&(s.index+=r)})}};var ut=m(874);class me extends B.ZP{constructor(e,t,i){super(),void 0!==i&&void 0===t?this.setFlatCoordinates(i,e):this.setCenterAndRadius(e,t=t||0,i)}clone(){const e=new me(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const s=this.flatCoordinates,a=e-s[0],l=t-s[1],c=a*a+l*l;if(c<r){if(0===c)for(let d=0;d<this.stride;++d)i[d]=s[d];else{const d=this.getRadius()/Math.sqrt(c);i[0]=s[0]+d*a,i[1]=s[1]+d*l;for(let u=2;u<this.stride;++u)i[u]=s[u]}return i.length=this.stride,c}return r}containsXY(e,t){const i=this.flatCoordinates,r=e-i[0],s=t-i[1];return r*r+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return(0,x.T9)(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if((0,x.kK)(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]||(0,x.H6)(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+i;for(let s=1;s<t;++s)r[t+s]=e[s];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let s=(0,oe.IG)(r,0,e,this.stride);r[s++]=r[0]+t;for(let a=1,l=this.stride;a<l;++a)r[s++]=r[a];r.length=s,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),r=this.getStride();this.setCenter((0,ut.U1)(i,0,i.length,r,e,t,i)),this.changed()}translate(e,t){const i=this.getCenter(),r=this.getStride();this.setCenter((0,ut.Iu)(i,0,i.length,r,e,t,i)),this.changed()}}const _n=me;var Cn=m(1994);class _e extends Oe.ZP{constructor(e,t){super(e),this.feature=t}}function Ce(o,e){return(0,W.bI)(o[0],o[1],e[0],e[1])}function V(o,e){const t=o.length;return e<0?o[e+t]:e>=t?o[e-t]:o[e]}function xe(o,e,t){let i,r;e<t?(i=e,r=t):(i=t,r=e);const s=Math.ceil(i),a=Math.floor(r);if(s>a)return Ce(q(o,i),q(o,r));let l=0;i<s&&(l+=Ce(q(o,i),V(o,s))),a<r&&(l+=Ce(V(o,a),q(o,r)));for(let c=s;c<a-1;++c)l+=Ce(V(o,c),V(o,c+1));return l}function ht(o,e,t){if(e instanceof G.Z)ve(o,e.getCoordinates(),!1,t);else if(e instanceof le){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r)ve(o,i[r],!1,t)}else if(e instanceof M.ZP){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r)ve(o,i[r],!0,t)}else if(e instanceof ue){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let l=0,c=a.length;l<c;++l)ve(o,a[l],!0,t)}}else if(e instanceof K){const i=e.getGeometries();for(let r=0;r<i.length;++r)ht(o,i[r],t)}}const Ue={index:-1,endIndex:NaN};function ve(o,e,t,i){const r=o[0],s=o[1];for(let a=0,l=e.length-1;a<l;++a){const u=gt(r,s,e[a],e[a+1]);if(0===u.squaredDistance){const f=a+u.along;return void i.push({coordinates:e,ring:t,startIndex:f,endIndex:f})}}}const Be={along:0,squaredDistance:0};function gt(o,e,t,i){const r=t[0],s=t[1],c=i[0]-r,d=i[1]-s;let u=0,f=r,h=s;return(0!==c||0!==d)&&(u=(0,W.uZ)(((o-r)*c+(e-s)*d)/(c*c+d*d),0,1),f+=c*u,h+=d*u),Be.along=u,Be.squaredDistance=(0,W.FH)((0,W.bI)(o,e,f,h),10),Be}function q(o,e){const t=o.length;let i=Math.floor(e);const r=e-i;i>=t?i-=t:i<0&&(i+=t);let s=i+1;s>=t&&(s-=t);const a=o[i],l=a[0],c=a[1],d=o[s];return[l+(d[0]-l)*r,c+(d[1]-c)*r]}function bn(){const o=(0,j.Ly)();return function(e,t){return o[e.getGeometry().getType()]}}const Fn=class Tn extends fe.Z{constructor(e){const t=e;t.stopDown||(t.stopDown=H.Dv),super(t),this.shouldHandle_=!1,this.downPx_=null,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function wn(o){switch(o){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+o)}}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:H.uX,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const r=this.mode_;if("Circle"===r)i=function(s,a,l){const c=a||new _n([NaN,NaN]),d=(0,_.Vs)(s[0],l),u=(0,w.bI)(d,(0,_.Vs)(s[s.length-1],l));c.setCenterAndRadius(d,Math.sqrt(u),this.geometryLayout_);const f=(0,_.Cs)();return f&&c.transform(l,f),c};else{let s;"Point"===r?s=N.Z:"LineString"===r?s=G.Z:"Polygon"===r&&(s=M.ZP),i=function(a,l,c){return l?l.setCoordinates("Polygon"===r?a[0].length?[a[0].concat([a[0][0]])]:[]:a,this.geometryLayout_):l=new s(a,this.geometryLayout_),l}}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Re.Z({source:new z.Z({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:bn(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Z.rM,this.freehandCondition_=e.freehand?Z.Bx:e.freehandCondition?e.freehandCondition:Z.vY,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(ot.Z.ACTIVE,this.updateState_)}setTrace(e){let t;t=e?!0===e?Z.Bx:e:Z.Fi,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Y.Z.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);let t=e.type===k.Z.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===k.Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===k.Z.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===k.Z.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===k.Z.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===k.Z.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e)):e.type===k.Z.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Cn.Z(k.Z.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),r=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),s=(0,x.hI)([i,r]),a=this.traceSource_.getFeaturesInExtent(s);if(0===a.length)return;const l=function xn(o,e){const t=[];for(let i=0;i<e.length;++i)ht(o,e[i].getGeometry(),t);return t}(e.coordinate,a);l.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:l,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex;i===e.startIndex<=t?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const r=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),i=s-r+1}else{const r=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),i=r-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const r=[];if(t<i){const s=Math.ceil(t);let a=Math.floor(i);a===i&&(a-=1);for(let l=s;l<=a;++l)r.push(V(e.coordinates,l))}else{const s=Math.floor(t);let a=Math.ceil(i);a===i&&(a+=1);for(let l=s;l>=a;--l)r.push(V(e.coordinates,l))}r.length&&this.appendCoordinates(r)}updateTrace_(e){const t=this.traceState_;if(!t.active||-1===t.targetIndex&&(0,w.TE)(t.startPx,e.pixel)<this.snapTolerance_)return;const i=function vn(o,e,t,i){const r=o[0],s=o[1];let a=1/0,l=-1,c=NaN;for(let f=0;f<e.targets.length;++f){const h=e.targets[f],g=h.coordinates;let C,p=1/0;for(let b=0;b<g.length-1;++b){const U=gt(r,s,g[b],g[b+1]);U.squaredDistance<p&&(p=U.squaredDistance,C=b+U.along)}p<a&&(a=p,h.ring&&e.targetIndex===f&&(h.endIndex>h.startIndex?C<h.startIndex&&(C+=g.length):h.endIndex<h.startIndex&&C>h.startIndex&&(C-=g.length)),c=C,l=f)}const d=e.targets[l];let u=d.ring;if(e.targetIndex===l&&u){const f=q(d.coordinates,c),h=t.getPixelFromCoordinate(f);(0,w.TE)(h,e.startPx)>i&&(u=!1)}if(u){const f=d.coordinates,h=f.length,g=d.startIndex,p=c;if(g<p){const C=xe(f,g,p);xe(f,g,p-h)<C&&(c-=h)}else{const C=xe(f,g,p);xe(f,g,p+h)<C&&(c+=h)}}return Ue.index=l,Ue.endIndex=c,Ue}(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(-1!==t.targetIndex){const c=t.targets[t.targetIndex];this.removeTracedCoordinates_(c.startIndex,c.endIndex)}const l=t.targets[i.index];this.addTracedCoordinates_(l,l.startIndex,i.endIndex)}else this.addOrRemoveTracedCoordinates_(t.targets[t.targetIndex],i.endIndex);t.targetIndex=i.index;const r=t.targets[t.targetIndex];r.endIndex=i.endIndex;const s=q(r.coordinates,r.endIndex),a=this.getMap().getPixelFromCoordinate(s);e.coordinate=s,e.pixel=[Math.round(a[0]),Math.round(a[1])]}handleUpEvent(e){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(e.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||"Point"===this.mode_)&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,r=t[0]-i[0],s=t[1]-i[1],a=r*r+s*s;if(this.shouldHandle_=this.freehand_?a>this.squaredClickTolerance_:a<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(e),this.modifyDrawing_(e.coordinate)):this.createOrUpdateSketchPoint_(e.coordinate.slice())}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let r=!1,s=[this.finishCoordinate_];const a=this.mode_;if("Point"===a)i=!0;else if("Circle"===a)i=2===this.sketchCoords_.length;else if("LineString"===a)r=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===a){const l=this.sketchCoords_;r=l[0].length>this.minPoints_,s=[l[0][0],l[0][l[0].length-2]],s=t?[l[0][0]]:[l[0][0],l[0][l[0].length-2]]}if(r){const l=this.getMap();for(let c=0,d=s.length;c<d;c++){const u=s[c],f=l.getPixelFromCoordinate(u),h=e[0]-f[0],g=e[1]-f[1],p=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(h*h+g*g)<=p,i){this.finishCoordinate_=u;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new S.Z(new N.Z(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new S.Z);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new G.Z(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=(0,B.tP)(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new S.Z(new G.Z(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new S.Z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new _e("drawstart",this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),r=t.getView().getProjection(),s=(0,B.tP)(this.geometryLayout_);let a,l;for(;e.length<s;)e.push(0);"Point"===this.mode_?l=this.sketchCoords_:"Polygon"===this.mode_?(a=this.sketchCoords_[0],l=a[a.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(a=this.sketchCoords_,l=a[a.length-1]),l[0]=e[0],l[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),"Polygon"===i.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,s;const a=this.mode_;"LineString"===a||"Circle"===a?(this.finishCoordinate_=e.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(e.slice()),this.geometryFunction_(s,t,i)):"Polygon"===a&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(e.slice()),r&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),r&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let s=0;s<e;++s){let a;if("LineString"===r||"Circle"===r){if(a=this.sketchCoords_,a.splice(-2,1),a.length>=2){this.finishCoordinate_=a[a.length-2].slice();const l=this.finishCoordinate_.slice();a[a.length-1]=l,this.createOrUpdateSketchPoint_(l)}this.geometryFunction_(a,t,i),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===r){a=this.sketchCoords_[0],a.splice(-2,1);const l=this.sketchLine_.getGeometry();if(a.length>=2){const c=a[a.length-2].slice();a[a.length-1]=c,this.createOrUpdateSketchPoint_(c)}l.setCoordinates(a),this.geometryFunction_(this.sketchCoords_,t,i)}if(1===a.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const i=e.getGeometry(),r=this.getMap().getView().getProjection();"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,i,r)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,i,r),t=i.getCoordinates()),"MultiPoint"===this.type_?e.setGeometry(new ce([t])):"MultiLineString"===this.type_?e.setGeometry(new le([t])):"MultiPolygon"===this.type_&&e.setGeometry(new ue([t])),this.dispatchEvent(new _e("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new _e("drawabort",e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;let r;if(i&&this.startDrawing_(e[0]),"LineString"===t||"Circle"===t)r=this.sketchCoords_;else{if("Polygon"!==t)return;r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&r.shift(),r.pop();for(let a=0;a<e.length;a++)this.addToDrawing_(e[a]);const s=e[e.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new S.Z(new N.Z(r)),this.updateSketchFeatures_(),this.dispatchEvent(new _e("drawstart",this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}};var Pn=m(154);function Te(o){return"string"==typeof o?o:""}const En=class Ln extends We{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(Te(e),this.adaptOptions(t))}readFeatureFromText(e,t){return(0,v.O3)()}readFeatures(e,t){return this.readFeaturesFromText(Te(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return(0,v.O3)()}readGeometry(e,t){return this.readGeometryFromText(Te(e),this.adaptOptions(t))}readGeometryFromText(e,t){return(0,v.O3)()}readProjection(e){return this.readProjectionFromText(Te(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return(0,v.O3)()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return(0,v.O3)()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return(0,v.O3)()}},Sn={POINT:N.Z,LINESTRING:G.Z,POLYGON:M.ZP,MULTIPOINT:ce,MULTILINESTRING:le,MULTIPOLYGON:ue},ft="EMPTY",pt="Z",mt="M",kn={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Mn{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=void 0!==t&&t,e>="0"&&e<="9"||"."==e&&!t}isWhiteSpace_(e){return" "==e||"\t"==e||"\r"==e||"\n"==e}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let r,i=e;if("("==e)r=2;else if(","==e)r=5;else if(")"==e)r=3;else if(this.isNumeric_(e)||"-"==e)r=4,i=this.readNumber_();else if(this.isAlpha_(e))r=1,i=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);r=6}return{position:t,value:i,type:r}}readNumber_(){let e;const t=this.index_;let i=!1,r=!1;do{"."==e?i=!0:("e"==e||"E"==e)&&(r=!0),e=this.nextChar_()}while(this.isNumeric_(e,i)||!r&&("e"==e||"E"==e)||r&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class Zn{constructor(e){this.lexer_=e,this.token_={position:0,type:0},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(1)){const i=t.value;i===pt?e="XYZ":i===mt?e="XYM":"ZM"===i&&(e="XYZM"),"XY"!==e&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(2)){const e=[];do{e.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(2)){const e=this.parsePoint_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(2)){const e=this.parsePointList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(2)){const e=this.parseLineStringTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(2)){let e;if(e=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(2)){const e=this.parseLineStringTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(2)){const e=this.parsePolygonTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let i=0;i<t;++i){const r=this.token_;if(!this.match(4))break;e.push(r.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(5);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(5);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(5);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(5);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(1)&&this.token_.value==ft;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(1)){const t=e.value;this.layout_=this.parseGeometryLayout_();const i=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==t){if(i)return new K([]);const a=this.parseGeometryCollectionText_();return new K(a)}const r=Sn[t];if(!r)throw new Error("Invalid geometry type: "+t);let s;if(i)s="POINT"==t?[NaN,NaN]:[];else switch(t){case"POINT":s=this.parsePointText_();break;case"LINESTRING":s=this.parseLineStringText_();break;case"POLYGON":s=this.parsePolygonText_();break;case"MULTIPOINT":s=this.parseMultiPointText_();break;case"MULTILINESTRING":s=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":s=this.parseMultiPolygonText_()}return new r(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}function yt(o){const e=o.getCoordinates();return 0===e.length?"":e.join(" ")}function He(o){const e=o.getCoordinates(),t=[];for(let i=0,r=e.length;i<r;++i)t.push(e[i].join(" "));return t.join(",")}function _t(o){const e=[],t=o.getLinearRings();for(let i=0,r=t.length;i<r;++i)e.push("("+He(t[i])+")");return e.join(",")}const jn={Point:yt,LineString:He,Polygon:_t,MultiPoint:function An(o){const e=[],t=o.getPoints();for(let i=0,r=t.length;i<r;++i)e.push("("+yt(t[i])+")");return e.join(",")},MultiLineString:function Nn(o){const e=[],t=o.getLineStrings();for(let i=0,r=t.length;i<r;++i)e.push("("+He(t[i])+")");return e.join(",")},MultiPolygon:function Dn(o){const e=[],t=o.getPolygons();for(let i=0,r=t.length;i<r;++i)e.push("("+_t(t[i])+")");return e.join(",")},GeometryCollection:function On(o){const e=[],t=o.getGeometries();for(let i=0,r=t.length;i<r;++i)e.push(Ct(t[i]));return e.join(",")}};function Ct(o){const e=o.getType(),i=(0,jn[e])(o);let r=kn[e];if("function"==typeof o.getFlatCoordinates){const s=function Rn(o){const e=o.getLayout();let t="";return("XYZ"===e||"XYZM"===e)&&(t+=pt),("XYM"===e||"XYZM"===e)&&(t+=mt),t}(o);s.length>0&&(r+=" "+s)}return 0===i.length?r+" "+ft:r+"("+i+")"}const xt=class Gn extends En{constructor(e){super(),this.splitCollection_=void 0!==(e=e||{}).splitCollection&&e.splitCollection}parse_(e){const t=new Mn(e);return new Zn(t).parse()}readFeatureFromText(e,t){const i=this.readGeometryFromText(e,t),r=new S.Z;return r.setGeometry(i),r}readFeaturesFromText(e,t){let i=[];const r=this.readGeometryFromText(e,t);i=this.splitCollection_&&"GeometryCollection"==r.getType()?r.getGeometriesArray():[r];const s=[];for(let a=0,l=i.length;a<l;++a){const c=new S.Z;c.setGeometry(i[a]),s.push(c)}return s}readGeometryFromText(e,t){return ie(this.parse_(e),!1,t)}writeFeatureText(e,t){const i=e.getGeometry();return i?this.writeGeometryText(i,t):""}writeFeaturesText(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);const i=[];for(let s=0,a=e.length;s<a;++s)i.push(e[s].getGeometry());const r=new K(i);return this.writeGeometryText(r,t)}writeGeometryText(e,t){return Ct(ie(e,!0,t))}};var Jn=m(3324),be=m(5044),Un=m(7392),we=m(6785);class Vn{constructor(e,t,i,r,s=null){this.counter=0,this.holePolygonDrawingStatus=!1,this.allFeatures=[],this.fillColor="#ffcc33",this.strokeColor="black",this.strokeWidth=2,this.deleted=!1,this.locked=!1,this.featuresSelected=[],this.featuresDeselected=[],this.zoomPadding=[100,100,100,100],this.maxZoom=14,this.map=e,this.layerName=t,this.geomType=i,this.groupId=s,this.id=it(),this.zIndexValue=r,this.setLayer(),this.initSelect(),this.initTranslate(),this.initSnap(),this.initModifier(),this.map.addLayer(this.vectorLayer)}setLayer(){this.sourceFeatures=new z.Z,this.vectorLayer=new Re.Z({source:this.sourceFeatures,style:(e,t)=>Tt(e)}),this.vectorLayer.set("name",this.layerName,!0),this.vectorLayer.set("geomType",this.geomType,!0),this.vectorLayer.setZIndex(this.zIndexValue)}removeLayer(){this.map.removeLayer(this.vectorLayer),this.deleted=!0}initSelect(){this.select=new Jn.Z({condition:Z.V4,multi:!1,layers:[this.vectorLayer]})}initSnap(){this.snap=new un({source:this.sourceFeatures})}initTranslate(){this.translate=new gn({features:this.select.getFeatures()})}enableTranslating(){this.map.addInteraction(this.translate)}disableTranslating(){this.map.removeInteraction(this.translate)}enableSelecting(){this.map.addInteraction(this.select)}disableSelecting(){this.map.removeInteraction(this.select)}initModifier(){this.modifier=new yn({features:this.select.getFeatures()}),this.modifier.on("modifyend",e=>{e.mapBrowserEvent.originalEvent.ctrlKey&&this.removeHoles(e),e.features.getArray().length>0&&e.features.getArray().forEach(t=>{this.updateFeature(t)})})}enableDrawing(e=!1){this.holePolygonDrawingStatus=e,this.draw=new Fn({type:this.geomType,stopClick:!1,source:this.vectorLayer.getSource()}),this.map.addInteraction(this.draw),this.map.addInteraction(this.snap),this.draw.on("drawstart",this.onDrawStart.bind(this)),this.draw.on("drawend",this.onDrawEnd.bind(this)),this.draw.on("drawabort",this.onDrawAborting.bind(this))}disableDrawing(){this.map.removeInteraction(this.draw),this.map.removeInteraction(this.snap)}enableEditing(){this.disableEditing(),this.map.addInteraction(this.modifier),this.map.addInteraction(this.snap)}disableEditing(){this.map.removeInteraction(this.modifier),this.map.removeInteraction(this.snap)}cleanEvents(){this.disableDrawing(),this.disableEditing(),this.disableSelecting()}onDrawAborting(e){this.holePolygonDrawingStatus&&void 0!==this.polygonIntersected&&(this.polygonIntersected.setGeometry(this.previousPolygonGeometry),this.polygonIntersected=void 0)}onDrawStart(e){if(this.holePolygonDrawingStatus&&"Polygon"===e.feature.getGeometry()?.getType()){let t=this.checkIfCoordIntersectLayer(e.feature);if(this.polygonIntersected=t,void 0===this.polygonIntersected)return e.target.abortDrawing(),this.onDrawAborting(e),void alert("An hole is possible only on a polygon!");if(void 0!==this.polygonIntersected){this.previousPolygonGeometry=this.polygonIntersected.getGeometry();const i=this.polygonIntersected.getGeometry();this.coordsLength=i.getCoordinates().length,e.feature.getGeometry().on("change",this.onGeomChangeBuildHole.bind(this))}}}checkIfCoordIntersectLayer(e){let t;return this.vectorLayer.getSource().forEachFeatureIntersectingExtent(e.getGeometry().getExtent(),i=>{t=i}),t}onDrawEnd(e){if(this.holePolygonDrawingStatus)return setTimeout(()=>{this.sourceFeatures.removeFeature(e.feature)},5),void 0!==this.polygonIntersected&&(e.feature.setGeometry(this.polygonIntersected.getGeometry()),this.select.getFeatures().clear()),void(this.polygonIntersected=void 0);this.addProperties(e.feature)}addProperties(e){++this.counter;const t=it();let i;return e.setId(t),i=void 0!==e.get("name")?e.get("name")+" copy":"feature "+this.counter,e.setProperties({id:e.getId(),layer_id:this.id,no:this.counter,name:i,geom_type:e.getGeometry()?.getType(),status:"added",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},!0),void 0===e.get("fill_color")&&e.set("fill_color",this.fillColor,!0),void 0===e.get("stroke_width")&&e.set("stroke_width",this.strokeWidth,!0),void 0===e.get("stroke_color")&&e.set("stroke_color",this.strokeColor,!0),e}addFeaturesAndUpdateIds(e){e.length>0&&e.forEach(t=>{let i=t.clone(),r=this.addProperties(i);this.sourceFeatures.addFeature(r)})}onGeomChangeBuildHole(e){if(void 0!==this.polygonIntersected){let i=this.polygonIntersected.getGeometry().getCoordinates(),r=new M.ZP(i.slice(0,this.coordsLength)),s=new Pn.Z(e.target.getCoordinates()[0]);r.appendLinearRing(s),this.polygonIntersected.setGeometry(r)}}removeFeature(e){const t=this.sourceFeatures.getFeatureById(e);null!==t&&this.sourceFeatures.removeFeature(t)}duplicateFeature(e){const t=this.sourceFeatures.getFeatureById(e);if(null!==t){const i=this.addProperties(t.clone());this.sourceFeatures.addFeature(i)}}getFeatureAttribute(e,t){const i=this.sourceFeatures.getFeatureById(e);if(null!==i)return i.get(t)}features(){return this.deleted?[]:this.sourceFeatures.getFeatures().sort((t,i)=>t.get("no")-i.get("no"))}removeHoles(e){const t=e.features.getArray()[0],i=e.mapBrowserEvent.coordinate;if("Polygon"==t.getGeometry().getType()){const r=t.getGeometry().getLinearRings();if(r.length>1){let s=new z.Z;r.forEach((c,d)=>{const u=new G.Z(c.getCoordinates());let f=new S.Z({geometry:u});f.setId(d),s.addFeature(f)});const a=s.getClosestFeatureToCoordinate(i);let l=[];r.forEach((c,d)=>{d!==a.getId()&&l.push(c.getCoordinates())}),t.getGeometry().setCoordinates(l)}}}updateFeature(e){e.setProperties({updated_at:(new Date).toISOString(),status:"modified"},!0)}getOpacity(){return this.vectorLayer.getOpacity()}setOpacity(e){this.vectorLayer.setOpacity(e.target.valueAsNumber)}setName(e){this.layerName=e.target.value,this.vectorLayer.set("name",this.layerName,!0)}setStyleForAllFeatures(e,t){let i;"stroke_width"===t?i=e.target.value:(i=e,"fill_color"===t?this.fillColor=e:"stroke_color"===t&&(this.strokeColor=e)),this.features().forEach(r=>{r.set(t,i,!1)})}exportBounds(){return this.sourceFeatures.getExtent().join(",").split(",").map(Number)}exportBoundsPolygon(){const e=this.exportBounds(),i=new M.ZP([[[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]],[e[0],e[3]]]]);return{Polygon:[new S.Z({geometry:i})]}}exportToGeoJSON(){let e=new et;return JSON.stringify(JSON.parse(e.writeFeatures(this.features())),null,2)}exportToWkt(){let e=[];return this.features().forEach(t=>{e.push(Fe(t.getGeometry()))}),e.join("\n")}exportToPytestFixture(){let t=[];return void 0!==this.features()&&this.features().forEach(i=>{t.push("\n@pytest.fixture\ndef "+i.get("name").replace(" ","_")+"():\n\treturn '"+Fe(i.getGeometry())+"'")}),"import pytest\n"+t.join("\n")}zoomToLayer(){this.sourceFeatures.getFeatures().length>0&&this.map.getView().fit(this.sourceFeatures.getExtent(),{size:this.map.getSize(),maxZoom:this.maxZoom,padding:this.zoomPadding})}zoomToFeature(e){this.features().filter(t=>{t.getId()===e&&this.map.getView().fit(t.getGeometry(),{size:this.map.getSize(),maxZoom:this.maxZoom})})}}function vt(o,e,t){let i=[];const r=o.findIndex(l=>l.id===e),s=o[r].zIndexValue,a=s+t;return a>=0&&a<o.length?(o.splice(a,0,o.splice(s,1)[0]),o.forEach((l,c)=>{l.zIndexValue=c,l.vectorLayer.setZIndex(c),i.push(l)}),i):o}function Fe(o){return(new xt).writeGeometry(o)}function Tt(o){let e,t=o.getGeometry();if(void 0!==t){const i=o.get("fill_color"),r=o.get("stroke_width"),s=o.get("stroke_color");return"Point"===t.getType()?e=function qn(o,e,t){return new j.ZP({image:new Un.Z({radius:7,fill:new be.Z({color:o}),stroke:new we.Z({color:t,width:e})})})}(i,r,s):"LineString"===t.getType()?e=function Yn(o,e,t){return[new j.ZP({fill:new be.Z({color:o}),stroke:new we.Z({color:t,width:2*e})}),new j.ZP({fill:new be.Z({color:o}),stroke:new we.Z({color:o,width:e})})]}(i,r,s):"Polygon"===t.getType()&&(e=function Kn(o,e,t){return new j.ZP({fill:new be.Z({color:o}),stroke:new we.Z({color:t,width:e})})}(i,r,s)),e}return new j.ZP}var Qe=m(3396);let bt=(()=>{class o{constructor(){this.newFeatures=new O.x}addNewFeatures(t){this.newFeatures.next(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var J=m(4945);let wt=(()=>{class o{constructor(t,i){this._elemRef=t,this.renderer=i,this.isRemoved=!1,this.renderer.appendChild(document.body,this._elemRef.nativeElement)}ngOnChanges(t){t.isRemoved.currentValue&&this.ngOnDestroy()}ngOnDestroy(){this.renderer.removeChild(document.body,this._elemRef.nativeElement)}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(n.SBq),n.Y36(n.Qsj))},o.\u0275dir=n.lG2({type:o,selectors:[["","moveDivToBody",""]],inputs:{isRemoved:"isRemoved"},features:[n.TTD]}),o})();function zn(o,e){if(1&o&&(n.O4$(),n.TgZ(0,"svg",13),n._UZ(1,"circle",14),n.qZA()),2&o){const t=n.oxw();n.xp6(1),n.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",t.feature.get("stroke_width"))("fill",t.feature.get("fill_color"))}}function $n(o,e){if(1&o&&(n.O4$(),n.TgZ(0,"svg",13),n._UZ(1,"line",15)(2,"line",15),n.qZA()),2&o){const t=n.oxw();n.xp6(1),n.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",2*t.feature.get("stroke_width")),n.xp6(1),n.uIk("stroke",t.feature.get("fill_color"))("stroke-width",1.5*t.feature.get("stroke_width"))}}function ei(o,e){if(1&o&&(n.O4$(),n.TgZ(0,"svg",16),n._UZ(1,"rect",17),n.qZA()),2&o){const t=n.oxw();n.xp6(1),n.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",t.feature.get("stroke_width"))("fill",t.feature.get("fill_color"))}}function ti(o,e){if(1&o){const t=n.EpF();n.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"strong"),n._uU(4),n.qZA(),n.TgZ(5,"em",21),n._uU(6),n.qZA(),n.TgZ(7,"em",6),n._uU(8),n.qZA(),n.TgZ(9,"button",22),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.showPopup())}),n.qZA()(),n.TgZ(10,"div",23)(11,"div",24)(12,"span",25),n._uU(13,"Actions :"),n.qZA(),n.TgZ(14,"span",26),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.copyToClipboard(r.getWktFromFeature()))}),n._uU(15," WKT "),n.qZA(),n.TgZ(16,"span",27),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.copyToClipboard(r.getBoundsFromFeature()))}),n._uU(17," Bbox "),n.qZA()(),n.TgZ(18,"div",28)(19,"span"),n._uU(20),n.ALo(21,"date"),n.qZA(),n.TgZ(22,"span"),n._uU(23),n.ALo(24,"date"),n.qZA()(),n.TgZ(25,"div",29)(26,"h6",5),n._uU(27,"Style"),n.qZA(),n.TgZ(28,"div",30)(29,"span",31),n._uU(30,"Couleur de fond :"),n.qZA(),n.TgZ(31,"input",32,33),n.NdJ("change",function(){n.CHM(t);const r=n.MAs(32),s=n.oxw();return n.KtG(s.updateFillColor(r.value))}),n.qZA(),n._UZ(33,"label"),n.qZA(),n.TgZ(34,"div",30)(35,"span",31),n._uU(36,"Couleur du contour :"),n.qZA(),n.TgZ(37,"input",34,35),n.NdJ("change",function(){n.CHM(t);const r=n.MAs(38),s=n.oxw();return n.KtG(s.updateStrokeColor(r.value))}),n.qZA(),n._UZ(39,"label"),n.qZA(),n.TgZ(40,"div",30)(41,"span",31),n._uU(42,"Epaisseur du contour :"),n.qZA(),n.TgZ(43,"input",36),n.NdJ("change",function(r){n.CHM(t);const s=n.oxw();return n.KtG(s.updateStrokeWidth(r))}),n.qZA()()()()()()}if(2&o){const t=n.oxw();n.Q6J("id","featurePopup"+t.feature.getId()),n.xp6(4),n.Oqu(t.feature.get("name")),n.xp6(2),n.hij("(",t.feature.get("geom_type"),")"),n.xp6(2),n.hij("Couche: ",t.currentLayer.layerName,""),n.xp6(12),n.hij("Cr\xe9\xe9 \xe0 ",n.xi3(21,13,t.feature.get("created_at"),"HH:mm:ss"),""),n.xp6(3),n.hij("Modifi\xe9 \xe0 ",n.xi3(24,16,t.feature.get("updated_at"),"HH:mm:ss"),""),n.xp6(8),n.Q6J("id","fillColor-"+t.feature.getId())("value",t.feature.get("fill_color")),n.xp6(2),n.uIk("for","fillColor-"+t.feature.getId()),n.xp6(4),n.Q6J("id","strokeColor-"+t.feature.getId())("value",t.feature.get("stroke_color")),n.xp6(2),n.uIk("for","strokeColor-"+t.feature.getId()),n.xp6(4),n.Q6J("value",t.currentStrokeWidth)}}let ni=(()=>{class o{constructor(t){this.elementRef=t,this.disabledIcon=y.g82,this.duplicateIcon=Qe.WM4,this.centerIcon=y.TL5,this.paramIcon=y.gr5,this.displayPopup=!1}ngOnInit(){this.currentFillColor=this.feature.get("fill_color"),this.currentStrokeColor=this.feature.get("stroke_color"),this.currentStrokeWidth=this.feature.get("stroke_width")}ngOnDestroy(){this.elementRef.nativeElement.remove()}ngOnChanges(t){t.currentFeatureIdSelected&&t.currentFeatureIdSelected.currentValue!==this.feature.getId()&&(this.displayPopup=!1)}removeFeature(){this.currentLayer.removeFeature(this.feature.getId())}duplicateFeature(){this.currentLayer.select.getFeatures().clear(),this.currentLayer.duplicateFeature(this.feature.getId())}showPopup(){this.displayPopup=!this.displayPopup}copyToClipboard(t){const i=document.createElement("textarea");i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.opacity="0",i.value=t,document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),document.body.removeChild(i)}updateFillColor(t){this.feature.set("fill_color",t,!1)}updateStrokeWidth(t){this.feature.set("stroke_width",t.target.value,!0)}updateStrokeColor(t){this.feature.set("stroke_color",t,!0)}zoomToFeature(){this.currentLayer.zoomToFeature(this.feature.getId())}getWktFromFeature(){return Fe(this.feature.getGeometry())}getBoundsFromFeature(){return this.feature.getGeometry().getExtent().join(", ")}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(n.SBq))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-feature"]],inputs:{feature:"feature",currentFeatureIdSelected:"currentFeatureIdSelected",currentLayer:"currentLayer"},features:[n.TTD],decls:18,vars:9,consts:[[1,"feature","py-0","d-flex","align-items-center","pointer","border-bottom"],[1,"d-flex","flex-row","pointer","justify-content-start","align-items-center","flex-fill"],[1,"m-1"],["height","25","width","25",4,"ngIf"],["height","15","width","25",4,"ngIf"],[1,""],[1,"ms-auto"],["ngbPopover","Center sur l'object","triggers","mouseenter:mouseleave",1,"ms-auto","btn","p-1","bg-transparent","border-0",3,"click"],["size","xs",1,"",3,"icon"],["ngbPopover","Dupliquer l'object","triggers","mouseenter:mouseleave",1,"ms-auto","btn","p-1","bg-transparent","border-0",3,"click"],["ngbPopover","Supprimer l'object","triggers","mouseenter:mouseleave",1,"btn","m-0","bg-transparent","border-0","text-danger",3,"click"],["ngbPopover","Options de l'objet","triggers","mouseenter:mouseleave",1,"btn","m-0","bg-transparent","border-0","text-black",3,"click"],["class","featureToasts position-fixed bottom-0 end-0 p-3 d-flex flex-row overflow-auto fw-normal pointer-none","style","z-index: 11",3,"id",4,"ngIf"],["height","25","width","25"],["cx","12","cy","12","r","8"],["x1","0","y1","12.5","x2","25","y2","12.5"],["height","15","width","25"],["x","0","y","0","width","25","height","15"],[1,"featureToasts","position-fixed","bottom-0","end-0","p-3","d-flex","flex-row","overflow-auto","fw-normal","pointer-none",2,"z-index","11",3,"id"],["role","alert","aria-live","assertive","aria-atomic","true",1,"toast","toastFeature","faded"],[1,"toast-header","justify-content-between"],[1,"ms-2","me-auto","me-auto"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"toast-body","bg-white"],["id","toastActions",1,"d-flex","flex-row","justify-content-start","align-items-center"],[1,"fw-bold"],["data-bs-toggle","tooltip","data-bs-placement","bottom","title","Copier le WKT",1,"badge","bg-dark","rounded","m-1","small","pointer",3,"click"],["data-bs-toggle","tooltip","data-bs-placement","bottom","title","Copier la Bbox (xmin, ymin, xmax, ymax)",1,"badge","bg-primary","rounded","m-1","small","pointer",3,"click"],[1,"d-flex","flex-row","justify-content-between"],[1,"d-flex","flex-column","my-3"],[1,"d-flex","flex-row","ms-2","my-1"],[1,"me-2"],["type","color",1,"fillColor","m-1","pointer",3,"id","value","change"],["fillColor",""],["type","color",1,"strokeColor","m-1","pointer",3,"id","value","change"],["strokeColor",""],["type","number","min","0","max","12",1,"small","strokeWidth",3,"value","change"]],template:function(t,i){1&t&&(n.TgZ(0,"li",0)(1,"div",1)(2,"div",2),n.YNc(3,zn,2,3,"svg",3),n.YNc(4,$n,3,4,"svg",3),n.YNc(5,ei,2,3,"svg",4),n.qZA(),n.TgZ(6,"div",5),n._uU(7),n.qZA(),n.TgZ(8,"div",6)(9,"button",7),n.NdJ("click",function(){return i.zoomToFeature()}),n._UZ(10,"fa-icon",8),n.qZA(),n.TgZ(11,"button",9),n.NdJ("click",function(){return i.duplicateFeature()}),n._UZ(12,"fa-icon",8),n.qZA(),n.TgZ(13,"button",10),n.NdJ("click",function(){return i.removeFeature()}),n._UZ(14,"fa-icon",8),n.qZA(),n.TgZ(15,"button",11),n.NdJ("click",function(){return i.showPopup()}),n._UZ(16,"fa-icon",8),n.qZA()()()(),n.YNc(17,ti,44,19,"div",12)),2&t&&(n.xp6(3),n.Q6J("ngIf","Point"===i.feature.get("geom_type")),n.xp6(1),n.Q6J("ngIf","LineString"===i.feature.get("geom_type")),n.xp6(1),n.Q6J("ngIf","Polygon"===i.feature.get("geom_type")),n.xp6(2),n.hij(" ",i.feature.get("name")," "),n.xp6(3),n.Q6J("icon",i.centerIcon),n.xp6(2),n.Q6J("icon",i.duplicateIcon),n.xp6(2),n.Q6J("icon",i.disabledIcon),n.xp6(2),n.Q6J("icon",i.paramIcon),n.xp6(1),n.Q6J("ngIf",(i.currentLayer.id===i.feature.get("layer_id")||i.currentFeatureIdSelected===i.feature.getId())&&i.displayPopup))},dependencies:[P.O5,A.BN,J.o8,P.uU],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer-none[_ngcontent-%COMP%]{cursor:auto}.feature[_ngcontent-%COMP%]:hover{font-weight:700}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.feature[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_featureColorTransition;animation-duration:.5s}.feature[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{font-weight:700}@keyframes _ngcontent-%COMP%_featureColorTransition{0%{background-color:var(--bs-secondary)}to{background-color:var(--bs-light)}}"]}),o})();function ii(o,e){if(1&o&&n._UZ(0,"fa-icon",55),2&o){const t=n.oxw();n.Q6J("icon",t.pointIcon)}}function ri(o,e){if(1&o&&n._UZ(0,"fa-icon",55),2&o){const t=n.oxw();n.Q6J("icon",t.lineStringIcon)}}function si(o,e){if(1&o&&n._UZ(0,"fa-icon",55),2&o){const t=n.oxw();n.Q6J("icon",t.polygonIcon)}}function oi(o,e){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"app-feature",62),n.NdJ("click",function(){const s=n.CHM(t).$implicit,a=n.oxw(2);return n.KtG(a.selectFeatureById(s.getId()))}),n.qZA(),n.BQk()}if(2&o){const t=e.$implicit,i=n.oxw(2);n.xp6(1),n.Q6J("ngClass",i.featureIdSelected==t.getId()?"fw-bold bg-secondary bg-opacity-25":"")("currentFeatureIdSelected",i.featureIdSelected)("feature",t)("currentLayer",i.layer)}}function ai(o,e){if(1&o){const t=n.EpF();n.TgZ(0,"div",56)(1,"ul",57)(2,"li",58),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.unSelectFeature())}),n.TgZ(3,"div",59),n._UZ(4,"fa-icon",60),n._uU(5,"D\xe9s\xe9lectionner "),n.qZA()(),n.YNc(6,oi,2,4,"ng-container",61),n.qZA()()}if(2&o){const t=n.oxw();n.xp6(1),n.Q6J("id","featuresLayer-"+t.layer.id),n.xp6(1),n.Q6J("ngClass","none"==t.featureIdSelected&&t.isSelected?"bg-opacity-25":""),n.xp6(2),n.Q6J("icon",t.disabledIcon),n.xp6(2),n.Q6J("ngForOf",t.layer.features())}}let li=(()=>{class o{constructor(t,i){this.elementRef=t,this.interactionsService=i,this.layerIdCurrentlySelected=new n.vpe,this.layerMoveUp=new n.vpe,this.layerMoveDown=new n.vpe,this.layerCloned=new n.vpe,this.removeLayerId=new n.vpe,this.groupIcon=y.Krp,this.helpIcon=y.FDd,this.addIcon=y.EQ8,this.editIcon=y.TzT,this.paramIcon=y.gr5,this.disabledIcon=y.g82,this.EditIcon=y.diR,this.pointIcon=y.diR,this.lineStringIcon=y.fQK,this.polygonIcon=y.ubJ,this.visibleIcon=y.Mdf,this.invisibleIcon=y.Aq,this.upIcon=y.l1h,this.downIcon=y.eW2,this.duplicateIcon=Qe.WM4,this.centerIcon=y.TL5,this.lockIcon=y.byT,this.unLockIcon=y._1N,this.isVisible=!0,this.isDrawn=!1,this.isEdited=!1,this.isShown=!1,this.isHole=!1,this.isLocked=!1,this.displayLayerModal=!1,this.isLayerRemoved=!1,this.exportData="",this.exportDataMode="geojson",this.removeLayerSubscription=this.interactionsService.removeLayers.subscribe(r=>{this.removeLayer()}),this.selectableLayerStatusSubscription=this.interactionsService.selectableLayerId.subscribe(r=>{this.layer.id!==r?this.layer.disableSelecting():(this.layer.disableSelecting(),this.layer.enableSelecting())}),this.selectableAllLayersStatusSubscription=this.interactionsService.selectableAllLayers.subscribe(r=>{this.layer.disableSelecting(),this.layer.enableSelecting()})}ngOnInit(){this.layer.enableSelecting(),this.layer.select.on("select",t=>{let r=t.selected;t.deselected.length>0&&0===r.length&&this.unSelectFeature(),r.length>0&&r.forEach(s=>{this.selectFeatureById(s.getId())})}),this.layer.sourceFeatures.on("changefeature",t=>{Tt(t.feature)})}ngOnDestroy(){this.isLayerRemoved=!0;let t=document.getElementById("modalWktLayer-"+this.layer.id);null!==t&&t.remove(),this.removeLayerSubscription.unsubscribe(),this.selectableLayerStatusSubscription.unsubscribe(),this.selectableAllLayersStatusSubscription.unsubscribe(),this.layer.disableSelecting(),this.elementRef.nativeElement.remove()}ngOnChanges(t){t.isSelected&&(t.isSelected.currentValue||this.unSelectFeature()),t.isLocked&&this.layer.locked!==t.isLocked.currentValue&&this.lockingLayer(t.isLocked.currentValue),t.isVisible&&this.visibleHandler(t.isVisible.currentValue)}visibleHandler(t){this.isVisible=t,this.layer.vectorLayer.setVisible(t)}lockingLayer(t){this.isLocked=t,this.layer.locked=this.isLocked,this.isSelected&&this.interactionsService.activateEditBar(!this.layer.locked)}removeLayer(){this.layer.removeLayer(),this.removeLayerId.emit(this.layer.id),this.interactionsService.sendSelectedLayer(null),this.ngOnDestroy()}layerGoUp(){this.layerMoveUp.emit(this.layer.id)}layerGoDown(){this.layerMoveDown.emit(this.layer.id)}selectLayer(){this.interactionsService.sendSelectedLayerId(this.layer.id),this.interactionsService.sendSelectedLayer(this.layer)}zoomToLayer(){this.layer.zoomToLayer()}duplicateLayer(){this.unSelectFeature();const t=Object.create(this.layer);this.layerCloned.emit(t)}hideModalLayer(){this.displayLayerModal=!1}displayLayerSettings(){this.displayLayerModal=!0,this.exportBuilder(this.exportDataMode)}exportBuilder(t){this.exportDataMode=t,"wkt"===t?this.exportData=this.layer.exportToWkt():"geojson"===t?this.exportData=this.layer.exportToGeoJSON():"pytestFixture"===t&&(this.exportData=this.layer.exportToPytestFixture())}unSelectFeature(){this.featureIdSelected="none",this.layer.select.getFeatures().clear()}selectFeatureById(t){this.featureIdSelected=t;let i=this.getFeature(this.featureIdSelected);this.layer.select.getFeatures().clear(),this.layer.select.getFeatures().push(i),this.selectLayer()}getFeature(t){let i=this.layer.features().filter(r=>r.getId()===t);return 1===i.length?i[0]:null}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(n.SBq),n.Y36(te))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-layer"]],inputs:{layer:"layer",isSelected:"isSelected",layersVisibleStatus:"layersVisibleStatus",isVisible:"isVisible",isLocked:"isLocked"},outputs:{layerIdCurrentlySelected:"layerIdCurrentlySelected",layerMoveUp:"layerMoveUp",layerMoveDown:"layerMoveDown",layerCloned:"layerCloned",removeLayerId:"removeLayerId"},features:[n.TTD],decls:113,vars:58,consts:[[1,"layer","pointer","d-flex","flex-column","small","mt-1","mx-1","px-1","align-items-around"],[1,"header","d-flex","flex-row","border","rounded",3,"ngClass"],[1,"d-flex","flex-row","justify-content-start","align-items-center","me-1"],["type","checkbox",1,"btn-check",3,"id","checked","click"],["btnVisible",""],["container","body","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","pointer",3,"for","ngClass","ngbPopover"],["size","xs",1,"",3,"icon"],["btnLocked",""],["container","body","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0","pointer",3,"for","ngbPopover"],[1,"d-flex","flex-column",3,"ngClass"],["container","body","ngbPopover","Remonter","triggers","mouseenter:mouseleave",1,"p-0","bg-transparent","border-0","text-danger",3,"click"],["container","body","ngbPopover","Descendre","triggers","mouseenter:mouseleave",1,"p-0","bg-transparent","border-0","text-danger",3,"click"],[1,"d-flex","flex-row","pointer","justify-content-start","align-items-center","flex-fill","p-1",3,"ngClass","click"],[1,""],["class","me-2","size","xs",3,"icon",4,"ngIf"],[1,"layer-name"],[1,"ms-auto","d-flex","flex-row",3,"ngClass"],["ngbPopover","Dupliquer","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0",3,"click"],["ngbPopover","Supprimer","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0","text-danger",3,"ngClass","click"],[1,"ms-auto","d-flex","flex-row"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0",3,"click"],["data-bs-toggle","modal","ngbPopover","Options de la couche","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","text-black",3,"click"],["class","feature-container d-flex flex-row small mb-1",4,"ngIf"],["moveDivToBody","","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade",3,"isRemoved","id"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","staticBackdropLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"d-flex","flex-column","my-3",3,"ngClass"],[1,"d-flex","flex-row","ms-2","mb-2"],[1,"me-2"],["type","text","aria-label","layerName",1,"form-control",3,"placeholder","change"],[1,"d-flex","flex-column","ms-2"],[1,"small"],[1,"d-flex","flex-row","ms-2","my-1"],["id","","type","range","min","0","max","1","step","0.1",1,"small","opacity-setter",3,"value","change"],["type","color",1,"fillColor","m-1","pointer",3,"id","value","change"],["layerFillColor",""],["layerStrokeColor",""],["type","number","min","0","max","12",1,"small","strokeWidth",3,"value","change"],[1,"d-flex","flex-column","my-3"],["role","tablist",1,"nav","nav-pills","align-items-center","justify-content-center"],["role","presentation",1,"nav-item","border","m-1"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold","active",3,"click"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold",3,"click"],["id","'tabContent' + layer.id",1,"d-flex","flex-row","mx-2","tab-content"],["role","tabpanel",1,"tab-pane","fade","w-100","show",3,"ngClass","id"],["aria-label","With textarea","readonly","",1,"form-control","vh-100",3,"click"],["exportGeoJsonStringGeomDiv",""],["exportWktStringGeomDiv",""],["exportPytestFixturesGeomDiv",""],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["size","xs",1,"me-2",3,"icon"],[1,"feature-container","d-flex","flex-row","small","mb-1"],["id","featuresList",1,"w-100","list-group","list-unstyled","list-group-flush","mx-3","rounded",3,"id"],[1,"feature","border-bottom",3,"ngClass","click"],[1,"d-flex","flex-row","pointer","justify-content-center","align-items-center","flex-fill","m-1"],[1,"me-1",3,"icon"],[4,"ngFor","ngForOf"],[3,"ngClass","currentFeatureIdSelected","feature","currentLayer","click"]],template:function(t,i){if(1&t){const r=n.EpF();n.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3,4),n.NdJ("click",function(){n.CHM(r);const a=n.MAs(4);return n.KtG(i.visibleHandler(a.checked))}),n.qZA(),n.TgZ(5,"label",5),n._UZ(6,"fa-icon",6),n.qZA(),n.TgZ(7,"input",3,7),n.NdJ("click",function(){n.CHM(r);const a=n.MAs(8);return n.KtG(i.lockingLayer(a.checked))}),n.qZA(),n.TgZ(9,"label",8),n._UZ(10,"fa-icon",6),n.qZA(),n.TgZ(11,"div",9)(12,"button",10),n.NdJ("click",function(){return i.layerGoUp()}),n._UZ(13,"fa-icon",6),n.qZA(),n.TgZ(14,"button",11),n.NdJ("click",function(){return i.layerGoDown()}),n._UZ(15,"fa-icon",6),n.qZA()()(),n.TgZ(16,"div",12),n.NdJ("click",function(){return i.selectLayer()}),n.TgZ(17,"div",13),n.YNc(18,ii,1,1,"fa-icon",14),n.YNc(19,ri,1,1,"fa-icon",14),n.YNc(20,si,1,1,"fa-icon",14),n.qZA(),n.TgZ(21,"div",15)(22,"span"),n._uU(23),n.qZA()()(),n.TgZ(24,"div",16)(25,"button",17),n.NdJ("click",function(){return i.duplicateLayer()}),n._UZ(26,"fa-icon",6),n.qZA(),n.TgZ(27,"button",18),n.NdJ("click",function(){return i.removeLayer()}),n._UZ(28,"fa-icon",6),n.qZA()(),n.TgZ(29,"div",19)(30,"button",20),n.NdJ("click",function(){return i.zoomToLayer()}),n._UZ(31,"fa-icon",6),n.qZA(),n.TgZ(32,"button",21),n.NdJ("click",function(){return i.displayLayerSettings()}),n._UZ(33,"fa-icon",6),n.qZA()()(),n.YNc(34,ai,7,4,"div",22),n.qZA(),n.TgZ(35,"div",23)(36,"div",24)(37,"div",25)(38,"div",26)(39,"h5",27),n._uU(40),n.qZA(),n.TgZ(41,"button",28),n.NdJ("click",function(){return i.hideModalLayer()}),n.qZA()(),n.TgZ(42,"div",29)(43,"div",30)(44,"h4",13),n._uU(45,"G\xe9n\xe9ral"),n.qZA(),n.TgZ(46,"div",31)(47,"span",32),n._uU(48,"Nom de la couche :"),n.qZA(),n.TgZ(49,"input",33),n.NdJ("change",function(a){return i.layer.setName(a)}),n.qZA()(),n.TgZ(50,"div",34)(51,"span",32),n._uU(52,"Bounding box:"),n.qZA(),n.TgZ(53,"span",35),n._uU(54),n.qZA(),n.TgZ(55,"span",35),n._uU(56),n.qZA(),n.TgZ(57,"span",35),n._uU(58),n.qZA(),n.TgZ(59,"span",35),n._uU(60),n.qZA()()(),n.TgZ(61,"div",30)(62,"h4",13),n._uU(63,"Style"),n.qZA(),n.TgZ(64,"div",36)(65,"span",32),n._uU(66,"Opacit\xe9 :"),n.qZA(),n.TgZ(67,"input",37),n.NdJ("change",function(a){return i.layer.setOpacity(a)}),n.qZA()(),n.TgZ(68,"div",36)(69,"span",32),n._uU(70,"Couleur de fond :"),n.qZA(),n.TgZ(71,"input",38,39),n.NdJ("change",function(){n.CHM(r);const a=n.MAs(72);return n.KtG(i.layer.setStyleForAllFeatures(a.value,"fill_color"))}),n.qZA(),n._UZ(73,"label"),n.qZA(),n.TgZ(74,"div",36)(75,"span",32),n._uU(76,"Couleur du contour :"),n.qZA(),n.TgZ(77,"input",38,40),n.NdJ("change",function(){n.CHM(r);const a=n.MAs(78);return n.KtG(i.layer.setStyleForAllFeatures(a.value,"stroke_color"))}),n.qZA(),n._UZ(79,"label"),n.qZA(),n.TgZ(80,"div",36)(81,"span",32),n._uU(82,"Epaisseur du contour :"),n.qZA(),n.TgZ(83,"input",41),n.NdJ("change",function(a){return i.layer.setStyleForAllFeatures(a,"stroke_width")}),n.qZA()()(),n.TgZ(84,"div",42)(85,"h4",13),n._uU(86,"Export"),n.qZA(),n.TgZ(87,"ul",43)(88,"li",44)(89,"a",45),n.NdJ("click",function(){return i.exportBuilder("geojson")}),n._uU(90," GeoJSON "),n.qZA()(),n.TgZ(91,"li",44)(92,"a",46),n.NdJ("click",function(){return i.exportBuilder("wkt")}),n._uU(93," WKT "),n.qZA()(),n.TgZ(94,"li",44)(95,"a",46),n.NdJ("click",function(){return i.exportBuilder("pytestFixture")}),n._uU(96," Pytest Fixtures "),n.qZA()()(),n.TgZ(97,"div",47)(98,"div",48)(99,"textarea",49,50),n.NdJ("click",function(){n.CHM(r);const a=n.MAs(100);return n.KtG(a.select())}),n._uU(101),n.qZA()(),n.TgZ(102,"div",48)(103,"textarea",49,51),n.NdJ("click",function(){n.CHM(r);const a=n.MAs(104);return n.KtG(a.select())}),n._uU(105),n.qZA()(),n.TgZ(106,"div",48)(107,"textarea",49,52),n.NdJ("click",function(){n.CHM(r);const a=n.MAs(108);return n.KtG(a.select())}),n._uU(109),n.qZA()()()()(),n.TgZ(110,"div",53)(111,"button",54),n._uU(112,"Fermer"),n.qZA()()()()()}if(2&t){const r=n.MAs(4),s=n.MAs(8),a=n.MAs(78);n.xp6(1),n.Q6J("ngClass",i.isSelected?"border-dark border-2":""),n.xp6(2),n.Q6J("id","btnVisible"+i.layer.id)("checked",i.isVisible),n.xp6(2),n.Q6J("for","btnVisible"+i.layer.id)("ngClass",r.checked?"text-success":"text-danger")("ngbPopover",r.checked?"Masquer":"Afficher"),n.xp6(1),n.Q6J("icon",r.checked?i.visibleIcon:i.invisibleIcon),n.xp6(1),n.Q6J("id","btnLocked"+i.layer.id)("checked",i.isLocked),n.xp6(2),n.Q6J("for","btnLocked"+i.layer.id)("ngbPopover",s.checked?"D\xe9verrouiler":"Verrouiller"),n.xp6(1),n.Q6J("icon",s.checked?i.lockIcon:i.unLockIcon),n.xp6(1),n.Q6J("ngClass",i.isSelected?"pe-auto":"pe-none"),n.xp6(2),n.Q6J("icon",i.upIcon),n.xp6(2),n.Q6J("icon",i.downIcon),n.xp6(1),n.Q6J("ngClass",i.isSelected?"fw-bold":"text-black"),n.xp6(2),n.Q6J("ngIf","Point"===i.layer.geomType),n.xp6(1),n.Q6J("ngIf","LineString"===i.layer.geomType),n.xp6(1),n.Q6J("ngIf","Polygon"===i.layer.geomType),n.xp6(3),n.Oqu(i.layer.layerName),n.xp6(1),n.Q6J("ngClass",i.isSelected?"d-block":"d-none"),n.xp6(2),n.Q6J("icon",i.duplicateIcon),n.xp6(1),n.Q6J("ngClass",i.layer.locked?"pe-none":"pe-auto"),n.xp6(1),n.Q6J("icon",i.disabledIcon),n.xp6(3),n.Q6J("icon",i.centerIcon),n.xp6(1),n.uIk("data-bs-target","#modalLayerSettings-"+i.layer.id),n.xp6(1),n.Q6J("icon",i.paramIcon),n.xp6(1),n.Q6J("ngIf",i.layer.features().length>0),n.xp6(1),n.Q6J("isRemoved",i.isLayerRemoved)("id","modalLayerSettings-"+i.layer.id),n.xp6(5),n.Oqu(i.layer.layerName),n.xp6(3),n.Q6J("ngClass",i.layer.locked?"pe-none":"pe-auto"),n.xp6(6),n.Q6J("placeholder",i.layer.layerName),n.xp6(5),n.hij("x min: ",i.layer.exportBounds()[0],""),n.xp6(2),n.hij("y min: ",i.layer.exportBounds()[1],""),n.xp6(2),n.hij("x max: ",i.layer.exportBounds()[2],""),n.xp6(2),n.hij("y max: ",i.layer.exportBounds()[3],""),n.xp6(1),n.Q6J("ngClass",i.layer.locked?"pe-none":"pe-auto"),n.xp6(6),n.Q6J("value",i.layer.getOpacity()),n.xp6(4),n.Q6J("id","fillColor-"+i.layer.id)("value",i.layer.fillColor),n.xp6(2),n.uIk("for","fillColor-"+i.layer.id),n.xp6(4),n.Q6J("id","strokeColor-"+i.layer.id)("value",a.value),n.xp6(2),n.uIk("for","strokeColor-"+i.layer.id),n.xp6(4),n.Q6J("value",i.layer.strokeWidth),n.xp6(6),n.uIk("data-bs-target","#GeoJsonTab"+i.layer.id),n.xp6(3),n.uIk("data-bs-target","#wktTab"+i.layer.id),n.xp6(3),n.uIk("data-bs-target","#pytestFixture"+i.layer.id),n.xp6(3),n.Q6J("ngClass","geojson"===i.exportDataMode?"active":"")("id","GeoJsonTab"+i.layer.id),n.xp6(3),n.Oqu(i.exportData),n.xp6(1),n.Q6J("ngClass","wkt"===i.exportDataMode?"active":"")("id","wktTab"+i.layer.id),n.xp6(3),n.Oqu(i.exportData),n.xp6(1),n.Q6J("ngClass","pytestFixture"===i.exportDataMode?"active":"")("id","pytestFixture"+i.layer.id),n.xp6(3),n.Oqu(i.exportData)}},dependencies:[P.mk,P.sg,P.O5,A.BN,J.o8,wt,ni],styles:[".layer[_ngcontent-%COMP%]{background-color:var(--bs-light)}.layer[_ngcontent-%COMP%]   .layer-name[_ngcontent-%COMP%]:hover{font-weight:700}.layer[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_layerColorTransition;animation-duration:2s}@keyframes _ngcontent-%COMP%_layerColorTransition{0%{background-color:var(--bs-warning)}to{background-color:var(--bs-light)}}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.pointer[_ngcontent-%COMP%]{cursor:pointer}.colorPicker[_ngcontent-%COMP%]{width:10px;height:25px;cursor:pointer}"]}),o})();function ci(o,e){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",2),n.NdJ("click",function(){const s=n.CHM(t).$implicit,a=n.oxw();return n.KtG(a.addLayer(s.mode))}),n._UZ(2,"fa-icon",3),n.qZA(),n.BQk()}if(2&o){const t=e.$implicit;n.xp6(1),n.Q6J("ngbPopover",t.label),n.xp6(1),n.Q6J("icon",t.icon)}}let di=(()=>{class o{constructor(){this.newLayerEvent=new n.vpe,this.pointIcon=y.diR,this.lineStringIcon=y.fQK,this.polygonIcon=y.ubJ,this.layerTypes=[{mode:"Point",label:"Ajouter une couche de Points",icon:this.pointIcon},{mode:"LineString",label:"Ajouter une couche de LineString",icon:this.lineStringIcon},{mode:"Polygon",label:"Ajouter une couche de Polygones",icon:this.polygonIcon}]}addLayer(t){this.newLayerEvent.emit(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-create-tools"]],outputs:{newLayerEvent:"newLayerEvent"},decls:2,vars:1,consts:[["id","creationTools",1,"text-center","m-3"],[4,"ngFor","ngForOf"],["placement","bottom","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-dark","border-0","me-1","text-warning",3,"ngbPopover","click"],[1,"",3,"icon"]],template:function(t,i){1&t&&(n.TgZ(0,"div",0),n.YNc(1,ci,3,2,"ng-container",1),n.qZA()),2&t&&(n.xp6(1),n.Q6J("ngForOf",i.layerTypes))},dependencies:[P.sg,A.BN,J.o8]}),o})();function ui(o,e){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",15),n.NdJ("click",function(){const s=n.CHM(t).$implicit,a=n.oxw();return n.KtG(a.setImportDataType(s.label_text))}),n._UZ(2,"fa-icon",16),n._uU(3),n.qZA(),n.BQk()}if(2&o){const t=e.$implicit;n.xp6(1),n.Q6J("ngbPopover",t.label),n.xp6(1),n.Q6J("icon",t.icon),n.xp6(1),n.hij("",t.label_text," ")}}function hi(o,e){if(1&o&&(n.TgZ(0,"option",17),n._uU(1),n.qZA()),2&o){const t=e.$implicit;n.Q6J("value",t),n.xp6(1),n.Oqu(t)}}function gi(o,e){if(1&o&&(n.TgZ(0,"option",17),n._uU(1),n.qZA()),2&o){const t=e.$implicit;n.Q6J("value",t.id),n.xp6(1),n.hij("Importer dans la couche : ",t.layerName,"")}}let fi=(()=>{class o{constructor(){this.featuresToNewLayerEvent=new n.vpe,this.featuresToAppendEvent=new n.vpe,this.loadIcon=y.cf$,this.importModes=[{mode:"GeoJSON",label:"Importer un GeoJSON",label_text:"GeoJSON",icon:this.loadIcon},{mode:"WKT",label:"Importer un/des WKT(s)",label_text:"WKT(s)",icon:this.loadIcon}],this.componentRemoved=!1,this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="newLayer"}ngOnInit(){}ngOnDestroy(){this.componentRemoved=!0}setImportDataType(t){this.importDataType=t}importFromFormat(){let i,t={};this.strInputEpsgInput!==this.currentEpsg&&(t={dataProjection:this.strInputEpsgInput,featureProjection:this.currentEpsg}),null!==this.strInputDataValues&&("GeoJSON"===this.importDataType?i=function pi(o,e){let t={};return t=function mi(o){return o.reduce((e,t)=>{let i=t.getGeometry().getType();return e[i]||(e[i]=[]),e[i].push(t),e},{})}(new z.Z({features:(new et).readFeatures(JSON.parse(o,e))}).getFeatures()),t}(this.strInputDataValues,t):"WKT(s)"===this.importDataType&&(i=Ft(this.strInputDataValues.split("\n"),t)),"newLayer"===this.modeImportInput?this.featuresToNewLayerEvent.emit(i):this.featuresToAppendEvent.emit({layerId:this.modeImportInput,features:i})),this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="newLayer"}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-import-tools"]],inputs:{epsgAvailable:"epsgAvailable",currentEpsg:"currentEpsg",existingLayers:"existingLayers"},outputs:{featuresToNewLayerEvent:"featuresToNewLayerEvent",featuresToAppendEvent:"featuresToAppendEvent"},decls:23,vars:9,consts:[["id","importTools",1,"text-center","m-3"],[4,"ngFor","ngForOf"],["moveDivToBody","","id","modalDataImport","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade",3,"isRemoved"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-control",3,"ngModel","ngModelChange"],[1,"form-select","form-select-sm",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","newLayer"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"ngClass","click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["data-bs-toggle","modal","data-bs-target","#modalDataImport","type","button","role","tab","placement","bottom","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-dark","border-0","me-1","text-warning",3,"ngbPopover","click"],[1,"mx-1",3,"icon"],[3,"value"]],template:function(t,i){1&t&&(n.TgZ(0,"div",0),n.YNc(1,ui,4,3,"ng-container",1),n.qZA(),n.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h5",6),n._uU(7),n.qZA()(),n.TgZ(8,"div",7)(9,"textarea",8),n.NdJ("ngModelChange",function(s){return i.strInputDataValues=s}),n.qZA(),n._uU(10," EPSG des donn\xe9es \xe0 importer "),n.TgZ(11,"select",9),n.NdJ("ngModelChange",function(s){return i.strInputEpsgInput=s}),n.YNc(12,hi,2,2,"option",10),n.qZA(),n._uU(13," Type d'importation "),n.TgZ(14,"select",9),n.NdJ("ngModelChange",function(s){return i.modeImportInput=s}),n.TgZ(15,"option",11),n._uU(16,"Cr\xe9er de nouvelles couches"),n.qZA(),n.YNc(17,gi,2,2,"option",10),n.qZA()(),n.TgZ(18,"div",12)(19,"button",13),n.NdJ("click",function(){return i.importFromFormat()}),n._uU(20,"Ajouter"),n.qZA(),n.TgZ(21,"button",14),n._uU(22,"Fermer"),n.qZA()()()()()),2&t&&(n.xp6(1),n.Q6J("ngForOf",i.importModes),n.xp6(1),n.Q6J("isRemoved",i.componentRemoved),n.xp6(5),n.hij("Importer ",i.importDataType,""),n.xp6(2),n.Q6J("ngModel",i.strInputDataValues),n.xp6(2),n.Q6J("ngModel",i.strInputEpsgInput),n.xp6(1),n.Q6J("ngForOf",i.epsgAvailable),n.xp6(2),n.Q6J("ngModel",i.modeImportInput),n.xp6(3),n.Q6J("ngForOf",i.existingLayers),n.xp6(2),n.Q6J("ngClass",null!==i.strInputEpsgInput&&null!==i.strInputDataValues?"":"pe-none"))},dependencies:[P.mk,P.sg,A.BN,J.o8,D.YN,D.Kr,D.Fj,D.EJ,D.JJ,D.On,wt]}),o})();function Ft(o,e){let t={};return o.forEach(i=>{let r;try{r=(new xt).readFeature(i,e)}catch(s){alert(s.message)}if(void 0!==r&&!r.getGeometry().flatCoordinates.includes(NaN)){const s=r.getGeometry(),a=s.getType();a in t||(t[a]=[]),void 0!==s&&t[a].push(r)}}),t}const yi=["exportStringGeomDiv"],_i=["layersList"];function Ci(o,e){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"app-layer",19),n.NdJ("layerMoveUp",function(r){n.CHM(t);const s=n.oxw();return n.KtG(s.layerGoUp(r))})("layerMoveDown",function(r){n.CHM(t);const s=n.oxw();return n.KtG(s.layerGoDown(r))})("layerCloned",function(r){n.CHM(t);const s=n.oxw();return n.KtG(s.duplicateLayer(r))})("removeLayerId",function(r){n.CHM(t);const s=n.oxw();return n.KtG(s.removeLayer(r))}),n.qZA(),n.BQk()}if(2&o){const t=e.$implicit,i=n.oxw();n.xp6(1),n.Q6J("layer",t)("isSelected",i.currentLayerIdSelected==t.id)("isVisible",i.forceVisibleStatus)("isLocked",i.layersLockStatus)}}let xi=(()=>{class o{constructor(t,i,r){this.mapService=t,this.interactionsService=i,this.editComputingService=r,this.disabledIcon=y.g82,this.loadIcon=y.cf$,this.visibleIcon=Qe.Mdf,this.invisibleIcon=y.Aq,this.centerIcon=y.TL5,this.lockIcon=y.byT,this.unLockIcon=y._1N,this.forceVisibleStatus=!0,this.layersLockStatus=!1,this.existingLayers=[],this.allLayers=[],this.layerNamedIncrement=-1,this.zoomPadding=[100,100,100,100],this.epsgChangesSubscription=this.mapService.setMapProjectionFromEpsg.subscribe(s=>{this.existingLayers.forEach(a=>{a.features().forEach(l=>{l.setGeometry(l.getGeometry().transform(this.currentEpsg,s))})}),this.currentEpsg=s}),this.layerIdSelectedSubscription=this.interactionsService.layerIdSelected.subscribe(s=>{this.currentLayerIdSelected=s}),this.newFeaturesSubscription=this.editComputingService.newFeatures.subscribe(s=>{this.createNewLayersFromFeatures(s)})}ngOnInit(){}ngOnDestroy(){this.existingLayers.forEach(t=>{this.map.removeLayer(t.vectorLayer),t.cleanEvents()}),this.epsgChangesSubscription.unsubscribe(),this.layerIdSelectedSubscription.unsubscribe(),this.newFeaturesSubscription.unsubscribe()}ngOnChanges(t){t.layersList&&this.refreshLayers()}addLayer(t){let i=this.setNewLayer(t);this.existingLayers.push(i),this.refreshLayers()}setNewLayer(t,i=null,r=null){const s=++this.layerNamedIncrement;return null===i&&(i="layer "+s),new Vn(this.map,i,t,s,r)}duplicateLayer(t){let i=this.setNewLayer(t.geomType,t.layerName+" copy");i.addFeaturesAndUpdateIds(t.features()),this.existingLayers.push(i),this.refreshLayers()}addLayerFromFeatures(t,i){let r=this.setNewLayer(t);r.addFeaturesAndUpdateIds(i),this.existingLayers.push(r),this.refreshLayers()}layerGoUp(t){this.existingLayers=vt(this.existingLayers,t,1),this.refreshLayers()}layerGoDown(t){this.existingLayers=vt(this.existingLayers,t,-1),this.refreshLayers()}removeLayer(t){this.existingLayers=this.existingLayers.filter(i=>i.id!==t),this.buildLayersIndexes()}getLayerFromId(t){return this.existingLayers.filter(r=>r.id===t)[0]}refreshLayers(){this.allLayers=this.existingLayers.filter(t=>!t.deleted).sort((t,i)=>t.zIndexValue>i.zIndexValue?-1:1)}unSelectLayer(){this.interactionsService.sendSelectedLayerId("none"),this.interactionsService.sendSelectedLayer(null)}buildLayersIndexes(){let t=this.existingLayers;this.existingLayers=[],t.forEach((i,r)=>{i.zIndexValue=r,i.vectorLayer.setZIndex(r),this.existingLayers.push(i)})}createNewLayersFromFeatures(t){Object.keys(t).forEach(i=>{this.addLayerFromFeatures(i,t[i])})}appendFeatureOnLayerFromFeatures(t){const r=t.features;let s=this.getLayerFromId(t.layerId);Object.keys(r).forEach(a=>{a===s.geomType&&(s.addFeaturesAndUpdateIds(r[a]),this.refreshLayers())})}zoomLayers(){let t=(0,x.lJ)();this.existingLayers.forEach(i=>{(0,x.l7)(t,i.sourceFeatures.getExtent())}),t[0]!==1/0&&t[1]!==1/0&&t[2]!==1/0&&t[3]!==1/0&&this.map.getView().fit(t,{size:this.map.getSize(),padding:this.zoomPadding})}visibleLayers(t){this.forceVisibleStatus=t}lockLayers(t){this.layersLockStatus=t}removeLayers(){this.interactionsService.removeAllLayers()}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(Ee.S),n.Y36(te),n.Y36(bt))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-layer-manager"]],viewQuery:function(t,i){if(1&t&&(n.Gf(yi,5),n.Gf(_i,5)),2&t){let r;n.iGM(r=n.CRH())&&(i.exportStringGeomDiv=r.first),n.iGM(r=n.CRH())&&(i.layersList=r.first)}},inputs:{map:"map",currentEpsg:"currentEpsg",epsgAvailable:"epsgAvailable"},features:[n.TTD],decls:29,vars:15,consts:[[1,"text-center","fw-bold","bg-dark","bg-gradient","text-white","p-3"],[3,"newLayerEvent"],[3,"epsgAvailable","currentEpsg","existingLayers","featuresToNewLayerEvent","featuresToAppendEvent"],["id","layersTools",1,"d-flex","flex-row","justify-content-evenly","align-items-center","mx-2"],["type","checkbox","id","btnVisibleLayers",1,"btn-check",3,"checked","click"],["btnVisible",""],["for","btnVisibleLayers","container","body","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer",3,"ngClass","ngbPopover"],["size","1x",1,"",3,"icon"],["type","checkbox","id","btnLockLayers",1,"btn-check",3,"checked","change"],["btnLock",""],["for","btnLockLayers","container","body","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer",3,"ngbPopover"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer",3,"click"],["ngbPopover","Supprimer toutes les couches","triggers","mouseenter:mouseleave",1,"m-1","btn","btn-sm","btn-transparent","border-0","pointer","text-danger",3,"click"],["id","layersList",1,"d-flex","flex-column","justify-content-start","mb-2"],["layersList",""],[1,"layer","pointer","d-flex","flex-column","small","mt-1","mx-1","px-1","align-items-around",3,"ngClass","click"],[1,"pointer","p-2","d-flex","flex-row","pointer","justify-content-center","align-items-center","border-bottom"],[1,"me-1",3,"icon"],[4,"ngFor","ngForOf"],[3,"layer","isSelected","isVisible","isLocked","layerMoveUp","layerMoveDown","layerCloned","removeLayerId"]],template:function(t,i){if(1&t){const r=n.EpF();n.TgZ(0,"div")(1,"div",0),n._uU(2," Cr\xe9er\n"),n.qZA(),n.TgZ(3,"app-create-tools",1),n.NdJ("newLayerEvent",function(a){return i.addLayer(a)}),n.qZA(),n.TgZ(4,"div",0),n._uU(5," Importer\n"),n.qZA(),n.TgZ(6,"app-import-tools",2),n.NdJ("featuresToNewLayerEvent",function(a){return i.createNewLayersFromFeatures(a)})("featuresToAppendEvent",function(a){return i.appendFeatureOnLayerFromFeatures(a)}),n.qZA(),n.TgZ(7,"div",0),n._uU(8," Couches\n"),n.qZA(),n.TgZ(9,"div",3)(10,"input",4,5),n.NdJ("click",function(){n.CHM(r);const a=n.MAs(11);return n.KtG(i.visibleLayers(a.checked))}),n.qZA(),n.TgZ(12,"label",6),n._UZ(13,"fa-icon",7),n.qZA(),n.TgZ(14,"input",8,9),n.NdJ("change",function(){n.CHM(r);const a=n.MAs(15);return n.KtG(i.lockLayers(a.checked))}),n.qZA(),n.TgZ(16,"label",10),n._UZ(17,"fa-icon",7),n.qZA(),n.TgZ(18,"button",11),n.NdJ("click",function(){return i.zoomLayers()}),n._UZ(19,"fa-icon",7),n.qZA(),n.TgZ(20,"button",12),n.NdJ("click",function(){return i.removeLayers()}),n._UZ(21,"fa-icon",7),n.qZA()(),n.TgZ(22,"div",13,14)(24,"div",15),n.NdJ("click",function(){return i.unSelectLayer()}),n.TgZ(25,"div",16),n._UZ(26,"fa-icon",17),n._uU(27,"D\xe9s\xe9lectionner "),n.qZA()(),n.YNc(28,Ci,2,4,"ng-container",18),n.qZA()()}if(2&t){const r=n.MAs(11),s=n.MAs(15);n.xp6(6),n.Q6J("epsgAvailable",i.epsgAvailable)("currentEpsg",i.currentEpsg)("existingLayers",i.existingLayers),n.xp6(4),n.Q6J("checked",!0),n.xp6(2),n.Q6J("ngClass",r.checked?"text-success":"text-danger")("ngbPopover",r.checked?"Masquer":"Afficher"),n.xp6(1),n.Q6J("icon",r.checked?i.visibleIcon:i.invisibleIcon),n.xp6(1),n.Q6J("checked",!1),n.xp6(2),n.Q6J("ngbPopover",s.checked?"D\xe9v\xe9rouiller":"Verrouiller"),n.xp6(1),n.Q6J("icon",s.checked?i.lockIcon:i.unLockIcon),n.xp6(2),n.Q6J("icon",i.centerIcon),n.xp6(2),n.Q6J("icon",i.disabledIcon),n.xp6(3),n.Q6J("ngClass","none"===i.currentLayerIdSelected?"bg-secondary  bg-gradient bg-opacity-25 fw-bold text-black":"text-black"),n.xp6(2),n.Q6J("icon",i.disabledIcon),n.xp6(2),n.Q6J("ngForOf",i.allLayers)}},dependencies:[P.mk,P.sg,A.BN,J.o8,li,di,fi],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),o})();var vi=m(6488),Ti=m(529);let bi=(()=>{class o{constructor(t){this.http=t,this.apiUrl=vi.n+"api/v1/network-api/",this.shortestPathRoute=this.apiUrl+"path/shortest"}getShortestPathFromApi(t,i="vehicle"){return this.http.get(this.shortestPathRoute,{params:{mode:i,step_point:t}})}}return o.\u0275fac=function(t){return new(t||o)(n.LFG(Ti.eN))},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function wi(o,e){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"input",9,19),n.NdJ("click",function(){n.CHM(t);const r=n.MAs(2),s=n.oxw(2);return n.KtG(s.editHandler(r.checked))}),n.qZA(),n.TgZ(3,"label",20)(4,"div",12),n._UZ(5,"fa-icon",13),n.qZA()(),n.BQk()}if(2&o){const t=n.oxw(2);n.xp6(1),n.Q6J("id","btnEdit"+t.layer.id)("checked",t.isEdited),n.xp6(2),n.Q6J("for","btnEdit"+t.layer.id),n.xp6(1),n.Q6J("ngClass",t.isEdited?"btn-outline-danger":""),n.xp6(1),n.Q6J("icon",t.editIcon)}}function Fi(o,e){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"input",9,21),n.NdJ("click",function(){n.CHM(t);const r=n.MAs(2),s=n.oxw(2);return n.KtG(s.drawHoleHandler(r.checked,!0))}),n.qZA(),n.TgZ(3,"label",22)(4,"div",12),n._UZ(5,"fa-icon",13),n.qZA()(),n.BQk()}if(2&o){const t=n.oxw(2);n.xp6(1),n.Q6J("id","btnHole"+t.layer.id)("checked",t.isHole),n.xp6(2),n.Q6J("for","btnHole"+t.layer.id),n.xp6(1),n.Q6J("ngClass",t.isHole?"btn-outline-danger":""),n.xp6(1),n.Q6J("icon",t.polygonIcon)}}function Pi(o,e){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"div",23)(2,"div",24),n._UZ(3,"fa-icon",13),n.qZA(),n.TgZ(4,"div",25)(5,"button",26),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(2);return n.KtG(r.computeShortestPath("pedestrian"))}),n._UZ(6,"fa-icon",13),n.qZA(),n.TgZ(7,"button",27),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(2);return n.KtG(r.computeShortestPath("vehicle"))}),n._UZ(8,"fa-icon",13),n.qZA()()(),n.BQk()}if(2&o){const t=n.oxw(2);n.xp6(3),n.Q6J("icon",t.pathIcon),n.xp6(3),n.Q6J("icon",t.pedestrianIcon),n.xp6(2),n.Q6J("icon",t.motorIcon)}}const Pt=function(){return["Polygon","LineString"]};function Li(o,e){if(1&o){const t=n.EpF();n.TgZ(0,"div",5)(1,"div",6)(2,"span",7),n._uU(3,"Ajouter"),n.qZA(),n.TgZ(4,"div",8)(5,"input",9,10),n.NdJ("click",function(){n.CHM(t);const r=n.MAs(6),s=n.oxw();return n.KtG(s.drawHandler(r.checked))}),n.qZA(),n.TgZ(7,"label",11)(8,"div",12),n._UZ(9,"fa-icon",13),n.qZA()()()(),n.TgZ(10,"div",6)(11,"span",7),n._uU(12,"Editer"),n.qZA(),n.TgZ(13,"div",8)(14,"input",9,14),n.NdJ("click",function(){n.CHM(t);const r=n.MAs(15),s=n.oxw();return n.KtG(s.translateHandler(r.checked))}),n.qZA(),n.TgZ(16,"label",15)(17,"div",12),n._UZ(18,"fa-icon",13),n.qZA()(),n.YNc(19,wi,6,5,"ng-container",16),n.YNc(20,Fi,6,5,"ng-container",16),n.qZA()(),n.TgZ(21,"div",6)(22,"span",7),n._uU(23,"Calculer"),n.qZA(),n.TgZ(24,"div",17),n.ynx(25),n.TgZ(26,"button",18),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.computeBoundingBox())}),n._UZ(27,"fa-icon",13),n.qZA(),n.BQk(),n.YNc(28,Pi,9,3,"ng-container",16),n.qZA()()()}if(2&o){const t=n.oxw();n.xp6(5),n.Q6J("id","btnDraw"+t.layer.id)("checked",t.isDrawn),n.xp6(2),n.Q6J("for","btnDraw"+t.layer.id)("ngbPopover","Ajouter un objet de type '"+t.layer.geomType+"'"),n.xp6(1),n.Q6J("ngClass",t.isDrawn?"btn-outline-danger":""),n.xp6(1),n.Q6J("icon",t.addIcon),n.xp6(5),n.Q6J("id","btnMove"+t.layer.id)("checked",t.isMoved),n.xp6(2),n.Q6J("for","btnMove"+t.layer.id),n.xp6(1),n.Q6J("ngClass",t.isMoved?"btn-outline-danger":""),n.xp6(1),n.Q6J("icon",t.moveIcon),n.xp6(1),n.Q6J("ngIf",n.DdM(15,Pt).includes(t.layer.geomType)),n.xp6(1),n.Q6J("ngIf",n.DdM(16,Pt).includes(t.layer.geomType)),n.xp6(7),n.Q6J("icon",t.centerIcon),n.xp6(1),n.Q6J("ngIf","Point"===t.layer.geomType)}}let Ei=(()=>{class o{constructor(t,i,r,s){this.interactionsService=t,this.editComputingService=i,this.graphComputingService=r,this.cdRef=s,this.addIcon=y.EQ8,this.editIcon=y.TzT,this.paramIcon=y.gr5,this.lockIcon=y.byT,this.unLockIcon=y._1N,this.polygonIcon=y.ubJ,this.moveIcon=y.$pG,this.pathIcon=y.KJ_,this.motorIcon=y.yn$,this.pedestrianIcon=y.EiI,this.centerIcon=y.TL5,this.isDrawn=!1,this.isEdited=!1,this.isHole=!1,this.isMoved=!1,this.isShortestPath=!1,this.epsgAvailable=["EPSG:4326","EPSG:3857"],this.strInputDataValues=null,this.strInputEspgInput=null,this.layerLockStatusSubscription=this.interactionsService.editBarActivation.subscribe(a=>{a?this.isEditBarEnabled=!0:(this.isEditBarEnabled=!1,this.disableEditing()),this.cdRef.detectChanges()})}ngOnInit(){this.isEditBarEnabled=!this.layer.locked}ngOnDestroy(){this.disableEditing(),this.layerLockStatusSubscription.unsubscribe()}ngOnChanges(t){}enablingSelectOnlyOnTheCurrentLayer(){this.interactionsService.setSelectableLayer(this.layer.id)}enableSelectingOnAllLayers(){this.interactionsService.setSelectableAllLayers()}disableEditing(t=!0){this.drawHoleHandler(!1),this.drawHandler(!1),this.editHandler(!1),this.translateHandler(!1),t&&this.unSelectFeature()}unSelectFeature(){this.layer.select.getFeatures().clear()}removeFeature(){}translateHandler(t){t?(this.disableEditing(!1),this.translateFeatureEnable()):this.translateFeatureDisable()}editHandler(t){t?(this.disableEditing(!1),this.editFeatureEnable()):this.editFeatureDisable()}drawHandler(t,i=!1){t?(this.disableEditing(!1),this.enablingSelectOnlyOnTheCurrentLayer(),this.addFeatureEnable(i)):(this.addFeatureDisable(),this.enableSelectingOnAllLayers())}drawHoleHandler(t,i=!0){t?(this.disableEditing(!1),this.enablingSelectOnlyOnTheCurrentLayer(),this.addHoleFeatureEnable(i)):(this.addHoleFeatureDisable(),this.enableSelectingOnAllLayers())}translateFeatureEnable(){this.layer.enableTranslating(),this.isMoved=!0}translateFeatureDisable(){this.layer.disableTranslating(),this.isMoved=!1}addFeatureEnable(t=!1){this.layer.enableDrawing(t),this.isDrawn=!0}addFeatureDisable(){this.layer.disableDrawing(),this.isDrawn=!1}editFeatureEnable(){this.layer.enableEditing(),this.isEdited=!0}editFeatureDisable(){this.layer.disableEditing(),this.isEdited=!1}addHoleFeatureEnable(t=!0){this.layer.enableDrawing(t),this.isHole=!0}addHoleFeatureDisable(){this.layer.disableDrawing(),this.isHole=!1}computeShortestPath(t){let i=[];if(this.layer.features().length>0){this.layer.features().forEach(s=>{let l=s.clone().getGeometry();void 0!==l&&("EPSG:4326"!==this.currentEpsg&&(l=l.transform(this.currentEpsg,"EPSG:4326")),i.push(Fe(l)))});const r={dataProjection:"EPSG:4326",featureProjection:this.currentEpsg};this.graphComputingService.getShortestPathFromApi(i,t).subscribe(s=>{const a=Ft(s,r);this.editComputingService.addNewFeatures(a)})}}computeBoundingBox(){this.layer.features().length>0&&this.editComputingService.addNewFeatures(this.layer.exportBoundsPolygon())}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(te),n.Y36(bt),n.Y36(bi),n.Y36(n.sBO))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-edit-bar"]],inputs:{layer:"layer",currentEpsg:"currentEpsg"},features:[n.TTD],decls:7,vars:3,consts:[[1,"d-flex","flex-column","editTools","bg-dark","bg-gradient","p-2","m-2","rounded-3","shadow"],[1,"d-flex","flex-row","justify-content-center","text-warning","m-2"],[1,"fw-bold","me-1"],[1,"fst-italic"],["class","d-flex flex-row m-2",4,"ngIf"],[1,"d-flex","flex-row","m-2"],[1,"d-flex","flex-row","mx-2","align-items-center","shadow","border","rounded","bg-light"],[1,"text-dark","mx-2","fw-bold","small"],[1,"d-flex","flex-row","border-start","rounded-end","p-1"],["type","checkbox",1,"btn-check",3,"id","checked","click"],["btnDraw",""],["triggers","mouseenter:mouseleave",3,"for","ngbPopover"],[1,"btn","btn-outline-success","m-1",3,"ngClass"],[3,"icon"],["btnMove",""],["ngbPopover","D\xe9placer","triggers","mouseenter:mouseleave",3,"for"],[4,"ngIf"],[1,"d-flex","flex-row","align-items-center","border-start","rounded-end","p-1"],["ngbPopover","La bounding box","triggers","mouseenter:mouseleave",1,"btn","btn-outline-success","m-1",3,"click"],["btnEdit",""],["ngbPopover","Editer","triggers","mouseenter:mouseleave",3,"for"],["btnHole",""],["ngbPopover","Ajouter un trou","triggers","mouseenter:mouseleave",3,"for"],[1,"input-group","border","border-success","rounded","mx-1"],["ngbPopover","Plus court chemin","id","btnGroupAddon","triggers","mouseenter:mouseleave",1,"input-group-text","text-success","m-0"],[1,"btn-group"],["ngbPopover","Pi\xe9ton","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-outline-secondary","border-0",3,"click"],["ngbPopover","Motoris\xe9","triggers","mouseenter:mouseleave",1,"btn","btn-sm","btn-outline-secondary","border-0",3,"click"]],template:function(t,i){1&t&&(n.TgZ(0,"div",0)(1,"div",1)(2,"span",2),n._uU(3),n.qZA(),n.TgZ(4,"span",3),n._uU(5),n.qZA()(),n.YNc(6,Li,29,17,"div",4),n.qZA()),2&t&&(n.xp6(3),n.Oqu(i.layer.layerName),n.xp6(2),n.hij("(",i.layer.geomType,")"),n.xp6(1),n.Q6J("ngIf",i.isEditBarEnabled))},dependencies:[P.mk,P.O5,A.BN,J.o8]}),o})();function Si(o,e){if(1&o&&(n.TgZ(0,"div",10),n._UZ(1,"app-edit-bar",11),n.qZA()),2&o){const t=n.oxw();n.xp6(1),n.Q6J("layer",t.currentLayerSelected)("currentEpsg",t.currentEpsg)}}const Ii=[{path:"",component:(()=>{class o{constructor(t,i,r,s,a){this.mapService=t,this.controlerService=i,this.activatedRoute=r,this.interactionsService=s,this.cdRef=a,this.epsgAvailable=["EPSG:4326","EPSG:3857"],this.geoIcon=y.g4A,this.leftSideIcon=y._Wx,this.rightSideIcon=y.ccb,this.layersIcon=y.Krp,this.isLegendDisplayed=!0,this.currentMenuDisplayed="createTools",this.mapSubscription=this.mapService.map.subscribe(l=>{this.map=l,this.currentEpsg=this.map.getView().getProjection().getCode(),this.defaultMapView=this.map.getView()}),this.layerObjectSelectedSubscription=this.interactionsService.layerObjectSelected.subscribe(l=>{l!==this.currentLayerSelected?(this.editBarEnabled=!1,this.cdRef.detectChanges(),this.editBarEnabled=!0):null===l&&(this.editBarEnabled=!1),this.currentLayerSelected=l})}ngOnInit(){this.sendResumeSubMenus(),this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap()}ngOnDestroy(){this.map.setView(this.defaultMapView),this.mapSubscription.unsubscribe(),this.layerObjectSelectedSubscription.unsubscribe(),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(Ee.S),n.Y36(Et.L),n.Y36(Le.gz),n.Y36(te),n.Y36(n.sBO))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-app-layout"]],decls:12,vars:16,consts:[["fluidHeight","","id","sandbox",1,"d-flex","flex-row","position-fixed"],["id","panelsContainer",1,"d-flex","flex-column","bg-light",3,"ngClass"],["id","geoTools",1,"overflow-auto",3,"ngClass","map","currentEpsg","epsgAvailable"],["id","createTools",1,"overflow-auto",3,"ngClass","map","currentEpsg","epsgAvailable"],["id","legendLabels",1,"d-flex","flex-column"],[1,"tool","btn","btn-warning","text-black","my-3","shadow","rounded-end",3,"ngClass","click"],[3,"icon"],[1,"tool","btn","btn-info","text-white","mb-1","shadow","rounded-end",3,"ngClass","click"],["type","button",1,"tool","btn","btn-dark","text-white","mb-1","shadow","rounded-end",3,"ngClass","click"],["class","d-flex flex-row justify-content-center",4,"ngIf"],[1,"d-flex","flex-row","justify-content-center"],["id","editBar",3,"layer","currentEpsg"]],template:function(t,i){1&t&&(n.TgZ(0,"div",0)(1,"div",1),n._UZ(2,"app-geoinfo",2)(3,"app-layer-manager",3),n.qZA(),n.TgZ(4,"div",4)(5,"span",5),n.NdJ("click",function(){return i.showHideLegend()}),n._UZ(6,"fa-icon",6),n.qZA(),n.TgZ(7,"span",7),n.NdJ("click",function(){return i.currentMenuDisplayed="geoTools"}),n._UZ(8,"fa-icon",6),n.qZA(),n.TgZ(9,"span",8),n.NdJ("click",function(){return i.currentMenuDisplayed="createTools"}),n._UZ(10,"fa-icon",6),n.qZA()()(),n.YNc(11,Si,2,2,"div",9)),2&t&&(n.xp6(1),n.Q6J("ngClass",i.isLegendDisplayed?"displayed":"hidden"),n.xp6(1),n.Q6J("ngClass","geoTools"==i.currentMenuDisplayed?"d-block":"d-none")("map",i.map)("currentEpsg",i.currentEpsg)("epsgAvailable",i.epsgAvailable),n.xp6(1),n.Q6J("ngClass","createTools"==i.currentMenuDisplayed?"d-block":"d-none")("map",i.map)("currentEpsg",i.currentEpsg)("epsgAvailable",i.epsgAvailable),n.xp6(2),n.Q6J("ngClass",i.isLegendDisplayed?"selected":""),n.xp6(1),n.Q6J("icon",i.isLegendDisplayed?i.leftSideIcon:i.rightSideIcon),n.xp6(1),n.Q6J("ngClass","geoTools"===i.currentMenuDisplayed?"selected":""),n.xp6(1),n.Q6J("icon",i.geoIcon),n.xp6(1),n.Q6J("ngClass","createTools"===i.currentMenuDisplayed?"selected":""),n.xp6(1),n.Q6J("icon",i.layersIcon),n.xp6(1),n.Q6J("ngIf",i.editBarEnabled&&null!==i.currentLayerSelected))},dependencies:[P.mk,P.O5,A.BN,St,Gt,xi,Ei],styles:["#panelsContainer[_ngcontent-%COMP%]{box-shadow:1em 0 1rem #00000026!important}#panelsContainer.displayed[_ngcontent-%COMP%]{transition:all .3s}#panelsContainer.displayed[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{opacity:1;transition:all .1s}#panelsContainer.hidden[_ngcontent-%COMP%]{transition:all .3s}#panelsContainer.hidden[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{opacity:0;transition:all .1s}@media (max-width: 960px){#panelsContainer.hidden[_ngcontent-%COMP%]{width:3vw}#panelsContainer.displayed[_ngcontent-%COMP%]{width:40vw}}@media (min-width: 960px){#panelsContainer.hidden[_ngcontent-%COMP%]{width:1vw}#panelsContainer.displayed[_ngcontent-%COMP%]{width:18vw}}.tool[_ngcontent-%COMP%]{border-radius:unset;transition:all .1s}.tool.btn[_ngcontent-%COMP%]{width:45px}.tool.btn[_ngcontent-%COMP%]:hover, .tool.btn.selected[_ngcontent-%COMP%]{width:60px}#editBar[_ngcontent-%COMP%]{position:fixed;bottom:0;-webkit-user-select:none;user-select:none}"]}),o})(),data:{title:"Bac \xe0 sable",page:"map-sandbox"},outlet:"map-sandbox"}];let ki=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[Le.Bz.forChild(Ii),Le.Bz]}),o})();var Mi=m(5540);let Zi=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[P.ez,ki,A.uH,J.IJ,D.u5,Mi.o]}),o})()}}]);